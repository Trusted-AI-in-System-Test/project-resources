{
  "title": "PositionSmoothing: fix corner altitude bug",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/22331",
  "body": "### Solved Problem\r\nWe got multiple reports that the altitude profile between two waypoints is not a diagonal line but changes altitude much quicker when leaving the previous waypoint and getting much flatter after that.\r\n\r\nDuring a round corner the L1 distance calculation\r\nwas only done in 2D and the z-axis coordinate\r\nwas directly coming from the next waypoint.\r\nThis lead to an unpredictable altitude profile\r\nbetween two waypoints. Sometimes almost all\r\naltitude difference was already covered during\r\nthe turn instead of going diagonally.\r\n\r\nFixes #{Github issue ID}\r\n\r\n### Solution\r\n- Make the entire L1 distance and intersection calculation 3D\r\n- Refactor ...\r\n\r\n### Changelog Entry\r\n```\r\nBugfix: Multicopter altitude change sometimes not linear between two waypoints\r\n```\r\n\r\n### Test coverage\r\nSimulation testing procedure:\r\n\r\n1. Command to test: `PX4_SIM_SPEED_FACTOR=100 make px4_sitl jmavsim`\r\n1. [Load plan file](https://docs.qgroundcontrol.com/master/en/PlanView/PlanView.html#file) for jMAVsim location through QGC: [rounded_altitude_change.plan](https://github.com/PX4/PX4-Autopilot/files/13283004/rounded_altitude_change.plan.txt)\r\n\r\nI still need to verify the 2D only case with no valid altitude works as expected.\r\n\r\n### Context\r\nBefore: https://logs.px4.io/3d?log=45c8f43e-32e7-4c7f-ab30-975e1c8aa32b\r\n![image](https://github.com/PX4/PX4-Autopilot/assets/4668506/d7da8173-9016-48f8-ada5-49fb1e6c2d25)\r\nAfter: https://logs.px4.io/3d?log=17dd1c3e-bd5e-46b0-abad-3bba6c517e2f\r\n![image](https://github.com/PX4/PX4-Autopilot/assets/4668506/e161ac7a-5966-4623-97f1-47192f13683c)\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/22331",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/22331",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/22331.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/22331.patch",
    "merged_at": "2023-11-10T09:02:20Z"
  }
}
{
  "title": "EKF2: Only fuse fake yaw when really needed",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20840",
  "body": "<!--\r\n\r\nThank you for your contribution!\r\n\r\nGet early feedback through\r\n- Dronecode Discord: https://discord.gg/dronecode\r\n- PX4 Discuss: http://discuss.px4.io/\r\n- opening a draft pr and sharing the link\r\n\r\n-->\r\n\r\n### Solved Problem\r\nWhen not using a mag (e.g.: after yaw emergency or mag type \"none\"), a yaw error isn't properly corrected even in presence of a large acceleration an a GNSS observation.\r\n\r\n### Solution\r\nConstantly fusing a zero yaw innovation makes the filter too confident about its yaw estimate and doesn't correct itself anymore. The proposed solution is to only fuse a fake yaw measurement when the yaw variance of the estimator is too large (i.e.: larger than its initialization value).\r\n\r\nOther changes:\r\n- do not run the mag selection/reset/fusion logic when the mag is inhibited\r\n- stop the mag fusion when the mag is constantly inhibited, this prevents having the mag fusion flag set while the fusion is not occurring for a long time.\r\n\r\n### Test coverage\r\nSITL test: mag type none, takeoff in alt mode, move to init yaw. After a couple of seconds, change the gyro bias to 0.1 rad/s\r\n\r\nbefore:\r\nThe gyro bias takes time to estimate and during that time, the drone makes a violent toilet bowl spiral. It ends up stopping navigation and falls back to alt mode after 2 yaw resets.\r\nhttps://logs.px4.io/plot_app?log=9619a774-677a-43e3-96c7-6dc710d1828e\r\n![DeepinScreenshot_select-area_20221229172559](https://user-images.githubusercontent.com/14822839/209981336-b4934b10-fb4b-41fa-97a1-82944e3819eb.png)\r\n\r\nthis PR:\r\nhttps://logs.px4.io/plot_app?log=e8694d1e-8798-4734-89fb-fd7e663bdfd5\r\nThe gyro bias is learned rapidly and a slight toilet bowl is enough to correct the yaw estimate properly.\r\n![DeepinScreenshot_select-area_20221229170529](https://user-images.githubusercontent.com/14822839/209981905-c5c5cdc0-7109-42d3-aaf9-4b54d37d02a0.png)\r\n\r\n\r\n- unit tests for the mag inhibition\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/20840",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20840",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/20840.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/20840.patch",
    "merged_at": "2022-12-29T17:56:37Z"
  }
}
{
  "title": "ekf2: reinit baro height on sensor or calibration change",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20818",
  "body": " - handle reset on delayed time horizon\r\n - avoid unnecessary preflight failures due to initial primary baro change (eg external DroneCAN barometer starting later than internal)\r\n\r\nhttps://review.px4.io/plot_app?log=0afe68b4-721d-4827-bf18-57c8f267592d\r\n![Screenshot from 2022-12-21 17-19-25](https://user-images.githubusercontent.com/84712/209013340-60b324c5-f6e1-4b36-8bc8-920140f2d747.png)\r\n\r\n![Screenshot from 2022-12-21 17-20-40](https://user-images.githubusercontent.com/84712/209013494-fd681f7d-af88-458f-927c-49dd50fc9ac7.png)\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/20818",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20818",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/20818.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/20818.patch",
    "merged_at": "2022-12-29T21:37:34Z"
  }
}
{
  "title": "Fix invalid offboard setpoints for fw pos control",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20669",
  "body": "### Solved Problem\r\nThis commit fixes a regression that caused problems when trying to use offboard control with fixedwings (or VTOLs in fixedwing mode)\r\n\r\nThe problem was that all offboard setpoints were considered invalid in offboard mode:\r\n![image](https://user-images.githubusercontent.com/5248102/203829851-55e1195d-9498-44be-aa6e-1e67db5f7ae5.png)\r\n![image](https://user-images.githubusercontent.com/5248102/203829872-ccfb20a0-c004-4592-bbfe-f7160d51c7bd.png)\r\n\r\n### Solution\r\nThis was a regression introduced by https://github.com/PX4/PX4-Autopilot/pull/19942, where the valid flag in position_setpoint_triplet was no longer being used and the offboard logic was left out.\r\n\r\n### Test coverage\r\nTested in SITL Gazebo and publishing offboard setpoints\r\n- Flight logs before PR: https://review.px4.io/plot_app?log=b46b490c-69f8-4fe1-a47f-b16fc6ab8b54\r\n- Flight logs after PR: https://review.px4.io/plot_app?log=ced912ac-1b8d-427e-8829-90337d208482\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/20669",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20669",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/20669.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/20669.patch",
    "merged_at": "2022-11-30T08:14:58Z"
  }
}
{
  "title": "Broken Loiter: loitering at wrong position, erratic loiter direction",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/20477",
  "body": "## Describe the bug\r\nThe drone sometimes loiters around a wrong position and doesn't respect NAV_LOITER_RAD nor the desired turning direction.\r\n\r\nI've observed it regularly on SITL VTOLs, and I could also break it once on a SITL plane. On VTOLs it's always the first HOLD command after a transition in mission mode which fucks up. The drone either holds around Home or at next Waypoint, but not at current position as it's supposed to. Resuming mission and then triggering Hold again works fine. Even the Hold in MC mode is affected by this, if triggered after a back transition.\r\n\r\nOn a pure FW drone I don't know what it takes to break, but it's possible as well. I've had one occurrence where the drone flew to the next WP instead of Loitering at current position.\r\n\r\nAlso, if this happens, then the NAV_LOITER_RAD is ignored and the drone is just flying with max bank angle. \r\n\r\nThe bug is present in both v1.13 and current main.\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\n1. `make px4_sitl gazebo_standard_vtol`\r\n2. Upload a mission containing a transition, e.g. the one here: \r\n[Zurich FT loiter bug.zip](https://github.com/PX4/PX4-Autopilot/files/9858850/Zurich.FT.loiter.bug.zip)\r\n3. Launch the mission. Trigger Hold at some point after the front transition.\r\n4. See error\r\n5. Feel free to resume mission, trigger Hold again, and observe that it works correctly again. Then resume mission, launch a back transition via QGC interface, and Hold again -> broken again.\r\n\r\n## Expected behavior\r\nThe drone should loiter around the point where the HOLD command was sent.\r\n\r\n## Log Files and Screenshots\r\nLog on v1.13 (roughly, our fork contains some minor changes but nothing which affects this) where the drone more or less returns home for Loiter : https://logs.px4.io/plot_app?log=f24d5c4e-b495-4d9b-93dc-b6e321beda15\r\n\r\nLog on upstream where I consistently managed to break the logic after transitioning, even after back transitions : https://logs.px4.io/plot_app?log=4e307d13-c94a-4543-a625-3e54d88ae0b9\r\n\r\nLog on upstream with tailsitter. Same behaviour as with standard VTOL: https://logs.px4.io/plot_app?log=f1441279-1e2f-42e1-8599-b17ff4881f19\r\n\r\nLog on upstream on a FW plane where I managed once (on the second trigger) to break the logic, but not the first time nor any time after: https://logs.px4.io/plot_app?log=683f7ffa-58c3-4860-ae32-debca6c1433e\r\n\r\nLog on upstream on a MC drone where I couldn't break it (not sure if nothing is broken for MC or if I just haven't found how to break it): https://logs.px4.io/plot_app?log=d2fafa11-a5fa-4bed-a6ed-108749353267\r\n\r\nAdd screenshots to help explain your problem.\r\n![position_controller_status type](https://user-images.githubusercontent.com/48206725/197734350-158a8591-dcf8-42ae-8ea3-f3d4035fe66e.png)\r\nI've found so far that during the Loiter which goes badly the position_controller_status/type stays at 0 instead of being the usual 2.\r\n\r\n## Drone (please complete the following information):\r\nI haven't dared to check on a real drone yet. The following SITL models have so far found to be affected:\r\n- gazebo_standard_vtol\r\n- gazebo_tailsitter\r\n- gazebo_plane\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Navigator: fix init of _mission_item, plus add guards for using mision_item.loiter_radius",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20464",
  "body": "\r\n## Describe problem solved by this pull request\r\nThis is to address what was reported here: https://github.com/PX4/PX4-Autopilot/pull/19928#issuecomment-1277934841\r\n\r\nWhat I think was going on:\r\n- RTL triggered a couple of times, and each time it was above the return altitude, so didnâ€™t have to climb. In the v1.13 RTL logic, as pointed out [here](https://github.com/PX4/PX4-Autopilot/pull/19928#issuecomment-1284454859), the mission_item.loiter_radius field wasn't filled, and it just kept using it as initialized. \r\n- The initialization happens in the constructor, and it initializes it to `_navigator->get_loiter_radius()`, which itself just gets the value of `_param_nav_loiter_rad`. At this moment, the params are though not yet fetched (happens [here](https://github.com/PX4/PX4-Autopilot/blob/c267cf71c3aa57fbbe544d02f3b25650f029384d/src/modules/navigator/navigator_main.cpp#L151))\r\n- in the [flight](https://review.px4.io/plot_app?log=4a466655-3c02-4f78-ab9e-1d90bca4b8e3) linked in the above mentioned issue , the initialisation value of it seems to have been 3.9e32, which was then passed through to the `position_setpoint_current.loiter_radius` (there is only a check for if(>0)), and the vehicle started on it's voyage around the solar system\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/26798987/197223431-d4a5a3c5-33ee-4655-8974-32d73cfc8abb.png)\r\n\r\n\r\n## Describe your solution\r\nOn current main we by accident fixed this particular issue already,[ as we explicitly set the loiter_radius](https://github.com/PX4/PX4-Autopilot/blob/ed558e199faab703ea3fb352db16512981fdb7ec/src/modules/navigator/rtl.cpp#L407) in every state of the RTL state machine. This wasn't the case in v1.13, but I guess we should back port it.\r\nAdditionally we should change the initialization of mission_item. I propose here to initialize to 0, which is considered as \"invalid\" before and not used in then (checks for ISFINITE and >FLT_EPS). \r\nI did the same for mission_item.acceptance_radius. \r\n\r\n## Describe possible alternatives\r\n- do we have a way to update the params before the constructor is called?\r\n- should we initialize `mission_item` fields consistently to NAN instead of some to NAN (currently yaw, lat, lon), and some to 0, and some not at all (e.g. altitude). And is this initialization in the constructor even needed?\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/20464",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/20464",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/20464.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/20464.patch",
    "merged_at": "2022-10-27T08:28:05Z"
  }
}
{
  "title": "Fixedwing RTL failsafe makes the vehicle crash right after takeoff",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/20260",
  "body": "## Describe the bug\r\nWhen running takeoff in SITL without QGC running, the plane immediately goes into failsafe, goes into RTL and then crases\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior: (Make sure no QGC is running)\r\n1. Start plane SITL simulation\r\n```\r\nmake px4_sitl gazebo_plane\r\n```\r\n2. Command takeoff\r\n```\r\ncommander takeoff\r\n```\r\n\r\n## Expected behavior\r\n- Vehicle should either takes off or rejects the takeoff command\r\n\r\n## Log Files and Screenshots\r\n![plane_bug](https://user-images.githubusercontent.com/5248102/191316218-3a925953-5b73-4fca-82e9-a51dd60b0ded.gif)\r\n- Flight log: https://review.px4.io/plot_app?log=0314e693-cb1e-4675-a7ef-bad36473a129\r\n- Log:\r\n```\r\npxh> commander takeoff\r\npxh> INFO  [commander] Armed by internal command\t\r\nINFO  [tone_alarm] arming warning\r\nINFO  [navigator] Using minimum takeoff altitude: 30.00 m\t\r\nINFO  [fw_pos_control_l1] Takeoff on runway\t\r\nINFO  [commander] Takeoff detected\t\r\nWARN  [commander] Failsafe enabled: no datalink\t\r\nINFO  [commander] Failsafe mode activated\t\r\nINFO  [tone_alarm] battery warning (fast)\r\nINFO  [navigator] RTL: landing at home position.\t\r\nINFO  [navigator] RTL: climb to 589 m (100 m above destination)\t\r\nINFO  [commander] Failsafe mode deactivated\t\r\nWARN  [health_and_arming_checks] Preflight Fail: velocity estimate error\r\nERROR [commander] Critical failure detected: lockdown\t\r\nWARN  [commander] Motor failure detected\t\r\nWARN  [health_and_arming_checks] Preflight Fail: velocity estimate error\r\n```\r\n\r\n## Additional context\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix busy loop in gps module when using RTCM",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19906",
  "body": "Please use [PX4 Discuss](http://discuss.px4.io/) or [Slack](http://slack.px4.io/) to align on pull requests if necessary. You can then open draft pull requests to get early feedback.\r\n\r\n## Describe problem solved by this pull request\r\nRTCM data message length was increased to 300 bytes without changing data type of integer holding the length.\r\nThis caused an overflow which lead to a busy loop in the gps driver.\r\n\r\n## Describe your solution\r\nUse a uint16.\r\n\r\n## Describe possible alternatives\r\nA clear and concise description of alternative solutions or features you've considered.\r\n\r\n## Test data / coverage\r\nHow was it tested? What cases were covered? Logs uploaded to https://review.px4.io/ and screenshots of the important plot parts.\r\n\r\n## Additional context\r\nAdd any other related context or media.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/19906",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19906",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/19906.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/19906.patch",
    "merged_at": "2022-07-13T05:49:47Z"
  }
}
{
  "title": "Issue with heading estimation",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19846",
  "body": "We are developing a drone with the PX4 firmware, running on a holybro V5x FCU.\r\n\r\nWe have run into an issue which we can't understand within the team, so I am hoping for someone to help us.\r\nThe issue has happened in multiple flights, but can be easiest seen in the following flight log: \r\n[log](https://review.px4.io/plot_app?log=9d997dff-c93e-4d6b-a257-8a581f824e0a)\r\n\r\nThe heading estimate is very unstable (a jump of >90 degrees at the 1:12 mark), after which the drone is almost uncontrollable, since all orientations are messed up. This has started happening repeatedly, but we have also made more than 10 flights before where the issue did not arise.\r\n\r\nI have noticed that the EKFs are also using the internal magnetometer, while it is set at a lower priority and the external magnetometer does produce data.\r\n\r\nIf anyone can assist (even if only giving some pointers on how to analyse this issue) that'd be greatly appreciated.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "v1.13.0-beta1 UAVCAN Battery Can't Take Off Due to RTL Time Estimate",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19642",
  "body": "I am unable to take off on v1.13.0-beta1 using a uavcan battery in any mode. As soon as I start throttling up, it throws a \"Remaining flight time low, returning to land\" error and switches into RTL.\r\n\r\nhttps://review.px4.io/plot_app?log=761b3a20-94ae-43d9-aba3-1205751f58ce\r\nhttps://review.px4.io/plot_app?log=25386252-9972-4f8f-bac0-716c54559f68\r\n\r\nBeta on a different non uavcan battery drone. ARK GPS + ARK Flow flies well.\r\nhttps://review.px4.io/plot_app?log=3618593a-4485-4606-9236-2316af742a07\r\n\r\nComparing the two, in the failure case, the RTL Time Estimate values are very low, below 100. But in the working case, the values are in the 1000000's.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "icm20649 glitches at low IMU_GYRO_RATEMAX on fmu-v5x on v1.12.3",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19134",
  "body": "**Describe the bug**\r\nICM-20649 IMU measurements (both accel and gyro) contain several glitches when `IMU_GYRO_RATEMAX` is set to 250 Hz on v1.12.3 (fmu-v5x).\r\nThe issue does not show up when `IMU_GYRO_RATEMAX` is set to larger values (e.g. with 400 Hz there is no issue).\r\n\r\n**To Reproduce**\r\n* Flash v1.12.3 stable\r\n* From QGC reset parameters to default\r\n* Set `IMU_GYRO_RATEMAX` to 250 Hz\r\n* Reboot\r\n* From the nsh console run `icm20649 status`. Several errors show up.\r\n* Log `sensor_gyro_0` and `sensor_accel_0` for a minute. Check that glitches appear on both gyro and accel (with the autopilot fixed on ground).\r\n\r\n```\r\nnsh> icm20649 status\r\nINFO  [SPI_I2C] Running on SPI Bus 3\r\nINFO  [icm20649] FIFO empty interval: 3555 us (281.3 Hz)\r\nicm20649: bad register: 0 events\r\nicm20649: bad transfer: 62 events\r\nicm20649: FIFO empty: 0 events\r\nicm20649: FIFO overflow: 5871 events\r\nicm20649: FIFO reset: 5872 events\r\nicm20649: DRDY missed: 0 events\r\n```\r\n\r\n**Expected behavior**\r\nThe IMU measurements are expected to contain no glitches/discontinuities. It is expected that running `icm20649 status` shows no errors. The gyros should read (0,0,0) and accels should read constant (0,0,-g) when fixed on ground.\r\n\r\n**Log Files and Screenshots**\r\n\r\nlog at `IMU_GYRO_RATEMAX` 250: glitches show up on gyros and accels\r\nhttps://logs.px4.io/plot_app?log=64ffb368-d808-4687-b811-7b74288e1183\r\n\r\nlog at `IMU_GYRO_RATEMAX` 400: no glitches show up\r\nhttps://logs.px4.io/plot_app?log=ae0a092a-7756-4e00-b394-129a18e8679c\r\n\r\nScreenshots in the case of `IMU_GYRO_RATEMAX` 250: the glitches are evident even in the logfile:\r\n\r\n![gyro_IMU_GYRO_RATEMAX_250](https://user-images.githubusercontent.com/24300565/152633248-856abf12-dab9-4f69-8294-90e09cffefd6.png)\r\n\r\n![accel_IMU_GYRO_RATEMAX_250](https://user-images.githubusercontent.com/24300565/152633252-204574bf-a8f0-41b8-89a0-e79acea73755.png)\r\n\r\n**Autopilot hardware:** Holybro Pixhawk 5X (fmu-v5x)\r\nhttps://docs.px4.io/master/en/flight_controller/pixhawk5x.html\r\n\r\nIMUs:\r\n* Accel/Gyro: ICM-20649\r\n* Accel/Gyro: ICM-42688P\r\n* Accel/Gyro: ICM-20602\r\n\r\n**Additional context**\r\nOther IMUs mounted on Pixhawk 5X (ICM-42688P and ICM-20602) are not subject to the issue.\r\n\r\n```\r\nnsh> icm42688p status\r\nINFO  [SPI_I2C] Running on SPI Bus 2\r\nINFO  [icm42688p] FIFO empty interval: 4000 us (250.0 Hz)\r\nicm42688p: bad register: 0 events\r\nicm42688p: bad transfer: 0 events\r\nicm42688p: FIFO empty: 0 events\r\nicm42688p: FIFO overflow: 0 events\r\nicm42688p: FIFO reset: 1 events\r\nicm42688p: DRDY missed: 0 events\r\n\r\nnsh> icm20602 status\r\nINFO  [SPI_I2C] Running on SPI Bus 1\r\nINFO  [icm20602] FIFO empty interval: 4000 us (250.0 Hz)\r\nicm20602: bad register: 0 events\r\nicm20602: bad transfer: 0 events\r\nicm20602: FIFO empty: 0 events\r\nicm20602: FIFO overflow: 0 events\r\nicm20602: FIFO reset: 1 events\r\nicm20602: DRDY missed: 0 events\r\n```\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "X500V2 kit Jumps when switching to AltHold",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19046",
  "body": "After trying to fly with the Holybro X500 V2 kit which flies well with Stabilized mode, I noticed that the drone jumps up and down when switching to Altitude mode. The kit is equipped with Pixhawk 5X. A log is also as below:\r\n\r\nhttps://review.px4.io/plot_app?log=21beb351-f2bb-4767-b71f-725946098ec0\r\n\r\nI found something which might be relevant [here](https://github.com/PX4/PX4-Autopilot/issues/11717) but not sure if it is the case!!! \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fixed-wing landing consistently veering off to right",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18595",
  "body": "**Describe the bug**\r\n(Presumably this is user error and not a real bug, but I was asked to create an issue so I'll try to follow the template.)\r\n\r\nThe aircraft tracks the planned path quite well until approximately when it exits the landing loiter for the final approach. At this point, it seems to make a turn to the right and then land on this new path.\r\n\r\nI would like to understand why this occurs and ideally how I can correct it.\r\n\r\n**To Reproduce**\r\nSee logs below. We're flying entirely in mission mode (with the exception of noted aborted landings).\r\n\r\n**Expected behavior**\r\nI expected the plane to track the planned landing direction, heading on a path towards the landing waypoint.\r\n\r\n**Log Files and Screenshots**\r\n\r\nOriginal example: https://logs.px4.io/plot_app?log=eea3a1e0-be68-470d-98ab-3730bf357679\r\n![image](https://user-images.githubusercontent.com/1906581/140832721-156a392e-96fd-4bf6-b152-4d1b7b5644b3.png)\r\nThe divergence can be seen quite clearly in the above PX4 screenshot.\r\nFlight plan: [nov3-flight3.plan.txt](https://github.com/PX4/PX4-Autopilot/files/7500669/nov3-flight3.plan.txt)\r\n\r\nLooking at the yaw angle plot for this one, it looks to me like the plane is lagging behind the set point consistently until suddenly the set point is updated to approximately the current estimated yaw. \r\n![image](https://user-images.githubusercontent.com/1906581/140833088-c69982b5-ab96-45bd-9f82-d939b51459c9.png)\r\n\r\nAnother example from this morning: https://logs.px4.io/plot_app?log=63428e7b-2bd6-490b-9d14-e347effb02a4\r\nThis one I had `FW_LND_HHDIST` set to 0.\r\nThere are two landing attempts on this one. The first showed the same behavior of veering off to the right and was going to miss our landing area entirely, so I switched to position control mode and we put it up in a hold. We uploaded a new plan with the landing pattern shifted significantly to the west and let it land on that one. Probably easier to decipher what's happening on the first log.\r\n\r\n**Drone (please complete the following information):**\r\nX-UAV Talon (the 1.7 m wingspan one -- not the mini or pro)\r\nAutopilot hardware is a Pixhawk 4 mini with the GPS puck and a Lidar Lite v3.\r\nMounting of GPS puck and autopilot are as shown below:\r\n![image](https://user-images.githubusercontent.com/1906581/140833310-7a93007f-05cf-4e58-97a0-d8f6eb77593e.png)\r\n![image](https://user-images.githubusercontent.com/1906581/140833427-8a173f63-d96b-4eac-98cc-b4bfb9695d7c.png)\r\n(You can ignore the extra wires in the second picture - they were for some ground testing.)\r\n\r\nBoth are oriented in their normal direction.\r\n\r\nI haven't done any tuning for this platform. I'm just flying it on the X-UAV Mini Talon profile, which seems to be plenty good enough to get it to fly, however I think it's quite clear from the logs that some of the control loops could be better tuned.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Enable offboard actuator setpoints",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18581",
  "body": "**Describe problem solved by this pull request**\r\nSending actuator setpoints directly from a onboard computer provides a useful way to execute open loop manuevers which is useful for system identification.\r\n\r\nWhile previous to https://github.com/PX4/PX4-Autopilot/pull/16739  it was possible to send actuator commands using the `https://mavlink.io/en/messages/common.html#SET_ACTUATOR_CONTROL_TARGET` mavlink message, this is no longer working since it is not understood as a valid offboard mode.\r\n\r\n**Describe your solution**\r\nThis commit adds a case for adding offboard actuator commands in the offboard mode\r\n\r\n**Test data / coverage**\r\nTested with Gazebo SITL no lockstep target\r\n```\r\nmake px4_sitl_nolockstep gazebo\r\n```\r\n\r\nAs can be observed in the log, actuator setpoint to elevator (output 7) is increased as a ramp function\r\nFlight log: https://logs.px4.io/plot_app?log=15a16288-d153-467e-8ab2-9303bb855d35\r\n\r\n\r\n**Additional context**\r\n- This is fixes a regression from https://github.com/PX4/PX4-Autopilot/pull/16739 ",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18581",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18581",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18581.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18581.patch",
    "merged_at": "2021-11-07T20:38:42Z"
  }
}
{
  "title": "Handle setpoint types properly in fw position controller",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18578",
  "body": "**Describe problem solved by this pull request**\r\nFixes https://github.com/PX4/PX4-Autopilot/issues/18576\r\n\r\nWhile the FW position controller mode was changing, the throttle was not changing accordingly\r\n\r\nThis seems to be a regression introduced by https://github.com/PX4/PX4-Autopilot/pull/18340\r\n\r\n**Test data / coverage**\r\n- Before PR: https://logs.px4.io/plot_app?log=4f360063-83eb-43bd-81f1-0749f89a9e4e\r\n- After PR: https://logs.px4.io/plot_app?log=15f471bd-2a86-4855-9206-ce111cd0b393\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18578",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18578",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18578.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18578.patch",
    "merged_at": "2021-11-08T00:21:00Z"
  }
}
{
  "title": "Corner case with takeoff waypoint acceptance radius",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18576",
  "body": "**Describe the bug**\r\nThere seems to be a corner case where if the vehicle is unable to get close enough to the takeoff waypoint (due to high winds), the vehicle will never use TECS pitch setpoints resulting in a crash.\r\n\r\n- TECS pitch setpoints are not used in takeoff flight mode\r\n\r\nhttps://github.com/PX4/PX4-Autopilot/blob/f492fa9d3ab5a1e7b105594a1f637bd6a22bfad4/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L873-L882\r\n\r\n- If the vehicle is not close enough to the takeoff waypoint, it will continue to stay in takeoff mode therefore not use the pitch setpoint from TECS\r\n\r\nhttps://github.com/PX4/PX4-Autopilot/blob/f492fa9d3ab5a1e7b105594a1f637bd6a22bfad4/src/modules/navigator/mission_block.cpp#L184-L190\r\n\r\nHowever, the throttle is set from TECS: https://github.com/PX4/PX4-Autopilot/blob/f492fa9d3ab5a1e7b105594a1f637bd6a22bfad4/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L864\r\n\r\n- This results in the airspeed getting invalidated and results in a crash\r\n```\r\n WARN  [airspeed_selector] Airspeed sensor failure detected. Return to launch (RTL) is advised.\r\n```\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run SITL Plane in a windy environment (set wind speed to 14m/s)\r\n```\r\nmake px4_sitl gazebo_plane__windy\r\n```\r\n2. Uploaded mission with a takeoff waypoint up wind\r\n\r\n\r\n**Log Files and Screenshots**\r\nTest condition: windspeed 14m/s, takeoff waypoint is up wind\r\n- Flight log: https://logs.px4.io/plot_app?log=4f360063-83eb-43bd-81f1-0749f89a9e4e\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ekf: force fallback to baro if GPS is stopped while in GPS height mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18458",
  "body": "Otherwise, no height aiding source is used.\r\n\r\nfixes https://px4.slack.com/archives/C0V533X4N/p1634539666104800\r\nlog with issue: https://review.px4.io/plot_app?log=56a6fb8b-b804-4a50-974b-3f88d04c2cbe",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18458",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18458",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18458.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18458.patch",
    "merged_at": "2021-10-26T08:05:29Z"
  }
}
{
  "title": "Bug Found in msgID #147 mavlink protocol OOB",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18385",
  "body": "Steps to reproduce the behavior:\r\n-----------------------------------------------------------------------------------------\r\n1. Turn the drone on\r\n2. Prepare many MAVLINKs with msgID 147 with different \"sysID\" and \"compID\".\r\n3. send a packet\r\n4. Out Of Bound (OOB) vuln occur\r\n5. Turn the drone off\r\n\r\n**Describe the bug**\r\n-----------------------------------------------------------------------------------------\r\nThe method we tested sets MAVLINK's msgID to 147, compID and sysID to random, and sends a packet.\r\n\r\nThe source code part where the problem occurs is 1733 code line ~ 1736 code line and 1733 code line of the site below.\r\n\r\nThe reason for the problem is that MAVLINK packets with different compID and sysID operate the target handler function and\r\nWhen the \"cell_count++\" part is calculated at a specific timing, \"cell_count\" becomes greater than 10 and goes out of the range of the \"battery_mavlink.voltages[cell_count]\" array (the size of the array is 10).\r\n\r\nI found it in sitl mode and also checked it on the drone board.\r\n\r\n\r\nsource code\r\n-----------------------------------------------------------------------------------------\r\nhttps://github.com/PX4/PX4-Autopilot/blob/master/src/modules/mavlink/mavlink_receiver.cpp\r\n\r\nPX4-Autopilot/src/modules/mavlink/mavlink_receiver.cpp (line 1733 ~ line 1737, The line of code where the problem occurs is 1733. )\r\n\r\n\r\nTEST board\r\n-----------------------------------------------------------------------------------------\r\npx4_fmu-v5\r\nnxp_fmuk66-v3\r\n\r\n\r\nlog file page\r\n-----------------------------------------------------------------------------------------\r\nhttps://logs.px4.io/plot_app?log=0f0583c3-a609-4b61-a283-6e3df243141c\r\n\r\n\r\nscreen shot\r\n-----------------------------------------------------------------------------------------\r\n![image](https://user-images.githubusercontent.com/91944211/136547203-1b51b617-1aca-4759-bff8-28ea9eeb46c5.png)\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Catapult launch: Motor delay not working",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18354",
  "body": "PX4 (SW 1.12.3 / HW holibro pixhawk 4)\r\nThe Motor starts immedialtely after launch is detected.\r\nThis causes damage to the propeller, because it hits the catapult.\r\n**Actual behaviour:**\r\nIf Accelerometer threshold > LAUN_CAT_A    then  Motor starts immediately\r\n**Expected behaviour:**\r\nIf Accelerometer threshold > LAUN_CAT_A    then  Motorstart is delayed by value of LAUN_CATMDEL  waits then motors starts.\r\n\r\nParameters: LAUN_CAT_MDEL and LAUN_CAT_T have no effect. Motor startup is not delayed as expected.\r\nhttps://review.px4.io/plot_app?log=e1c738f7-7be6-4f54-9af0-c12667ef83d9\r\nThis was working in 1.9.1\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL Fix back transition devaitions",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18350",
  "body": "**Describe problem solved by this pull request**\r\nI found a bug with back transitions that was introduced with I think https://github.com/PX4/PX4-Autopilot/pull/16499. \r\n\r\nIf you set the next WP after the back transition to a different altitude the drone can enter a \"spiralling down\" mode (set here: https://github.com/PX4/PX4-Autopilot/blob/master/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L842-L850). This can lead to unexpected deviations during back transitions. And as the altitude is ultimately controlled (fix) by the MC module the spiralling down doesn't actually spiral down anyway... Also note that if you have a small value on FW_CLMBOUT_DIFF you can be affected even when the next WP is at the same altitude if the drone gets a lot of altitude during back transition due to pitching up.\r\n\r\n**Describe your solution**\r\nDeactivate the loitering logic during transitions. \r\n\r\n**Describe possible alternatives**\r\n\\-\r\n\r\n**Test data / coverage**\r\nFound on two different real quadplanes, and I was able to reproduce it on SITL.\r\n\r\nReal flight on v1.12.1: https://logs.px4.io/plot_app?log=2f6a1c96-eabb-4576-abb1-a99b716f6c67\r\n\r\nSITL tests with attached mission file [test BT deviations.zip](https://github.com/PX4/PX4-Autopilot/files/7279541/test.BT.deviations.zip):\r\n\r\nmaster, FW_AIRSPD_TRIM = 19, FW_L1_PERIOD = 25 and NAV_LOITER_RAD = 50: https://logs.px4.io/plot_app?log=79cadeb1-27bc-4c4c-88c4-7ded26c0a430\r\n\r\nmaster, default parameters: https://logs.px4.io/plot_app?log=6c1b368b-a435-4868-a856-159d68da926c\r\nInterestingly there is no deviation even though the logic still triggers. I don't understand why the deviation doesn't happen on default parameters, must be something particular with the FW loitering logic. Check `position_controller_status.type`, it goes to 2, showing that the loitering logic is triggered.\r\n\r\nThis PR: https://logs.px4.io/plot_app?log=ef558a1a-2c2c-461f-a781-645a3ad2e121 \r\n`position_controller_status.type` = 0 throughout, no deviation.\r\n\r\n**Additional context**\r\nUnfortunately _not_ linked to https://github.com/PX4/PX4-Autopilot/issues/18240",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18350",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18350",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18350.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18350.patch",
    "merged_at": "2021-10-05T12:40:14Z"
  }
}
{
  "title": "RTL going to wrong Landing location",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18271",
  "body": "**Describe the bug**\r\nWith RTL_TYPE = 3 and RTL_TYPE = 1 the drone always flies to mission landing to land even if it's by far not the closest point. To be precise, it first flies to the correct RTL position but then instead of descending to RTL_DESCEND_ALT it flies to mission landing to land there...\r\n\r\nMore technically: \r\nThe phase corresponding to \"RTL: return at 548 m (60 m above destination)\" is correct. But as soon as it goes into \"RTL: descend to 518 m (30 m above destination)\" then it flies to the wrong position.\r\n\r\n**To Reproduce**\r\nReproducible on SITL on v1.12 and master. \r\nTested with `make px4_sitl gazebo_standard_vtol` and the following mission: \r\n[bad RTL.zip](https://github.com/PX4/PX4-Autopilot/files/7204594/bad.RTL.zip)\r\n\r\nTrigger RTL when it's closer to home or RP than it is to mission land and observe the bug.\r\n\r\n**Expected behavior**\r\nThe drone should land at the closest safe point (home, rallypoint) according to the parameter description and not land and mission landing which might be very far away.\r\n\r\n**Log Files and Screenshots**\r\nv1.12, RTL_TYPE = 3 : https://logs.px4.io/plot_app?log=98b92060-e3e4-4a81-afcc-16a9dc8315e0\r\nmaster, RTL_TYPE = 3: https://logs.px4.io/plot_app?log=a5edc70d-8be0-424f-98dc-0c96f8d31c16\r\nmaster, RTL_TYPE = 1: https://logs.px4.io/plot_app?log=9f6e48ee-6b5b-4b2c-83df-3a8de754352d\r\n\r\nFor reference, here is what it should look like: (RTL_TYPE = 0)\r\nhttps://logs.px4.io/plot_app?log=dbb7f55f-6038-41c1-b009-bbd39c177af7 (I don't like the loitering down, but that's another point)\r\n\r\n**Additional context**\r\nPotentially linked to changes in https://github.com/PX4/PX4-Autopilot/pull/16377 ? I haven't had time to investigate yet. @sfuhrer @RomanBapst \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix srf05 driver.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18262",
  "body": "Please use [PX4 Discuss](http://discuss.px4.io/) or [Slack](http://slack.px4.io/) to align on pull requests if necessary. You can then open draft pull requests to get early feedback.\r\n\r\n**Describe problem solved by this pull request**\r\nA clear and concise description of the problem this proposed change will solve.\r\nE.g. For this use case I ran into...\r\n\r\n**Describe your solution**\r\nA clear and concise description of what you have implemented.\r\n\r\n**Describe possible alternatives**\r\nA clear and concise description of alternative solutions or features you've considered.\r\n\r\n**Test data / coverage**\r\nHow was it tested? What cases were covered? Logs uploaded to https://review.px4.io/ and screenshots of the important plot parts.\r\n\r\n**Additional context**\r\nAdd any other related context or media.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18262",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18262",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18262.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18262.patch",
    "merged_at": "2021-10-19T01:00:59Z"
  }
}
{
  "title": "Consistently bad magnetometer calibration on 1.12",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18041",
  "body": "We repeatedly get bad magnetometer calibration results on 1.12: after aircraft rotation yaw drifts. See https://logs.px4.io/plot_app?log=13194004-cc98-49e9-80d2-e1e1aa7196f7 for example. On magnetometer raw data and gyro data plots there are very clear time ranges, when actual rotation happens, but yaw plot demonstrates drift outside of them. Also yaw check bit is 1 in estimator watchdog.\r\n\r\nIt isn't a hardware issue, because when we switch back to 1.13 firmware we get good results: https://logs.px4.io/plot_app?log=d4f79fd4-1623-43ad-baa6-bd748f4a1e2e.\r\n\r\nWe have also recorded log on 1.12 with SENS_BOARD_ROT=0 to check if this relates to problem, still getting drift: https://logs.px4.io/plot_app?log=3760a163-3aa2-48f0-84f5-afdacd6dd3b4.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix flaps being deployed in manual flight modes for fixedwing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18035",
  "body": "**Describe problem solved by this pull request**\r\nFor fixedwings, there were different flap scalings deployed between auto modes and manual flight modes, resulting in the flaps always being deployed halfway in manual flight modes.\r\n\r\n- In manual flight modes(stabilized, manual), zero flap input was mapped to flap command 0.5\r\n- In auto modes(mission, hold), zero flap command was mapped to flap command 0.0\r\n\r\n**Describe your solution**\r\nThis PR removes the special scaling in manual flight modes, so that the flap does not get deployed when switching fixed wing aircraft between manual and auto modes.\r\n\r\nThis should not influence flaps being deployed in auto modes.\r\n\r\n**Describe possible alternatives**\r\nBy removing the scaling, we are assuming that flap commands range from [-1, 1]. This makes more sense since the mixers actually allow you to give -1 flap commands. If we want to prevent this behavior, IMO we need to add an explicit mode for it rather than secretly scaling this inside the attitude controller.\r\n\r\n**Test data / coverage**\r\nTested by flying a plane model in Gazebo SITL\r\n```\r\nmake px4_sitl gazebo_plane\r\n```\r\nFlown using a virtual joystick on QGroundControl. Note that the flap channels getting deployed in manual flight modes\r\n\r\n- Before PR: https://logs.px4.io/plot_app?log=e5f35769-c0fa-4585-aab8-6478d50041aa\r\n![bokeh_plot (1)](https://user-images.githubusercontent.com/5248102/128637127-af367e33-2924-483b-a426-e04bb21c537f.png)\r\n\r\n\r\n- After PR: https://logs.px4.io/plot_app?log=df16c2cb-1d7e-4733-9269-ff9003b0d3b9\r\n![bokeh_plot](https://user-images.githubusercontent.com/5248102/128637045-9cc9ced2-6fdd-4a0e-87d4-39e28f9b3e30.png)\r\n\r\n**Additional context**\r\n- This was not apparent before there were flaps in the SITL plane model, but this is more visible after it has been added.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/18035",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/18035",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/18035.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/18035.patch",
    "merged_at": "2021-08-13T13:46:23Z"
  }
}
{
  "title": "1.12 Release everything great except Weather Vane",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17911",
  "body": "**Describe the bug**\r\nsince the beginning of 2021 Weather Vane no longer works and also in the 1.12.0 release. Is there a trick to activate WV, or is something important missing?\r\n\r\n**To Reproduce**\r\nConvergence Airframe\r\ngps+HereFlow\r\nUSB disabled to have enough ram left \r\n(without airspeed sensor)\r\nForward Thrust enabled\r\nEnough wind\r\nenable wv\r\nstart position, mission or rtl\r\n\r\n**Expected behavior**\r\nWV should work and turn the aircraft into the wind from a slight roll inclination.\r\nlike it was in 1.11 with the same setup\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=a8f081af-ee68-42a0-81e4-71768cec0ed2",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Heading timeout in FW flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17746",
  "body": "@Silvan Fuhrer \r\n**Describe the bug**\r\nRTL is trigered in FW flight because timeout for heading in MC triggers, sending this messages:\r\n[navigator] unable to reach heading within timeout\r\n[commander] Mission cannot be completed\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nFirmware: Tailsitter v1.11.3.\r\n1. Set MIS_YAW_TMT to a value lower than the time to turn 180 degree in FW flight.\r\nIn mi case I had MIS_YAW_TMT set to 1.\r\n2. Fly a mision with several alt loiters\r\n\r\nYou wil get a RTL with this messages:\r\n[navigator] unable to reach heading within timeout\r\n[commander] Mission cannot be completed\r\n\r\nSeems that this error is triggered here:\r\n[https://github.com/PX4/PX4-Autopilot/blob/release/1.11/src/modules/navigator/mission_block.cpp#L398](https://github.com/PX4/PX4-Autopilot/blob/release/1.11/src/modules/navigator/mission_block.cpp#L398)\r\n\r\n**Expected behavior**\r\nIgnore the time out since is FW flight.\r\nWhould be nice also improve the description of MIS_YAW_TMT in the parameter reference, is not clear what a value of 0 does.\r\nWhould be also nice to be able to ignore the transition heading in a mision for VTOLs with a parameter.\r\n\r\n\r\n**Log Files and Screenshots**\r\n[https://logs.px4.io/plot_app?log=92979fd1-0fc9-44f9-9a14-2c80e6ed66d3](https://logs.px4.io/plot_app?log=92979fd1-0fc9-44f9-9a14-2c80e6ed66d3)\r\n\r\nRelated:\r\n[https://github.com/PX4/PX4-Autopilot/pull/3740](https://github.com/PX4/PX4-Autopilot/pull/3740)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix bug in external Quadchute trigger (from PR 16691)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17695",
  "body": "Fixes a bug introduced with https://github.com/PX4/PX4-Autopilot/pull/16691. (@dagar @sfuhrer @RomanBapst )\r\n\r\n**Describe problem solved by this pull request**\r\nEli Vigdorchik ran into an undesired external quadchute during one of his test flights as reported on slack (https://px4.slack.com/archives/C39C4E709/p1622652580039900). Log here: https://review.px4.io/plot_app?log=26c65922-793b-4bad-88fa-86f58b97eb82 . For some reason Param2 of the command is set to 3, triggering the Quadchute instead of doing a normal back transition during RTL. I was able to reproduce in SITL on v1.12.0-beta and on master. I guess the issue is a badly initialized / old value of param2 floating around somewhere.\r\nhttps://logs.px4.io/plot_app?log=efaae0f0-a8a8-494c-b32d-6e041689836f\r\nhttps://logs.px4.io/plot_app?log=e177614d-a4c1-4ebf-97ca-6ed6fb8cf420\r\n\r\n**Describe your solution**\r\nExplicitly set Param2 to 0.0f in all occurrences where a normal BT is desired (I searched for all occurrences of *DO_VTOL_TRANSITION in the code).\r\n\r\nI also added a check on NANs. If param2 is a NAN, then _immediate_transition is false too.\r\n\r\n**Describe possible alternatives**\r\n- \r\n\r\n**Test data / coverage**\r\nSame procedure, i.e. Position mode flight with RTL triggered over QGC:\r\nhttps://logs.px4.io/plot_app?log=7cc61dad-7145-4e81-9ee3-f7c84dd04ef9\r\n\r\nI also tried manual transitions, transitions over QGC, missions with VTOL Land and normal Land items, `commander transition` and switching to Land mode via QGC. I couldn't provoke any external quadchutes. Did I miss another option to get into back transition?\r\n\r\n**Additional context**\r\nFollow up of https://github.com/PX4/PX4-Autopilot/pull/16691\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/17695",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17695",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/17695.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/17695.patch",
    "merged_at": "2021-06-21T20:39:55Z"
  }
}
{
  "title": "Yaw setpoint spike, when landing triggered via Mavlink command MAV_CMD_NAV_LAND",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17685",
  "body": "In 1.12.beta, triggering landing via MAV_CMD_NAV_LAND leads to a spike in Yaw at the beginning of the landing phase, which should not occur. This issue is independent from parameter 4 of MAV_CMD_NAV_LAND (setting it to NaN or current yaw):\r\n\r\n<img width=\"793\" alt=\"Bildschirmfoto 2021-06-01 um 16 21 37\" src=\"https://user-images.githubusercontent.com/7580193/120339553-7fb0c780-c2f5-11eb-9306-82bfc93f0a56.png\">\r\n\r\n<img width=\"793\" alt=\"Bildschirmfoto 2021-06-01 um 16 25 22\" src=\"https://user-images.githubusercontent.com/7580193/120340119-036ab400-c2f6-11eb-90b9-c7826195471c.png\">\r\n\r\n\r\nULog: [https://logs.px4.io/plot_app?log=07daba2b-95db-4f4b-b5e9-423ebb3f5fa0](https://logs.px4.io/plot_app?log=07daba2b-95db-4f4b-b5e9-423ebb3f5fa0)\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ekf2 replay does not work for SDLOG_PROFILE = 2",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17578",
  "body": "A log generated with upstream master using a single EKF instance with only ekf2 replay messages is unable to be replayed. Here is an example log.\r\n\r\nhttps://logs.px4.io/plot_app?log=31ebbb10-97a4-469e-8092-2d3ac1ecbfe4\r\n\r\ngenerated using:\r\n\r\nSDLOG_MODE, 2\r\nSDLOG_PROFILE, 2\r\n\r\nThere are two errors that occur when replaying this log:\r\n\r\n1) unrecogonised message definition, ig: ERROR [replay] unknown log definition type 81, size 28 (offset 55043). This can be resolved using https://github.com/priseborough/PX4-Autopilot/commit/13b36e1a5de6829c76762ecb553a976a58d8f844\r\n\r\n2) Repeated baro timeouts, eg: WARN  [ecl/EKF] baro hgt timeout - reset to baro\r\n\r\nThe ability to replay logs with SDLOG_PROFILE=2 is essential for the debug on F4 boards that do ot have adequate resources to log without  dropouts if other log data is included, eg SDLOG_PROFILE = 3",
  "state": "closed",
  "pull_request": null
}
{
  "title": "flashparams: Fix a null-pointer dereference crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17385",
  "body": "Fix a potential crash caused by calling erase_sector with a null\r\nsector_descriptor (current_sector == 0).\r\n\r\nSigned-off-by: Jukka Laitinen <jukkax@ssrc.tii.ae>\r\n\r\nPlease use [PX4 Discuss](http://discuss.px4.io/) or [Slack](http://slack.px4.io/) to align on pull requests if necessary. You can then open draft pull requests to get early feedback.\r\n\r\n**Describe problem solved by this pull request**\r\nA clear and concise description of the problem this proposed change will solve.\r\nE.g. For this use case I ran into...\r\n\r\n**Describe your solution**\r\nA clear and concise description of what you have implemented.\r\n\r\n**Describe possible alternatives**\r\nA clear and concise description of alternative solutions or features you've considered.\r\n\r\n**Test data / coverage**\r\nHow was it tested? What cases were covered? Logs uploaded to https://review.px4.io/ and screenshots of the important plot parts.\r\n\r\n**Additional context**\r\nAdd any other related context or media.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/17385",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17385",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/17385.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/17385.patch",
    "merged_at": "2021-04-14T14:55:34Z"
  }
}
{
  "title": "vtol_att_control: occasional tailsitter forward transition failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17310",
  "body": "\r\nTailsitter VTOLs very occasionally gets stuck with zero roll and pitch angle in multicopter mode after\r\na forward transition command is issued.\r\n\r\nLog files with the transition failure:\r\nhttps://logs.px4.io/plot_app?log=d3c74285-5ae5-430d-a1bd-1b4e6de13938\r\nhttps://review.px4.io/plot_app?log=8d86e43c-5570-4480-9123-7e25669c5463\r\n\r\nIn the above logs you can see the pitch and roll sp set to zero during the forward transition. \r\n\r\nThis very rare behavior is triggered by the following events:\r\n1> a forward transition is triggered either in auto or manual mode.\r\n2> in the vtol_att_control main loop, if multicopter and fixed wing attitude setpoints are not updated, transition state is not updated\r\n3> the commander changes the vehicle status to transition mode.\r\n4> multicopter pos controller initiated  Transition flight task. This results in zero roll and pitch setpoint due to zero acceleration setpoint\r\n5> now vtol_att_control executes and updates the transition state. Specifically, _q_trans_start and _q_trans_sp are set with zero roll and pitch sp\r\n6> tilt is evaluated to be NaN, despite _q_trans_sp being normalized. This happens for 25% of all yaw angles when using float datatype. This can be\r\n   verified using the matrix library\r\n7> once tilt is evaluated to be NaN, _q_trans_sp is never updated again and is stuck in this state for ever.\r\n\r\nThis has been fixed by constraining the cos(tilt) within +1 to -1 range\r\nFurther, _q_trans_start and _q_trans_sp are immedietly initialized after a transition event is triggered.\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/17310",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17310",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/17310.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/17310.patch",
    "merged_at": "2021-04-03T17:19:48Z"
  }
}
{
  "title": "Motors spin up to ~1500 pwm when vehicle is armed. [Control Allocation V1.12.0Beta]",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17220",
  "body": "**The bug**\r\nMotors spin up to ~1500 pwm when vehicle [ Hexacopter Control Allocation V1.12.0Beta] is armed. No response to throttle or stick inputs.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on\r\n2. Arm via RC or QGC\r\n3. See motors spin to ~1500 pwm\r\n\r\n**Expected behavior**\r\nMotors spin at idle speed (1075 pwm default)\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=f2aa0437-ef1d-416c-aa16-5c64591922fa\r\n\r\n**Drone :**\r\n- Pixhawk 4, hexacopter\r\n- 6 x motors connected to PX4 IO out, and 6 x servos connected to FMU out\r\n\r\n**Firmware:**\r\n- px4 v1.12.0 beta1 (935c5df)\r\n- Control allocation hexacopter (6003_hexa_x_ctrlalloc)\r\n\r\n**Additional context**\r\n- Tried the same setup with normal hexacopter airframe (6001_hexa_x), the issue did not show up.\r\n- CA_ACTX parameters have MIN 0, MAX 1\r\n- Changing PWM_MAIN_MIN did not affect the issue\r\n- Throttling up and down shows no changes in motor PWM\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "compass loss causes unsafe maneuvers",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17192",
  "body": "**Describe the bug**\r\nDuring the landing sequence, a compass failure leads to a position loss and the vehicle jerks violently. Tested on recent commit. \r\n\r\n**To Reproduce**\r\n1. Takeoff\r\n2. Land\r\n3. While landing, fail every compass instance\r\n\r\n**Expected behavior**\r\nThe vehicle to proceed through the landing sequence.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=b9da48e7-9b6a-4a87-a9b0-4d1ffb8d4e26\r\n\r\n**Drone (please complete the following information):**\r\nSITL Gazebo Iris\r\n\r\n**Additional context**\r\nN/A\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "mc_pos_control: add OFFBOARD takeoff intent",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17042",
  "body": "OFFBOARD CI tests are failing on landing due to the takeoff state machine reactivating immediately on landing because OFFBOARD is always setting want_takeoff = true.\r\n\r\nThis change attempts to capture the takeoff intent in an OFFBOARD (trajectory) setpoint.\r\n\r\nExample failure log - https://logs.px4.io/plot_app?log=775688d0-faee-4f31-bb9b-1772ea0b1d9e",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/17042",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17042",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/17042.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/17042.patch",
    "merged_at": "2021-03-07T10:04:17Z"
  }
}
{
  "title": "land_detector: continue respecting hover thrust throughout descent",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17041",
  "body": "The hover thrust estimate becomes invalid on final descent, which can disrupt the land detector ground contact logic if MPC_THR_HOVER is sufficiently wrong.\r\n\r\nhttps://logs.px4.io/plot_app?log=3b44224e-4cca-42ad-a1dc-db2acff4f324\r\n\r\n<img width=\"864\" alt=\"Screen Shot 2021-03-06 at 10 21 05 PM\" src=\"https://user-images.githubusercontent.com/84712/110227839-43262900-7eca-11eb-8e12-e17f5736a4ec.png\">\r\n\r\n<img width=\"1366\" alt=\"Screen Shot 2021-03-06 at 10 22 23 PM\" src=\"https://user-images.githubusercontent.com/84712/110227854-723c9a80-7eca-11eb-9557-c5d1c2b87569.png\">\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/17041",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/17041",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/17041.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/17041.patch",
    "merged_at": "2021-03-08T10:33:37Z"
  }
}
{
  "title": "HITL Simulation very jumpy",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16670",
  "body": "**Describe the bug**\r\nI performed HITL Simulation with Pixhawk 1 hardware using 1.10.2 firmware version with jMAVsim simulator. The controller performance for a simple mission was very jumpy and not smooth at all.  \r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Flash the [1.10.2 firmware](https://github.com/PX4/PX4-Autopilot/releases/tag/v1.10.2) on Pixhawk 1.\r\n2. Follow the steps mentioned in this [doc](https://docs.px4.io/master/en/simulation/hitl.html#setting-up-hitl)  on how to set up the QGC for HITL.\r\n3. Follow the steps mentioned [here](https://docs.px4.io/master/en/simulation/hitl.html#jmavsim-quadrotor-only) for starting the jMAVSim simulator in HITL mode.\r\n4. Create a simple mission, upload it and start. Follow the instructions mentioned [here](https://docs.px4.io/master/en/simulation/hitl.html#fly-an-autonomous-mission-in-hitl) .\r\n5. Observe the jumpy behaviour\r\n\r\n**Expected behavior**\r\nI expect a smooth controller performance. \r\n\r\n**Log Files and Screenshots**\r\n- The log flight review can be found [here](https://review.px4.io/plot_app?log=ef92140a-b1bc-4c82-80c6-48ccb6224838). \r\n- The video of the quadcopter performing the mission in jMAVSim can be seen [here](https://drive.google.com/file/d/13PI-148FiCjFmpaoCSy16xiPDDERk-RD/view?usp=sharing).\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 Rover, mission mode doesn't work in a real vehicle.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16586",
  "body": "**Describe the bug**\r\nIn SITL rover in master mission mode works in qgroundcontrol with takeoff waypoint. but in the a real vehicle in mission mode,\r\nrover stands still. it arms and works in stabilized mode, but does nothing on the mission mode.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Upload any mission to a rover that is working in stabilized mode.\r\n2. switch to mission mode (either from the transmitter or from the qgc )\r\n3. it goes to mission mode (shows in qgc)\r\n4. actuators doesn't respond.\r\n\r\n**Expected behavior**\r\nRover should navigate the mission just like in the SITL\r\n\r\n**Log Files and Screenshots**\r\n\r\nlog file ----> it's on master, i only did change some comments as i was going through the code. \r\nhttps://review.px4.io/plot_app?log=a108e8e8-a0b8-41ce-93b5-8ed9ef1a7720\r\n\r\n\r\n**Rover Hardware\r\n- just a generic rover frame with Pixhawk 4 - px4_fmu_v5 with a brushless motor and an esc.\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 software crashes and Pixhawk restarts mid-air",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16390",
  "body": "**Describe the bug**\r\nWe are using a Pixhawk Holybro V4 for a multicopter setup. It seems that the platform restarts mid-air which causes the vehicle to crash (Motors stop and the Pixhawk reboots immediately). These test flights are done in a MoCap environment and we are using the internal EKF2 by feeding the MoCap pose at 30Hz via the mavlink vision pose topic. Each individual flight produces 3 logfiles:\r\n\r\n- First file: Short ~4 second period\r\n- Second file: The longer flight period with the notification of a software error\r\n- Third file: A short ~4 second period again\r\n\r\nI'm not sure about the smaller logfiles before and after the flight test but I attached them anyway. The second file however points out a software crash. We are using the latest and unmodified firmware release (v1.11.2) and I can not see a clear cause for the error in the log file.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. We are using the internal EKF2 estimator and feed 30Hz MoCap pose information via the mavlink vision topic\r\n2. Takeoff and let the copter hover in position control for a while\r\n3. In our case, the Pixhawk restarts after 20 seconds or 2 minutes (this varies)\r\n4. Motors turn off and the multicopter performs a hard landing\r\n\r\n**Expected behavior**\r\nThe PX4/Pixhawk V4 should not restart\r\n\r\n**Log Files and Screenshots**\r\n\r\n- First file: Short ~4 second period\r\n  - https://logs.px4.io/plot_app?log=fab2c889-e3c8-4ff6-a6cf-6b5af31cd0ba\r\n- Second file: The longer flight period with the notification of a software error\r\n  - https://logs.px4.io/plot_app?log=a288b862-a60b-426c-af81-cf5b57629769\r\n- Third file: A short ~4 second period again\r\n  - https://logs.px4.io/plot_app?log=b5f2e049-dfbb-4b8b-bc7f-2b91eb25634a\r\n\r\n**Drone (please complete the following information):**\r\n- Twins V1 Quadcopter with PM07 powerboard (https://www.twins.co.at/wp-content/uploads/2020/11/Produktspezifikationen_SCIENCE.pdf)\r\n\r\n**Additional information**\r\nI'm not sure, but this could be related to issue #14075",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ekf2 airspeed check bit on a multicopter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16372",
  "body": "This is from a quadcopter that as far as I know doesn't have an airspeed sensor.\r\n\r\n<img width=\"801\" alt=\"Screen Shot 2020-12-10 at 9 23 17 PM\" src=\"https://user-images.githubusercontent.com/84712/101853721-1615e480-3b2e-11eb-8f1f-f4f9464e2e27.png\">\r\n\r\nhttps://logs.px4.io/plot_app?log=0ad8c6f0-a7d5-47a1-be91-0da064561eea",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[VTOL] 0Â° yaw/heading after back transition in mission",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16305",
  "body": "**Describe the bug**\r\nIn mission mode, just after a back transition the VTOL (quadplane) always yaws towards due north. This 0Â° yaw setpoint only changes once the drone moves on to the next waypoint. \r\n\r\nPresent in v1.11.2 and on current master. In SITL and on a real drone.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on. Both `make px4_sitl gazebo_standard_vtol` and a real drone\r\n2. Uploaded mission: \r\n[RC club many transitions.zip](https://github.com/PX4/PX4-Autopilot/files/5616756/RC.club.many.transitions.zip)\r\n3. Start the mission\r\n4. Observe the yaw after back transitions.\r\n\r\n**Expected behavior**\r\nThe drone should either\r\n- keep its current heading \r\n- use the heading as calculated normally in the MPC trajectory generation\r\n- weathervane\r\nlike in v1.10.1 : https://logs.px4.io/plot_app?log=9ba19728-7ba2-4250-8884-e39e3c6a1d7f\r\n\r\n**Log Files and Screenshots**\r\n-Real quadplane: https://logs.px4.io/plot_app?log=3b4e3749-8b0e-44a2-9e9b-74b329b3dbab (ignore after 6:00)\r\n-SITL, v1.11.2: https://logs.px4.io/plot_app?log=21bdc8c9-9cfc-4964-90aa-2f123ebb70f6\r\n-SITL, master: https://logs.px4.io/plot_app?log=cc6301a2-0a6f-4100-a973-128cb7784ddf\r\n-SITL, v1.11.2, other flight modes: https://logs.px4.io/plot_app?log=74ae49e6-1d82-4a2f-81ee-2fb387cacd1c (no enforced 0Â° yaw)\r\n\r\nUseless 360 after back transition: \r\n![image](https://user-images.githubusercontent.com/48206725/100627921-f0b3fa00-3327-11eb-887c-17ef06e2fe98.png)\r\n\r\n\r\n**Drone (please complete the following information):**\r\n- Quadplane with Pixhawk 4, v1.11.2\r\n- Gazebo Standard VTOL\r\n\r\n**Additional context**\r\nI could only reproduce this in mission mode (see 4th log).\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Drone can't Return in a planned mission in v1.11",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16299",
  "body": "**Describe the bug**\r\nIn v1.11 RTL_TYPE parameter changed, which caused the Drone can not Return in a planned mission after \"Land Start\".\r\nin v1.10 with RTL_TYPE=1 (Return to a planned mission landing, if available, via a direct path, else return to home via direct path)\r\nevery this was ok but in v1.11 RTL_TYPE=1,3 causes that drone fly directly to Land location and RTL_TYPE=2 causes that drone resume mission.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Select VTOL standard HI airframe.\r\n2. Uploaded this mission.\r\n3. during mission change mode to return.\r\n4. See error: drone fly directly to Land location and dismiss Land pattern.\r\n\r\n**Expected behavior**\r\nthe drone must directly fly to the waypoint after the \"land start\" command.(planned landing pattern)\r\n\r\n**Log Files **\r\nhttps://logs.px4.io/plot_app?log=5b7ac051-0e0b-4be4-adc9-d8bb75717c56\r\n\r\n**Plan**\r\n\r\n[2.zip](https://github.com/PX4/PX4-Autopilot/files/5638657/2.zip)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Handle takeoff waypoints for rover",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/16297",
  "body": "**Describe problem solved by this pull request**\r\nPreviously, rover vehicles were not able to handle Takeoff waypoints. The behavior when a takeoff waypoint was passed to a rover vehicle was:\r\n- The vehicle would not move since the waypoint was too close\r\n- The takeoff waypoint would not get accepted since rovers are not able to climb and reach the altitude\r\n\r\nI think it might be obvious that one \"should not\" pass takeoff waypoints to a vehicle. However, QGroundControl only lets you plan a mission that starts with a takeoff waypoint. While this should also be an improvement on the QGC side, I think it is still useful to handle this case on the vehicle side so that the vehicle can still progress with the mission even with a takeoff waypoint\r\n\r\n**Describe your solution**\r\nThis adds a special case when handling takeoff waypoints for rover vehicles. The acceptance radius is set to only consider horizontal distance to the waypoint, if the vehicle type is rover.\r\n\r\n**Test data / coverage**\r\n- This was tested in SITL gazebo, with the rover model.\r\n```\r\nmake px4_sitl gazebo_rover\r\n```\r\nThis log shows a full mission successfully finished starting with a Takeoff waypoint and finished with a RTL: https://review.px4.io/plot_app?log=25fe983b-44d0-4a11-a7c2-2ab9662c35d4\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/16297",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/16297",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/16297.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/16297.patch",
    "merged_at": "2020-11-28T23:08:54Z"
  }
}
{
  "title": "Unexpected mode switch from OFFBOARD mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16235",
  "body": "**Describe the bug**\r\nIt has been reported by several users that while flying in offboard the Pixhawk randomly changes to a different mode for no apparent reason, i.e. not due to offboard control failure, or sensor failure etc. Usually this change is extremely fast and the reason for is not registered in the flight logs making this issue quite hard to debug. In our case this mode change coincided with the mode that was set in the Pilot RC at the time, in this case ACRO, though @bperseghetti reported haaving the same issue in the past and it even happened without an RC on which seems to indicate it is not an RC issue. He also mentioned that this mode switch seemed random but it's still to be verified. @ThomasRigi also reported facing the same issue more than once and one time also in the kill switch.\r\n\r\nThis issue was discussed in PX4 Dev call on November 18th 2020: https://discuss.px4.io/t/px4-dev-call-november-18-2020/19554\r\n\r\nIt was first raised in slack here: https://px4.slack.com/archives/C0W2KUFFT/p1605613677266600\r\n\r\nSo far it has been reported on V1.09 and V1.10. No instances on V1.11 but most likely it's just from lack of usage. \r\n\r\nAll the logs will be provided further below.\r\n\r\n**To Reproduce**\r\nUnfortunately this issue seems super hard to reproduce as it does happen quite rarely (@bperseghetti put it in the range of happening once every 150/200 flights). But the steps are to simply fly offboard often and for large periods of time.\r\n\r\n\r\n**Expected behavior**\r\nThe UAV should NOT exit offboard mode for no apparent reason, and while there are many reasons that could explain this mode change, for our current architecture the UAV would have changed into HOLD mode given our parameters, or in more extreme situations it could switch into either POSITION, ALTITUDE, or as a last resort into STABILIZED.\r\n\r\nA secondary issue is that even if the UAV is indeed changing modes, that should be explicitly recorded in the logs which is currently not happening as it seems that since it's such a quick change it goes in between the two log points.\r\n\r\n**Log Files and Screenshots**\r\n\r\n**Log 1** \r\nUAV changed from OFFBOARD mode to ACRO. No change in the RC Input:\r\n\r\n![RC_Input](https://user-images.githubusercontent.com/11491719/99655093-8cf21d00-2a5b-11eb-8f4c-7596eea85591.png)\r\n\r\nhttps://logs.px4.io/plot_app?log=e83a1c3d-99a5-484a-b908-6eff075edc56\r\n\r\nUser: @RicardoM17 \r\n\r\n**Log 2**\r\n\r\nKill switch was engaged for an extremely short time but no action is recorded from the Pilot RC\r\n\r\n![image](https://user-images.githubusercontent.com/11491719/99664346-58389280-2a68-11eb-92fa-ca0e0ff30977.png)\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/11491719/99664255-33441f80-2a68-11eb-80b3-c96b3b2b6a51.png)\r\n\r\nhttps://logs.px4.io/plot_app?log=7ba7eefa-ed3e-4247-96c8-1a0294aea8d6\r\n\r\nUser: @ThomasRigi \r\n\r\n**Log 3**\r\n\r\nMomentary offboard loss with no Pilot RC input.\r\n\r\n![image](https://user-images.githubusercontent.com/11491719/99664937-3c81bc00-2a69-11eb-912b-dcfa8385be8f.png)\r\n\r\n![image](https://user-images.githubusercontent.com/11491719/99665036-5f13d500-2a69-11eb-860b-138d0c3f9373.png)\r\n\r\nUser: @ThomasRigi \r\n\r\n@bperseghetti also mentioned being affected by this issue several times. I'm not sure if you have any logs that you could share?\r\n\r\n**Possible Solutions/Changes**\r\nThese Solutions/Changes were discussed on the Dev Call when this was first raised.\r\n\r\n1. Add some hysteresis or more simply a timeout for the mode change. It really shouldn't matter for most of the user base if the mode change takes 50-100ms extra vs being basically instant. For the small use cases where this can be a concern perhaps this could be disabled via a parameter or even the precise timout period could be defined there.\r\n\r\n2. Throw an INFO message on mode change. If possible with the reason for mode change. It doesn't really solve this issue but it would help gather data to solve it in a different way in the future. IMO it also makes sense that this is enabled anyway.\r\n\r\n3. Change the message logging structure to ensure that no relevant data escapes the log in the presence of such a glitch.\r\n\r\n4. ???\r\n\r\nFYI @ThomasRigi @bperseghetti @dagar @MaEtUgR \r\n\r\nMany thansk in advance.\r\n\r\nP.s. @dagar We would especially like to ask if a fix regarding 1. could be fast tracked as there is a good chance that we are blocked from flying atleast we implement a solution, even if temporary. So this is quite high priority/critical from our side. Of course whatever help that you need just let me know and we'll help out in any way I can but I would assume it would just be changed in commander. If you do not have the bandwidth let me know and I can try to get a PR for you to review but in that case any pointers that you can provide would be helpful.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fail to trigger the position (GPS) loss failsafe",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16122",
  "body": "**Describe the bug**\r\n\r\nWhile I have experimented the GPS loss failsafe, I have found that PX4 fails to trigger the failsafe mode.\r\nI think this issue is related to #15065. Thanks.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nFrist case, \r\n- make px4_sitl jmavsim\r\n- Takeoff and fly (e.g. using Joystick in QGC)\r\n- Enable failure injection: param set SYS_FAILURE_EN 1\r\n- param set COM_POS_FS_DELAY -1\r\n- Turn on orbit mode\r\n- failure gps off\r\n- fail to trigger the GPS failsafe\r\n* Result: keep floating in the air\r\n\r\nSecond case,\r\n- make px4_sitl jmavsim\r\n- Takeoff and fly (e.g. using Joystick in QGC)\r\n- Enable failure injection: param set SYS_FAILURE_EN 1\r\n- param set COM_POS_FS_DELAY -1\r\n- flying into another location (i.e., by using \"go to the location\" in QGC)\r\n- failure gps off\r\n* Result: blind land\r\n\r\nIf the flight mode is another mode except orbit or \"go to the location\", PX4 well triggers the GPS failsafe even though the parameter (COM_POS_FS_DELAY) has a strange value. To fix such issue, I think that PX4 needs to check the valid range of the parameter or something else.\r\n\r\n**Expected behavior**\r\nThe GPS failsafe is triggered.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=a5823c45-07e5-43f5-9227-e8493ae89e54\r\nhttps://logs.px4.io/plot_app?log=05fd86e9-3f3f-48c7-aa4f-117894ce26a3\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL Tailsitter: Thrust issue during transition",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16057",
  "body": "**Describe the bug**\r\nWhen we are performing a VTOL transition with a tailsitter type drone We are getting very weird thrust fluctuations. It seems that it's taking two references basically at the same time, I would assume from the MC and FW controllers.\r\nAlso in simulation we don't get this issue.\r\n\r\nMore over @xdwgood also reported this issue on PX4 slack, thus proving that this issue is on upstream PX4 and not custom software.\r\n\r\n**To Reproduce**\r\nUse a VTOL Tailsitter type drone and perform a transition.\r\n\r\n**Expected behavior**\r\nThe thrust reference should be smooth during transition.\r\n\r\n**Log Files and Screenshots**\r\n\r\n![bokeh_plot (6)](https://user-images.githubusercontent.com/11491719/97275750-9ad6c880-1836-11eb-9a59-ae861984b5b8.png)\r\n\r\nhttps://logs.px4.io/plot_app?log=1e0b41e7-79d0-4d75-be15-27168f4274cc\r\n\r\n![bokeh_plot (5)](https://user-images.githubusercontent.com/11491719/97275673-82ff4480-1836-11eb-8d75-1d0fb814896b.png)\r\n\r\nhttps://review.px4.io/plot_app?log=6ce3fbeb-33d0-44db-8232-f3f9dd0f87b2\r\n\r\n**Additional context**\r\n@xdwgood reported that setting MPC_USE_HTE to 0, i.e. disabling the hover throttle estimator, seems to solve the issue. It's still to be confirmed but I'm still creating this issue to keep track of the problem as it should be fixed entirely.\r\n\r\n@sfuhrer @RomanBapst  FYI",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MAVSDK SITL test intermittent failures",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15940",
  "body": " - standard_vtol: 'Fly forward in position control': failed\r\n    - https://github.com/PX4/Firmware/pull/15939/checks?check_run_id=1236860638\r\n    - https://logs.px4.io/plot_app?log=15eba26f-7e86-439b-b44e-188cb41c0c91\r\n - iris: 'Land on GPS lost during mission (GPS height mode)': failed\r\n    - https://github.com/PX4/Firmware/pull/15943/checks?check_run_id=1238804612\r\n    - https://logs.px4.io/plot_app?log=bf7c6b14-31b0-43a2-9377-88c0f99d28c7\r\n    - **SIGABRT - Abort (abnormal termination) signal**\r\n        - sitl_gazebo crashing?\r\n - standard_vtol: 'Continue on mag lost during mission': failed\r\n    - https://github.com/PX4/Firmware/pull/15930/checks?check_run_id=1248017118\r\n    - https://logs.px4.io/plot_app?log=3cf4b823-fdbb-4e84-8ff2-c4a79413d333",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Gazebo simulation of Typhoon causes flip/crash on takeoff",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15879",
  "body": "I am simulating in Gazebo using Ubuntu 18.04 running on VMWare ESXi. There are a few different models of drones pre-made for use with the simulator. I have been using the 3DR Iris, which works fine, but I want to use the camera plugin so I tried switching to the Yuneec Typhoon. I launch the simulator with the command `make px4_sitl gazebo_typhoon_h480`, as per the simulation tutorial page. When I try to take off (either through my autopilot script or QGroundControl) the drone promptly does a flip and crashes upside-down on the ground\r\n\r\nHere are log files for the [successful Iris takeoff](https://logs.px4.io/plot_app?log=f7c7ee5d-fa5a-47cf-b572-ee711f3e1893) and the [Typhoon failure](https://logs.px4.io/plot_app?log=003e3314-1c9f-4860-8e16-a01245fb6003).\r\n\r\nPotentially related to #14997 , where another user experiences flips during flight of a simulated drone.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Increase uavcan main stack size",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15864",
  "body": "**Describe problem solved by this pull request**\r\nI observed hard faults when running `uavcan params list`. A stackcheck build showed that the `uavcan` task overflowed its stack.\r\n\r\n**Describe your solution**\r\nI increased the stack size for the `uavcan` command\r\n\r\n**Describe possible alternatives**\r\nNone\r\n\r\n**Test data / coverage**\r\nIncreasing stack size shouldn't cause any issues, but for what it's worth I have flown with this commit\r\nhttps://review.px4.io/plot_app?log=d0f658d7-60ab-40ae-b4e2-a32aae84d942\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/15864",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15864",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/15864.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/15864.patch",
    "merged_at": "2020-10-02T05:31:28Z"
  }
}
{
  "title": "hovergames disarm in air",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15810",
  "body": "\r\nhttps://review.px4.io/plot_app?log=37ee74be-7c86-41b9-b172-115dcd91cd5b\r\nhttps://www.youtube.com/watch?v=6e8kV0kW_Gk\r\n\r\n![Screenshot from 2020-09-24 11-12-02](https://user-images.githubusercontent.com/84712/94164261-d0168200-fe56-11ea-9e45-b9f9e6f2eb65.png)\r\n\r\nhttps://github.com/PX4/Firmware/pull/13992#issuecomment-698317062\r\n\r\n@igalloway ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "USB connection is only accessible if connected in a window of few seconds",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15667",
  "body": "**Describe the bug**\r\n\r\nIf we do not connect the USB to a consumer right after the bootloader, once the RGB LED starts breathing blue (in a window of few seconds), the Pixhawk is inaccessible, no message can be received or sent anymore, but the TTY ACM driver is still up and running, thinking it can communicate.\r\n\r\nI could replicate the exact same behavior going one level down, using `libusb1.0` instead of using the kernel `usb-cdc-acm` driver but the exact same behavior happened. This seems to indicate that the last burst would come from the Pixhawk's buffer and not the tty driver buffer. As the log shows below, if nobody subscribes to the data in `/dev/ttyACM0`, the USB connection is not initialized.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Power the Pixhawk with the USB\r\n2. Wait for the LED to be blue breathing\r\n3. Wait an additional 10 seconds\r\n4. Try to connect Mavros, QGc or `cat /dev/ttyACM0`\r\n5. When connecting, few messages are received\r\n6. The connection hangs: No message can be sent or received\r\n\r\nSteps to reproduce the behavior after successful connection:\r\n1. Power the Pixhawk with the USB\r\n2. Wait for the LED to be blue breathing\r\n3. ~Wait an additional 10 seconds~\r\n4. Try to connect Mavros, QGc or `cat /dev/ttyACM0`\r\n5. The connection is successful and can be used for any time you want\r\n6. Disconnect (stop the node)\r\n7. Wait 10 seconds\r\n8. Try to reconnect with the same method\r\n9. When connecting, few messages are received\r\n10. The connection hangs: No message can be sent or received\r\n\r\n**Expected behavior**\r\n\r\nSteps to reproduce the behavior after successful connection:\r\n1. Power the Pixhawk with the USB\r\n2. Wait for the LED to be blue breathing\r\n3. You can wait any time you want before connecting\r\n4. Try to connect Mavros, QGc or `cat /dev/ttyACM0`\r\n5. The connection is successful and can be used for any time you want\r\n\r\n**Log Files and Screenshots**\r\n\r\n`sudo apt install vusb-analyzer usbmon`\r\n\r\nFollowing a USB log file showing the problem. The Pixhawk in this log is DEV 1018. To view it, download it, rename it to remove the `.txt` and open it with vusb-analyzer:\r\n\r\n[usbmon.mon.txt](https://github.com/PX4/Firmware/files/5160810/usbmon.mon.txt)\r\n\r\n```bash\r\nmv usbmon.mon.txt usbmon.mon # .mon files are not supported on Github\r\nvusb-analyzer usbmon.mon\r\n```\r\n\r\n*History of the log:*\r\n* `0.00s`: Start the log\r\n* `6.00s`: Connect Pixhawk\r\n* `12.50s`: Pixhawk left the Bootloader (CDC driver advertised)\r\n* `13.50s`: Mavlink node started on `/dev/ttyACM0` (showing normal behavior)\r\n* `21.25s`: Mavlink node manually stopped\r\n* `37.70s`: Mavlink node started on `/dev/ttyACM0` (showing a stuck behavior)\r\n    * The messages **do contain data**\r\n\r\nNormal start:\r\n![image](https://user-images.githubusercontent.com/6976744/91954802-998b9280-ed02-11ea-9220-a5228873eb45.png)\r\n\r\nFailing start:\r\n![image](https://user-images.githubusercontent.com/6976744/91954851-ac05cc00-ed02-11ea-973e-404da6cb89f4.png)\r\n\r\nExample log https://review.px4.io/plot_app?log=85f3ab21-074b-4a19-9baa-820d606824c2\r\n\r\n**To reproduce the log:**\r\n\r\n```bash\r\nsudo su\r\nmodprobe usbmon\r\ncat /sys/kernel/debug/usb/usbmon/1u > usbmon.mon\r\n```\r\n\r\n**Drone:**\r\n- Pixhawk 1 (original 3DR)\r\n- Firmware: px4_fmuv2_default 1.11.0, also tested (same error) on 1.9.0\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Possible attitude estimation bug",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15612",
  "body": "**Describe the bug**\r\n[Flight 1](https://review.px4.io/plot_app?log=70d80c6c-46f4-4d45-a710-bcc0ed0cae1c)\r\nAfter ~30s of full manual indoor flight (~5m height above floor), the estimated attitude began to drift significantly in the roll angle (even in pitch, but not so much), even though the pose desired by the pilot was the hover state. The pilot tried to compensate by tilting the drone in the opposite direction, however, he reached the limit position of the roll stick on the RC and the roll still continued to drift. The high velocity led to a rough crash into a wooden bench. There was no RC signal loss and we checked that the RC had no trims and subtrims in effect.\r\n\r\nThis was the first time we experienced this behavior after ~4 years working with PX4 firmware.\r\n\r\n[Flight 2](https://review.px4.io/plot_app?log=5dc3d4bb-5c16-4ec6-b7ad-17f2456e4f3b)\r\nThe second incident we had was the next day on the same location with different hardware, but the same symptoms. After ~30s of manual flight in altitude mode (~5m height above floor) the UAV started tilting uncontrollably and then crashed into a wall. Again no RC signal losses, no trims and subtrims. We were even flying with this platform the same day in the morning for ~10 minutes without any issues [(OK Flight)](https://review.px4.io/plot_app?log=e0c02122-4335-4ce3-ab3d-598a38e98c7f).\r\n\r\nPlease find attached logs and description of the hardware in the following sections. My colleague will also upload a video which compares the PX4 estimated attitude with the correctly estimated attitude obtained from a custom attitude estimator run on the recorded IMU flight data.\r\n\r\nWhat is the cause of this behavior? Could there be a bug in the attitude estimator that only manifests in some highly specific conditions? Is there some problem apparent from the logs that we are missing?\r\n\r\nPlease ask for any relevant additional information that could help solving the issue. Until we resolve this issue we cannot fly indoor in this setup, because it is too unreliable and dangerous.\r\n\r\n**To Reproduce**\r\nWe tried to reproduce the behavior in lower height above floor with another drone with the same setup as in the first flight without success. \r\n\r\n**Log Files and Screenshots**\r\n[Flight 1](https://review.px4.io/plot_app?log=70d80c6c-46f4-4d45-a710-bcc0ed0cae1c)\r\n[Flight 2](https://review.px4.io/plot_app?log=5dc3d4bb-5c16-4ec6-b7ad-17f2456e4f3b)\r\n[OK Flight](https://review.px4.io/plot_app?log=e0c02122-4335-4ce3-ab3d-598a38e98c7f)\r\n\r\n**Drone (please complete the following information):**\r\n\r\n***Flight 1***\r\n- Frame: Quadrotor Tarot T650\r\n- Total mass: 3.5 kg\r\n- Motors: Tarot 4114-11 320KV\r\n- ESCs: BL-Heli 32 50A\r\n- FCU: Pixhawk 4 (PX4 FW v1.10.1)\r\n   - attached to the frame by screws\r\n- RC: Hi-Tec Flash 8\r\n- RC receiver: Optima SL\r\n\r\n***Flight 2***\r\n- Frame: Custom coaxial octarotor\r\n- Total mass: 5.5 kg\r\n- Motors: T-Motor MT2814-11 710KV\r\n- ESCs: FOXY Multi 30A Opto V2015\r\n- FCU: Pixhawk 2.1 Cube (PX4 FW v1.10.1)\r\n   - attached to the frame by foam dampeners\r\n- RC: Hi-Tec Aurora 9\r\n- RC receiver: Optima SL\r\n\r\n**Additional context**\r\n- Magnetometer fusion was turned off for both flights\r\n- All components were used previously in many flights\r\n- Calibration of accelerometers, gyroscopes and level horizon was done the day before the first incident",
  "state": "closed",
  "pull_request": null
}
{
  "title": "land_detector: MC remove relaxed throttle threshold",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15569",
  "body": "There are intermittent MAVSDK mission test failures due to land detector false ground contact.\r\n\r\nFor example this mission.\r\nhttps://logs.px4.io/plot_app?log=70226385-5b90-4310-91ca-8fe2be3e7948\r\n\r\n<img width=\"1466\" alt=\"Screen Shot 2020-08-17 at 7 57 29 PM\" src=\"https://user-images.githubusercontent.com/84712/90455368-e563f800-e0c3-11ea-9859-c1ffb9661a74.png\">\r\n\r\nDebatably I think we could blame the somewhat unrealistic gazebo iris model with apparently ~20% hover and MPC_THR_MIN at 12%.\r\n\r\n<img width=\"1468\" alt=\"Screen Shot 2020-08-17 at 7 58 16 PM\" src=\"https://user-images.githubusercontent.com/84712/90455437-0f1d1f00-e0c4-11ea-8a77-3682f820fe3b.png\">\r\n\r\nAs a precaution (and SITL test failure workaround) I'm going to remove the land detector ground contact optimization that tightens the throttle threshold if the hover thrust estimate is valid.\r\n\r\nCould we also take a closer look at making these models more realistic?",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/15569",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15569",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/15569.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/15569.patch",
    "merged_at": null
  }
}
{
  "title": "Failed to transition from TAKEOFF to MISSION",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15471",
  "body": "While testing PR #15083 the vehicle was commanded to execute a mission, took off but failed to transition from Takeoff to Mission.\r\n\r\nA workaround was to pause the mission and then continue the mission.\r\n\r\nVehicle used: Holybro S500 with Pixhawk 4 and Drotek GPS.\r\n\r\nMission with RTL\r\nIn 4/5 missions the vehicle tookoff and didn't went to the next waypoint, I think is related to the issue of the auto-takeoff, land flights. I needed to pause the mission or switch different flight mode and then click continue mission.\r\nhttps://review.px4.io/plot_app?log=d2dc82d7-0024-4562-b8dc-2edf5e4bbf22\r\nhttps://review.px4.io/plot_app?log=b1762b52-0ce7-4231-8f66-004e334ccdf2\r\nhttps://review.px4.io/plot_app?log=7d6db655-f099-4d24-9de9-878498a6cace <- log with no issue\r\nhttps://review.px4.io/plot_app?log=dbb8da1c-8f3f-4e56-91a3-ee9ed80b6585\r\nhttps://review.px4.io/plot_app?log=936188a2-8917-4c4e-9820-a519e949d8ba\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Sometimes takeoff fails in CI tests",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15450",
  "body": "When working on the MAVSDK SITL CI tests I often run into the case where a takeoff fails completely, or the landed state toggles back and forth between finally taking off.\r\n\r\nHere are examples where takeoff doesn't happen at all:\r\nhttps://logs.px4.io/plot_app?log=0f20b944-0704-4cbf-b499-1aec5bf6f9d6\r\nhttps://logs.px4.io/plot_app?log=690f6488-0644-4b5c-a9cb-8ccdcda7f3ae\r\n\r\n![bokeh_plot](https://user-images.githubusercontent.com/1419688/88920913-edbbd680-d26d-11ea-91de-f67a65c7d563.png)\r\n\r\n\r\nAnd here are examples where takeoff on the second try seems to work:\r\nhttps://logs.px4.io/plot_app?log=972ffaf8-da85-4142-a469-7195e0ba342f\r\nhttps://logs.px4.io/plot_app?log=f13ba39e-cab0-4feb-8f6a-f7b8a506bc9c\r\nhttps://logs.px4.io/plot_app?log=bab77966-e501-4923-9181-e922063a4109\r\n\r\nYou can see how there is:\r\n```\r\n[commander] Takeoff detected\r\n[commander] Landing detected\r\n[commander] Takeoff detected\r\n```\r\n\r\nFYI @MaEtUgR @dagar  ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL: descending before having reached mission land point",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15410",
  "body": "**Describe the bug**\r\nUpon RTL the drone starts to descend immediately and does not even reach the Land waypoint of the mission.\r\nYou can see how the horizontal velocity stops suddenly but the controller wants to continue:\r\n![image](https://user-images.githubusercontent.com/48206725/88314240-e730da80-cd14-11ea-9911-0527860f7e8c.png)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Checkout current master (aa7735c)\r\n2. `make px4_sitl gazebo_standard_vtol`\r\n3. Load a mission, e.g. [square vtol.zip](https://github.com/PX4/Firmware/files/4967729/square.vtol.zip)\r\n4. Start the mission and observe. (this uses bug #15409 to trigger RTL with the provided .plan file)\r\n5. Alternatively switch to RTL over QGC once the drone has taken off.\r\n\r\n\r\n**Expected behavior**\r\nThe drone should follow what is outlined in https://docs.px4.io/master/en/flight_modes/return.html . In particular, it should stay at or above RTL_RETURN_ALT until it has reached the landing spot. (or according the cone settings, but the default settings were on no cone)\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=44529271-2e29-4827-a09a-64d78b725c6d\r\nhttps://logs.px4.io/plot_app?log=32d68ad0-a322-451d-b3ca-4640bda64670\r\n\r\n**Drone (please complete the following information):**\r\nTested with Gazebo standard_vtol\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[VTOL] Not yawing towards VTOL Takeoff & Transition waypoint",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15409",
  "body": "**Describe the bug**\r\nThe VTOL is no longer yawing towards the VTOL Takeoff & Transition waypoint. This causes the mission to fail, triggering RTL (which then itself has a bug).\r\n@RomanBapst \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Checkout current master (aa7735c)\r\n2. `make px4_sitl gazebo_standard_vtol`\r\n3. Load a mission with a VTOL Takeoff & Transition waypoint, e.g. [square vtol.zip](https://github.com/PX4/Firmware/files/4967632/square.vtol.zip)\r\n4. Start the mission and observe.\r\n\r\n**Expected behavior**\r\nThe drone should yaw towards the waypoint and then transition.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=44529271-2e29-4827-a09a-64d78b725c6d (RTL)\r\n\r\n**Drone (please complete the following information):**\r\nGazebo standard_vtol\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Takeoff ramp broken",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15408",
  "body": "**Describe the bug**\r\nWith MPC_TKO_RAMP_T = 5s the drone does not take off anymore when starting a mission. With MPC_TKO_RAMP_T = 3s it still takes off, but only after 4s not doing anything and then taking off with a ramp time of 1s.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Checkout current master (aa7735c1c0)\r\n2. Launch SITL. I used `make px4_sitl gazebo_standard_vtol`\r\n3. Set MPC_TKO_RAMP_T = 5 (1st log)\r\n4. Load a mission. E.g. [square vtol.zip](https://github.com/PX4/Firmware/files/4967582/square.vtol.zip)\r\n5. Start the mission\r\n6. The drone does not take off.\r\n7. Repeat with MPC_TKO_RAMP_T = 3 (2nd log) and MPC_TKO_RAMP_T = 1 (3rd log) and observe the differences\r\n\r\n**Expected behavior**\r\nThe drone should take off gently respecting MPC_TKO_RAMP_T.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=0aa9b360-1230-4944-9159-4fb03aabd9d3\r\nhttps://logs.px4.io/plot_app?log=44529271-2e29-4827-a09a-64d78b725c6d\r\nhttps://logs.px4.io/plot_app?log=f698d92c-6636-496b-921a-5bc2c3d8a02f\r\n\r\n**Drone (please complete the following information):**\r\nTested with gazebo standard_vtol\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Goto altitude controlled too late for multicopter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15402",
  "body": "When a goto command is used with an altitude (AMSL), a multirotor first goes to the new location, and only then climbs or sinks to the required altitude. I don't consider that the expected behaviour but I would expect the altitude to be assumed first like we see it in missions or at least at the same time.\r\n\r\nhttps://logs.px4.io/plot_app?log=2de5ba52-c66f-46e3-9741-1337465c31fc\r\n\r\nThis came up in https://github.com/mavlink/MAVSDK-Python/issues/233",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Drone Crash: Motors shutdown on fly",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15347",
  "body": "During some flight test we had an hexarotor crash. All the motors stopped suddenly and the machine crashed on the ground.\r\nWe right now can't explain such a behavior.\r\nHere is the flight log: https://review.px4.io/plot_app?log=f177f3be-1ffc-4040-a86d-5831aefa752c\r\nCan you guys spot any SW related issue?\r\nThe firmware is based on bcce75e691657e7da06ff1bf88fc878eb026c92b. It's an April master commit.\r\nThe modification we made to the firmware are minors and do not related to navigation. I do not think they can explain such a think.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Slow large shake on an X680 quad",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15242",
  "body": "**Describe the bug**\r\nA Chinese user met this situation in his beginning PX4 flight.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=4a16cd09-badf-47e4-a858-58fd7f44d99b\r\n![image](https://user-images.githubusercontent.com/4748411/86071722-8f56d900-bab2-11ea-8129-7202fbb42a7b.png)\r\n\r\nAnd two log before this (vibration is smaller)\r\nhttps://logs.px4.io/plot_app?log=4be2d974-37d8-4262-9949-0d7f7ce82ed1\r\nhttps://logs.px4.io/plot_app?log=6eecae0d-733d-4eb9-bf49-0b67752bf796\r\n\r\n**Drone (please complete the following information):**\r\nX680, had a nice flight in ArduPilot before.\r\n\r\n**Additional context**\r\nMy guess is caused by he choosed DJI airframe, makes the MIN PWM too large, but why it shake like this, maybe I was wrong.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "multicopter land detector ground contact fixes",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15083",
  "body": "Opening this for discussion/testing of possible fixes for https://github.com/PX4/Firmware/issues/13124, https://github.com/PX4/Firmware/issues/11683, https://github.com/PX4/Firmware/issues/13507.\r\n\r\nhttps://logs.px4.io/plot_app?log=4b65cf44-80cb-4910-bc2a-151028afe9da",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/15083",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15083",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/15083.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/15083.patch",
    "merged_at": "2020-08-02T17:37:24Z"
  }
}
{
  "title": "[VTOL] impose minimum transition duration",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15080",
  "body": "**Describe problem solved by this pull request**\r\nBefore this PR, VT_F_TR_OL_TM would silently reduce VT_TRANS_MIN_TM when VT_F_TR_OL_TM was smaller. This almost caused a crash on our quadplane because the (non-airspeed) transition was considered finished way too early. The drone lost 45m of altitude before the quadchute could stabilise it (luckily we transitioned at 50m altitude). \r\n\r\n**Describe your solution**\r\nIncrease the open loop transition duration if it is smaller than the minimum transition duration and notify the user.\r\n\r\n**Test data / coverage**\r\ngazebo standard vtol: Log showing logged messages and imposed 10s front transition: https://logs.px4.io/plot_app?log=4204093e-ffbc-4c4a-b029-21cf52a55c17\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/15080",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15080",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/15080.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/15080.patch",
    "merged_at": "2020-07-03T17:19:03Z"
  }
}
{
  "title": "GPS lost in position control (or RTL) lands without pilot having control",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15065",
  "body": "**Describe the bug**\r\nWhen GPS is lost while flying in POSCTL I expect the vehicle to go into ALTCTL so that the pilot can still bring the vehicle safely back. However, what happens instead is that a blind land is initiated, even though the mode displayed in QGC is ALTCTL.\r\n\r\nThe same can be reproduced in RTL. Switching to Manual control does still work but chances are a user will not try that in time!\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use: https://github.com/PX4/Firmware/pull/15063\r\n2. `make px4_sitl jmavsim`\r\n3. Takeoff and fly in POSCTL (e.g. using Joystick in QGC).\r\n4. Enable failure injection: `param set SYS_FAILURE_EN 1`\r\n5. Trigger GPS lost: `failure gps off`\r\n\r\n**Log Files and Screenshots**\r\n\r\nhttps://logs.px4.io/plot_app?log=8bd577fe-63ea-41da-8846-33f2fef20db5\r\n\r\n```\r\npxh> param set SYS_FAILURE_EN 1\r\n  SYS_FAILURE_EN: curr: 0 -> new: 1\r\npxh> \r\npxh> \r\npxh> failure gps off\r\npxh> WARN  [commander] Failsafe enabled: no local position\r\nINFO  [commander] Failsafe mode activated\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [ecl/EKF] 156392000: GPS data stopped\r\nINFO  [ecl/EKF] 156392000: reset position to last known position\r\nINFO  [ecl/EKF] 156392000: reset velocity to zero\r\nWARN  [ecl/EKF] 156392000: stopping navigation\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nINFO  [commander] Landing detected\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nINFO  [commander] Takeoff detected\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nINFO  [commander] Landing detected\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nINFO  [commander] DISARMED by Auto disarm initiated\r\nINFO  [commander] Failsafe mode deactivated\r\nWARN  [mc_pos_control] Position-Ctrl activation failed with error: Activation Failed\r\nWARN  [mc_pos_control] Previous flight task failed, switching to mode 1\r\nINFO  [logger] closed logfile, bytes written: 9569092\r\n```\r\n\r\nAnd here is another log out of RTL:\r\nhttps://logs.px4.io/plot_app?log=95824b1d-61df-4a02-ae1b-654f9a8e40d6\r\n\r\nFYI @MaEtUgR @dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "pixracer IMU (icm20608g) errors",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15042",
  "body": "**Describe the bug**\r\nMAV topic SCALED IMU shows very high noise. Amplitude is about 1000. Unable to calibrate gyro (movement detected). Stable version shows clean data.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n- Master 5.6.2020\r\n- Pixracer R14\r\n- Standard plane\r\n\r\n**Log Files and Screenshots**\r\n\r\n10 seconds on qgroundcontrol:\r\n![Kuvakaappaus 2020-06-05 13-53-45](https://user-images.githubusercontent.com/5569656/83868700-07401680-a734-11ea-8b6e-6408874a085e.png)\r\n\r\nhttps://logs.px4.io/plot_app?log=dfc4f4f4-ce6b-4f57-bece-88d0a4f229f7",
  "state": "closed",
  "pull_request": null
}
{
  "title": "tailsitter vtol frnot/back transmission failed (no pitch set value is generated)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15037",
  "body": "**Describe the bug**\r\nWhen I used tailsitter to fly, I found that **sometimes**(Sometimes it can enter successfully, in the same flight) even if I switch, vtoll can not enter the fw mode\r\n\r\n**To Reproduce**\r\n1. use master branch fly(tailsitter vtol)\r\n2. in altitude mode and try transmission(mc to fw) \r\n3. The drone pitch angle has not changed, there is no tilt acceleration\r\n\r\n**Expected behavior**\r\nEvery time a customer uses a stick for transmission, vtol should enter the transmission state correctly\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=4df87c34-da2f-46be-b612-ddcc13b135c8\r\n\r\n![840347981](https://user-images.githubusercontent.com/24932258/83841898-55551a00-a734-11ea-9430-6e67fcd8b502.jpg)\r\n\r\n**Additional context**\r\nI found that fw to mc sometimes fails when I try to send a transfer command using the remote control. I will do some investigations to see where the problem is. I now suspect \r\n\r\nnumerical calculations under certain extreme conditions? (eg:at the start of transmission, the actual/setpoint angle of pitch are both 0)\r\n\r\nhere: https://github.com/PX4/Firmware/blob/master/src/modules/vtol_att_control/tailsitter.cpp#L206-L218\r\n\r\nBecause I compared the two switches, the only difference I found was that the drone angle/setpoint angle was close to 0 before the failed transmission started\r\n\r\nFYI: @sfuhrer  :smiley: \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Gyro filtering: apply IMU_GYRO_CUTOFF also to D-term",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15018",
  "body": "- flying master lately I noticed the D-term is considerably more suspectible to noise on different vehicles. Initially I attributed that to the removal of the on-chip DLPF.\r\n- trying to fly the Kopis 2 on master, it was just unflyable. And no matter how much PID and filter tuning I did, I could not get it to fly.\r\n\r\nI then made the filter change here, and it immediately improved things a lot (so apparently the ordering matters). With some further tuning it's flyable again.\r\n\r\nLog: https://logs.px4.io/plot_app?log=65497f73-7350-4965-aec1-5ccdce1c628c\r\n\r\n@dakejahl I'm pretty sure this helps on your S500 as well.\r\n\r\nSome feedback if other people experience the same would be appreciated.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/15018",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/15018",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/15018.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/15018.patch",
    "merged_at": "2020-06-05T00:58:41Z"
  }
}
{
  "title": "[VTOL] Adaptive Quadchute is broken",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14947",
  "body": "**Describe the bug**\r\nThe \"loss of altitude\" quadchute only triggers when it's already too late. \r\n\r\nThe problem seems to lie with the non-documented hard-coded conditions on TECS height rate which take too long to be set to true: https://github.com/PX4/Firmware/blob/6c16a29d26b2c79d63f1459be361c8972399d9ce/src/modules/vtol_att_control/vtol_type.cpp#L246-L249\r\n\r\n**To Reproduce**\r\nI only tested with gazebo_standard_vtol, v1.11.0-beta2.\r\nSteps to reproduce the behavior:\r\nVersion 1: (worst I found, quadchute has no possibility to recover the drone)\r\n1. Disable the elevator in the sdf file, e.g. by setting [the area of the elevator](https://github.com/PX4/sitl_gazebo/blob/4acd679d17a735a1f62781349d14289a29b01014/models/standard_vtol/standard_vtol.sdf#L732) to 0 (you could also comment out the whole elevator block)\r\n2. `make px4_sitl gazebo_standard_vtol`\r\n3. Make sure VT_FW_ALT_ERR is set accordingly (in my logs 15m)\r\n4. Launch a mission (or something else) that makes the drone transition to FW\r\n5. In FW mode the drone will tip over and lose altitude\r\n6. Observe how late the the quadchute is triggered\r\n\r\nVersion 2: (not as extremely late, drone still crashed though after quadchute)\r\n1. Have the gazebo_standard_vtol model fly a normal mission with FW flight\r\n2. Make sure VT_FW_ALT_ERR is set accordingly (in my logs 15m)\r\n3. Disable the pusher motor (via motor failure plugin)\r\n4. Watch the drone lose altitude and eventually trigger the quadchute (still late, but not as late as with Version 1)\r\n\r\n**Expected behavior**\r\nQuadchute should activate as soon as you have lost VT_FW_ALT_ERR meters of altitude with respect to the altitude setpoint. I understand the idea behind also checking if the drone is falling to not trigger in situations where for example you ask for a steep climb that the drone can't immediately react to, but the current implementation clearly doesn't work well if it only triggers when the drone is falling out of the sky with more than 20m/s vertical speed with already more than 25m of altitude lost.\r\n\r\n**Log Files and Screenshots**\r\nVersion 1, disabled elevator: https://logs.px4.io/plot_app?log=5e45b915-3e91-4156-9d14-956cbffbc73e\r\n\r\nVersion 2, disabled pusher motor: https://logs.px4.io/plot_app?log=b3cf09c8-9b47-4832-98bf-b453ebd7cfa2\r\n\r\n**Drone (please complete the following information):**\r\n- Gazebo standard VTOL\r\n\r\n**Additional context**\r\n(Part of) the reason why it triggers so late with Version 1 is that TECS first still needs to initialise after the front transition, but the drone is already dropping. It takes way too long until TECS actually asks for +1m/s height rate\r\n\r\n@sfuhrer @RomanBapst I think some thoughts should be spent on how to best set the trigger logic.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC position controller not engaging cleanly",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14927",
  "body": "https://logs.px4.io/plot_app?log=677d9349-3e6e-4242-b253-44d1ef488568\r\n\r\n![Screenshot from 2020-05-18 18-07-19](https://user-images.githubusercontent.com/84712/82264189-6e875980-9932-11ea-9422-df53e8a69149.png)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 altitude jump when GPS checks first pass in flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14926",
  "body": "https://logs.px4.io/plot_app?log=677d9349-3e6e-4242-b253-44d1ef488568\r\n\r\n![Screenshot from 2020-05-18 18-03-08](https://user-images.githubusercontent.com/84712/82263884-dab58d80-9931-11ea-9b66-8071ae09fb27.png)\r\n\r\n![Screenshot from 2020-05-18 18-04-28](https://user-images.githubusercontent.com/84712/82263972-0b95c280-9932-11ea-8d78-1a44a11bef6a.png)\r\n\r\nThe z reset counter is 0 the entire flight.\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "NAV_DELAY not working properly",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14909",
  "body": "**Describe the bug**\r\nWhen a NAV_DELAY mission item is used, a multicopter oscillates back and forth around the waypoint where it is supposed to wait.\r\n\r\n**To Reproduce**\r\nCan be reproduced in SITL jMAVSim. Here is a plan file: \r\n[delay.zip](https://github.com/PX4/Firmware/files/4633983/delay.zip)\r\n\r\n**Expected behavior**\r\nIt should nicely hold the position.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=f284d761-8709-4701-bb26-1dba665b187a\r\n\r\n![bokeh_plot(2)](https://user-images.githubusercontent.com/1419688/82044691-1a6c4300-96ae-11ea-9365-17a7435dfa83.png)\r\n\r\nThis is required to resolve https://github.com/PX4/Firmware/issues/14904.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Takeoff altitude is not correctly respected",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14903",
  "body": "**Describe the bug**\r\nA multicopter does not go to the correct takeoff altitude but actually lower, presumably it is `MIS_TAKEOFF_ALT` - `NAV_MC_ALT_RAD` because once it \"reaches\" takeoff altitude it switches to HOLD and doesn't keep climbing.  \r\n\r\n**To Reproduce**\r\nSITL:\r\n```\r\nparam set NAV_RCL_ACT 0\r\nparam set NAV_DLL_ACT 0\r\nparam set MIS_TAKEOFF_ALT 2.5\r\ncommander takeoff\r\nlistener local_position -n 1\r\n```\r\n\r\nTo \"fix\" it, set the threshold smaller:\r\n```\r\nparam set NAV_MC_ALT_RAD 0.05\r\n```\r\n\r\n**Expected behavior**\r\nIt should go to the correct altitude as it used to.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=eaae3517-b6bd-460a-be32-a2eae6506eb0\r\n\r\n![bokeh_plot(1)](https://user-images.githubusercontent.com/1419688/81953319-d161b380-9607-11ea-86b7-3bc9b92b5731.png)\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Poor Fixed wing runway takeoff tracking ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14851",
  "body": "Fixed wing runway takeoff tracking is very poor on various firmwares and aircraft types that i've been testing and had others test.\r\n\r\nI've compiled some notes and logs on this and it was even brought up (in a different context) in https://github.com/PX4/Firmware/issues/11785 but the more we look at it, the more this is a true issue and from a practical standpoint is making using autonomous takeoff not feasible given the high risk.\r\n\r\nLet me also preface this by saying a many things have been tested and changed and a makeshift solution was come up with as well but that doesn't solve the problem. Wheel Rate settings have been altered to various extreme and subdued amounts (as seen in the logs). This has reduced some things present like sudden full wheel deflection upon mission start but it never fixes the trajectory of the takeoff and that it does not generally point or aim to the takeoff waypoint but goes off course many time more than it does not.\r\n\r\nMultiple different aircraft and aircraft types were used, even though the mixer is the same, that is only because we have varying sizes and weights of test aircraft and even foam ones where the setup, weight and geometry on the nose gear and linkages is completely different (which is good to rule out a single hardware type or build as the culprit).\r\n\r\nI often have seen the wheel channel output (main 5) swing up and down 500us over neutral, essentially max on both extremes and even when that isnt having the same type of behavior exists at +/200. The scaling factor probably helps in these cases by reducing movement (so long as you are still on course enough or at least not going to crash on takeoff) but the thing to remember is this entire process is only 3-8 seconds long before you're airborne so it's easy to not see or overlook.\r\n\r\nThe hacked solution? Limit min/max pwm value of the wheel servo either in PX4 or at the servo level to limit how much steering can physically occur. This is not a solution but gets things airborne by quasi limiting the ability to go off course. Not a true solution.\r\n\r\nLogs:\r\n\r\nhttps://review.px4.io/plot_app?log=efad594a-afe0-451a-a1dd-a6130e49a03b\r\nThis log has an sudden full right wheel right as the mission is initiated.\r\n\r\n<img width=\"815\" alt=\"Screen Shot 2020-05-06 at 4 09 07 PM\" src=\"https://user-images.githubusercontent.com/31726584/81230497-38072180-8fb7-11ea-9942-27b46c07db99.png\">\r\n\r\nhttps://review.px4.io/plot_app?log=25ce0df8-15d6-4591-8578-83042921cffe - This is similar but not as severe as the previous log (still has huge wheel swings though).\r\n\r\nhttps://review.px4.io/plot_app?log=53e17faa-3f52-4a3f-8e7e-b2d8c8ede219 - This log is interesting that the aircraft was purposely moved to the corner of the runway because the previous flights had it going to the right during the takeoff portion and it sill went much too hard right and then off the runway.\r\n\r\n<img width=\"825\" alt=\"Screen Shot 2020-05-06 at 4 35 30 PM\" src=\"https://user-images.githubusercontent.com/31726584/81230726-a1873000-8fb7-11ea-846f-1522b97372cc.png\">\r\n\r\n\r\nhttps://review.px4.io/plot_app?log=ee6bef2c-167c-4d43-ae96-8ac2144df2e1 - This takes off successfully because of the large area, thats the only reason. There is video of the takeoff if need be.\r\n\r\nhttps://review.px4.io/plot_app?log=bc807a89-07c1-44ac-836b-7d9e09ee7d0a - This log actually doenst look as bad except if you zoom out and look at the first waypoint, it's still off to the left.\r\n\r\n\r\nhttps://review.px4.io/plot_app?log=668ab1af-c9f8-4c30-b6fb-f26b998c85b4 - This log takes off successfully but zoom into the wheel output. It's successful because the area used was large and it has the time and room to recover and/or just get airborne.\r\n\r\nhttps://review.px4.io/plot_app?log=bac42025-4d70-45d3-ae4c-39c781328b01 This was a taxi test but still shows rapid oscillation (so throttle is only at 30%).\r\n \r\n<img width=\"811\" alt=\"Screen Shot 2020-05-06 at 4 48 22 PM\" src=\"https://user-images.githubusercontent.com/31726584/81231820-6c7bdd00-8fb9-11ea-84cd-6ed33cc17f38.png\">\r\n\r\nhttps://review.px4.io/plot_app?log=cbb044ac-211d-49f9-86b9-3d0702427cbe - Same place, post taxi test (same wheel rate settings) and less rapid oscillation but still really bad, had to abort since about to go off runway.\r\n\r\n<img width=\"813\" alt=\"Screen Shot 2020-05-06 at 5 01 44 PM\" src=\"https://user-images.githubusercontent.com/31726584/81233100-b5cd2c00-8fbb-11ea-9a40-f8fe560be6eb.png\">\r\n\r\nhttps://review.px4.io/plot_app?log=08ff0f58-b264-49b0-a694-58eab9b76ffd\r\n\r\n\r\nhttps://review.px4.io/plot_app?log=bd117170-1dca-42a8-a309-58b537296419\r\n\r\nBelow are a collection more, some are very extreme, some less. Multiple combinations of the wheel rate parameters were altered but this still represents multiple settings where oscillation occurred severely.\r\n\r\nhttps://review.px4.io/plot_app?log=7758631a-a5ae-4ead-97b4-f496cfa2a3c8\r\nhttps://review.px4.io/plot_app?log=10e31631-552f-4585-b1f4-bc73da6ac094\r\nhttps://review.px4.io/plot_app?log=75486b4a-385b-47a6-a851-c54ae909c077\r\nhttps://review.px4.io/plot_app?log=d6d43381-14ac-4ba7-9cf2-f9b68d0ed7b7\r\nhttps://review.px4.io/plot_app?log=b0be9c38-62e5-4cee-9f2e-9c40b603c143\r\nhttps://review.px4.io/plot_app?log=c1dcab38-8c6b-42a8-91a2-4e89ab1ec26a\r\nhttps://review.px4.io/plot_app?log=6130efca-f4dd-4a81-b648-f1ed5424f585\r\nÂ https://review.px4.io/plot_app?log=e7e3027f-8cf0-4ef8-ace5-640383a2775b\r\nhttps://review.px4.io/plot_app?log=6130efca-f4dd-4a81-b648-f1ed5424f585\r\nhttps://review.px4.io/plot_app?log=7c70673a-5d26-4996-9de1-35e1b1633d3c\r\n\r\n@dagar - as discussed\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Misfire at catapult launch (custom FW version 1.7.2)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14838",
  "body": "**Describe the bug**\r\nFrom 55 test flights we had 2x misfire at catapult launch. It looks like PWM was not send on ESC and motor didn't start. I need suggestion what to check in ulg files.\r\n\r\n**To Reproduce**\r\nWe do not know how to reproduce.\r\n\r\n**Expected behavior**\r\nMotor should always start at catapult launch\r\n\r\n**Log Files and Screenshots**\r\nULG files\r\n[misfire2x.zip](https://github.com/PX4/Firmware/files/4583095/misfire2x.zip)\r\nor\r\nhttps://review.px4.io/plot_app?log=530849b9-21cb-4097-9acb-cf0d311b97bf\r\nhttps://review.px4.io/plot_app?log=b78cdaff-b13b-43a9-8d57-0168c43b90e7\r\n\r\n**Drone (please complete the following information):**\r\nhttps://www.unmannedtechshop.co.uk/product/unmanned-pixhawk-autopilot-kit/\r\npixhawk 2 fmuv2\r\nStack: PX4 Pro\r\nVehicle: Fixed wing\r\nFW Version: 1.7.2 custom build\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "mc_pos_control: fix takeoff ramp gets amended by feed-forward",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/14821",
  "body": "**Describe problem solved by this pull request**\r\nI found an issue with the takeoff ramp when real world testing https://github.com/PX4/Firmware/pull/14749 on the Holybro QAV250. But I found the issue is independent of that pr.\r\n\r\nThe thrust doesn't ramp nicely anymore like it was designed but depending on stick input can go up and down unexpectedly during the ramp up. This can lead to early land detection if the thrust goes up high enough and then back down because the ramp is not yet high enough.\r\n\r\nThe problem is: Because the takeoff ramp is a vertical velocity limit ramp for the nice user experience but the acceleration feed-forward can add on top of the output and depending on trajectory generation result in unwanted thrust changes during the ramp.\r\n\r\n**Describe your solution**\r\nI suppress the vertical acceleration feed-forward during the ramp.\r\n\r\n**Test data / coverage**\r\nIt's reproducable in SITL with the correct configuration:\r\n`MPC_TKO_RAMP_T` 5, `MPC_JERK_MAX` 20\r\n1. Switch to position mode\r\n2. Arm\r\n3. Fully rise the throttle stick\r\n\r\nBefore: https://review.px4.io/plot_app?log=ba57f51e-abaf-4990-ad34-64b3cef56d11\r\n![image](https://user-images.githubusercontent.com/4668506/80960930-27657880-8e0a-11ea-854d-0b59169d5c9a.png)\r\nAfter: https://review.px4.io/plot_app?log=532b6cdd-5101-4007-82b6-529b1491e85b\r\n![image](https://user-images.githubusercontent.com/4668506/80960966-3a784880-8e0a-11ea-8318-54b2023b1d2d.png)\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/14821",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/14821",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/14821.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/14821.patch",
    "merged_at": "2020-05-04T14:10:37Z"
  }
}
{
  "title": "EKF2 velocity estimate wrong - v1.11-beta",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14735",
  "body": "**Describe the bug**\r\nWe are flying in indoor environments with VIO, and while testing recently, discovered that the EKF's velocity estimate significantly differed from that provided by the vision system. We don't know if this is a new issue, or whether this already existed before, since we have not flown this setup so extensively before. We also only recently plumbed the vision system's velocity estimate through to PX4, so it's easy to confirm the issue now.\r\n\r\n*EDIT: older logs (~1 mo old - upstream `d7a9b123e6b84df4a7c01daaac64706c39abd3d7`) don't show this velocity offset, and have lower vibration levels. I think the on-sensor DLPF was disabled between then and now.* https://logs.px4.io/plot_app?log=ff62827a-7eff-45c6-b2e6-6ea22cd087c6\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/80012224-f8aae200-849a-11ea-8594-8472c7f0853b.png)\r\n\r\n**Expected behavior**\r\nThe velocity estimate matches the one provided by the vision system, which is accurate and has been benchmarked against groundtruth. Also the vehicle was flying in a straight line, and that velocity offset wasn't actually there in real life.\r\n\r\n**Log Files and Screenshots**\r\nHere are two logs from boot illustrating the issue. The first one is without velocity fusion enabled, and the second one is with velocity fusion enabled (which doesn't make much of a difference).\r\n\r\n1. EKF2_AID_MASK = 24 (ev pos, ev yaw): https://logs.px4.io/plot_app?log=6eb5a9cb-a4e9-4b4a-89eb-e71e11419670\r\n2. EKF2_AID_MASK = 280 (ev pos, ev yaw, ev vel): https://logs.px4.io/plot_app?log=dcb3b53b-07d2-4db9-a118-592ef82d5cba\r\n\r\nThese are both replayable. Our branch is based on upstream `746b3124abe9df486c6d88a3d9ec0c438e63654d`\r\n\r\n#### First log\r\nAccel bias estimate:\r\n![image](https://user-images.githubusercontent.com/5557676/80014423-470db000-849e-11ea-9028-a36471ee2864.png)\r\n\r\nVelocity estimates:\r\n![image](https://user-images.githubusercontent.com/5557676/80014748-bb485380-849e-11ea-9c1d-a0703bd55958.png)\r\n\r\n#### Second log\r\nAccel bias estimate:\r\n![image](https://user-images.githubusercontent.com/5557676/80014567-7a503f00-849e-11ea-940e-11f289aad6bf.png)\r\n\r\nVelocity estimate:\r\n![image](https://user-images.githubusercontent.com/5557676/80014810-d6b35e80-849e-11ea-9c49-2de800e50f8d.png)\r\n\r\n#### Last good log\r\nhttps://logs.px4.io/plot_app?log=ff62827a-7eff-45c6-b2e6-6ea22cd087c6\r\n\r\nBased on upstream `d7a9b123e6b84df4a7c01daaac64706c39abd3d7`\r\n\r\n**Drone (please complete the following information):**\r\n- 550 sized carbon quadcopter.\r\n- Hardmounted Pixhawk 4.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[VTOL] Front transition deviates",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14718",
  "body": "**Describe the bug**\r\nDuring the front transition, the drone rolls into the wrong direction and deviates from the expected path. Observed in SITL, probably linked to https://github.com/PX4/Firmware/pull/14405 @RomanBapst \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run SITL: `make px4_sitl gazebo_standard_vtol`\r\n2. Launch a mission with a vtol takeoff and transition waypoint \r\n3. Observe\r\n\r\n**Expected behavior**\r\nThe drone should face / fly towards the front transition waypoint \r\n\r\n**Log Files and Screenshots**\r\nLog file: (transition northwards) https://logs.px4.io/plot_app?log=af78e5c4-99fc-46fb-924c-c706a9fe6964\r\n\r\nSimilar behaviour when transitioning towards East or South:\r\n![image](https://user-images.githubusercontent.com/48206725/79860129-6dfeb000-83d2-11ea-84d6-19be4600bafd.png)\r\n\r\n**Drone (please complete the following information):**\r\n- SITL standard VTOL on Gazebo\r\n- run on master from 20.04.2020\r\n\r\n**Additional context**\r\nGoing through the code changes of https://github.com/PX4/Firmware/pull/14405, I additionally noticed the hard coded limit in https://github.com/PX4/Firmware/blob/809b45eac89cd89cb20a9a5cba646396ef136730/src/modules/vtol_att_control/vtol_type.cpp#L193 that I would prefer to have as a parameter and a comment that should be adapted at https://github.com/PX4/Firmware/blob/809b45eac89cd89cb20a9a5cba646396ef136730/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L1579 to include the transitions.\r\n\r\nI think there is also a problem with the yaw alignment when the drone initiates the transition. It still rotates at around 45Â°/s in the log shared above. But that's I guess a separate point.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC throttle drop STABILIZED -> ALTCTL (v1.11.0-beta1)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14704",
  "body": "\"if take off in stable mode, then change to altitude hold mode; the altitude drops quickly\"\r\n\r\nhttps://logs.px4.io/plot_app?log=6b774a27-5f7a-403f-ade2-0c53df838ebc\r\n\r\n![Screenshot from 2020-04-19 11-41-28](https://user-images.githubusercontent.com/84712/79692370-bb441b80-8232-11ea-9092-0f38d3348c16.png)\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Multicopter v1.11 beta testing - max throttle is suddenly asserted",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14677",
  "body": "https://logs.px4.io/plot_app?log=23c4f03d-819d-4f6e-a9fa-f6a8fdc57e01",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Unstable GPS data while using the 2nd telemetry on TELEM2 port - v1.11.0-beta1",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14659",
  "body": "**Describe the bug**\r\nHi, I found very strange GPS behavior after uploaded \"v1.11.0-beta1\" to pixhawk 4. Firstly, I configured MAV_1_CONFIG = TELEM2 (My UAV has been flown using this config. before since firmware v1.8.2, v1.9.2 and v1.10.2 and I got no error). Then, I investigated using\"mavlink inspector\" in QGC and take a look at GPS_RAW_INT. \r\n\r\nGPS signal seems unstable, the fluctuation ranges from 0 to 5 Hz. It should be a constant value or nearly constant (compared with an older firmware, I have already tested before).\r\n\r\nFinally, the result is the flight mode could not be changed from ALTITUDE to POSITION, No Green GPS LED light visible. I managed the test as follows \r\n\r\n**To Reproduce / Test Case**\r\nCase 1: v1.11.0-beta1 --> OK\r\nMAV_1_CONFIG = Disabled\r\nhttps://review.px4.io/plot_app?log=9764baca-ec06-40aa-b1ba-79719d0b75fc\r\n\r\nCase 2: v1.11.0-beta1 --> Error / ubx msg warning\r\nMAV_1_CONFIG = TELEM2\r\nhttps://review.px4.io/plot_app?log=a670c429-592e-4e52-a200-b811bd45f14d\r\n\r\nCase 3: v1.11.0-beta1 --> OK\r\nMAV_1_CONFIG = TELEM/SERIAL4 \r\nhttps://review.px4.io/plot_app?log=98b8c1ec-d492-48b5-823a-870af29e5686\r\n\r\nCase 4:  v1.11.0-beta1 --> Error / ubx msg warning\r\nMAV_2_CONFIG =  TELEM2  \r\n\r\nCase 5: v1.11.0-beta1 --> OK\r\nMAV_2_CONFIG =  TELEM/SERIAL4 \r\n\r\nCase 6: v1.11.0-beta1 --> Error / ubx msg warning\r\nMAV_1_CONFIG = TELEM/SERIAL4 \r\nMAV_2_CONFIG =  TELEM2  \r\n\r\nCase 7: v1.10.1 --> OK (compare to Case 2 v1.11.0-beta1. It is not the same result even config. is the same)\r\nMAV_1_CONFIG = TELEM2\r\nhttps://review.px4.io/plot_app?log=29bea816-da9d-4cd4-b042-c0fdb14e489d\r\n\r\nThe error is the same whether telemetry is available on that port or not, indoor or outdoor if I configure MAV_X_CONFIG to TELEM2. According to the flight log of Case 2, you will see the strange GPS behavior at \"GPS Uncertainty and GPS Noise & Jamming\". In every test case, Telemetry works fine.\r\n\r\nHowever, GPS works fine if I upload the older firmware \"v1.10.1\" (v1.8.2 / v1.9.2 is the same) Is it firmware bug ? or Did I miss anything?\r\n\r\n**Drone (please complete the following information):**\r\n- Describe the type of drone: Tiltrotor using E-flite Convergence airframe\r\n- Hardware: Pixhawk4 + GPS pixhawk 4 + Holybro telemetry\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "bad altitude hold v1.11.0-beta1 vs v1.10.0",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14640",
  "body": "User reported worse altitude hold after upgrading from PX4 stable v1.10.0 to the current v1.11 beta.\r\n\r\n### v1.10.1\r\n - https://review.px4.io/plot_app?log=664c4e7a-9bb1-423f-935f-5abbf69f6170\r\n - (**new 2020-04-22**) https://review.px4.io/plot_app?log=d26da1f6-24a8-43e3-aadc-0bf5a634d86f\r\n\r\n### master (slightly before v1.11.0-beta1 with old IMU drivers)\r\n - https://review.px4.io/plot_app?log=ba162746-c163-4b68-9259-251410e4d053\r\n\r\n### v1.11.0-beta1\r\n - (windy): https://review.px4.io/plot_app?log=c27b7984-de30-4f85-ac27-4b6083007d02\r\n - (windy): https://review.px4.io/plot_app?log=672dcf31-f717-4136-830e-e20fd5e80038\r\n - https://review.px4.io/plot_app?log=047d7d42-f16f-4dfd-a9a2-33613455eeeb\r\n - (**new 2020-04-22**): https://review.px4.io/plot_app?log=e625d55b-613c-43f8-bad7-ce666000b264\r\n - (**new 2020-04-22**): EKF2_HGT_MODE=GPS https://review.px4.io/plot_app?log=7f123d8b-0c5d-4188-88b8-df5752340d4d\r\n - (**new 2020-04-22**): EKF2_BARO_NOISE baro noise tuning: https://review.px4.io/plot_app?log=d178c0b5-b863-4038-bead-9026c0a0a598\r\n\r\n\r\n### Local Position Z (v1.10.0 vs v1.11.0-beta1)\r\n![Screenshot from 2020-04-10 11-16-18](https://user-images.githubusercontent.com/84712/79001600-bb4e6800-7b1c-11ea-90c8-4d77405c2f78.png)\r\n\r\n### Velocity Z (v1.10.0 vs v1.11.0-beta1)\r\n![Screenshot from 2020-04-10 11-18-58](https://user-images.githubusercontent.com/84712/79001772-1d0ed200-7b1d-11ea-92f9-e6196679637f.png)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "imu rotation issue",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14612",
  "body": "**Describe the bug**\r\nThe first IMU of my cube black have a bad rotation.\r\n\r\n**To Reproduce**\r\n- flash a cube black with master\r\n- (reset all acc off to 0 and scale to 1 and reboot)\r\n- see estimated orientation or sensors measures (my cube was leveled) :\r\n![image](https://user-images.githubusercontent.com/59083163/78683411-890bf300-78ef-11ea-9aee-1b321347a1aa.png)\r\n\r\n\r\n**Expected behavior**\r\nAcc 0 should measure about -9.81m/s/s not +9.81\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=9531c76c-abd9-4656-9fd1-3d50dbc8ced5\r\n\r\n**Additional context**\r\n@bkueng it was ok at 2f3174abb0ee2503a94d8b41b99e729fc1946ebb and not after 532ccd18ad2d82f72a33d1c0915a50b49f53eada\r\n\r\nAnother issue happened when I tried to calibrated the acceleros with this issue: scales of imu 1 and 2 were negative.\r\nShouldn't be great to have test on this",
  "state": "closed",
  "pull_request": null
}
{
  "title": "logger watchdog triggered on FW fmu-v5",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14600",
  "body": "https://logs.px4.io/plot_app?log=b815c6b1-707c-4a9b-bdf3-5bb7f41af758\r\nCPU usage went to 100% shortly after arming due to the logger watchdog triggering.\r\n\r\n\r\n![Screenshot from 2020-04-05 13-04-37](https://user-images.githubusercontent.com/84712/78504931-0859c500-773e-11ea-9bcb-095914384391.png)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[Gazebo][Tailsitter] Drone angle is unstable when fw to mc",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14588",
  "body": "**Describe the bug**\r\nI used the latest mastre branch and performed the gazebo_tailsitter test. I found that when I choose fw to mc, the drone attitude is unstable!\r\n\r\nI'm not sure if this is a simulation problem? Or is there a mistake in the recent changes?\r\n\r\n**To Reproduce**\r\n\r\n1. make px4_sitl gazebo_tailsitter\r\n2. open QGC ,send takeoff\r\n3. switch mc to fw\r\n4. Wait a minute\r\n5. switch fw to mc\r\n6. see unstable angle(by gazebo display)\r\n\r\n**Expected behavior**\r\nhave stable back-transmission\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=25a0b4df-5602-4274-8d8f-b933c0dff8ac\r\n\r\n![11111](https://user-images.githubusercontent.com/24932258/78357807-aa659a00-75e4-11ea-88d8-13998196e639.png)\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[uorb] sensor_mag advertise failed (5)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14579",
  "body": "**Describe the bug**\r\nOn the Pixhawk cube, the ULog file is full off these logged messages: \"[uorb] sensor_mag advertise failed (5)\"\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Upload the latest stable PX4 firmware (v1.10.1)\r\n2. Boot UAV and start logging (via shell \"logger on\")\r\n3. Stop logging after a short time (\"logger stop\")\r\n4. Open ULog, see messages\r\n\r\n**Expected behavior**\r\nThere should be no error when the sensor_mag message is advertised\r\n\r\n**Log Files and Screenshots**\r\n*Always* provide a link to the flight log file:\r\n- Uploaded fresh firmware, no configuration done ([PX4 Flight Review](https://logs.px4.io/plot_app?log=2ddaa946-d048-4160-a762-a151b25efb83)).\r\n- Did the basic config (choose airframe, calibrate sensors, etc) ([PX4 Flight Review](https://logs.px4.io/plot_app?log=ceb8e90c-d4f8-4a30-8de9-fe4f771f944b)).\r\n\r\n**Drone (please complete the following information):**\r\n- Octocopter\r\n- Pixhawk Cube\r\n- Here+ gps\r\n\r\n**Additional context**\r\nThis started when uploaded a modified 1.10.0 version for the first time, previously there was a modified 1.8.x version of the PX4 firmware. \r\nOn a second Pixhawk (Pixhawk 1) this problem does not occur.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Battery emergency RTL initiate climb command, even if drone already landing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14479",
  "body": "**Describe the bug**\r\nI found on a flight that I have came to nearly empty battery that there is something that look to me like bug in the emergency and critical battery logic.\r\nI started to land in nearly empty battery, but then the emergency battery logic intiated, and instead of continue landing, it started to RTL (climbing), I took control to RC and landed.\r\nit seems that COM_LOW_BAT_ACT doesn't respect the current flight mode, and if the drone has already started to land, it can re-initiate action, that might be climbing.\r\n\r\n**To Reproduce**\r\n * in order to reproduce easily in simulator I have changed the next parameters:\r\nBAT_LOW_THR = 30%\r\nBAT_EMERGEN_THR  = 20%\r\nBAT_CRIT_THR = 10%\r\nCOM_LOW_BAT_ACT = 3 (Return mode at critically low level, Land mode at current position if reaching dangerously low levels)\r\nRTL_RETURN_ALT = 100m\r\nSIM_BAT_MIN_PCT = 0%\r\n\r\n * take-off\r\n * fly to another location\r\n * climb to 20m\r\n * wait that the battery will get to ~30% and start land\r\n * the RTL will be initiated, starting with climbing (and here the bug)\r\n\r\n**Expected behavior**\r\nin case of already started landing, don't initiate RTL. and don't re-initiate landing\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=c50117f1-3f81-4141-af5f-5e905ea239e5\r\n![image](https://user-images.githubusercontent.com/29940676/77550563-ecdaf880-6eb9-11ea-8598-910b5f52d097.png)\r\n\r\n\r\n**Drone (please complete the following information):**\r\n- simulation (master 25/3/2020)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "AutoSmoothVel: Fix straight line autocontinue",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/14476",
  "body": "This fixes the issue that makes the drone slow-down even in straight lines due to the Z component being constrained to a really small value.\r\n\r\nWith master:\r\nhttps://logs.px4.io/plot_app?log=f7efacca-6262-4a65-b4e2-39c7e4f2f5bb\r\n![2020-03-25_14-34-27_01_plot](https://user-images.githubusercontent.com/14822839/77541925-b2676080-6ea5-11ea-83fa-9aac67a414f3.png)\r\n\r\nThis PR:\r\nhttps://logs.px4.io/plot_app?log=1692b126-f195-48c1-8150-2b1b499a900e\r\n![2020-03-25_14-30-07_01_plot](https://user-images.githubusercontent.com/14822839/77541555-19d0e080-6ea5-11ea-9117-020ddfb92836.png)\r\n\r\nThanks @jkflying for the help.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/14476",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/14476",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/14476.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/14476.patch",
    "merged_at": "2020-03-26T07:31:11Z"
  }
}
{
  "title": "Position control failure when MPC_TILTMAX_AIR >= 90 degrees",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14456",
  "body": "**Describe the bug**\r\nA tilt parameter of 90 (or more) degrees creates invalid setpoints in the position controller\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Takeoff in stabilized/altitude\r\n2. Set `MPC_TILTMAX_AIR` >=90\r\n3. Switch to position control\r\n```\r\npxh> param set MPC_TILTMAX_AIR 90\r\n+ MPC_TILTMAX_AIR: curr: 45.0000 -> new: 90.0000\r\npxh> WARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] Failsafe: stop and wait\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\nWARN  [mc_pos_control] PositionControl: invalid setpoints\r\n```\r\n\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=c772812b-eba6-47f0-b2ed-965f2e1d9f4a",
  "state": "closed",
  "pull_request": null
}
{
  "title": "SITL jmavsim crazy pitch rate oscillations",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14303",
  "body": "**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. master on this commit https://github.com/PX4/Firmware/commit/2b087a92c277d542405c79fd98e99e5ccfb358ca\r\n2. run `make px4_sitl jmavsim`\r\n3. immediately switch to altitude mode and takeoff by pushing up with the stick\r\n4. Don't move the sticks anymore and see the drone having fast and extreme pitch oscillation for multiple seconds\r\n\r\n**Expected behavior**\r\nThere used to be stable flight from the beginning on.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=44c727a2-9b7c-43e7-b86d-f4d58e5e50d3\r\n![image](https://user-images.githubusercontent.com/4668506/75981578-16b98480-5ee5-11ea-9515-f98cd07ffddf.png)\r\n\r\n**Additional context**\r\n- ~Suspect might be https://github.com/PX4/Firmware/pull/14228 (NOT YET VERIFIED)~\r\nI'll do some further testing to narrow it down.\r\n\r\n~FYI @TSC21 @Jaeyoung-Lim~ \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fixed-wing position controller not ouputting attitude setpoints if GPS switched off in altitude mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14243",
  "body": "**Describe the bug**\r\nFixed-wing altitude mode doesn't work without GPS data because it seems to run only with a [valid global position](https://github.com/PX4/Firmware/blob/18754225c93ee18c76c227cc66f687835e4a0046/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L1481). \r\nIt is though currently possible to switch to altitude flight mode (at least for a VTOL) without a GPS connected.\r\n\r\n**To Reproduce**\r\nIn sitl, fly a VTOL in fixed-wing mode or a plane, and disable GPS fusing in air by setting the EKF2_AID_MASK to 0. Switch to stabilized and back to altitude mode.\r\n\r\n**Expected behavior**\r\nI expect that altitude flight mode works without issues after a GPS loss (at least with valid baro data).\r\nTill we have that we should disable the ability to switch to altitude flight mode if you don't have a valid global position (resp. for VTOL disable transition to FW mode in altitude mode).\r\n\r\n**Log Files and Screenshots**\r\nThis is a sitl flight where I disabled GPS fusing in air (by setting the EKF2_AID_MASK to 0). When then switching out and in again into altitude flight mode, the attidue sp and control signals are frozen. \r\nhttps://review.px4.io/plot_app?log=3cfedd2d-14e0-4f6f-8afd-781823577aa6\r\n\r\nAdd screenshots to help explain your problem.\r\n\r\n**Additional context**\r\nI became aware of this problem recently while flying a VTOL without GPS sensor.\r\n\r\nShould we maybe split TECS and L1 into separate modules @RomanBapst @dagar ? Just as an effort to disentangle this all a bit.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ROS test of tiltrotor fails",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14200",
  "body": "The ROS test of tiltrotor started failing in CI and this can also be reproduced locally:\r\n\r\n```\r\nPX4_DOCKER_REPO=px4io/px4-dev-ros-melodic:2020-02-11 Tools/docker_run.sh bash\r\nDONT_RUN=1 make px4_sitl gazebo\r\ntest/rostest_px4_run.sh mavros_posix_test_mission.test mission:=VTOL_mission_1 vehicle:=tiltrotor\r\n```\r\n\r\nWhat happens is that the tiltrotor does not actually seem to take off but only switches to in-air for about 1 second and then auto-disarms again. I have seen this manually in testing as well, especially with tailsitter.\r\n\r\nTest output:\r\n```\r\nINFO  [ecl/EKF] 5188000: reset position to GPS\r\nINFO  [ecl/EKF] 5188000: reset velocity to GPS\r\nINFO  [ecl/EKF] 5188000: commencing GPS fusion\r\n[ INFO] [1582276040.013415824, 17.360000000]: WP: mission received\r\n[ INFO] [1582276040.660517600, 18.004000000]: WP: mission sended\r\n[ WARN] [1582276041.664164514, 19.012000000]: CMD: Unexpected command 176, result 0\r\n[ INFO] [1582276042.674148856, 20.020000000]: FCU: ARMED by Arm/Disarm component command\r\n[ INFO] [1582276042.726149218, 20.072000000]: FCU: Takeoff to 15.0 meters above home.\r\nINFO  [commander] Takeoff detected\r\n[ INFO] [1582276049.615119419, 26.948000000]: FCU: Takeoff detected\r\nINFO  [commander] Landing detected\r\n[ INFO] [1582276050.309446351, 27.640000000]: FCU: Landing detected\r\n[ INFO] [1582276050.421811711, 27.752000000]: FCU: DISARMED by Auto disarm initiated\r\nINFO  [logger] closed logfile, bytes written: 2344626\r\n\r\nPX4 Exiting...\r\nShutting down\r\n[Testcase: testVTOL_mission_1] ... ok\r\n\r\n[ROSTEST]-----------------------------------------------------------------------\r\n\r\n[px4.rosunit-VTOL_mission_1/test_mission][FAILURE]------------------------------\r\nposition not reached | lat: 47.397736151, lon: 8.547064163, alt: 503.05, current pos_xy_d: 110.65, current pos_z_d: 14.77, best pos_xy_d: 110.47, best pos_z_d: 14.24, index: 0 | timeout(seconds): 60\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 329, in run\r\n    testMethod()\r\n  File \"/home/julianoes/src/Firmware/integrationtests/python_src/px4_it/mavros/mission_test.py\", line 271, in test_mission\r\n    index)\r\n  File \"/home/julianoes/src/Firmware/integrationtests/python_src/px4_it/mavros/mission_test.py\", line 228, in reach_position\r\n    best_pos_z_d, index, timeout))\r\n  File \"/usr/lib/python2.7/unittest/case.py\", line 422, in assertTrue\r\n    raise self.failureException(msg)\r\n--------------------------------------------------------------------------------\r\n\r\n\r\nSUMMARY\r\n * RESULT: FAIL\r\n * TESTS: 1\r\n * ERRORS: 0\r\n * FAILURES: 1\r\n```\r\n\r\nhttps://logs.px4.io/plot_app?log=feba07e1-cd9d-4ee6-8f77-f570f2ebc8fb",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 estimates for x and y unstable with constant optical flow innovation ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14165",
  "body": "Hey everyone,\r\nfirst of all shoutout for your great work, it's really impressive.\r\n\r\nRemark: In hindsight I've written quite a long story here, but I hope providing what I figured out help digging into the problem faster.\r\n\r\nI'm currently working with the Intel Aero RTF drone with the PX4 v1.9.0 firmware. I'm trying to fly indoors (hence no GPS) with ORB-SLAM2. This basically works already, fusing the data to the EKF2 via /mavros/vision_pose/pose. However, I experienced undesired behavior if SLAM fails (e.g. when it looses track after fast motions). I thought it should be possible to still get decent state estimates using only internal sensors, PX4Flow, and the LeddarOne distance sensor (the sonar on the PX4Flow board is still active but not used. Also I'm sharing the Telemetry port for PX4flow and LeddarOne as suggested here https://github.com/intel-aero/meta-intel-aero/issues/315#issuecomment-391439235).\r\n\r\nSo I did some experiments without SLAM running, and dragging around the drone by hand only for safety. Indeed, the position and velocity estimates are quite ok for multiple minutes (note that I put down the drone from time to time to observe the integration drifts). But at some point x and y drift off devastatingly and need to be resetted by the EKF2 all the time. I'm not sure why this happens. All I found out (using fw_px4_plottools) is that the optical flow innovations just freeze at some point and that's exactly the timestamp when everything gets messy. I'm not sure whether that's the cause or just another effect though. Note that also lifting the drone to a height where optical flow values should be plausible didn't make it recover anymore.\r\n\r\nThe z position / velocity do not seem to be affected. However, I noticed an issue there as well, although I personally can't see any connection: there are non-zero z-velocities (up to 0.4m/s), even when the drone is standing still and the z position is constant. Thinking of their kinematic relationship, that doesn't really make sense. Looking at some plots one could think they behave the same way, i.e. z velocity is just a scaled version of z position (which would explain why it's static and then it'd only be a bug in the log). Also looking at different static phases, the z positions are not necessarily equal (although the floor is the same). I saw that the LeddarOne tends to output 0 when the drone is on the floor, so I tried to fix this by forcing EKF2_MIN_RNG to 0.0m, but it didn't do the trick.\r\n\r\nHere are two logs where the drone is dragged around and xy goes nuts after some minutes.\r\nhttps://logs.px4.io/plot_app?log=91bc8ed4-6044-45e8-bfcf-5416976ad011\r\nhttps://logs.px4.io/plot_app?log=907f8a65-388e-40ad-83d9-3bdee61bc29c\r\n\r\nHere's one log where I actually flew around with the RC using POSITION flight mode. Note how here first OF innovations go constant and simultaneoulsy xy drift off. But then when SLAM is fed xy recovers. However, apparently I lost SLAM at some point during flight and the drone skyrocketed to the left (as far as I can tell at a faster rate than I thought MPC_XY_VEL_MAX would allow).\r\nhttps://logs.px4.io/plot_app?log=af47b24a-1a44-4eee-898d-7f9a72c8412b\r\n\r\nHere are also 2 screenshots to show the main problem without the need of opening any logs, i.e. drifting xy position (and velocity) and constant optical flow innovations:\r\n![constant_flow_innovation_xy_drift](https://user-images.githubusercontent.com/46818571/74592643-77ab1680-5023-11ea-9731-9bb9127b42fa.png)\r\n\r\nThe third case makes clear why I want to make sure, a scenario without SLAM would lead to a safe landing at least. Hopefully some more experienced people can have a look at this and we find out whether it's my setup, some parameters, or the EKF2 (for the latter I assume @priseborough to be the ideal contact person). I'm of course happy to provide more info on my setup if needed.\r\n\r\nBest,\r\nDominik\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 stops, causing a flight termination",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14133",
  "body": "**Describe the bug**\r\nDuring flight, the ekf2 module stops publishing all messages, causing a flight termination.  \r\nIt is remarkable that before it's stops publishing, it publishes one more time all messages at the exact same moment and with exact same timestamp.  \r\nSensor data (sensor_combined, vehicle_magnetometer, etc) keeps publishing as expected.  \r\n\r\n**To Reproduce**\r\nThis occurred twice, no idea if it's possible to trigger it.  \r\n\r\n**Expected behavior**\r\nekf2 should keep working en publishing it's messages.  \r\n\r\n**Log Files and Screenshots**\r\n- [first log](https://logs.px4.io/plot_app?log=b40595e7-efe5-43dd-8594-7fa282d267ca) (17:28)\r\n- [second log](https://logs.px4.io/plot_app?log=61ed5269-868b-4e7c-bc16-e0ff5420335f) (8:12)\r\n_How can I delete location (gps) information before uploading the Ulogs?_\r\n\r\nScreenshot from plotted timestamps (sensors + ekf2), __added delay__ to view them separately.\r\n![Screenshot from 2020-02-06 18-03-56-2](https://user-images.githubusercontent.com/6920950/74146602-b72bca00-4c01-11ea-9ea6-c2d510b5f154.png)\r\n\r\n**Drone:**\r\n- generic quad-copter, with onboard companion computer\r\n- Pixhawk 1\r\n- Firmware PX4 v10.0.0 with small modifications\r\n\r\n**Additional context**\r\nFlight is mostly done in auto modes (takeoff, loiter, mission)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 10.0.1 Stable, Hard Fault in file:armv7-m/up_hardfault.c",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14075",
  "body": "Hello,\r\nI encountered an issue with PX4 1.10.1 Stable where the copter seems to make a 180Â° flip upside down. I am using a MoCap pose input over MavRos, mapped to the vision pose topic as described in the [tutorial](https://dev.px4.io/v1.10/en/ros/external_position_estimation.html ). The logs indicate that this seems to be a software crash, thus the movement might be a random result due to the underlying error. The Pixhawk 4 gives multiple beeper signals after engaging the killswitch.\r\nBoth logfiles below show 'Type:Hard Fault in file:armv7-m/up_hardfault.c at line: 148 running task: init'\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Map the MoCap pose to the vision pose topic\r\n2. Enable the vision pose estimate\r\n3. Start the copter in altitude mode and take off\r\n4. Switch to position mode\r\n5. The copter holds its position stable for ~5 seconds until the described issue occurs \r\n\r\n**Expected behavior**\r\nThe copter should hold its position.\r\n\r\n**Log Files**\r\nMoCap at 120Hz, the log indicates I2C3 low on the stack:\r\nhttps://logs.px4.io/plot_app?log=92b60ea2-4b1e-4fac-9402-e1c797494866\r\nMoCap at 30Hz, the log does not point out a clear error but the same issue occurred:\r\nhttps://logs.px4.io/plot_app?log=afa24f21-0f51-42a4-bd2e-9b90ef29b14c\r\n\r\n**Hardware**\r\nPixhawk 4 Holybro",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Huge amount of drifting on IRIS in SITL simulation",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14068",
  "body": "Hello,\r\n\r\nI am using IRIS for SITL simulation, I am using 4 quadrotors at the same time, all of them use the same PX4 version. Only one of them is facing a huge amount of drifting during the flight. \r\nHere is the last flight with this quadrotor\r\nhttps://logs.px4.io/plot_app?log=460f767c-25fe-4702-b910-66f3645203af\r\nYou can notice a spiral landing which I have been observing only with this one. \r\n\r\nAny thought?\r\nBest regards,\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Issue with landing PixRacer FMUV4_K66, FMUv5",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13956",
  "body": "**Describe the bug**\r\nWhen flying the vehicle in Mission mode and trigger RTL, upon landing the vehicle does not descend vertically but drifts away with the wind. I had to take command of the vehicle in position mode and landed the vehicle manually. This is an issue that we have seen constantly, with the PixRacer and K66, FMUv5. **We are seeing this issue when the wind is 6 m/s and over.** \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on \r\n2. Uploaded mission to the vehicle\r\n3. Took off in Mission Mode \r\n4. All commands were sent form QGC (Armed and takeoff)\r\n5. Once all waypoint completed vehicle switched to RTL\r\n6. When the vehicle was landing, it did not descend vertically, drifted away with the wind and landed the vehicle manually\r\n\r\n**Expected behavior**\r\nThe vehicle should land and disarm.\r\n\r\n**Log Files and Screenshots**\r\nThis is the latest PR tested with the PixRacer and issue persisted, Reference [#13678](https://github.com/PX4/Firmware/pull/13678)\r\nLogs: https://review.px4.io/plot_app?log=67a2120c-a473-43a3-a556-6a542f62f7b1\r\n\r\nIssue noticed on Reference  [#13701](https://github.com/PX4/Firmware/pull/13701\r\n), wind 10.2 m/s, PixRacer.\r\n\r\nIssue noticed on Reference [#13745](https://github.com/PX4/Firmware/pull/13745#event-2883456760), wind 10.2 m/s, PixRacer V4.\r\nLog: https://review.px4.io/plot_app?log=719ab88b-d993-47c8-a9ca-eaf429d4577e\r\n\r\nIssue noticed on Reference [#13613](https://github.com/PX4/Firmware/pull/13613#event-2837043850), 10.2 m / s, PixRacer V4.\r\nLogs: https://review.px4.io/plot_app?log=b0f1f872-fc9e-41ee-89e3-4e146862efc7\r\nLog: https://review.px4.io/plot_app?log=a8a1391c-06c0-475e-943a-48bea5da2e24\r\n\r\nIssue noticed on Reference [#13065](https://github.com/PX4/Firmware/pull/13065), NXP_FMUK66_V3, \r\nLogs: https://review.px4.io/plot_app?log=792db7ac-8738-4bdd-8a03-aa6d88b371b3\r\n\r\n\r\n**Drone (please complete the following information):**\r\n**PixRacer**\r\nFrame: DJI F450\r\nFlight Controller: PixRacer \r\nGPS: Readytosky M8N GPS Module Built-in Compass\r\nMotors: T Motor 2212-920kv\r\nPropellers: DJI Phantom Built-in Nut Upgrade Propellers - MR PH 9.4x5 \r\nReceiver: FrSky D4R-II 2.4G 4CH ACCST Telemetry Receiver\r\nTelemetry:Holibro Telemetry, 100mW Telemetry Radio V3 915MHz\r\nESC: Hobbywing XRotor 20A APAC Brushless ESC\r\nBattery: 3S 5200mAh(Hobbyking)\r\n\r\n**NXP:**\r\nVehicle description:  RDDRONE-FMUK66\r\nFlight Controller: FMUK66 \r\nFrame: ReadytoSky LJI X4 500\r\nMotors: ReadytoSky RS2212 920 kV CW & CCW  \r\nPropellers: LJI 9450 self-locking propellers\r\nGPS: Holybro Pixhawk 4 GPS\r\nESC: ReadytoSky 2-6S 40 A OPTO ESCs\r\nBattery: 3S 5200mAh \r\n\r\n**Additional context**\r\nWe will test when windy on Master and Stable and see if the issue persists. ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Vehicle starts to descend after backtransition, before reaching land waypoint",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13952",
  "body": "**Describe the bug**\r\nIn a VTOL mission with the last waypoint being a land waypoint and the previous ones being navigated as fixed wing, the expectation is that the vehicle transitions before reaching the land waypoint and only starts descending when horizontally reaching the land waypoint.\r\nHowever, on latest master the vehicle executes the transition and after it's completion immediately starts descending, even if it hasn't gotten close to the land waypoint.\r\n\r\n\r\n**To Reproduce**\r\nIn SITL (use standard vtol model) plan a mission using a VTOL takeoff item, a couple of way waypoints and lastly add a land waypoint. Due to the excessive drag of the gazebo model the vehicle will finish the transition back to hover well before it has gotten close to the land waypoint. However, you will see that while moving to the land waypoint for the landing it will start descending as well.\r\n\r\n\r\n**Expected behavior**\r\nThe vehicle should finish the back-transition, move to the landing waypoint while maintaining altitude and only start descending once the land waypoint has been reached.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=4769c91c-9c71-4db5-b98b-b580a3efa943\r\n\r\nAdd screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/7610489/72433595-b3e02280-37aa-11ea-9583-cb820edc5823.png)\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pixhawk 3 Pro v4_ failed connection to the RC",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13892",
  "body": "**Describe the bug**\r\nThe vehicle did not connect to RC, it would not let the user bind the RC nor calibrate, the same issue was noticed on Master it seems to be working on Stable firmware. This is a brand new flight controller shipped from Drotek, the previous flight controller had bad vibrations and the mag data looked bad. We suspect the issue was something electrical and the flight controller was replaced. Now we are having a failed connection to the RC.  \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nBinding Procedure:\r\n\r\nRC Steps:\r\n1- Turn on RC\r\n2- Activate Biding mode (RC will make beeping sounds)\r\n\r\nVehicle Steps:\r\n\"With the vehicle turned on\"\r\n1- Unplug the receptor\r\n2- Press Binding button and keep pressed\r\n3- Plug in receptor (without letting the binding button go) and make sure both red and green light of the receptor are turned on.\r\nRC Step\r\n1- Disable binding mode\r\nVehicle Step:\r\n1- Confirm binding by having the receptor with a solid green light on (algo confirm by moving flight modes switches.)\r\n\r\n**Log Files and Screenshots**\r\nPR13837: https://review.px4.io/plot_app?log=51c918b7-763c-41c8-b7c8-4a162be0fd3d\r\nMaster: https://review.px4.io/plot_app?log=e9b18b85-685e-4f30-8931-9bfdafbc159a\r\n![81888019_596289817600621_1788273439723749376_n](https://user-images.githubusercontent.com/39415493/72025384-ce575080-322c-11ea-88b9-ac3ce3e1d483.jpg)\r\n![81572634_469390607331633_522361898293788672_n](https://user-images.githubusercontent.com/39415493/72025419-ea5af200-322c-11ea-8ee1-09cbf3c265b8.png)\r\n![83031236_1268661076637838_3741699096512036864_n](https://user-images.githubusercontent.com/39415493/72025421-ec24b580-322c-11ea-8d17-60e68567841b.png)\r\n\r\n**Drone Information**\r\n- Pixhawk 3 Pro v4\r\n- DJI F450 Frame\r\n- CUAV GPS\r\n\r\n**Additional context**\r\n Below is the last working logs on Master for the Pixhawk Pro. The PixRacer seems to be working fine.\r\nFlight card 1\r\nLog: https://review.px4.io/plot_app?log=35d59e70-c3f1-4bfc-a76a-ec8de20261c3\r\nFlight card 2\r\nLog: https://review.px4.io/plot_app?log=0ebede1a-549f-4638-af23-7dcfe365e371\r\nFlight card 3\r\nLog: https://review.px4.io/plot_app?log=5bbb5e95-acd1-4fd1-a78d-5f2e028d8fb7\r\nFlight card 4\r\nLog: https://review.px4.io/plot_app?log=81e3f2bd-bcca-4263-9b00-20f9beea0d6a\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix and add warnings for RTL with invalid landing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13873",
  "body": "**Describe problem solved by this pull request**\r\nCurrently RTL skips this segment of code which displays an error if the vehicle is unable to use the mission.:\r\n`} else {\r\n\t\t\t\t// Otherwise use regular RTL.\r\n\t\t\t\tmavlink_log_critical(_navigator->get_mavlink_log_pub(), \"RTL: unable to use mission landing\");\r\n\t\t\t}`\r\nWe have also ran into issues with users missing this initial message. This has lead to users being confused as to why the fixedwing vehicle is not landing. \r\n\r\n**Describe your solution**\r\nThis gets rid of the dead code introduced previously, and fixes the bug with the warning message not being displayed. It also adds a message that displays every 30 seconds warning the user that the vehicle cannot use the mission landing. \r\n\r\n**Describe possible alternatives**\r\nThe best alternative would be to reject invalid missions and keep the current valid mission on the vehicle. This would get rid of an invalid landing being uploaded to the vehicle.  \r\n\r\n**Test data / coverage**\r\nThis was tested in SITL\r\nhttps://review.px4.io/plot_app?log=cfa987ce-62c4-4a50-b018-ca3456d892c3\r\n\r\nA version of this has also been in use on our Fixedwing vehicles since August. \r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/13873",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13873",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/13873.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/13873.patch",
    "merged_at": null
  }
}
{
  "title": "Altitude Fluctuation in Constant-Altitude Missions",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13793",
  "body": "**Describe the bug**\r\nWhen flying a basic mission with constant-altitude waypoints, the droneâ€™s altitude erroneously fluctuates. Our use-case requires a much more reliable altitude for precision deployment of sensors. Let me know if you can/can't reproduce this issue.\r\n\r\n![altitudegrpah2](https://user-images.githubusercontent.com/33331023/71501357-f2736480-281e-11ea-87d5-d1f1c158680b.PNG)\r\n\r\nNotice how the estimated altitude doesn't follow the setpoint altitude in mission mode (purple region), but it follows exactly in position mode (green region). This shows that the instruments and sensors are capable of producing altitude-accurate flight.\r\n\r\nI also posted this issue here: [https://discuss.px4.io/t/altitude-fluctuation-in-missions/14416](url)\r\n\r\n**To Reproduce**\r\n1. Use Pixhawk1 or Pixhawk Cube with 1.8.2, 1.9.2, or 1.10 firmware\r\n2. Upload mission detailed below\r\n3. Take off and start mission\r\n4. See drone fluctuate 1-2 meters from setpoint.\r\n\r\nMission:\r\n\r\nMission Start - 0m\r\nTakeoff - 8m rel to home\r\nWaypoint - 8m rel to home, 5sec hold\r\nWaypoint - 8m rel to home, 5sec hold\r\nWaypoint - 8m rel to home\r\nWaypoint - 8m rel to home\r\nWaypoint - 8m rel to home\r\nWaypoint - 8m rel to home\r\n\r\n**Expected behavior**\r\nI expect the drone's altitude to follow the setpoint altitude in mission mode with the same accuracy as position mode.\r\n\r\n**Log Files Analysis**\r\n[https://review.px4.io/plot_app?log=624517a3-9159-415c-8974-4fc790206f6f](url)\r\nMore log files for different missions are available upon request. They have all resulted in the same issue--despite using different setpoint altitudes and types of waypoints.\r\n\r\n**Drone**\r\nThis problem was reproduced on two drones; a Flamewheel 450 and a custom drone that is much larger--about 1 meter span between opposite motors. We tried multiple configurations for each drone consisting of Pixhawk 1, Pixhawk Cube, v1.8.2 PX4 and v1.9.2 PX4. For each Pixhawk, we used the standard recommended GPS. Both drones were adequately powered.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "LAND commanded but not land.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13754",
  "body": "**Describe the bug**\r\nLand was commanded, but vehicle is not landing at all.\r\n\r\n**To Reproduce**\r\nVehicle was hit on the wall, EKF lost a little bit. Then, land is keep commanded, but never land.\r\nVehicle was drifted along wind direction. And later, battery was drained, it finally landed.\r\n\r\n**Expected behavior**\r\nLand immediately.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=2b373434-6c98-4c93-bbc3-675000b4725d\r\n\r\n**Drone (please complete the following information):**\r\nFirmware is bit old version. 6e395fe885740f88aa633ce747fb12e950110cb0.\r\nHowever, I think this is not an issue.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Takeoff not happening when switching mode at the same time as arming",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13751",
  "body": "**Describe the bug**\r\nSadly I found another corner case of race condition with the thrust setpoint state when switching from Stabilized to a position controlled mode. I found that sometimes in SITL jMAVsim the drone instead of taking of when giving it the command just detects takeoff, landing and disarms.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. SITL jMAVsim on master\r\n2. Make sure it starts and stays in Manual mode\r\n3. Wait for GPS lock\r\n4. Send takeoff command from QGC\r\n5. See problem in ~ 1 out of 5 cases\r\n\r\n**Expected behavior**\r\nThe vehicle should still take off even if the takeoff command, mode transition and arming are basically instantaneous like in a SITL setup.\r\n\r\n**Log Files and Screenshots**\r\nExample log: https://logs.px4.io/plot_app?log=03e85548-bd0e-449a-a0cf-9a3b3426b46c\r\n![log_screen](https://user-images.githubusercontent.com/4668506/70867650-0a71fb00-1f78-11ea-829b-51570df6c678.PNG)\r\n\r\n**Additional context**\r\nThe problem is very similar to https://github.com/PX4/Firmware/issues/12171\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Durandal Mission transfer fail",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13732",
  "body": "**Describe the bug**\r\nWe were able to flash master on the latest QGC 3.5.6 on the Durandal flight controller. The problem is that we are getting a Mission transfer fail error message when loading the Mission on QGC. We tried with USB and Mission failed, USB and battery connected and Mission failed, it seems to work via Telemetry. We formatted the SD card and we encountered the same issue. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Make sure you have the latest QGC 3.5.6\r\n2. Flash firmware Master branch\r\n3. Uploaded mission to the vehicle\r\n4. Error message \"Mission transfer failed\" see picture below.\r\n![78786969_1548876298601624_6122367445408677888_n (1)](https://user-images.githubusercontent.com/39415493/70669964-b63fe180-1c2c-11ea-98e9-66581acb430c.png)\r\n\r\n**Log Files**\r\n**Modes Tested**\r\nPosition Mode: Good.\r\nAltitude Mode: Good.\r\nStabilized Mode: Good.\r\nMission Plan Mode (Automated): Good.RTL (Return To Land): Good.\r\nhttps://review.px4.io/plot_app?log=0a193cd7-9b3b-483f-86de-aea71489b32b\r\nhttps://review.px4.io/plot_app?log=62b6b784-7e3a-41c2-a47b-b27791a90635\r\n\r\n**Drone Information**\r\nFirmware: v1.10.0 (beta) (d6ffdc09)\r\nFlight Controller: Durandal(Holybro)\r\nGPS: Holybro GPS\r\nFrame: F450\r\nTelemetry: Holybro 915Mhz\r\n\r\n**Additional Note:**\r\nWhen we removed the SD card and uploaded the logs 2 flight logs were not saved on the SD card. The logs are shown on the SD but no information was registered. The total flights completed were 4 and only 2 flight logs registered the data. ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Bad system behavior when airspeed data disapears",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13697",
  "body": "There is some bad system behavior we've observed in legacy firmware (between v1.8-v1.9) related to airspeed data disappearing, for example if the I2C bus flakes out or if power is lost to the airspeed sensor.\r\n\r\nI submit this for review against the new airspeed selector work @sfuhrer and others are contributing in hopes the new airspeed features will robustly handle these difference cases.\r\n\r\nIf airspeed data suddenly disappears there are several bad behaviors:\r\n\r\n1. The system seems to keep sending the last known airspeed reading down the MAVlink pipe to the ground station (might need to be verified).  It should instead stop sending airspeed data if no new data is available.\r\n\r\n2. There are no warnings to the user that airspeed data has gone missing. There should be some warning inidcation if airspeed data is expected but disappeared.  There should also be an indication if it returns.  (note: similar data disappeared, data returned indications should be extended to all sensor types).\r\n\r\n3. On a failed takeoff, if the autopilot stops receiving airspeed data, the LandDetector may think the vehicle is still flying because the last reported airspeed still seems to be piping into the system. The motor may still run at full throttle! Ideally airpseed would stop updating and \"zero\" or \"null\" would be reported and the system would understand that it should not be using airspeed as part of the LandDetector.\r\n\r\n4. If airspeed disappears during flight there is no indication that it disappeared. TECS will silently switch to non-airspeed mode and not tell the user and by-passes the airspeed failsafe functionality. There should be warning indications and the airspeed failsafe functionality should be followed.\r\n\r\nHere are some flight logs showing the last example of airspeed data disappearing during the middle of a flight:\r\nhttps://review.px4.io/plot_app?log=d378dac5-1061-444d-ba8d-ee911c6315cf\r\nhttps://review.px4.io/plot_app?log=35be23c2-6bdf-4caa-9075-f9805b6d2035\r\nhttps://review.px4.io/plot_app?log=5ffc7018-9793-4b88-89a3-8066988b1e54\r\n\r\nFYI @sfuhrer ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "navigator: do not use fixed wing acceptance radius if in rotary wingâ€¦",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13693",
  "body": "This is an attempt to fix an issue which can seen in this [log file](https://logs.px4.io/plot_app?log=47b2b562-bd40-4137-ae46-ef34d17d5f21)\r\nWhat happens is that the VTOL starts to descend after the back-transition prior to arriving at the actual waypoint. This can be very dangerous e.g. when the vehicle is pushed away from the land waypoint during the transition. It will then start to descend while moving toward the land waypoint.\r\nThe behavior should be that the vehicle keeps altitude until it has reached the landing waypoint.\r\n\r\nI have first reproduced this behavior on 1.9.2 but it only happened once in a while and appeared to be a race condition. I figured out that in some cases the navigator was using the acceptance radius from the fixed wing position controller in order to determine if the landing waypoint has been reached. This is a bug as the fixed wing acceptance radius can be very large and should not be used during hover.\r\nI believe this fix here solves the issue on 1.9.2.\r\n\r\nHowever, when testing the same fix on master I figured that there is a new problem in master.\r\nFor some reason the altitude setpoint of the position_setpoint_triplet.current is set to a very low value (6m) right at the start of the back-transition. This value is then further used as altitude setpoint during the horizonal movement during the landing waypoint. I'm not sure what causes this but the effect is again that the vehicle descends while moving towards the land waypoint. This needs further investigation.\r\n\r\nThis can easily be reproduced in SITL using the standard vtol model.\r\nI'm further uploading the mission file which can be used to reproduce the problem. You might need to change the file extension to .plan\r\n[vtol_mission.LOG](https://github.com/PX4/Firmware/files/3932587/vtol_mission.LOG)\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/13693",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13693",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/13693.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/13693.patch",
    "merged_at": "2019-12-24T17:52:11Z"
  }
}
{
  "title": "Yaw during takeoff",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13675",
  "body": "**Describe the bug**\r\nSometimes I observe a multicopter doing a strange yaw back and forth right during takeoff.\r\n\r\n**To Reproduce**\r\nDo many takeoff in SITL and every now and then it's visible.\r\n\r\n**Expected behavior**\r\nIt should not yaw during takeoff, period.\r\n\r\n**Log Files and Screenshots**\r\n![17_39_47-yaw-on-takeoff](https://user-images.githubusercontent.com/1419688/70135447-64c2b000-168a-11ea-976a-6f576dc582fb.png)\r\n![14_03_52-yaw-on-takeoff](https://user-images.githubusercontent.com/1419688/70135449-64c2b000-168a-11ea-8778-48dca6c56703.png)\r\n\r\nhttps://logs.px4.io/plot_app?log=907be591-f04b-4187-8e5a-153435b0bfe1\r\nhttps://logs.px4.io/plot_app?log=bb0b86a5-a23c-4acd-a88a-fda4a8b6b78c\r\n\r\n**Drone (please complete the following information):**\r\n- The logs are from a VTOL takeoff without weathervane activated, however, I've also seen the behaviour with iris.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Error message \"unable to read from microSD\" when flying a mission with \"jump to item\"",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13592",
  "body": "**Describe the bug**\r\nWhen flying a mission on a VTOL with a \"jump to item\" in it, it does what it is supposed to do (go back to selected item and then continue the mission from there on again), but it gives the following error message every time it reaches the \"jump to item\" waypoint:\r\n![image](https://user-images.githubusercontent.com/26798987/69558813-2d2c7780-0fa9-11ea-8d0d-f8b3859a2831.png)\r\n\r\nhttps://review.px4.io/plot_app?log=e3b60ca9-d232-46d3-99f4-65220f2360b2\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Throttle quickly goes to 0 on RTL init after idle HOLD/RTL on ground",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13533",
  "body": "**Describe the bug**\r\nWe found the corner case where throttle intermittently went to 0 when RTL is engaged.\r\nThe reason seems to be a faulty logic of triplet resetting and publishing in navigator.\r\n\r\nMore specifically, navigator publishes an idle setpoint while in HOLD on ground:\r\nhttps://github.com/PX4/Firmware/blob/84fe64b1c20a4ae8067f04b1e21a961263bac4db/src/modules/navigator/navigator_main.cpp#L662-L666\r\n\r\nthen in POSCTL the triplet is set to invalid\r\nhttps://github.com/PX4/Firmware/blob/84fe64b1c20a4ae8067f04b1e21a961263bac4db/src/modules/navigator/navigator_main.cpp#L675-L679\r\n\r\nbut not published because it's invalid.\r\nhttps://github.com/PX4/Firmware/blob/84fe64b1c20a4ae8067f04b1e21a961263bac4db/src/modules/navigator/navigator_main.cpp#L730-L736\r\n\r\nSo later when switching to RTL, flight task still has the idle setpoint until navigator has run and published the new RTL setpoint.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior in SITL with QGC and a joystick set-up:\r\n1. Start SITL, wait for GPS\r\n2. Switch mode to HOLD, arm, then disarm without taking off\r\n3. Arm and takeoff in POSCTL\r\n4. Switch to RTL. This is when the spike to 0 usually happens. It might not based on timing and it might only be visible in a log.\r\n\r\n**Expected behavior**\r\nThe thrust should not go to 0 even if navigator takes a while to figure out what to do. In the meantime flight task should do a failsafe and stay where it is.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=f1b66ae0-3751-481a-89cb-c7b9adc12037\r\n\r\n![bokeh_plot(1)](https://user-images.githubusercontent.com/1419688/69226852-2c4aae80-0b81-11ea-9f9e-3036154486dd.png)\r\n\r\n\r\n**Drone (please complete the following information):**\r\nInitially this happened on a S500 with Pixhawk 4. The log is in SITL.\r\n\r\n**Additional context**\r\nThe log features a lot more that goes wrong but this was one of the findings.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF gps hgt timeout - reset to baro",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13508",
  "body": "**Describe the bug**\r\nEKF gps hgt timeout - reset to baro problem.\r\nIt basically says GPS data is lagged because _gps_hgt_intermittent flag is on.\r\n\r\n_gps_hgt_intermittent = !((_time_last_imu - gps_init.time_us) < 2 * GPS_MAX_INTERVAL);\r\n\r\nHowever, it seems very difficult to meet this condition unless otherwise GPS has unstable connection. But it's not. It seems some timing issue.\r\n\r\n**To Reproduce**\r\nNot exactly reproducible\r\n\r\n**Expected behavior**\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=d8997f75-e796-4a42-9b90-ea5c06a3d54d\r\n\r\n**Drone (please complete the following information):**\r\n- FMUv5.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Thrust value oscillating (repeatedly dropping to 0)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13507",
  "body": "Hey,\r\n\r\nMy Pixhawk 4 mini hexarotor with PX4 1.9.2 release wasn't maintaining altitude while hovering, so I increased the mid throttle from 50% to 60%.\r\n\r\nWhat I got is this super odd thrust oscillation, while hovering (the thrust value is going to 0 for a short period of time -> see the logs). Even though I'm trying to land, it's only reacting to increasing the throttle, but not to not lowering -> also visible in the logs. I had to use kill switch.\r\n\r\nThe oscillations occur across all modes.\r\nAfter going back to 50% mid-throttle the problem disappears. \r\n\r\nThe battery warnings are result of the voltage sag (the actual voltage was 3.75V/cell and the default BAT_V_EMPTY is pretty high, at 3.50V/cell). \r\n\r\nLogs:\r\nhttps://logs.px4.io/plot_app?log=ececa147-2ad7-4aa7-9e0a-bcc0761c06af\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Unexpected Freefall druing Loiter Mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13479",
  "body": "I have flight three times with my vtol plane two days ago. In the last flight,  during loiter mode at 280meters, the plane start to descent its altitude. I commanded RTL at 25meters and it return back to home but It still losing altitude during rtl mode. RTL altitude set to 40m but the plane did not climbout to 40m during rtl mode. I switch to manual at about 10 meters and landed the plane. Loiter mode does not appear in flight log records. I think that fw control module stops to work in air. The plane did not try to reach cruise airspeed during this period. Actually, it did not try to correct anything. \r\n\r\nAfter landing, I was able to run lifter motors, servos and pusher motor. The plane was able to take off and landing normally after landing. There was no hardware problem. You can see easily, there is long dropout on flightlog at all plots. You can watch the flight from \"Open 3D View\", the plane was flying backwards bcause of dropouts on log file.\r\n\r\nFlight log: https://review.px4.io/plot_app?log=ecc40545-1384-4185-828e-c14322655122",
  "state": "closed",
  "pull_request": null
}
{
  "title": "v1.10.0-rc quadcopter doesn't take off in HITL/jMAVsim ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13471",
  "body": "**Describe the bug**\r\nSet up HITL simulation with jMAVsim on Ubuntu 18.04,  Pixhawk 4 with v1.10.0-rc, locally built px4_fmu-v5-multicopter. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Follow the recipe from [px4 website](https://dev.px4.io/v1.9.0/en/simulation/hitl.html#jmavsimgazebo-hitl-environment)\r\n2. Using Manual/Stabilized mode, arm vehicle and apply throttle\r\n3. Vehicle does not take off\r\n4. Mavlink shell (`listener` command) shows actuator_outputs_1 with *valid* values and actuator_outputs_0 with 0 values\r\n\r\n**Expected behavior**\r\nSERVO_OUTPUT_RAW or HIL_ACTUATOR_CONTROLS should follow actuator_outputs_1 and the vehicle should take off in simulation\r\n\r\n**Log Files and Screenshots**\r\n[Flight Review Link](https://review.px4.io/plot_app?log=8890b998-3b24-4a96-af5a-da4c10910bff)\r\n\r\nAdd screenshots to help explain your problem.\r\n\r\n**Drone:**\r\n- Pixhawk4 running in HITL Quad Mode\r\n- Photo of the IMU / autopilot setup if possible.\r\n![IMG_8020](https://user-images.githubusercontent.com/11541631/68861820-46d0e380-06ba-11ea-98e2-76585b3bb031.JPG)\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Violent jerk when switching from manual to position mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13415",
  "body": "**Firmware**: 1.9.2 (with #13312 and #13325)\r\n\r\n**Describe the bug**\r\nI'm seeing huge pitch/roll setpoints when switching from manual to position mode . It seems like it's the velocity controller, but I don't really understand how the velocity controller ends up demanding such large effort of the attitude controller. I've detuned the P gain on the velocity controller and am still seeing a violent jerk when switching from manual to position. Here's a log with 3 mode switch, the first one being the most violent.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Switch from `manual` to `position` mode. The more velocity you have before the switch, the more violent the jerk.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=4fa7056e-d1bc-437f-829d-0b45e3087276\r\n![Selection_038](https://user-images.githubusercontent.com/37091262/68419559-afb6d980-0157-11ea-96b3-72665d0f29f1.png)\r\n![Selection_041](https://user-images.githubusercontent.com/37091262/68419888-5307ee80-0158-11ea-93d5-1dddd621be10.png)\r\n\r\n\r\nThe velocity setpoints are not changing dramatically, so the attitude effort should not be there.\r\n![Selection_039](https://user-images.githubusercontent.com/37091262/68419561-b1809d00-0157-11ea-9cd0-991be8fbca65.png)\r\n\r\n@bresch @mhkabir @TSC21 \r\n\r\nRelated to #12389\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW: vehicle stays forever in takeoff mode if airspeed fails",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13413",
  "body": "If the airspeed is invalid (eg NAN) during FW mission takeoff (runway takeoff), the take off state is never exited. \r\n\r\n![image](https://user-images.githubusercontent.com/26798987/68403081-ad1aab00-017c-11ea-8368-b965edd717d8.png)\r\n\r\nhttps://review.px4.io/plot_app?log=ce5a3aee-13a2-4ee6-bd07-8e1f9b7a497a\r\n\r\nThis will btw also not be fixed with https://github.com/PX4/Firmware/pull/12887 and the default values (fallback to ground-windspeed would need to be enabled), and is part of the reason that the SITL CI fails for this PR till now).\r\n\r\nFYI @dagar @RomanBapst \r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Hard-fault produced when GPS is driver is started in-flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13352",
  "body": "**Describe the bug**\r\nThis may not be a regular use-case, but while testing to reproduce #13350, I had a bad crash, which turns out was a hard-fault.\r\n\r\n**Steps taken**\r\nSteps to reproduce the behavior:\r\n1. Drone with optical flow (pmw3901), GPS actively used. Commanded via MAVLink\r\n2. Stopped the GPS driver\r\n3. Take-off\r\n4. `gps start -b 115200`\r\n5. BOOM\r\n\r\n**Elaboration**\r\nI mention that the vehicle was commanded via MAVLink because I did the exact same test again immediately afterwards, with the only difference that I was using an RC and it did not hard-fault. I was scared to attempt to reproduce... Joysticks don't let you map a kill switch!\r\n\r\n**Log Files and Screenshots**\r\n[Log](https://review.px4.io/plot_app?log=b3af87ef-bc79-4795-be5e-6c99e36557a9)\r\n[Hard-fault file](https://drive.google.com/file/d/1IxdO0bjZCKV5n7AkUgmThaM9rMiLva93/view?usp=sharing)\r\n[ELF file](https://drive.google.com/file/d/1P0VStSh6af39KoXZ0IefE6NJOosAE7jF/view?usp=sharing)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC Landing Gear Don't Deploy at Correct Altitude at End of Mission",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13313",
  "body": "**Describe the bug**\r\nLanding gear are enabled via a mixer to AUX1. Landing gear properly retract upon takeoff. When landing, the gear do not start to deploy until the copter is around 1m above the ground.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Power on and wait for GPS lock\r\n2. Uploaded mission. Mission End is set to \"Return to Launch\" [gear-test.txt](https://github.com/PX4/Firmware/files/3786802/gear-test.txt)\r\n3. Took off in mission mode\r\n4. Verified during testing at two locations, 4 flights each.\r\n\r\n**Expected behavior**\r\nDuring the landing phase, landing gear should be commanded to deploy when RTL_DECEND_ALT, LAND_ALT_1, or LAND_ALT_2 is reached though I am not sure which it is (but would like to know). \r\n\r\n**Log Files and Screenshots**\r\nFlight Log showing a very quick flight with one waypoint:\r\nhttps://logs.px4.io/plot_app?log=c57c04e0-a6bd-4f04-9fe2-eb986cbcc1b4\r\n\r\n**Drone (please complete the following information):**\r\n- Tarot X6 (with Tarot retracts)\r\n- Pixhawk Cube 2.1\r\n- Here2 GNSS\r\n- PX4 1.9.2\r\n- QGC 3.5.5\r\n\r\n**Additional context**\r\nA file named lgear.aux.mix is placed in /fs/microsd/etc/mixers. This Tarot landing gear controller requires an PWM output of less than 1520 for the gear to retract and greater that 1520 for the gear to extend which is the reason for the (-) scaling. It has the following content:\r\n```\r\nM: 1\r\nS: 0 7 -10000 -10000 0 -10000 10000\r\n```\r\nA file named config.txt is placed in /fs/microsd/etc with the following content:\r\n```\r\nset MIXER_AUX lgear\r\nset PWM_AUX_OUT 1234\r\nset PWM_AUX_DISARMED 1500\r\nset PWM_AUX_MIN 1000\r\nset PWM_AUX_MAX 2000\r\nset PWM_AUX_RATE 50\r\n```\r\nThe gear are working properly in mission mode on takeoff as well as manual mode using an RC channel assigned by RC_MAP_GEAR_SW.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Commander mode offboard triggers PX4 freeze",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13309",
  "body": "**Describe the bug**\r\nUsing px4_sitl_default together with gazebo and sending set_actuator_control_target via pymavlink successfully establishes a mavlink connection and actuator commands are received on the px4 stack and uorb topic offboard_control_mode is published. When using the system console and sending `commander mode offboard` the stack freezes. No uorb topics are published and no mavlink messages are received (gazebo plugin correspondingly outputs `[Err] [gazebo_mavlink_interface.cpp:1155] poll timeout` in the mavlink poll function). The pxh system console remains responsive but commands to any module (e.g. commander, uorb) have no effect and hence indicating the system wide freeze. No error message from PX4 is shown and gdb debugger catches no signals.\r\n\r\n**To Reproduce**\r\n- run `px4_sitl_default gazebo`\r\n- send mavlink messages via pymavlink `c.mav.set_actuator_control_target_send(0, 0, 0, 0, controls)`\r\n- switch to offboard mode using `commander mode offboard`\r\n\r\n**Expected behavior**\r\nPx4 was expected to switch `vehicle_control_mode` into offboard mode.\r\n\r\n**Log Files and Screenshots**\r\n- https://review.px4.io/plot_app?log=86db944d-af82-456a-bb6c-79e8e5b223dd\r\n\r\n**Additional context**\r\n- PX4 firmware (v1.9.2)\r\n- mavlink (release/kinetic/mavlink/2019.10.10-1)\r\n- mavros (0.33.0)\r\n- Approaches so far:\r\n  - PX4_INFO() print outputs showed that commander reaches publishing in run() loop\r\n  - gdb info variables and inspecting last variables gave no further insights\r\n\r\nThe freeze presumably happens after the system console arguments are parsed and published in the commander run loop. It could also be that the crash happens earlier and all modules get stuck at the file descriptor polling. Maybe a problem from global variables causing a race condition with the main commander thread? Maybe I am missing something but it does not seem that variable access is coordinated when parsing the mode argument.\r\n\r\nAny advice on how to approach or debug this problem are very much appreciated!",
  "state": "closed",
  "pull_request": null
}
{
  "title": "AutoLineSmoothVel: fix constrain priority for autocontinue.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13272",
  "body": "The constrainAbs function was not prioritizing the minimum value that produces the autocontinue behavior. This caused zig-zag paths when the waypoints were almost -but not exactly- aligned.\r\n\r\nBefore this PR:\r\nhttps://logs.px4.io/plot_app?log=96749225-635d-4861-811c-53edc4fe03b0\r\n![bokeh_plot(27)](https://user-images.githubusercontent.com/14822839/67559392-27791300-f719-11e9-9a5c-c8002d2d0db2.png)\r\n\r\nAfter this PR:\r\nhttps://logs.px4.io/plot_app?log=74073a91-dccb-4624-96fc-de09e16bbb4f\r\n![bokeh_plot(28)](https://user-images.githubusercontent.com/14822839/67559398-2c3dc700-f719-11e9-9875-8d3e3a5b8f2f.png)\r\n\r\nFYI @mrivi \r\n\r\nI also made `const` the function that don't modify member variables and `static` the functions that don't use member variables.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/13272",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/13272",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/13272.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/13272.patch",
    "merged_at": "2019-10-26T06:34:31Z"
  }
}
{
  "title": "flight termination circuit braker not working",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13244",
  "body": "**Describe the bug**\r\nAs reported by Michael as well on https://discuss.px4.io/t/pixhawk-2-px4-fd-fail-flight-termination-not-working/13281 the CBRK_FLIGHTTERM seems not to work.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. set CBRK_FLIGHTTERM to 0 to enable circuit breaker\r\n2. set one of the PWM_MAIN_FAIL to 2000us and connect e.g. servo to that PWM port.\r\n3. arm drone and take off\r\n4. force drone to exeed the max roll/pitch angle of the default 60Â° (FD_FAIL_P and FD_FAIL_R)\r\n5. motors DO NOT stop now and a programmed PWM_MAIN_FAIL is not set (servo not moving)\r\n\r\n**Expected behavior**\r\nangle of more than 60 degrees should be detected. Motors to be stopped and PWM_MAIN_FAIL settings to become active.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=58de9b83-0cf3-4e7f-9a0e-55df674bfdbf\r\n\r\nAdd screenshots to help explain your problem.\r\n![grafik](https://user-images.githubusercontent.com/3907200/67264491-7de11a00-f4ab-11e9-9c98-ef1a5ebd57f7.png)\r\n![grafik](https://user-images.githubusercontent.com/3907200/67264500-83d6fb00-f4ab-11e9-9aa8-f41c602c23b9.png)\r\n\r\n**Drone (please complete the following information):**\r\n- LJI500S test drone with NXP FMUK66 revC\r\n- Red flash light connected to PWM6 port (flash light starts blinking at >1500us) to indicate status of PWM output.\r\n- CBRK_FLIGHTTERM set to 0\r\n- PWM_MAIN_DIS6 set to 900us\r\n- PWM_MAIN_FAIL6 set to 2000us\r\n\r\n**Additional context**\r\nTesting of the PWM_MAIN_FAIL6 settings was previously done by setting RC loss Failsave to \"Terminate\". With this configuration and by swithing off the RC transmitter motors were shut down and PWM_MAIN_FAIL6 set to 2000us got active. So the issue seems to be related to the CBRK_FLIGHTTERM (FD_FAIL_P and FD_FAIL_R) behaviour only.\r\n\r\nTest was executed without propellers! Drone was armed at ground floor and throttle value was set to 50%. Drone was carried up to 5th floor of building and flipped over (upside down).\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Land detector edge case in descend mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13231",
  "body": "**Describe the bug**\r\nThe land detector seems to detect ground contact in Descend mode (RC land failsafe without GPS).\r\n\r\n1. `vertical_movement` to be `false`: https://github.com/PX4/Firmware/blob/95dc522b99688a08402ac6462ad28f5dfd338eda/src/modules/land_detector/MulticopterLandDetector.cpp#L154\r\n2. `hit_ground` to be `true`: https://github.com/PX4/Firmware/blob/95dc522b99688a08402ac6462ad28f5dfd338eda/src/modules/land_detector/MulticopterLandDetector.cpp#L165\r\n\r\nThis happens because the z controller only reacts slowly to the new setpoint so the z velocity down is much less than the z velocity setpoint here:\r\nhttps://github.com/PX4/Firmware/blob/95dc522b99688a08402ac6462ad28f5dfd338eda/src/modules/land_detector/MulticopterLandDetector.cpp#L151-L154\r\n\r\nOne observation of the descend case is that the velocity setpoint jumps to the land speed instead of gradually reaching it like in Land (with GPS) mode.\r\n\r\n![bokeh_plot(1)](https://user-images.githubusercontent.com/1419688/67103273-14b88880-f1c5-11e9-932a-827e357f7cc7.png)\r\n\r\n\r\n**To Reproduce**\r\nThis is hard to reproduce in SITL because the drone seems to follow the setpoint quicker.\r\n\r\n**Expected behavior**\r\nIt should not detect ground contact until actually landed.\r\n\r\n**Log Files and Screenshots**\r\n\r\nThis happened in a failsafe descend test:\r\nhttps://review.px4.io/plot_app?log=3104d449-dd29-473f-9055-354984ff8afa\r\n\r\nThis does **not** happen in normal landing:\r\nhttps://review.px4.io/plot_app?log=2ea6423f-b232-45c9-8c40-32e775118359\r\n\r\nMore info in https://github.com/PX4/Firmware/pull/13143#issuecomment-543682487.\r\n\r\nFYI @bresch @MaEtUgR \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Offboard position setpoints with loiter type mask makes Fixed wing vehicle fly away",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13180",
  "body": "**Describe the bug**\r\nOffboard position setpoints with loiter type masks result in a fly away of a fixed wing vehicle. The roll and pitch setpoints are set to zero and continues to fly to the last direction where offboard mode was triggered. The offboard position setpoints fly as expected without the loiter type mask.\r\n\r\n![Screenshot from 2019-10-14 12-05-00](https://user-images.githubusercontent.com/5248102/66743792-fe37c780-ee7a-11e9-8d67-0b0f06dd44d1.png)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Take off FW vehicle in SITL\r\n2. Send `SET_POSITION_LOCAL_NED` setpoint with `type_mask=0x3000` ([see](https://github.com/PX4/Firmware/blob/master/src/modules/mavlink/mavlink_receiver.cpp#L774)\r\n3. Swich mode to offboard mode\r\n\r\n\r\n**Expected behavior**\r\nThe FW vehicle circles around the loiter setpoint\r\n\r\n**Log Files and Screenshots**\r\nThe [log](https://review.px4.io/plot_app?log=8617fe45-3269-4098-9165-e94b176d74a4) shows the offboard setpoint resulting in a fly away. A local position setpoint of [0.0, 0.0, 20.0] was being streemed with`type_mask=0x3000`\r\n\r\n**Additional context**\r\nCurrently flying offboard position setpoints are passed as a reference position for the L1 controller, which results the vehicle turning around and traversing the setpoint as can be seen [here](https://review.px4.io/plot_app?log=209a8f30-a2aa-45f1-85b0-6755170b88a2). Supporting circling the waypoints may be useful for various robotic applications using fixed wing.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "QGC _altitude issues_CUAV Nano",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13148",
  "body": "**Describe the bug**\r\nWe have noticed the altitude issues on the CUAV Nano this issue was noted on QGC altitude reading. (and relative altitude) not being displayed correctly. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on\r\n2. Uploaded mission\r\n3. Takeoff, Position Mode \r\n4. Switch from Position mode to Mission mode \r\n4. See altitude reading on QGC\r\n\r\n**Log Files and Screenshots**\r\nLog Nano V5:   \r\nhttps://review.px4.io/plot_app?log=e3d7bc0a-891d-4ecf-8ebd-01afb7630ab7\r\n![nano V5](https://user-images.githubusercontent.com/39415493/66510657-4d03ec80-ea8a-11e9-8544-4bf23e4d8059.jpg)\r\n![nano V5](https://user-images.githubusercontent.com/39415493/66510679-5725eb00-ea8a-11e9-84a6-876ba6643988.jpg)\r\n\r\n**Drone (please complete the following information):**\r\nFC- CUAV Nano \r\nFrame: F450 frame\r\nGPS- NEO V2\r\n![f450_cuav5_nano_complete](https://user-images.githubusercontent.com/39415493/66511077-1e3a4600-ea8b-11e9-90dd-80041808b8cc.jpg)\r\n\r\n\r\n**Additional context**\r\nThe vehicle flight performance is well but the altitude is off by approximately 10 to 13 meters.@dagar what could be the issue? ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "CUAV V5+_Accel inconsistent",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13083",
  "body": "**Describe the bug**\r\nWe are getting this constant error message of Accel inconsistent error with the CUAV V5+. We did all the calibrations, then try to arm again and again mark Accel inconsistent. We did a complete reset in the flight controller did the calibrations and the same issue. \r\n\r\n**Log Files and Screenshots**\r\n<img width=\"960\" alt=\"CUAV+ Accels inconsistent\" src=\"https://user-images.githubusercontent.com/39415493/66089260-64dfeb80-e533-11e9-93a4-3610550da5ba.png\">\r\n\r\nLog: \r\nhttps://review.px4.io/plot_app?log=37067a71-b746-4f44-8013-8c4fe57b3bfa\r\n\r\nLast working flight log: \r\nhttps://review.px4.io/plot_app?log=66332487-04b5-47f5-b1a3-a241e23a4dd7  \r\n\r\n**Drone (please complete the following information):**\r\n- FC- CUAV V5+\r\n- Frame- DJI f450\r\n- GPS- NEO V2\r\n![CUAV close pic](https://user-images.githubusercontent.com/39415493/66089507-7970b380-e534-11e9-8a08-7fc280ed0082.jpg)\r\n\r\n**Additional context**\r\nToday we tried the Master branch but I had already tried it in Stable & a PR and still the same error, I also changed the GPS from the working unit Nano CUAV but it remains the same.\r\n@dagar what could be the issue? ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL transition no rate sp for 1 second",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13030",
  "body": "**Describe the bug**\nNo rate sp are being published in the first second of a front transition.\n\n![image](https://user-images.githubusercontent.com/26798987/65669005-13bb8d80-e043-11e9-80c2-4e8607d602b4.png)\n\nlog file (todays master in sitl): \nhttps://review.px4.io/plot_app?log=7e8f18ac-0800-4c4b-a947-7773ed1ddc41\n\n\n**To Reproduce**\nDo a VTOL front transition in sitl, all control modes (stabilized, alt, pos) seem to be affected.\n\n\n**Additional context**\nNoticed it only because of accidentally triggered front transition, while also giving some roll input before. Then the rate_sp froze for 1s at a large value, almost resulting in a flip of the VTOL.\n![image](https://user-images.githubusercontent.com/26798987/65669305-9a706a80-e043-11e9-882a-93d21eba2ddf.png)\n\n@dagar @RomanBapst  FYI",
  "state": "closed",
  "pull_request": null
}
{
  "title": "CM8JL65 switches uORB instance mid-air",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12987",
  "body": "**Describe the bug**\r\nI've seen a bug where the distance sensor CM8JL65 switches the uORB topic it is publishing on, mid-air. This doesn't seem to bother EKF2 much, but it still doesn't sound like a great idea.\r\n\r\nThis was seen when testing a rebased version of https://github.com/PX4/Firmware/pull/12950, but I don't think the issue is related to the PR.\r\n\r\nWould be interesting to know if anybody has seen similar behavior with other sensors, or if this is more likely a bug in the CM8JL65 driver.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/14265408/65228612-1100eb80-dacb-11e9-93e1-cefa6e4880f9.png)\r\n\r\n**Logs**\r\n[Log file](https://review.px4.io/plot_app?log=c5c192d0-ae47-4bbc-a8de-2c887bddaf87)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: no control in FW after transition in ALT control",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12910",
  "body": "reproducable in sitl: take off in alt, switch to FW. Not possible to change flight direction.\r\n\r\nsitl log:\r\nhttps://review.px4.io/plot_app?log=a60bffd8-f43f-4ca1-b59e-18d7dbe46bc9\r\n\r\nflight log:\r\nhttps://review.px4.io/plot_app?log=a14d1d71-bb8c-4438-a0bb-6ae8daed4190",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Multicopter mission guidance improvements",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12905",
  "body": "A recent modification (#12505 ) allows the drone to pass through a waypoint without completely stopping depending on the previous-current-next waypoints and the maximum centripetal acceleration. The implementation had visible corner cases when the path is parallel to the north or east axis as shown on the picture below:\r\n![bokeh_plot(23)](https://user-images.githubusercontent.com/14822839/64342552-0df5fd80-cfeb-11e9-90d4-f74d47ee66a3.png)\r\n(log: https://logs.px4.io/plot_app?log=d4a1d4ef-48ae-4e80-847c-ddd69d2d95dd )\r\nThe problem is that the velocity the drone is allowed to fly in a waypoint was directly applied to the norm of the velocity vector instead of each axis independently.\r\n\r\nThis PR fixes that behavior by applying properly the constraints to each component of the velocity vector:\r\n![bokeh_plot(24)](https://user-images.githubusercontent.com/14822839/64342728-6d540d80-cfeb-11e9-8358-ce9c826e25cb.png)\r\n(log: https://logs.px4.io/plot_app?log=85680273-9b06-44e7-b7a4-918b79581d05 )\r\n\r\n**Additional change** the signum function now compares the number against `FLT_EPSILON` instead of 0 in case of a floating point number. \r\n\r\nFYI @Stifael ",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/12905",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12905",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/12905.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/12905.patch",
    "merged_at": "2019-09-13T15:46:02Z"
  }
}
{
  "title": "[WIP] VTOL attitude control: fix pusher support in hover",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12899",
  "body": "Pusher assist in position control is broken currently. Reason for it is that _pusher_throttle  is only updated every time https://github.com/PX4/Firmware/blob/69475a172bf743fb4b735d5e5595d8a23f2dba66/src/modules/vtol_att_control/vtol_att_control_main.cpp#L420 is executed, and otherwise _pusher_throttle=0 is set. And update_mc_state is only updated when mc_virtual_attitude_sp is updated.\r\n\r\nAlso reproducable in SITL (unsteady actuator_controls(3), see below)\r\n\r\nI made a quick fix for that by just filling the actuator outputs if the MC or FW virtual attitude sp have been updated. \r\n\r\n\r\n**Test data / coverage**\r\nSITL: before fix:\r\n![image](https://user-images.githubusercontent.com/26798987/64269866-efd0c480-cf3a-11e9-951d-5bf900f8cada.png)\r\nAfter the fix:\r\n![image](https://user-images.githubusercontent.com/26798987/64269946-0bd46600-cf3b-11e9-9cf1-4e9a3d7397ed.png)\r\n\r\n\r\nBench Test:\r\n\r\nhttps://review.px4.io/plot_app?log=afef455a-a52a-4055-9013-4ff2e4e5eecb\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/12899",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12899",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/12899.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/12899.patch",
    "merged_at": null
  }
}
{
  "title": "Parameter tuning MPC_ALT_MODE",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12833",
  "body": "**Describe the bug**\r\nA clear and concise description of the bug.\r\nI was trying to bind the parameter to (using parameter tuning in QGroundcontrol) to my low-medium-high settings of a 3-way switch, but only got\r\n![image](https://user-images.githubusercontent.com/30323691/63894397-d8e71b00-c9ec-11e9-978b-f9c6442df40f.png)\r\nlow:\r\n![image](https://user-images.githubusercontent.com/30323691/63894404-de446580-c9ec-11e9-8d8b-0d61111617ab.png)\r\nmedium:\r\n![image](https://user-images.githubusercontent.com/30323691/63894416-e1d7ec80-c9ec-11e9-9b02-b86878c058f6.png)\r\nhigh:\r\n![image](https://user-images.githubusercontent.com/30323691/63894432-e8666400-c9ec-11e9-9abc-e86b5f19fe65.png)\r\nPlease advice.\r\nBest \r\n--Seeelefant\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on '...'\r\n2. Uploaded mission '....' (attach QGC mission file)\r\n3. Took off '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\nLow-0: Altitude following\r\nMedium-1: Terrain following\r\nHigh-2: Terrain hold\r\n**Log Files and Screenshots**\r\n*Always* provide a link to the flight log file:\r\n- Download the flight log file from the vehicle ([tutorial](https://docs.px4.io/en/getting_started/flight_reporting.html)).\r\n- Share the link to a log showing the problem on [PX4 Flight Review](http://logs.px4.io/).\r\n\r\nAdd screenshots to help explain your problem.\r\n\r\n**Drone (please complete the following information):**\r\n- Describe the type of drone.\r\n- Photo of the IMU / autopilot setup if possible.\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL GPSF: fix fixed bank loiter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12778",
  "body": "Pull request fixing part of [#12758](https://github.com/PX4/Firmware/issues/12758)\n\n**Describe problem solved by the proposed pull request**\nFixed bank loiter after a No Global Position Failsafe wasn't working for VTOLs in FW mode. \n\n**Test data / coverage**\nTested in SITL `make px4_sitl gazebo_standard_vtol` by stopping `gpssim` driver. I also reactivated the `gpssim` driver to see if the vehicle recovers its position and continues its mission afterwards.\n\nLogs:\nWorking fixed bank loiter, late recovery:\nhttps://logs.px4.io/plot_app?log=217b432a-9452-4f67-862d-32322aaefe96\n\nWorking recovery:\nhttps://logs.px4.io/plot_app?log=b165d3ea-54cc-4145-aeb7-acf75892611e\n(running on an older commit head, but meanwhile it doesn't work anymore on this one, see this log: https://logs.px4.io/plot_app?log=2aad8195-476f-4af6-b289-c214e61fe853)\n\nGPSF is still working on normal planes : \nhttps://logs.px4.io/plot_app?log=79b5e483-f698-4aa0-8b30-265d25a3cd14\n\n**Describe your preferred solution**\nPublishing the failsafe values to `fw_virtual_attitude_setpoint` topic if the vehicle is a VTOL so that `VtolType::update_fw_state()` doesn't overwrite them with old values anymore.\n\n**Describe possible alternatives**\n\n**Additional context**\nThis PR does not fix the GPS recovery & continuing the automatic flight problems. \nAlso, the landing after \"Terminate\" is not working, the drone keeps loitering in fixed bank angle mode\n\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/12778",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12778",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/12778.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/12778.patch",
    "merged_at": "2019-10-16T15:57:44Z"
  }
}
{
  "title": "[VTOL] No Global Position Failsafe not working properly in FW mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12758",
  "body": "**Describe the bug**\nThe following points don't work as they should upon triggering a GPS Failsafe on a VTOL drone in FW (flying in an AUTO mode):\n1) The drone doesn't do the fixed bank loiter upon a GPS Failsafe. Instead, it pretty much continues to fly in whatever pose it happened to be upon triggering. \n2) Also, the landing doesn't seem to work. In SITL it just keeps flying.\n3) Recovering the GPS signal doesn't work properly.\n4) It \"randomly\" falls back to the previous flight mode after some time (after it should have initiated landing)\n\n**To Reproduce**\nSteps to reproduce the behavior:\n\n1. Start SITL with `make px4_sitl gazebo_standard_vtol`\n1. Set the NAV_GPSF_* parameters to some non-zero value\n1. Launch a mission or just loiter in FW\n1. Trigger the failsafe by disabling the GPS signal: `gpssim stop`\n1. The drone will not be doing the fixed bank loiter properly\n1. Enable the GPS driver again: `gpssim start`\n1. The drone will not (directly) recover its global position even though on QGC you can see its exact position\n1. Wait\n1. The drone will not initiate landing (even though navigator says Terminate)\n1. At some point the drone will switch back to what it was doing before (Mission or Loiter)\n\n**Expected behavior**\nThe drone should do the fixed bank loiter as a FW plane and upon recovery of its global position continue its mission or whatever it was doing before.\n\n**Log Files and Screenshots**\nSITL, v1.9 : https://logs.px4.io/plot_app?log=5befa577-0ade-4c90-b82c-045830915138\nSITL, current master : https://logs.px4.io/plot_app?log=ac15492a-04b5-4e27-851e-cdb00cb27d62\n\nReal flight, v1.9 : https://logs.px4.io/plot_app?log=7c1a4be9-8e6b-41e2-b7fa-dd29cd270795\n\n* our pilot took over after 7s, but clearly the fixed bank angle didn't work.\n![bokeh!UNITO-UNDERSCORE!plot(1)](https://user-images.githubusercontent.com/48206725/63368099-7d2de980-c37d-11e9-8b3b-44fddc5429c9.png)\n\n**Drone (please complete the following information):**\n\n* SITL : standard VTOL quadplane\n* Real drone : standard VTOL, running v1.9 on a Cube\n\n**Additional context**\nI tested the Failsafe on the Gazebo plane and it works as it should. I also tested the Failsafe on SITL VTOL in MC and it's good too.\n\nInsights on the root cause of the failsafe on the real drone would be very welcome too :) I can't quite pin down what caused the velocity and position innovations to diverge suddenly.\nI know that the vibrations and the magnetic interference could have been part of the issue, but we have over 10h of flight time with the same setup (or even more vibrations) on v1.8.2 where to my knowledge it never occurred and another 5h on v1.9 (with two triggers so far)\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pixhawk Cube_calibration issue on Master",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12692",
  "body": "**Describe the bug**\r\nWhen setting up the vehicle for a flight, on arming the vehicle I get a \"Compass not found\" message, see image below:\r\n![image](https://user-images.githubusercontent.com/39415493/62976692-0a979980-bdd2-11e9-9e1e-65a1f90f1168.png)\r\nThis issue is on Master e25db016 & PR Pull[12650](https://github.com/PX4/Firmware/pull/12650#event-2540347567), tried on Stable version and was able to fly. v1.9.2 (10690587).\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Power on the Drone\r\n2. Uploaded mission \r\n3. Arm vehicle and Takeoff\r\n4. Error, \"Preflight Fail: COmpass #2 uncalibrated\"\r\n5. Calibrate vehicle \r\n6. Error message Gyro 1 no matching uORB devid\r\n7. Unable to calibrate the vehicle on Master\r\n![image](https://user-images.githubusercontent.com/39415493/62978246-ad054c00-bdd5-11e9-8470-26f7e1acde02.png)\r\n\r\n\r\n**Log Files**\r\nCompass not found and Calibration issue log on Master:\r\nhttps://review.px4.io/plot_app?log=13cc9db5-4a03-41ff-a9e2-b80013d3e104\r\n\r\nStable  v1.9.2 (10690587) log:\r\nhttps://logs.px4.io/plot_app?log=71a782cc-7979-4ff1-a6e8-f3d8f4757f55\r\n\r\nPR 12650 log issue:\r\nhttps://review.px4.io/plot_app?log=18094d44-f808-4b67-b7d6-8ef0df7f4f05\r\n \r\n**Drone **\r\nFrame- DJI F450\r\nFlight Controller: Pixhawk 2(The Cube)\r\n\r\n@dagar we tried calibrating the vehicle and get an Error message Gyro 1 no matching uORB devid. On Stable version, we were able to arm, calibrate and fly the vehicle with no issues.\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Arm authorization fails on first attempt, succeeds erroneously after",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12685",
  "body": "Iâ€™m trying to get arm authorization working and running into some issues. First hereâ€™s my setup:\n\n- Pixhawk Cube\n- Authorizer is a Linux board running pymavlink using v2 dialect\n- Param COM_ARM_AUTH = 1280001 (require one arm, 5s timeout, authorizer sysid 1)\n- Param COM_ARM_MIS_REQ = 2 (require auth but not valid mission)\n- Arming via Qground\n\nI can go into more detail on the setup if needed, but all the basics appear to be working. When arming I see the COMMAND_LONG 3001 arrive in the python script, and I have even rebuilt PX4 for the Cube to check that the COMMAND_ACKs I send to it are being received in the mavlink module. Here is the behavior I observe:\n\n- After reboot of Cube, the first arming attempt fails. It appears to fail even before the first COMMAND_ACK (with result MAV_RESULT_IN_PROGRESS) reaches the arm_auth module via uORB\n- Subsequent arming attempts succeed, but they appear to rely on acks that are still queued from the first attempt. I have tested killing the python script after the first arming attempt (fail) and the second attempt still succeeds, despite no new acks being sent.\n\nHere is a snippet showing what the python script does:\n```\nin_msg = self._mav_sock.recv_match(blocking=False)\n  if in_msg != None:\n    if in_msg.get_type() == â€˜COMMAND_LONGâ€™:\n      self._mav.command_ack_send(3001, 5, 255, 5, 1, 1) # in progress\n      self._mav.command_ack_send(3001, 0, 255, 5, 1, 1) # arm cmd, accept\n```\n\nA log probably isn't that helpful in this scenario but here it is anyway:\nhttps://logs.px4.io/plot_app?log=bb57f1ee-6991-4190-b62b-6d2bdc7d013d\n\nHere's the nsh listener output showing that auth fails before my acks arrive (on this run I rebuilt PX4 with extra debug messages):\n[arm_auth_debug_fail_on_first_auth_attempt_txt.txt](https://github.com/PX4/Firmware/files/3495153/arm_auth_debug_fail_on_first_auth_attempt_txt.txt)\n\nPlease let me know what additional info would help.\n\nThis was also posted on the forum here: https://discuss.px4.io/t/arm-authorization/12383",
  "state": "closed",
  "pull_request": null
}
{
  "title": "nxp_fmuk66-v3 disable px4flow temporarily",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12632",
  "body": "As a precaution while we debug the underlying issue.\r\n\r\n@davids5 @igalloway \r\n\r\n\r\nhttps://review.px4.io/plot_app?log=0bcf24d7-b989-4283-a11d-c7443d9fd10d\r\n\r\nVery high cpu usage in the I2C WQ from the px4flow.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/12632",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/12632",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/12632.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/12632.patch",
    "merged_at": null
  }
}
{
  "title": "Logger stopped completely during flight?",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12565",
  "body": "**Describe the bug**\nWe did 4 flight tests on Tuesday, the first two logged fine, the last two stopped logging during fight. The other parts of the system were working as usual so I didn't even notice anything until reading the logs and finding out most of it is missing.\nI am logging everything at the highest rates so I am not surprised by the frequent dropouts, but why did it just go off completely? \n\nNow I am trying to increase the buffer size by multiplying it in line 283. [https://github.com/PX4/Firmware/blob/36534d5bab3d6a73f146e671df1b8f40772174b7/src/modules/logger/logger.cpp#L283](http://url)\nMultiplying it by 4 makes the dropouts less frequent but sometimes the buffer still saturates. If I try to multiply it by 5 the logger won't start at all. Why there is a limit? \nThe stack size seems unaffected but I try to increase it to 5000 anyway, making no difference.\n\n**Expected behavior**\nI would expect the logging to resume after the buffer clears up, not just to stop completely.\nAlso maybe the way to increase the buffer correctly is not completely clear to me.\n\n**Log Files and Screenshots**\nHere the logging stopped even before takeoff. There is 10+ minutes of flight missing.\nhttps://review.px4.io/plot_app?log=0fd05bfa-c092-49f5-8cf6-c89c3d950f51\n\nThis is the last flight, there should be another 5+ minutes tracked.\nhttps://review.px4.io/plot_app?log=fdb9b50f-cc70-48d0-92d1-04215f50c64c\n\n**System**\nPixhawk 4\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fixedwing position controller not able follow position setpoints in offboard mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12517",
  "body": "**Describe the bug**\r\nWhen streaming position setpoints to the fixed wing vehicle, it can enter offboard mode as the setpoint is sreamed. However, rather than following the setpoints (usually defined in local coordinates) it simply flies straight. \r\n\r\nThis seems to be because the fixed wing position controller blindly reads from the setpoints in global coordinates from the position_setpoint_triplets.\r\n\r\nhttps://github.com/PX4/Firmware/blob/master/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L854-L855\r\n\r\n**To Reproduce**\r\n1. Run SITL and start mission while streaming position_setpoints through mavros with setpoint_raw messages to takeoff and loiter\r\n2. After takeoff, switch vehicle to offboard mode\r\n\r\n**Expected behavior**\r\nWhen given a position setpoint, the desired behavior is to use it as a reference for the L1 position controller.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=f6204199-f876-4253-8d12-cb454c1e816b\r\n\r\nAs can be seen in the picture below, once the vehicle is in offboard mode, the vehicle simply flies straight.\r\n![Screenshot from 2019-07-19 00-59-14](https://user-images.githubusercontent.com/5248102/61497647-84e62100-a9c0-11e9-845e-d8893c43ba88.png)\r\n\r\n**Additional context**\r\nAttitude setpoints for offboard mode in fixed wing is currently working. However, to use this a l1 like path tracking controller needs to be implemented on the companion side to make it usable. Being able to stream position setpoints to a fixed wing drone would greatly simplify the interface for robotic applications in fixed wing",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 offboard position control doesn't work with px4 firmware 1.9.2",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12476",
  "body": "**Expected behavior**\r\nThe goal is to do offboard position control, simply to make the quad take off from the groud to a set point (0,0,0.5) and hover. But it failed.\r\n**Log Files and Screenshots**\r\nhttps://dev.px4.io/v1.9.0/en/ros/external_position_estimation.html\r\n![image](https://user-images.githubusercontent.com/36159013/61189437-8f6c8780-a65b-11e9-9f7c-aa8d4dc12af2.png)\r\nThe .ulg file is shown here.\r\nhttps://logs.px4.io/plot_app?log=e9b8b3cb-be93-4ef5-973c-5f1e553b19a3\r\n\r\n1. I updated the latest px4 firmware 1.9.2 through QGC. The pixhawk is fmu-v2, I use a companion compute board insatlled ros kinetic and mavros. And I'm trying to do offboard control indoor with vicon device.\r\n2. As the  screenshot shows, I publish the vicon data to the mavros/vision_pose/pose topic, and the left window shows the data with commander line: rostopic echo mavros/vision_pose/pose, the middle window shows the data with commander line: rostopic echo mavros/local_position/pose, and the right window is the QGC analyzer, and the three sets of position data is consistent. So I think I set the EKF2 parameters in QGC right based on this \r\n3. After I keep publishing data through the topic mavros/vision_pose/pose and run the script which continues to publish the waypoint to the topic /mavros/setpoint_position/local, I can change the drone to the offboard mode by using QGC,  when the drone is in offboard mode, it just takes off and seems not be able to reach the fixed point and hover, which should be the position (0,0,0.5) as I set in my code,  it just drifted away in one direction, and seems to rise up constantly. I also tried the code here, https://github.com/mzahana/px4_indoor_navigation/blob/master/scripts/px4_offbaord_test.py\r\nand it has the same results and can not hold position. I tuned the yaw rate controller PID, roll and pitch controller PID and they are fine. But I don't know whether this is a firmware issue or I need to tune the position controller PID. \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "thermal calibration issues",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12412",
  "body": "I am trying to perform a [offboard thermal calibration on my pixhawk 3] with v1.9.0 firmware (https://docs.px4.io/en/advanced_config/sensor_thermal_calibration.html).  And I am getting step like response for my bias compensation (see attached figure).  Notice the z acceleration bias is very large.  Looking at the [flight review](https://review.px4.io/plot_app?log=9ef38f6d-629e-43c8-84f3-5af83118771b) it seems that the raw data is fine and has temperature drift, but the estimate rpy angle and rate go crazy.  \r\n\r\nWhy do I get step like responses for my bias curves? Is this a hardware or software problem?\r\n Has anybody got this issues before and if so how can I resolve it? This problem exist and my 3 new pixhawk 3 systems.\r\n\r\n[log001.ulg.pdf](https://github.com/PX4/Firmware/files/3357190/log001.ulg.pdf)\r\n\r\nthanks\r\n\r\n\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Rate setpoint dropout during transition",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12359",
  "body": "While flying a quadplane one v1.9 I noticed that there is always a 1 second gap in the vehicle_rates_setpoint topic at the beginning of the transition. Normally the fixed wing attitude controller should be publishing values. The rate controllers still seem to run.\r\n\r\n![image](https://user-images.githubusercontent.com/7610489/60328611-e8b39600-998e-11e9-9269-062976e5a34f.png)\r\n\r\nIn the figure above you can see the gap in the rate setpoint topic (top right).\r\nAt the beginning of the transition we switch from multicopter attitude controller to fixed wing attitude controller to produce the rate setpoint. However, i don't see the reason yet why it takes the fixed wing attitude controller 1 second to publish to the rates setpoint topic.\r\n\r\n@dagar Any ideas?\r\n\r\nLog: https://logs.px4.io/plot_app?log=5bca4650-96a8-4f92-8619-b9b1cadccf4a",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MPC_THR_HOVER gets passed unconstrained to the thrust setpoint in manual mode.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12338",
  "body": "**Describe the bug**\r\nAn incorrect value of MPC_THR_HOVER will get passed unconstrained to the manual thrust setpoint.  In 1.8.2 the manual thrust setpoint was constrained between MPC_THR_MIN and MPC_THR_MAX.  If the user entered a MPC_THR_HOVER of 50 instead of 0.50 a centered stick would result in a thrust setpoint of 50 where the mixer expects values between 0 and 1.0.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nSet MPC_THR_HOVER to a value of 59 (instead of the correct 0.59).  In QGC this is would have to be entered as 5900 but in a startup script as 59.\r\n\r\n**Expected behavior**\r\nThe hover thrust setpoint should not be greater than 1.0, or MPC_THR_MAX\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=4a38b5fc-4684-4b16-9313-16dcda6294cd\r\n\r\n![image](https://user-images.githubusercontent.com/6790455/60197003-5aef7380-97f3-11e9-850c-6330f6c9bdd1.png)\r\n\r\n\r\nYeah, this was a dumb mistake on my part to fat finger the entry, but in 1.8.2 I would have to fat finger two separate parameters.  It's up to you guys if you want to protect against this kind of dumb.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RC loss behavior",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12307",
  "body": "**Describe the bug**\nDrone lost communication and then descended to ground.\n\n**To Reproduce**\nSteps to reproduce the behavior:\nFly drone in Position mode and lose communication with it. I don't know how to reproduce this consistently.\n\n**Expected behavior**\nI would expect the drone to continue to do what it was doing before because NAV_RCL_ACT  was set to 0.\n\n**Log Files and Screenshots**\nhttps://review.px4.io/plot_app?log=d97a8a6f-94a6-42fa-abf0-0dff97ba8102\n\n**Drone:**\n- Teal One\n\n**Additional context**\nPX4 1.9.0",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 not fusing the Rangefinder",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12247",
  "body": "**Describe the bug**\r\nThe estimated altitude and the local_position.z seem to ignore the rangefinder data.\r\nUsing the Lidar Lite through PWM,\r\nPixhawk 4 fmu_v5,\r\nstable release 1.9.0,\r\nquadrotor_x in position control or altitude hold mode.\r\n\r\nThe distance sensor data show that the sensor outputs correct readings but the altitude estimates seem uninfluenced.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=d19babaf-06b4-4074-b14e-af8828fb51c2\r\n\r\nAdd screenshots to help explain your problem.\r\n![Screenshot 2019-06-11 at 20 51 47](https://user-images.githubusercontent.com/22155994/59302939-072a4980-8c8d-11e9-9eeb-36fe5cfd2355.png)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Position control problems with typhoon_h480 model in gazebo sitl ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12221",
  "body": "**The bug**\r\n\r\nSince Firmware Commit https://github.com/PX4/Firmware/commit/43e3fc707de823faa19b16091e5ee4a900e3c446 the typhoon_h480 model does not exhibit good position control in gazebo simulation with mavros. Still the case as at https://github.com/PX4/Firmware/commit/b0176dc88aecd22363f771bfe62dafa57a6a194a. The error message ```Critical navigation failure! Check sensor calibration``` is logged in conjunction with the problem.\r\n\r\nFrom release v1.9.0 to the commit prior to the reported issue (4a4d323) seem to work fine.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Load commit version and ensure a totally clean build/initialisation (problem may not manifest unless all these steps are followed):\r\n```\r\ncd <FIRMWARE LOCATION>\r\ngit checkout <COMMIT UNDER TEST>\r\nmake clean\r\ngit submodule update\r\nrm ~/.ros/eeprom/parameters\r\nmake px4_sitl_default gazebo_typhoon_h480\r\n```\r\n2. roslaunch model ```roslaunch px4 mavros_posix_sitl.launch vehicle:=typhoon_h480```\r\n3. Arm / transition to offboard mode\r\n4. Send position target\r\n\r\n**Expected behavior**\r\nStable position control behaviour (from commit 4a4d323):\r\nhttps://logs.px4.io/plot_app?log=6c788665-95f7-4b2b-a963-9ad58911024c\r\n\r\n**Log Files and Screenshots**\r\nUnstable position control behaviour:\r\nhttps://logs.px4.io/plot_app?log=894c8553-18b1-4fc1-ad4a-d1587485637e\r\n\r\n\r\n**Additional context**\r\n- Iris model still seems to work OK in this regard\r\n- Have also observed ```Preflight Fail: Compass #0 uncalibrated``` but possibly due to not clearing parameter files between different build levels.\r\n- when using ```commander takeoff``` in gazebo via the pxh> shell the vehicle seems stable.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Compass calibration fail PixRacer V4 on Master ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12193",
  "body": "**Describe the bug**\r\nUploaded PR [#12120](https://github.com/PX4/Firmware/pull/12120) tried to arm and had an error \"compass Inconsistent\". Performed the compass calibrations and got error message \"Error: failed to get current calibration 2\". Uploaded  Master branch ac44584. To replicate the issue performed calibrations and got the same message, \"Error: failed to get current calibration 2\". Tried on Stable ea48cd4, performed the calibrations and went through successfully. Vehicle armed and had no issues.  \r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Upload Master branch or PR\r\n2. Perform compass calibration\r\n3. Failed calibrations \r\n4. See error\r\n\r\n**Expected behavior**\r\nThe expected behavior is for the vehicle to pass the calibrations and able to arm the vehicle.\r\n**Log Files and Screenshots**\r\n<img width=\"960\" alt=\"error\" src=\"https://user-images.githubusercontent.com/39415493/58993834-89090700-87a3-11e9-9d66-fa505e8772a1.png\">\r\n@dagar There seems to be an error when uploading the log on Flight Review. \r\n<img width=\"960\" alt=\"error al cargar log\" src=\"https://user-images.githubusercontent.com/39415493/58994274-cc17aa00-87a4-11e9-961e-060511c72f9a.png\">\r\n\r\n**Additional** context\r\nThe last working log\r\nhttps://review.px4.io/plot_app?log=116ede6d-d632-4836-91a7-fced724c82be-- \r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Custom firmware crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12071",
  "body": "**Describe the bug**\nThis is a vtol plane I flew for about 15+ flights. \n\n1. The FC is a hex cube. \n1. Firmware version is derived from 1.8.1 stable, RTK gps driver is modified. \n1. Before this crash flight, I encontered\nThis time when plane is in mission, reached the 5th waypoint, the plane didn't continue mission, however, it continued to fly towards the 5th point, the flight path is like a \"8\", then all the command from QGC became useless, still I can see all the plane status (attitude/vel/pos...). At the end the plane ran out of battery and crashed. (no RC, or I would have saved the plane)\n\n**To Reproduce**\nTwo ways to reproduce the behavior:\n\n1. Prepare the plane with RC, upload the mission, then plug out the sd card before manually take-off. Fly the plane, then switch to mission mode, the plane would fly to the only known point, the flght path is an \"8\".\n1. In HIL with rotory wing (can't use fw hil), make the rw excecuting mission, then plug out the sd card, the rw would stop at the moment it reaches the current waypoint and stop there. Made several tests, seems that MAVLINK_MISSION and NAVIGATOR modules stopped. COMMANDER module works normally. Switching mode in QGC is useless, mavlink console is dead. RTL is also useless. Only RC can truely switch the mode to manual/altitude/position. \nI checked code, I doubt it's a datamanager problem, maybe one semaphore is blocked... But I don't know how to dig this deeper.\n\n**Log Files and Screenshots**\nHere is the 4 minutes log for this crash, sorry I don't have a tlog as I use Ipad.\nhttps://logs.px4.io/plot_app?log=34ff913a-5414-4046-87db-181a0ea7b507\n\n**Additional context**\nThe same thing I suffered one year ago is shown below, after that crash, I changed my SD card to a Kingston card. Then this problem seems solved. However it crashed again as the SD card is obviously not good enough. I will use industriel sd card in the future, but I hope we can do something in code side, we can't guarantee the sd card quality every time...\nhttps://github.com/PX4/Firmware/issues/9271#issuecomment-383260595\n\nPlease help me out of this, I would like to offer any message you need.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "System wide replay broken in master",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12006",
  "body": "**Describe the bug**\r\nGeneral system wide replay, is broken on master (and likely v1.9). EKF2 replay works fine.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Follow instructions for system-wide replay (not EKF2 replay) here : https://dev.px4.io/master/en/debug/system_wide_replay.html\r\n2. Set logfile path `export replay=~/<path>/41b1370f-0007-4537-b245-2fe3344e4f69.ulg`\r\n3. Run `make px4_sitl_default jmavsim`\r\n\r\n**Log Files and Screenshots**\r\n- Log to reproduce : https://logs.px4.io/plot_app?log=41b1370f-0007-4537-b245-2fe3344e4f69\r\n\r\n- Terminal output:\r\n\r\n```\r\n[0/1] cd /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay/tmp && /Users/kabir/Development/PX4/Firmware/Tools/sitl_run.sh /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay/bin/px4 none jmavsim none /Users/kabir/Development/PX4/Firmware /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay\r\nSITL ARGS\r\nsitl_bin: /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay/bin/px4\r\ndebugger: none\r\nprogram: jmavsim\r\nmodel: none\r\nsrc_path: /Users/kabir/Development/PX4/Firmware\r\nbuild_path: /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay\r\nempty model, setting iris as default\r\nSITL COMMAND: \"/Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay/bin/px4\" \"/Users/kabir/Development/PX4/Firmware\"/ROMFS/px4fmu_common -s etc/init.d-posix/rcS -t \"/Users/kabir/Development/PX4/Firmware\"/test_data\r\nINFO  [uorb] Using orb rules from ./orb_publisher.rules\r\n+ SYS_AUTOSTART: curr: 50001 -> new: 10016\r\n+ BAT_N_CELLS: curr: 8 -> new: 3\r\n+ CAL_ACC0_ID: curr: 0 -> new: 1376264\r\n+ CAL_ACC1_ID: curr: 0 -> new: 1310728\r\n+ CAL_ACC_PRIME: curr: 6488106 -> new: 1376264\r\n+ CAL_GYRO0_ID: curr: 0 -> new: 2293768\r\n+ CAL_GYRO_PRIME: curr: 6553642 -> new: 2293768\r\n+ CAL_MAG0_ID: curr: 466977 -> new: 196616\r\n+ CAL_MAG_PRIME: curr: 466977 -> new: 196616\r\n+ COM_DISARM_LAND: curr: -1.0000 -> new: 0.1000\r\n+ COM_OBL_ACT: curr: 0 -> new: 2\r\n+ COM_OF_LOSS_T: curr: 0.0000 -> new: 5.0000\r\n+ COM_RC_IN_MODE: curr: 0 -> new: 1\r\n+ EKF2_AID_MASK: curr: 24 -> new: 1\r\n+ EKF2_HGT_MODE: curr: 3 -> new: 0\r\n+ EKF2_GBIAS_INIT: curr: 0.1000 -> new: 0.0100\r\n+ MIS_TAKEOFF_ALT: curr: 0.0100 -> new: 2.5000\r\n+ NAV_DLL_ACT: curr: 0 -> new: 2\r\n+ RTL_DESCEND_ALT: curr: 30.0000 -> new: 5.0000\r\n+ RTL_LAND_DELAY: curr: -1.0000 -> new: 5.0000\r\n+ RTL_RETURN_ALT: curr: 60.0000 -> new: 30.0000\r\n+ SDLOG_MODE: curr: 2 -> new: 1\r\n+ SDLOG_DIRS_MAX: curr: 0 -> new: 7\r\n+ SENS_BOARD_X_OFF: curr: -1.4278 -> new: 0.0000\r\n+ SENS_DPRES_OFF: curr: 0.0000 -> new: 0.0010\r\n+ SYS_RESTART_TYPE: curr: 0 -> new: 2\r\n* RTL_DESCEND_ALT: curr: 5.0000 -> new: 10.0000\r\n* RTL_LAND_DELAY: curr: 5.0000 -> new: 0.0000\r\n+ PWM_MAX: curr: 1800 -> new: 1950\r\n+ PWM_MIN: curr: 1200 -> new: 1075\r\nINFO  [replay] using replay log file: /Users/kabir/Development/Driverless/EKFtuning/log_7_2019-5-10-17-48-16.ulg\r\nINFO  [replay] Applying params from ULog file...\r\nBuildfile: /Users/kabir/Development/PX4/Firmware/Tools/jMAVSim/build.xml\r\n\r\nmake_dirs:\r\n\r\ncompile:\r\n\r\ncreate_run_jar:\r\n\r\ncopy_res:\r\n\r\nBUILD SUCCESSFUL\r\nTotal time: 0 seconds\r\nOptions parsed, starting Sim.\r\nStarting GUI...\r\nInit MAVLink\r\n+ MAV_TYPE: curr: 10 -> new: 2\r\nINFO  [init] Mixer: etc/mixers/quad_w.main.mix on /dev/pwm_output0\r\nINFO  [mavlink] MAVLink only on localhost (set param MAV_BROADCAST = 1 to enable network)\r\nINFO  [px4] Creating symlink /Users/kabir/Development/PX4/Firmware/ROMFS/px4fmu_common -> /Users/kabir/Development/PX4/Firmware/build/px4_sitl_default_replay/tmp/rootfs/etc\r\n\r\n______  __   __    ___ \r\n| ___ \\ \\ \\ / /   /   |\r\n| |_/ /  \\ V /   / /| |\r\n|  __/   /   \\  / /_| |\r\n| |     / /^\\ \\ \\___  |\r\n\\_|     \\/   \\/     |_/\r\n\r\npx4 starting.\r\n\r\nINFO  [px4] Calling startup script: /bin/sh etc/init.d-posix/rcS 0\r\nINFO  [dataman] Unknown restart, data manager file './dataman' size is 11798680 bytes\r\nINFO  [simulator] Waiting for simulator to connect on TCP port 4560\r\nINFO  [simulator] Simulator connected on TCP port 4560.\r\nINFO  [mavlink] mode: Normal, data rate: 4000000 B/s on udp port 14570 remote port 14550\r\nINFO  [mavlink] mode: Onboard, data rate: 4000000 B/s on udp port 14580 remote port 14540\r\nINFO  [logger] logger started (mode=all)\r\nINFO  [logger] Start file log (type: full)\r\nINFO  [logger] Opened full log file: ./log/2019-05-13/00_31_38_replayed.ulg\r\nINFO  [replay] Applying params from ULog file...\r\nINFO  [px4] Startup script returned successfully\r\nINFO  [replay] Replay in progress...\r\nWARN  pxh> [replay] Formats for vehicle_status don't match. Will ignore it.\r\nWARN  [replay]  Internal format: uint64_t timestamp;uint32_t onboard_control_sensors_present;uint32_t onboard_control_sensors_enabled;uint32_t onboard_control_sensors_health;float arspd_check_level;float load_factor_ratio;uint8_t nav_state;uint8_t arming_state;uint8_t hil_state;bool failsafe;uint8_t system_type;uint8_t system_id;uint8_t component_id;bool is_rotary_wing;bool is_vtol;bool vtol_fw_permanent_stab;bool in_transition_mode;bool in_transition_to_fw;bool rc_signal_lost;uint8_t rc_input_mode;bool data_link_lost;uint8_t data_link_lost_counter;bool high_latency_data_link_lost;bool engine_failure;bool mission_failure;uint8_t failure_detector_status;bool aspd_check_failing;bool aspd_fault_declared;bool aspd_use_inhibit;bool aspd_fail_rtl;uint8_t[4] _padding0;\r\nWARN  [replay]  File format    : uint64_t timestamp;uint32_t onboard_control_sensors_present;uint32_t onboard_control_sensors_enabled;uint32_t onboard_control_sensors_health;uint8_t nav_state;uint8_t arming_state;uint8_t hil_state;bool failsafe;uint8_t system_type;uint8_t system_id;uint8_t component_id;bool is_rotary_wing;bool is_vtol;bool vtol_fw_permanent_stab;bool in_transition_mode;bool in_transition_to_fw;bool rc_signal_lost;uint8_t rc_input_mode;bool data_link_lost;uint8_t data_link_lost_counter;bool high_latency_data_link_lost;bool engine_failure;bool mission_failure;uint8_t failure_detector_status;\r\nWARN  [replay] Formats for vehicle_status_flags don't match. Will ignore it.\r\nWARN  [replay]  Internal format: uint64_t timestamp;bool condition_calibration_enabled;bool condition_system_sensors_initialized;bool condition_system_hotplug_timeout;bool condition_system_returned_to_home;bool condition_auto_mission_available;bool condition_global_position_valid;bool condition_home_position_valid;bool condition_local_position_valid;bool condition_local_velocity_valid;bool condition_local_altitude_valid;bool condition_power_input_valid;bool condition_battery_healthy;bool circuit_breaker_engaged_power_check;bool circuit_breaker_engaged_airspd_check;bool circuit_breaker_engaged_enginefailure_check;bool circuit_breaker_engaged_gpsfailure_check;bool circuit_breaker_flight_termination_disabled;bool circuit_breaker_engaged_usb_check;bool circuit_breaker_engaged_posfailure_check;bool offboard_control_signal_found_once;bool offboard_control_signal_lost;bool offboard_control_set_by_command;bool offboard_control_loss_timeout;bool rc_signal_found_once;bool rc_input_blocked;bool rc_calibration_valid;bool vtol_transition_failure;bool usb_connected;bool avoidance_system_required;bool avoidance_system_valid;uint8_t[2] _padding0;\r\nWARN  [replay]  File format    : uint64_t timestamp;bool condition_calibration_enabled;bool condition_system_sensors_initialized;bool condition_system_hotplug_timeout;bool condition_system_returned_to_home;bool condition_auto_mission_available;bool condition_global_position_valid;bool condition_home_position_valid;bool condition_local_position_valid;bool condition_local_velocity_valid;bool condition_local_altitude_valid;bool condition_power_input_valid;bool condition_battery_healthy;bool circuit_breaker_engaged_power_check;bool circuit_breaker_engaged_airspd_check;bool circuit_breaker_engaged_enginefailure_check;bool circuit_breaker_engaged_gpsfailure_check;bool circuit_breaker_flight_termination_disabled;bool circuit_breaker_engaged_usb_check;bool circuit_breaker_engaged_posfailure_check;bool offboard_control_signal_found_once;bool offboard_control_signal_lost;bool offboard_control_set_by_command;bool offboard_control_loss_timeout;bool rc_signal_found_once;bool rc_input_blocked;bool rc_calibration_valid;bool vtol_transition_failure;bool usb_connected;uint8_t[4] _padding0;\r\nWARN  [replay] Topic vehicle_body_state not found internally. Will ignore it\r\nWARN  [replay] Topic vehicle_ackermann_setpoint not found internally. Will ignore it\r\nWARN  [replay] Topic wheel_odometry not found internally. Will ignore it\r\nERROR [sensors] Gyro #0 fail:  STALE!\r\nERROR [sensors] Sensor Gyro #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Gyro #0 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 75\r\nWARN  [ekf2] accel id changed, resetting IMU bias\r\nERROR [sensors] Accel #1 fail:  STALE!\r\nERROR [sensors] Sensor Accel #1 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 1: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 1: Accel #1 priority: 1\r\nWARN  [ekf2] accel id changed, resetting IMU bias\r\nERROR [sensors] Baro #0 fail:  STALE!\r\nERROR [sensors] Sensor Baro #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Baro #0 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nINFO  [ekf2] Mag sensor ID changed to 196616\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\nERROR [sensors] Accel #0 fail:  STALE!\r\nERROR [sensors] Sensor Accel #0 failed. Reconfiguring sensor priorities.\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #0 priority: 1\r\nWARN  [sensors] Remaining sensors after failover event 0: Accel #1 priority: 1\r\n\r\nfloating point exception\r\nINFO  [log] Backtrace: 3\r\nINFO  [log] 0   px4                                 0x00000001084b6bfc px4_backtrace + 44\r\nINFO  [log] 1   ???                                 0x0000000000000019 0x0 + 25\r\nINFO  [log] 2   ???                                 0x0000700009cc28e8 0x0 + 123145466685672\r\n\r\nfloating point exception\r\nINFO  [log] Backtrace: 3\r\nINFO  [log] 0   px4                                 0x00000001084b6bfc px4_backtrace + 44\r\nINFO  [log] 1   ???                                 0x0000000000000019 0x0 + 25\r\nINFO  [log] 2   ???                                 0x0000700009cc28e8 0x0 + 123145466685672\r\n\r\n...\r\n\r\n```",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PositionControl: tiny minimal thrust length",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11987",
  "body": "**Describe problem solved by the proposed pull request**\r\nTo be able to still infer the direction of the thrust vector we limit it to a minimal length even if `MPC_THR_MIN` is set to zero. The parameter `MPC_THR_MIN` already needs to be forced to 0 so this is really an extreme corner case.\r\n\r\nNote: This is a hotfix for certain specific applications. The direction of the thrust vector in this corner case is very likely to get into the tilt limit which is generally undesired.\r\n\r\n**Test data / coverage**\r\nSITL tests:\r\n- **Without** a tiny minimal thrust added in this PR flying unsmoothed position control with `MPC_THR_MIN` set to 0 and demanding a downwards step which results in hard downwards acceleration:\r\nhttps://logs.px4.io/plot_app?log=4ef6a4cf-359e-4561-adbb-5a93387a981e\r\nthrust goes to (0,0,0) attitude roll and pitch go to level.\r\n![without](https://user-images.githubusercontent.com/4668506/57354740-931bf380-716c-11e9-9843-40bc3ef41749.PNG)\r\n\r\n- **With** a tiny minimal thrust added in this PR flying unsmoothed position control with `MPC_THR_MIN` set to 0 and demanding a downwards step:\r\nhttps://logs.px4.io/plot_app?log=58cae91c-5896-45ea-8e12-b45551d28250\r\nThe thrust keeps a minimum length and hence roll and pitch can still be infered.\r\n![with](https://user-images.githubusercontent.com/4668506/57357162-9a460000-7172-11e9-8c29-6c8c9348ac54.PNG)\r\n\r\n\r\n**Describe your preferred solution**\r\nIt's desirable to keep the attitude information in the thrust vector and therefore it should never be exactly (0,0,0).\r\n\r\n**Additional context**\r\nA remaining problem that existed before is that if e.g. to accelerate downwards very hard the thrust vector in z-axis direction gets zero (which means demanded idle thrust and hence almost freefall) the desired attitude should not tilt extremely just because the result of the velocity control is 90 degree tilt in the direction of the horizontal error.\r\n\r\nI disucussed with @bresch that it would makes sense to at least not demand the direction of the thrust vector to change faster than the maximal rate to rate controller will execute in the end. Otherwise we know beforehands it will result in a large unfeasible error.\r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/11987",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11987",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/11987.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/11987.patch",
    "merged_at": "2019-05-08T08:08:46Z"
  }
}
{
  "title": "Unable to biuld px4 v 1.9.0 on beagle bone blue native",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11942",
  "body": "**Describe the bug**\r\nA clear and concise description of the bug.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Drone switched on '...'\r\n2. Uploaded mission '....' (attach QGC mission file)\r\n3. Took off '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Log Files and Screenshots**\r\n*Always* provide a link to the flight log file:\r\n- Download the flight log file from the vehicle ([tutorial](https://docs.px4.io/en/getting_started/flight_reporting.html)).\r\n- Share the link to a log showing the problem on [PX4 Flight Review](http://logs.px4.io/).\r\n\r\nAdd screenshots to help explain your problem.\r\n\r\n**Drone (please complete the following information):**\r\n- Describe the type of drone.\r\n- Photo of the IMU / autopilot setup if possible.\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL - Skip descend state in \"Return then land immediately\" mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11913",
  "body": "**Describe problem solved by the proposed pull request**\r\nDuring RTL, some users (thanks @bkueng ) reported that the behavior of the drone during the RTL final descent is weird: it accelerates and decelerates several times instead of simply performing a \"land\".\r\nI discovered that this was caused by the intermediate waypoint placed by RTL between \"descend\" and \"land.\r\nThis PR simply adds a shortcut in the state machine to directly go to land mode and skip that waypoint if RTL is configured as \"Return home, then land immediately\".\r\n\r\n**Test data / coverage**\r\nSITL tests:\r\nWithout this PR: https://logs.px4.io/plot_app?log=42c21502-6212-4ca1-82b8-34798e02fca0\r\nAs seen in the graph below, the drone reaches down speed of 1m/s then slows down to reach the \"end of RTL descend\" then accelerate to reach down speed and reduces speed to reach a land speed of 0.7m/s.\r\n![bokeh_plot(16)](https://user-images.githubusercontent.com/14822839/56738049-0cc6e100-676c-11e9-9c58-940319da5f61.png)\r\n\r\nWith this PR: https://logs.px4.io/plot_app?log=cdbc8ad6-4ff8-4525-9e98-f1ce6ebe4e7d\r\nThe drone goes down at 1m/s until it reaches the \"low altitude\" where it reduces its speed to 0.7m/s, like it would do in a normal \"land\".\r\n![bokeh_plot(15)](https://user-images.githubusercontent.com/14822839/56738208-6af3c400-676c-11e9-9460-7daa32de09c9.png)\r\n\r\nOther modes:\r\n- Loiter and land: https://logs.px4.io/plot_app?log=88a29c37-8348-4abe-b9e1-48ab64ae8eae\r\n- Loiter and do **not** land: https://logs.px4.io/plot_app?log=45780f74-191d-42f8-af1d-25b28e84e892",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/11913",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11913",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/11913.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/11913.patch",
    "merged_at": "2019-04-25T16:24:05Z"
  }
}
{
  "title": "High sensor noise in SITL when disarmed",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11912",
  "body": "I realized that in SITL Gazebo (using `standard_vtol`) the sensor noise (especially accel) is quite high.\r\n\r\nIn my opinion this is far from reality and should be improved.\r\n\r\nI stumbled upon this in SDK tests where arming failed with the message:\r\n```\r\n[commander] Preflight Fail: Accel Range, hold still on arming\r\n```\r\nhttps://logs.px4.io/plot_app?log=01919d08-3298-45ff-8cb2-c99929b890ca\r\n\r\n@bresch also saw it in SITL CI.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Poor initial climbout performance, fixed wing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11907",
  "body": "part of a related discussion with @LorenzMeier @RomanBapst @dagar here https://github.com/PX4/Firmware/pull/11883#discussion_r278098852\r\n\r\nWe sometimes see poor initial climb out performance on our hand-launched fixed wing. Looking at some logs it is not achieving the target pitch angle (15 deg), but the control system isn't trying very hard to get there.\r\n\r\nMight there be an integrator issue or is something else going on with airspeed and gain scaling?\r\n\r\n![image](https://user-images.githubusercontent.com/12117027/56701401-91f6bb00-66c4-11e9-835e-3dbd02233b24.png)\r\n\r\n\r\nExample logs here:\r\nhttps://review.px4.io/plot_app?log=a8b193bc-f3d7-4cab-ae3e-ba0302c1834b\r\nand\r\nhttps://review.px4.io/plot_app?log=09b99ed1-aef6-4eff-8d44-d166307f7132",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pr fw att airspeed scaling",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11897",
  "body": "Replacement for #11883\r\n\r\n@dagar I removed the check for negative airspeed and also removed the slew rate on the airspeed scaling.\r\nI think normally we should not have the situation where the airspeed valid flag toggles between true and false so I don't quite see the point of the slew rate. Furthermore, the slew rate could have hidden this problem in the first place.\r\nI'm happy to discuss this if you feel strong about it.\r\n\r\nThis was thoroughly flight tested on a fixed wing.\r\nhttps://logs.px4.io/plot_app?log=4a46bce4-476c-411b-8b14-acc5b1f3f7bd\r\nhttps://logs.px4.io/plot_app?log=7aa3beda-229f-41d4-9999-1b889daf2213\r\nhttps://logs.px4.io/plot_app?log=6f45f725-efe9-4370-a6b2-694f76674b61",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/11897",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11897",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/11897.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/11897.patch",
    "merged_at": "2019-04-24T12:27:38Z"
  }
}
{
  "title": "Elevator servo twitching in stabilized FW mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11880",
  "body": "\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. UAV switched on \r\n2. Put on a leveled surface \r\n3. Press safety switch on\r\n4. Activate stabilized mode\r\n5. Move elevator to the maximum up or maximum down position by manual controls\r\n6. Wait few seconds for elevator servo twitch it will be repeated randomly\r\n\r\n**Expected behavior**\r\n\r\nI expect a stable output of servo command without any random glitch or twitching.\r\n\r\n**Log Files and Screenshots**\r\n\r\n[Log file containing the bug](https://logs.px4.io/plot_app?log=b70751e1-6844-4d59-b85f-9495ca968ac5)\r\n\r\nFollowing graph clearly shows elevator twitches\r\n\r\n![Actuator output](https://user-images.githubusercontent.com/1194177/56459724-2ea11c00-6398-11e9-8ae8-b67a55cda1ff.png)\r\n\r\n\r\n**Additional context**\r\nThe amplitude of glitch seems to be proportional and fixed to elevator deflection. \r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Poor EKF2 yaw performance without compass",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11847",
  "body": "**Describe the bug**\r\nWhen using EKF2 without magnetometer fusion enabled, there is significant yaw drift. I'm using an ADIS16497 IMU (orders of magnitude better than the onboard sensors) on a Pixhawk 4 for tests.\r\n\r\nThis has been previously reported independently in https://github.com/PX4/ecl/issues/567 with analysis and logs.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Set EKF2_MAG_TYPE to \"None\" or \"MC Custom\"\r\n2. Reboot\r\n3. Look at heading estimate\r\n\r\nI also played with the inhibit imu bias estimation flag, but it didn't seem to make much of a difference.\r\n\r\n**Expected behavior**\r\nDrift lower than the order of degrees per second.\r\n\r\n**Log Files and Screenshots**\r\nLogs from boot and screenshots showing Z gyro integral compared to heading estimate. All tests are done with vehicle static on desk:\r\n\r\n1. EKF2_MAG_TYPE = None (https://logs.px4.io/plot_app?log=edb5aada-9f19-424b-958d-9f932517fa9f)\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/56095622-b1177080-5eac-11e9-86ec-cc670f837027.png)\r\n\r\n2. EKF2_MAG_TYPE = None, EKF2_AID_MASK has \"inhibit imu bias estimation\" (https://logs.px4.io/plot_app?log=074aab41-8e42-41a8-a83e-9bd0430743a0)\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/56095648-e9b74a00-5eac-11e9-9651-2924fe924fa6.png)\r\n\r\n3. EKF2_MAG_TYPE = MC Custom (https://logs.px4.io/plot_app?log=53912bb1-dd88-4168-b7a0-988edd0afa1b)\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/56095721-a6a9a680-5ead-11e9-9584-69fb92750b90.png)\r\n\r\n4. EKF2_MAG_TYPE = MC Custom, EKF2_AID_MASK has \"inhibit imu bias estimation\" (https://logs.px4.io/plot_app?log=6b17e1d2-6d03-4c29-8c01-ec087c4faf9a)\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/56095728-b75a1c80-5ead-11e9-9e16-4c6e60b08d26.png)\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pixhawk Cube v2 Return to land failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11824",
  "body": "**Describe the bug**\r\n- Modes Tested\r\nPosition Mode: Good.\r\nMission Plan Mode (Automated)\r\nRTL (Return To Land\r\n\r\n- Procedure\r\nArm and Take off in position mode, after flying for approximately one minute, switched to mission plan mode  behavior,the vehicle took-off and reached the designated altitude (35m) as expected; issue started once it reached the altitude of 35m, UAV began to oscillate and descend at the same time but the descend was not continuous, it had short pauses.\r\n\r\nhttps://review.px4.io/plot_app?log=e9d7b116-487a-45c2-98f9-52d9cec4d88f\r\n\r\n**Drone (please complete the following information):**\r\n- Describe the type of drone.F450 Pixhawk Cube v2\r\n\r\nVideo:  https://www.youtube.com/watch?v=Sv2jUGdmNBo&feature=youtu.be",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ECL breaks gazebo when there is a lidar",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11812",
  "body": "After the ECL update of April 4th, if the vehicle model has a lidar the local position drift like crazy when the vehicle is unarmed on ground.  Green line is vehicle local position\n\n![crazy](https://user-images.githubusercontent.com/15078736/55722173-c81a1680-5a05-11e9-851b-23405bd22d2a.png)\n\n\nLog: https://review.px4.io/plot_app?log=f1ff8c5b-d47a-4065-8a6a-1beafacd1b6c\nReported by @mrivi",
  "state": "closed",
  "pull_request": null
}
{
  "title": "nxp_fmuk66-v3 rev C issues",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11767",
  "body": "\r\n\r\n**Tested on NXP v3.x**\r\n\r\n**Modes Tested** \r\n_Position Mode:_ Armed and took-off as expected, once in the air the vehicle was oscillating. \r\n\r\n_Mission Plan Mode (Automated):_ Once switched from position to mission vehicle gain altitude but did not start the mission then switched back to position but UAV did not respond and crashed. \r\n\r\n_RTL (Return To Land):_ Untested. \r\n\r\n**Notes** \r\nVehicle took-off in position mode but was oscillating while in the air. \r\nThe vehicle did not respond to RC commands after switching from mission mode back to position mode.\r\n\r\nhttps://review.px4.io/plot_app?log=d9e76bc4-5c82-42c5-84bf-19c127e78016\r\n@igalloway @davids5 @dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fixed wing mission and altitude transition fail",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11759",
  "body": "Vehicle Information:\nAirframe: Phantom FPV Flying Wing\nHardware: | PX4_FMU_V3 (V2)\nSoftware Version: | v1.9.0 (beta) (25bf4ba7)\nSteps:\n\n1.  Vehicle arms \n1. Take off is smooth\n\nNotes: Flight as expected, but once the mission plan (automated) is triggered, fixed-wing accelerates towards the ground with the nose facing down.\n\nPR #10179 and Master same issues.\nhttps://review.px4.io/plot_app?log=d1c75dae-a1fe-4fc6-b6aa-20cb1f979aa8\nInitially, we thought it was the hardware. Last week we did several reboots and inspected the hardware. We tested again today and the same issue persisted.\n\nVideo of the issue below:\nhttps://www.youtube.com/watch?v=CdgrCeFI8A0&feature=youtu.be\n@dagar what could be the issue?\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Hard-fault in NuttX?",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11703",
  "body": "**Describe the bug**\nWe flew in position control testing some of the collision prevention capabilities (together with the avoidance on the companion), when suddenly the drone fell out of the sky.\n\n**Log Files and Screenshots**\n[Firmware: 2ebb9d](https://github.com/PX4/Firmware/commit/2ebb9d2ab52bce56a74d34d3b36c7130422577c2)\n[Logfile](https://review.px4.io/plot_app?log=a2750cab-5785-4dd2-bc34-c54e8ca32668)\n[.elf file](https://drive.google.com/file/d/12XRtolO2OdMxlqsjAS1kktjLkBmqnFY_/view?usp=sharing)\n\n**Drone :**\nQuad X racer, with a pixracer\n\nMy hard-fault debugging skills are severely limited, best I could tell is that it seemed to come from `fs_poll.c`, but I wouldn't trust myself about that. Maybe @bkueng or @julianoes are more qualified to debug this?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Achievable speed against heavy wind depends on auto vs manual",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11646",
  "body": "**Describe the bug**\nI cannot be 100% sure that this also happens on master but I'm assuming this now and verify.\n\n**To Reproduce**\nSteps to reproduce the behavior:\n1. Set the mission cruise speed and the manual position full stick flight speed to the same relatively high value e.g. 10m/s\n1. Fly away from you in very heavy wind\n1. Fly back to you in manual position mode full speed against the wind\nSetpoint is full speed but you don't reach full speed because of the wind\n1. Switch to RTL which should continue flight with the cruise speed (you configured it to be the same)\nSetpoint stays the same and now you reach it\n\nI repeated this several times and verified it's not the wind changing drastically in between the two modes.\n\n**Expected behavior**\nYou can reach the same speed in both modes even against the wind if the vehicle has enough power (which it clearly had in my case).\n\n**Log Files and Screenshots**\nhttps://logs.px4.io/plot_app?log=f8817dcc-abda-466a-b223-9e504e3486fd\n<img width=\"1559\" alt=\"log_bug\" src=\"https://user-images.githubusercontent.com/4668506/54364606-81870580-466d-11e9-904d-fdf4ca82bfd9.PNG\">\n\n**Drone:**\nYuneec H520\n\n**Additional context**\n- Both times it's a velocity setpoint that should be reached and it's not a feed forward to position control.\n- `MPC_TILTMAX_AIR` is the maximum tilt for auto and manual position flight so this should not be the reason.\n- Do the maximum rates in the rate setpoint make a difference?\n\nAny help or even hint is appreciated, otherwise I'll try to solve it myself.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FlightTaskAuto - Recover position control after local position reset",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11636",
  "body": "When the local position is invalid, the `_position` is set to `NAN` and the _triplet_target gets a `NAN`. In that state, the result of the if condition is always true (because `!(NAN > 0.001f) = true`) and the target cannot be updated anymore. \nThe target get stucks in a `NAN` condition even if local position is recovered and the vehicle drifts away. Changing the condition to (`_triplet_target - tmp_target < 0.001f`) returns a `false` if `_triplet_target` is NAN (because `NAN < 0.001f = false`) and the target gets a valid position as soon as local position is valid.\n\nWithout this PR:\nhttps://logs.px4.io/plot_app?log=501f7173-36a6-407d-b0da-4095bb020eb4\n![bokeh_plot(14)](https://user-images.githubusercontent.com/14822839/54275107-1a445500-458a-11e9-86eb-41ebe66fec4f.png)\n\nWith this PR:\nhttps://logs.px4.io/plot_app?log=0f4fc7cb-b228-41bc-ab0e-8d576cbc34fd\n![bokeh_plot(13)](https://user-images.githubusercontent.com/14822839/54275120-1fa19f80-458a-11e9-814d-f416c7545a00.png)\n(Note that the position setpoint is generated as soon as the local position is again valid)\n\n@sanderux This is why the XY position was not controlled during the land phase of the DQ of the flight test team after the EKF position reset.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/11636",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/11636",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/11636.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/11636.patch",
    "merged_at": "2019-03-15T04:42:25Z"
  }
}
{
  "title": "High CPU load on Pixhawk 4 (fmu-v5)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11604",
  "body": "When flashing master I noticed very high CPU loads when arming the vehicle. Depending on my parameters, the CPU load can go between 85 and 100%. Also when disarmed the cpu load is way higher than usual.\n\nLog: https://review.px4.io/plot_app?log=6d8f3085-a624-4cbb-8974-5ae992ba51d7\n\nThis log is from my bench setup with no external SPI or I2C sensors.\n\n![ph4_cpu_issue](https://user-images.githubusercontent.com/35664507/54019920-c05c1d80-418c-11e9-81ab-d3f122544a9a.png)\n\nFYI @LorenzMeier @dagar @davids5 @bkueng",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Must reboot Pixhawk Between Missions",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11588",
  "body": "After we land and finish a mission, if we disarm then arm back up or simply don't disarm but re-run the mission, mission mode engages but not take-off occurs (no throttle spin up). Flaps go down (take-off flaps are enabled) but there is no motor-spin up. The only way to fix it is to reboot the plane from QGC.\n\nThis is occurring on master but likely not new since it has done this repeatedly (nothing but this) on master from a week or two ago as well.\n\nFMU_v2 with v3 firmware on fixed-wing.\n\nLogs:\nSuccessful flight:\nhttps://review.px4.io/plot_app?log=ba1a4634-1c12-4461-9938-097c743a3e6c\nLog right after taxing back:\nhttps://review.px4.io/plot_app?log=3cca3276-7b5a-4a50-8073-9a4fd1947557\nQuick Disarm then arm and then taxing to try and takeoff (which didnt work:\nhttps://review.px4.io/plot_app?log=575072f3-09a1-4c50-bbe9-3edcd923b9b6\nAfter the last log, a reboot of the plane from QGC and the next mission (same exact mission) flew fine.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pixhawk 4 and Pikhawk 4mini v5 not disarming.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11569",
  "body": "**Description**\nUAV is not disarming manually nor automatically, same issue when using Kill Switch.\nChanged to Stable firmware and disarm functions where working as expected.\n\n**Log Files**\nPixhawk 4mini v5 _Commmit:_ 0df34af1\nhttps://review.px4.io/plot_app?log=b69fc363-d90d-49d1-8cf4-ecb6122f3202&fbclid=IwAR2DQunVucBs96HvJiQ9KvGzdutroVqC33kkPLZk8crRz0QyFi97vb1qy2Q\n\nPikhawk 4 v5 _Commmit:_ 0df34af1\nhttps://review.px4.io/plot_app?log=e715787a-7f9f-45d4-9947-e5b0e1576773&fbclid=IwAR3dsmfYIADvrCuK_24NColLyb5a2E1UnXGX25eYMjg21_FRJSy3evWkG_4\n\n**Drone**\n- Multicopter.\n- DJI Flame Wheel F450.\n@dagar",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Attitude glitches in velocity control",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11551",
  "body": "**Describe the bug**\nAfter flying with tightly tuned multicopters in position control mode (basically a racer with a GPS), I realized some attitude twitches that I don't see in stabilized mode. I'm now able to see that those twitches are created by the velocity controller.\nIn the log below, you can see that the velocity setpoint and estimate is perfectly smooth and that the thrust/pitch/pitchrate setpoint have glitches. Pitch and pitchrate setpoint glitches are a consequence of the thrust glitch and the thrust setpoint should have the shape of the error between the velocity estimate and setpoint (for my tests, I removed the integral and derivative gains to simplify the problem).\n\nReproduction in SITL with fullrate logging of the relevant topics:\n![velocity_control_attitude_glitch](https://user-images.githubusercontent.com/14822839/53484259-b39c4300-3a83-11e9-8537-e9a26d048815.png)\n\n**To Reproduce**\n- jMAVSim test in position control mode (default smoothing or velocity smoothing).\n- log `vehicle_attitude_setpoint`, `vehicle_local_position` and `vehicle_local_positon_setpoint` at full speed\n- set `MPC_VEL_MANUAL` to a small value to be able to give constant full stick and stay far from any saturation (3 m\\s for example)\n- takeoff and fly full stick straight to the North\n\n**Expected behavior**\nA smoooooooth flight\n\n**Log Files and Screenshots**\nhttps://logs.px4.io/plot_app?log=a63b076d-b174-40d0-80f3-a57bc4f6a87b\n\n@bkueng @MaEtUgR @Stifael Can you also reproduce the issue?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC - Loops maneuvers when MPC_XY_CRUISE > MPC_XY_VEL_MAX",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11420",
  "body": "Reducing the MPC_XY_VEL_MAX to lower value then MPC_XY_CRUISE make the drone to fly in very strange way, it makes \"loops\" and fly backwards every few seconds.\n\nThis was tested on simulator only.\nhttps://logs.px4.io/plot_app?log=14e8cf1c-2fca-4cf8-ba0d-26ea8c5dd5d1\nTo reproduce:\nâ€¢ Run simulator, with default parameters\nâ€¢ takeoff and fly-to remote location\nâ€¢ everything normal\nâ€¢ set MPC_XY_VEL_MAX 2\nâ€¢ you will see that every ~10 second the drone fly back, do some strange loop\nâ€¢ set MPC_XY_ CRUISE 2\nâ€¢ the drone fly slow, but ok\n![image](https://user-images.githubusercontent.com/29940676/52518803-73525d80-2c59-11e9-96f4-b1143cfea0af.png)\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Issue with Master_vehicle crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11408",
  "body": "Today we tested Master v1.9.0 (beta) (7f3b1700) with the Pixracer, Pixhawk 4 mini, Pixhawk 4. Created mission. The vehicle armed good, took off. At 30 meters the vehicle started spinning and came down to the ground. Resulted in a crash. Same behavior for all 3 platforms. \n\nSteps to reproduce the behavior:\n\n1. Uploaded mission\n1. Drone switched on\n1. Vehicle armed\n1. Took off\n1. Elevated to 30 meters\n1. vehicle started spinning out of control\n1. The vehicle came down and crashed\n\nPixracer:\nhttps://review.px4.io/plot_app?log=4f0c2692-5f27-4d83-bfbd-765bf48a989e\n\nPixhawk 4 Mini:\nhttps://review.px4.io/plot_app?log=53fa724b-906d-4e93-87fe-5a4f4c2a50b8\n\nPixhawk 4:\nhttps://review.px4.io/plot_app?log=69f42b00-6259-4a97-96c1-bd8f06b4d29d\n\n@dagar\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW SITL intermittent failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11257",
  "body": "http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/3/pipeline\n\nExiting early?\n![image](https://user-images.githubusercontent.com/84712/51485124-4eaa4a80-1d6b-11e9-9c78-c4a1e7122eb9.png)\nhttps://logs.px4.io/plot_app?log=214c70d1-d6c9-4cf7-a655-5faab83328e1\n\n\n\nExamples\n 1. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/3/pipeline\n 2. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/5/pipeline\n 3. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/6/pipeline\n 4. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/PR-11234/9/pipeline\n 5. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/9/pipeline\n 6. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/PR-11274/2/pipeline/\n 7. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/PR-11277/2/pipeline\n 8. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/improve-slow-landing/3/pipeline\n 9. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/master_nuttx_7.28%2B/14/pipeline",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 receives input_rc and arms by itself with no RC attached",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11238",
  "body": "**Describe the bug**\nIntermittently, the aircraft, when powered on and sitting on the ground with no RC transmitter turned on, will print out that it lost RC control, arm itself, spin up the motors, then switch into LAND failsafe because  GPS hasn't locked yet. The problem seems somewhat intermittent, but we can go for stretches of hours where it will do it on every boot. \n\nLogs of the event show that it receives input_rc messages every 3-20 seconds, with  SOURCE=RC_INPUT_SOURCE_MAVLINK and 8 channels of 65535 values. When looking at the scaled manual control inputs in the log viewer, that gives an almost full yaw command and zero throttle, which may be the source of the arming.\n\n\nWe also have ensured that the RC_IN lines while not connected to an RC transmitter are not floating electrically. \n\n\n**To Reproduce**\nSteps to reproduce the behavior:\n1. Unplug RC receiver, and remove props!\n2. Power on aircraft \n3. Wait\n4. Sometimes it will arm and takeoff.\n\n(Note that in our case we have the CBRK_IO_SAFETY set so that is NOT necessary to press the safety switch before launch), otherwise the arm would be prevented.\n\n**Expected behavior**\nWe expect the aircraft to sit there and never arm\n\n**Log Files and Screenshots**\nBecause the system arms, it starts logging. here are some logs from the events. It is worth noting that the input_rc message in the logs show a few received values, even though there are no  RC receivers connected, and the source is listed as MAVLINK.\nhttps://logs.px4.io/plot_app?log=4abb3756-1202-4d7f-93df-7278dcec0897\nhttps://logs.px4.io/plot_app?log=d12666c6-faed-4645-bc04-0d5a94d05116\nhttps://logs.px4.io/plot_app?log=508c3766-012d-4a24-a538-80235388be71\nhttps://logs.px4.io/plot_app?log=2f046532-ae41-4327-b683-57cdfe3e1d70\nhttps://logs.px4.io/plot_app?log=7cd79b51-c6b8-4ee0-9b33-311ef4f6c0ae\n\n\n**Drone (please complete the following information):**\nOur  system is based on a custom adapter board with a Pixhawk 2.1 cube on it, a wifi module, and a long range radio. The adapter board has an MCU that can communicate with the cube. In order to rule out all external sources of mavlink traffic, we wiped the adapter MCU and disabled the wifi serial port and unplugged long range RF, and can still get it to happen. Our PX4 code fork is based on 1.7.3 release with a custom CAN driver for our ESCs.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Tiltrotor SITL interrmittant failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11213",
  "body": "Originally reported in https://github.com/PX4/Firmware/issues/11144\n\nNew failures -\n - http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/pr-2swhoop-params/3/pipeline\n\n> Different issue, tiltrotor arming failing due to accels. http://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/PR-11136/4/pipeline/81\n> \n> ![image](https://user-images.githubusercontent.com/84712/50703875-830bd000-1023-11e9-84c1-955c9948209f.png)\n> \n> What's going on with the vibration in the tiltrotor model?\n> \n> From the failure log - https://logs.px4.io/plot_app?log=33db160e-75a1-413c-9401-9bda6daa063b\n> ![image](https://user-images.githubusercontent.com/84712/50704053-09281680-1024-11e9-99fb-255e3a00c938.png)\n> \n> From a successful log - https://logs.px4.io/plot_app?log=a20570ad-bd94-446d-b910-f56e441610b5\n> ![image](https://user-images.githubusercontent.com/84712/50704081-1d6c1380-1024-11e9-8906-9a46c923ddeb.png)\n\n\n@RomanBapst any ideas?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "HITL jmavsim fail",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11203",
  "body": "**Describe the bug**\nI follow http://dev.px4.io/en/simulation/hitl.html\nbut meet error.\nIt can obviously get RC signal, I can easily see it arm and disarm in the qground. I can also see it\n'MSG: Landing detected'\nand\n'MSG: Takeoff detected',when I control my RC controller.\nbut virtual copter moves nothing in the Jmavsim simulator. Virtual copter keeps staying still.\n\n\n\nI tested it indoors, is it a problem about GPS thing? If is, why there is also no reponse in Z direction.\n\n\n\n**Expected behavior**\nVirtual copter moves as I control with RC Controller.\n\n**Log Files and Screenshots**\n*Always* provide a link to the flight log file:\n\nHere's the flight log.\n[test log 5](https://logs.px4.io/plot_app?log=1ec6070f-2028-4292-b4c1-61336bb4e2c6)\n[test log 4](https://logs.px4.io/plot_app?log=4cbc7ec5-7625-40ae-a3f2-b80e6640ea90)\n[test log 3](https://logs.px4.io/plot_app?log=2bf8dd8e-1deb-427d-972e-fa1bf658085b)\n[test log 2](https://logs.px4.io/plot_app?log=39d6a810-b31b-4735-9bf1-f9e712f2d945)\n[test log 1](https://logs.px4.io/plot_app?log=ad447bfa-4857-431a-b89f-f9fe4ca15065)\n\nscreenshots\n![2019-01-13 22-32-10](https://user-images.githubusercontent.com/44794635/51086905-1c0abb80-1787-11e9-9b15-d78ddeb3e0f8.png)\n\n\n**Additional context**\nThanks for your team's work",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Multicopter takes off in HOLD on ground",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11197",
  "body": "I found a regression while running the Dronecode SDK integration tests. Before arming, the SDK sets PX4 into HOLD mode. That way we make sure that a drone does not shoot up right after being armed but always sits on ground and just spins the motors in idle, so this is a safety precaution.\n\nHowever, after 5887a2393cefad7268d165e07352384be61e1404 the drone suddenly starts hovering right after arming even though it's in HOLD mode.\n\nThe SDK command to test this is:\n```\nmake && build/default/integration_tests/integration_tests_runner --gtest_filter=\"SitlTest.ActionHoverAsync\"\n```\n\nFYI: @Stifael \n\nhttps://logs.px4.io/plot_app?log=c387cdf8-120a-4aab-90ca-bcfb559a5ea5",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[ecl/EKF] EKF stopping navigation in every flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11071",
  "body": "Hello,\n\nI am constantly getting this error in my flights: \"[ecl/EKF] EKF stopping navigation\". I am using a PX4FLOW and a Lidar Lite v3 for range data and I am flying without GPS. I am using fmu-v3 (master) with a small alteration to make the Lidar boot before the PX4FLOW (https://github.com/PX4/Firmware/issues/11009).\n\nFrom the logs I see that my local position estimates vary wildly at the beginning until I get the error and, after that, the estimating stops (obviously). However, the condition_local_position_valid flag drops to zero even before EKF stops navigation and it never goes back to one. Here is an example of a short test I did this morning:\n\nhttps://review.px4.io/plot_app?log=95d3f262-f3ef-4dea-9398-91dcce53d245\n\nI was flying outdoors and neither take-off nor landing were exactly smooth. I thought it might be an issue with the PX4FLOW, but I have tried both indoors and outdoors flights on floors with different textures and the quality data I get seems to be good enough. Also, even though the acceleration power spectral density data is not ideal, I get much better values indoors and yet I still get the same error, so I doubt vibration is an issue.\n\nAny ideas?\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "survey control lost at turn point",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11041",
  "body": "Performing a survey, we saw a weird behaviour at the first turn point. Reaching the turning point, the copter started to tumble violently and loose height. Quickly toggling to altitude and then position to stop the mission didn't stop the behaviour. The machine crashed into the ground tumbling, stayed grounded for a few seconds, and took off again, now hovering stable in position mode.\n\nThe tumbling seems to start with a jump of the yaw setpoint. At mission start the machine had a successfully yaw into flight direction however.\n\nThe tuning and general reaction tested before the survey in position and altitude mode seemed very stable.\n\nAny hints on possible reasons are very appreciated!\n\nhttps://review.px4.io/plot_app?log=c7976cfc-d926-4596-ae1a-44c4e216800b",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Strange drift on velocity tracking",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10881",
  "body": "https://logs.px4.io/plot_app?log=06cbb7ce-198a-45ff-9e9f-557143f20b93\n\nHere is the log.\nAround 2:00, there is a significant divergence on velocity tracking, but until then, it is fine.\n\nP.S.\nhttps://logs.px4.io/plot_app?log=a14f4203-1ad1-4a58-a9ee-cfde69bf0d9a\nanother log too.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Too many false positive \"Preflight Fail: HIGH IMU ACCEL BIAS\" warning messages",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10833",
  "body": "**Problem:**\n\nWe are getting a lot of false positive \"Preflight Fail: HIGH IMU ACCEL BIAS\" warning messages preventing arming.  This seems to have started in master this past spring and continues in stable 1.8.0.  I believe a lot of other PX4 users are getting these false positive warnings as well.\n\n- (Note: in recent master the text of this warning as changed to \"Preflight Fail: High Accelerometer Bias\")\n\nThis happens to us frequently on known good aircraft that are great fliers and continue to fly great once the fault is cleared. \n\nWe recently noticed the error seems correlated to a vehicle sitting level on the ground for some period of time.  @priseborough made a helpful suggestion to try pitching and rolling the vehicle slowly so that the X and Y accels could spend some time facing down (gravity) and EKF2 could better estimate their bias.  This worked to clear the error!  Here is an example of the error which was then easily cleared by pitching and rolling the vehicle:\nhttps://review.px4.io/plot_app?log=278fa376-2a02-4027-b465-12507dbc9062\n\n**Possible solution:**\nIt has been suggested that using the bias state uncertainty as a factor in the bias level check could help eliminate false positives.  The bias level check in Commander could use the already existing additional information from EKF2 for this.\n\n\n**Further support:**\n\nAnecdotally I know of this exact ACCEL BIAS warning happening to handfuls of other PX4 users, many of whom do not post to Github or Discuss.\n\nThere are a large number of github issues and PX4Discuss posts about getting this error.  Probably there are many complicating factors involved with each report, but the fact that there are so many makes me believe there is a systemic issue with the check, or the checks and warnings need to be more specific.\nhttps://github.com/PX4/Firmware/issues/9241\nhttps://github.com/PX4/Firmware/issues/9474\nhttp://discuss.px4.io/t/preflight-fail/7023/10\nhttp://discuss.px4.io/t/ekf2-problem-z-velocity-estimate-weird-behaviour/8395\nhttp://discuss.px4.io/t/auto-land-ekf2-test-ratios-flight-controller-reset/8264",
  "state": "closed",
  "pull_request": null
}
{
  "title": "DANGEROUS: VEHICLE_CMD_DO_REPOSITION broken on master",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10757",
  "body": "Had a Drone fly into a pole and smash into the ground when issuing a VEHICLE_CMD_DO_REPOSITION. I looked at the log and everything looked fine. This is broken on current `master` 294af5daada2fa08da8d9f1c4310779683fe9750\nhttps://review.px4.io/plot_app?log=cc6bccfc-44a5-4eca-bc2f-7a4be13a0a7a\n![selection_019](https://user-images.githubusercontent.com/37091262/47468014-45ceca80-d7b6-11e8-8a72-808d278e3b66.png)\n\nAs you can see we were just adjusting the altitude setpoint and nothing else.\n\nI then tested this in SITL using `make posix_sitl_default gazebo` and issued via QGroundControl a **`goto`** command and saw the vehicle fly to the new location, but then fly super far an a random direction for a while, then returns back to that location, wanders around a bit more, flys off in the opposite direction... then I got bored of watching.\n![selection_020](https://user-images.githubusercontent.com/37091262/47468301-c8a45500-d7b7-11e8-8acc-f1d56e639669.png)\n\nIsn't CI supposed to catch these types of bugs? This is extremely concerning to me.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Restore LNDMC_THR_RANGE for faster disarm on land",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10712",
  "body": "As of https://github.com/PX4/Firmware/commits/master/src/modules/land_detector the land detector cannot be configured to transition from `ground_contact` to `maybe_landed` via the now deprecated parameter LNDMC_THR_RANGE. \n\nIt now takes a considerable amount of time to disarm due to throttle down time.\nhttps://review.px4.io/plot_app?log=43987a80-5752-4f55-89a7-eec60e9298c3\n![selection_011](https://user-images.githubusercontent.com/37091262/47110927-65428200-d20f-11e8-8e41-0ab7008884d7.png)\n![selection_013](https://user-images.githubusercontent.com/37091262/47110989-8a36f500-d20f-11e8-86b4-ef158f78e931.png)\n\nIf there is a better way to do this lets discuss it, otherwise I think the parameter should be restored.\n\n**Note:** current implementation sets a hard coded limit\n```\n// 10% of throttle range between min and hover once we entered ground contact\nfloat sys_min_throttle = _params.minThrottle + (_params.hoverThrottle - _params.minThrottle) * 0.1f;\n```",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Position setpoint drift during takeoff",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10679",
  "body": "A strange update in the local position setpoint seems to occur during takeoff on a fairly recent branch (few weeks old):\n\nhttps://review.px4.io/plot_app?log=1d33a68b-c88b-420c-8e8f-4a4382675963\n\nDuring a mission, The vehicle takes off 4 meters in the air then suddenly changes position. as seen on local position setpoint X/Y. it does resume its takeoff to final altitude.\n\nThe position it moved to seems like it is the location where the first home lock occurred. \n\n![image](https://user-images.githubusercontent.com/14801663/46794991-52c8d400-cd49-11e8-8a9f-fe8fda09f7b9.png)\n\n\n@dagar @RomanBapst @bresch",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FlightTask: implement MPC_LAND_ALT1/2",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10659",
  "body": "MPC_LAND_ALT1 and MPC_LAND_ALT2 should be used for a final approach speed during landing.\nAccording to the param spec the vehicle should descend at MPC_Z_VEL_MAX_DN speed and slow down between MPC_LAND_ALT1 and MPC_LAND_ALT2 to MPC_LAND_SPEED.\n\nThere is a massive energy consumption benefit in having this\n\nCurrently this is not implemented in the FlightTask: https://github.com/PX4/Firmware/blob/bee6a6b8b08d30b36475628e0750edcb6038d798/src/lib/FlightTasks/tasks/AutoMapper/FlightTaskAutoMapper.cpp#L117\n\nThe params are used for takeoff which does not seem to be documented behavior: https://github.com/PX4/Firmware/blob/bee6a6b8b08d30b36475628e0750edcb6038d798/src/lib/FlightTasks/tasks/AutoMapper/FlightTaskAutoMapper.cpp#L128\n\nPerhaps implementing it as indicated currently is not a good idea, the altitudes default to 10 and 5m above home and we might be flying over a different altitude.\n\nThere are a few options on how this can be implemented safely;\n1. Within a small radius around home / for RTL only\n2. Only when a range finder is installed\n3. If QGC has given the terrain altitude\n4. When enabled by a param\n5. When enabled in the waypoint (explicitly chosen in QGC)\n\nIf there are any other ideas on how to do this please share.\n\nLog demonstrating the behavior: https://review.px4.io/plot_app?log=642eae62-6203-4ab3-b372-ef0b58f01e4c\nMPC_LAND_SPEED was 0.7\nMPC_Z_VEL_MAX_DN was 2.5\n\n/cc @dagar @bresch @LorenzMeier",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Skywalker X8 VTOL unable to recover from gust",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10639",
  "body": "After attempting to climb to 30 m in mission mode a moment is applied due to a gust. This causes the DeltaQuad to bank excessively sending it into a pitch down dive. We attempted to take over manual control but we didn't have enough altitude to recover. \n\nWe flashed our flight controller (Dropix V2.1) with the Master branch (Updated 24th September). We then tested our DeltaQuad in manual mode quickly to ensure everything was working correctly and we set up a simple mission (with a few way-points then a land only in QC mode). It began climbing normally until 24 m when a gust caused the drone to enter a roll. The drone wasn't able to recover from this and caused an adverse roll followed by a nose down attitude until contact with the ground.\n\nLink to the log file: https://review.px4.io/plot_app?log=992ecb6b-8410-4bd6-91e2-e82a7fa5e826\n\nOur drone is a Skywalker X8 with VTOL modules.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "pixhawk 2.1 voltage issues.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10620",
  "body": "@dagar @Tony3dr \n I had problems with pixhawk 2.1 voltage reading,  I have calibrated the voltage several times  and even with the full battery, activate the fail safe immediately. \nI already tested with another voltage sensor and reset the parameters and it's still the same.\n\nhttps://review.px4.io/plot_app?log=8c1f6603-3183-4bf6-87fd-6d527988a276\nhttps://review.px4.io/plot_app?log=23ce4f5f-e26c-4a00-96e7-5e7cf5c8138c",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW altitude control overshoot",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10495",
  "body": "FW altitude change, there is overshoot control\n![image](https://user-images.githubusercontent.com/5361334/45616312-9f4e2600-baa1-11e8-905a-d2a777287d56.png)\n\n\nLooking at the pitch control, that is good for setpoint\n![image](https://user-images.githubusercontent.com/5361334/45616361-cad11080-baa1-11e8-9a06-07bacbc0ccd5.png)\n\nthe log attach is \n[Flight Review](https://logs.px4.io/plot_app?log=ba6fc1bf-ef2a-4bd0-b357-7db23e39c1f4)\n\nand also discuss in\n [DroneCode Discussion](http://discuss.px4.io/t/fw-overshoot-when-changing-altitude/2382)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Navigator: Land/RTL quad flys towards home lat/lot/alt",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10412",
  "body": "**Describe the bug**\nAuto modes `land` and `rtl` cause quad to fly directly towards home lat/lon/alt. This is the third time I've seen this in two weeks. I've seen it ~10 times since the introduction of FlightTasks. We are flying ~7 hours a week, so this is a very rare edge case bug. Logging either dies completely or drops out when this happens. I finally have a partial log (2 minute long dropout) of a flight where this happened. \n\n**To Reproduce**\n1. Takeoff using mode `takeoff`\n2. Fly around in position mode\n3. Issue `land` or `rtl`\n4. This behavior will persist through a land/disarm/arm/takeoff\n\n**Log Files and Screenshots**\nhttps://review.px4.io/plot_app?log=7955d3de-31c9-4434-b30d-cb31fadefb32\n\n**Additional context**\nI am pretty sure `takeoff` is causing the bug. I am fairly certain `navigator` gets stuck in a loop somewhere, this would explain the logger dropouts due to thread starvation (navigator priority is higher than logger). I am guessing all `auto` modes will cause this, we only use `land` and `rtl`, but both of those modes do the same thing, fly right towards home.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[Intel Aero]: Arms but non responsive attitude",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10406",
  "body": "booted, waited for about 2 minutes, successfully armed and motors spun up to idle but copter non responsive to throttle input\n\nhttps://logs.px4.io/plot_app?log=12385dd2-7b2a-4cff-a7b7-711d50a7a270\nhttps://logs.px4.io/plot_app?log=332bc3b6-2bae-4503-95b2-b4dadda12d42\n\nseeing errors in log [mc_pos_control] Stabilized-Ctrl failed with error: Activation Failed",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Switching to HOLD mode using LPE or EKF performs different response",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10391",
  "body": "When EKF is used as a position estimator with activating both vision position and GPS bitmask, it is possible to switch HOLD mode but in LPE i cannot switch to HOLD mode with GPS and vision position fusion, the fcu rejects auto hold. LPE allows to switch to HOLD mode when only GPS bitmask activated. I cannot combine GPS and vision position in LPE while EKF has this feature. Is this desired feature or just a bug? In both cases, mavros fake_gps module was used and vision position data transferred as fake_gps at the same time.\n\n**Firmware version:** 1.8.0\n\n**Log samples:**\nLPE(vision+gps) reject auto hold: https://logs.px4.io/plot_app?log=5fc00993-5f27-4d65-a009-f6f09ca3bf6e\nEKF2(vision+gps) switches to hold mode: https://logs.px4.io/plot_app?log=a37b9199-a058-4642-8133-73f1c2a37004",
  "state": "closed",
  "pull_request": null
}
{
  "title": "**BUG** Timed Loiter running indefinitely",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10376",
  "body": "PX4 1.8.0 - QGC 3.3.2 Android\n\nA timed (30 sec.) loiter was planned just before the landing pattern. The loiter was entered and continued for 4 minutes before I had to manually select the next waypoint to go to.\n\nI created an issue in QGC and was directed to open an issue in firmware.\n\nhttps://logs.px4.io/plot_app?log=3ceb70c2-c26b-4c48-818c-0c1c7d31044",
  "state": "closed",
  "pull_request": null
}
{
  "title": "SITL test intermittent failures",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10352",
  "body": "The SITL mission tests are periodically failing due to anomalies detected by the ecl analysis script. FW is the most frequent, but VTOL is also failing.\n\nhttps://logs.px4.io/plot_app?log=88a0abf0-78bf-430b-8867-5821e8595f76\n![image](https://user-images.githubusercontent.com/84712/44729947-de461880-aaad-11e8-9379-4735065ee985.png)\n\nhttp://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests/detail/pr-vehicle_trajectory_waypoint-limit/6/pipeline\n\nDo we need to relax the script or is this something that should be adjusted in the gazebo models?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[Logger]: Log size doubled",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10345",
  "body": "a few weeks ago, the log size doubled on the same flights.\n\ntwo 5 minute flight running commit 7c76028 weighing in at 10.9 MB:\nhttps://logs.px4.io/plot_app?log=b0973caa-e51d-4612-8c70-3c13576cd8a8\nhttps://logs.px4.io/plot_app?log=7bdf4aa5-f309-4afa-af1e-31578b82a3a7\n\nsame two flights running commit 9a23295 weighing in at 22 MB:\nhttps://logs.px4.io/plot_app?log=0be6630a-0e50-4a23-ad50-561110cdee8a\nhttps://logs.px4.io/plot_app?log=632011ec-1d3b-4eba-82b8-fe6fe85b6fa7\n\ntoday's master bbc0c28 for reference also weighing in at 22 MB:\nhttps://logs.px4.io/plot_app?log=5af821ab-b9af-4514-9b98-804fdde019a8\nhttps://logs.px4.io/plot_app?log=afa1ca96-1f58-4cfc-9435-2e33be98dc0d\n\n@dagar thoughts?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "fix loiter yaw error for multirotor(#10262)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/10297",
  "body": "**Test data / coverage**\nbefore fix\nhttps://logs.px4.io/plot_app?log=58f3d121-cc66-4b11-9436-3ec3136b23c3\nafter fix\nhttps://logs.px4.io/plot_app?log=8a210ac9-fd87-4f63-8421-03a710e24153\n\nfixes #10262",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/10297",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/10297",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/10297.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/10297.patch",
    "merged_at": null
  }
}
{
  "title": "Random yawing when RC loss",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10296",
  "body": "**Describe the bug**\nThe vehicle loses RC connection and yaws to `home` heading. (We have loiter as our RC loss behavior: NAV_RCL_ACT = 1)\n![selection_001](https://user-images.githubusercontent.com/37091262/44433460-92eab200-a563-11e8-80e5-8b9efc0f3e8f.png)\n\n\n\n**To Reproduce**\nCurrent `master` just cause an RC loss. \n\n**Expected behavior**\nKeep the current heading.\n\n**Log Files and Screenshots**\nhttps://review.px4.io/plot_app?log=d9f20475-0558-45f8-9fc9-56d7389f173c\n\n**Additional context**\nWe are hitting a failsafe which we should not be hitting. `FlightTasks::update()` is failing at line `607` in `mc_pos_control_main.cpp`. This triggers `failsafe()`. Note the vehicle does not actually descend....\n\n![selection_002](https://user-images.githubusercontent.com/37091262/44433521-e6f59680-a563-11e8-8ea0-95868c0d5849.png)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Navigator: RC loss yaw mission item",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/10291",
  "body": "Added yaw mission item to `rcloss` state in `navigator`. This fixes the issue mentioned #10262 where the vehicle yaws in a seemingly random direction when RC is lost.\n\n**Test data / coverage**\nCurrent behavior:\n![selection_001](https://user-images.githubusercontent.com/37091262/44412682-c3f8c180-a526-11e8-9941-05af1f521a36.png)\nProposed behavior with this PR:\n![selection_002](https://user-images.githubusercontent.com/37091262/44414401-ed1b5100-a52a-11e8-837a-d81ea6349acb.png)\nhttps://review.px4.io/plot_app?log=2e96b2de-f511-49c0-a51a-a34ba7cabc13",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/10291",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/10291",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/10291.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/10291.patch",
    "merged_at": "2018-08-21T19:05:56Z"
  }
}
{
  "title": "FlightTasks Auto activation failed",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10282",
  "body": "I've noticed this in a couple logs. Any ideas what's going on?\n\nhttps://logs.px4.io/plot_app?log=f15dc101-491f-47fc-a547-5427060bb1a7\nhttps://logs.px4.io/plot_app?log=573371f3-4d7a-4a2a-b4d2-c7fd0d9aad73\n\n![image](https://user-images.githubusercontent.com/84712/44375367-58c8d400-a4c1-11e8-979a-146643427f5e.png)\n\nWhy is it only a warning?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[Global position] unable to obtain lock despite good sat count",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10258",
  "body": "Running current master 57052ed and it took several attempts and almost 3 minutes to obtain global position, successful flights:\nhttps://logs.px4.io/plot_app?log=641838bc-50ff-4654-997f-24cba2347631\nhttps://logs.px4.io/plot_app?log=a3837f58-7045-4539-9270-2f9b1d7a525c\n\nTurned on logging from boot and after 3+ minutes, was unable to obtain global position:\nhttps://logs.px4.io/plot_app?log=ca259319-8446-4dbf-abc0-d55f073387bf\n\nReverted to yesterday's master 36403e9 and could obtain lock under 30 seconds as normal:\nhttps://logs.px4.io/plot_app?log=79330666-0f92-4cbb-917d-4dc13f66a20f\nhttps://logs.px4.io/plot_app?log=872eb963-c9ef-40a6-8d44-dc53d8941704\n\n@dagar @priseborough thoughts?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Yaw setpoint jumps sharply",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10230",
  "body": "I am having an issue with a very heavy prototype VTOL that I'm building and I am seeing an issue that I am not sure where this behavior could be coming from. As I am hovering, sometimes the bird yaws hard and loses altitude. I think the fact I lose altitude indicates to me that we don't have enough thrust to push through the decent caused by spooling down half of the motors in the yaw.\n\nWhile I have been digging through the logs, I noticed a point where the yaw setpoint jump sharply at 7:36. I also noticed a baro EKF error and would that case an EKF reset on the mags which could cause a sharp heading change?\n\nI feel like this might just be a poor calibration and tune but I thought I would ping you to see if you have any great ideas.\n\nhttps://review.px4.io/plot_app?log=ca81fd27-ac49-4d8f-aac2-da9e1532396d",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Flight Tasks Issues",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10223",
  "body": "**Description**\n1) When releasing the x/y stick in position control mode the drone decelerates as it should but there is always a twitch in attitude. You can see in the log that for some reason the velocity setpoint pulls towards the current velocity.\n![flight_task_issue](https://user-images.githubusercontent.com/7610489/44019998-c1dbb0a2-9ee0-11e8-9814-5fde82b233b6.png)\n\n2) For some reason it seemed like our parameter changes did not take effect. We e.g. changed the parameter MPC_XY_VEL_MAX from 2 to 8 but the drone would not move faster than 2 m/s.\nThe parameter changes were logged so it was not a communication issue. \n\nWe were on this commit from master:\n30fb82d9b4157b74c741ec7e1e16d7408e5dfa3f\n\nLog file:\nhttps://logs.px4.io/plot_app?log=798b9ed5-d68c-4c22-99a8-3b3540386f50\n\n@Stifael @MaEtUgR Do you have an idea what went wrong? I tested flight tasks a week before on a different vehicle and I had no such issues.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "no pwm output in rover mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10221",
  "body": "**Describe the bug**\nI am using px4 in rover mode with 1/10 scale RC cars. After successfully arming and no errors reported in QGroundControl, there is no pwm output in any port.\n\n- hardware: pixfalcon\n- Firmware: v1.7.3 and v1.8.0 (tested both and neither works)\n- Airframe: Traxxas Stampede vxd 2wd\n- Mode: Manual or Stabilized \n\nI also tested Firmware v1.6.5 and everything works fine. The reason I preferred newer version is that I wanted to use pixhawk with mocap system and use EKF2 estimator. \n\nlog file:\nhttps://logs.px4.io/plot_app?log=5e97ce09-9c4b-4817-8d5a-38c24bacf376",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MPC_YAW_MODE stuck/not responding to changes in value",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10176",
  "body": "Flew a few flights on a Pixracer (v4) running master d3f5c06b\nparameter MPC_YAW_MODE seems to be stuck in mode 3 where the heading points towards the trajectory\n\nFirst couple flights with the value set to 3 intentionally:\nhttps://logs.px4.io/plot_app?log=32f554d3-c66e-4604-a731-63a4e9e721ff\nhttps://logs.px4.io/plot_app?log=94bc44cd-673c-4c71-bb89-05b50047397d\n\nChanged MPC_YAW_MODE to 0 and observed the same heading:\nhttps://logs.px4.io/plot_app?log=36bb7811-e852-4c0c-9462-fe18aed4e0b1\nhttps://logs.px4.io/plot_app?log=0c8d6dd0-5f19-4c83-b14e-54e57431943b\n\nChanged MPC_YAW_MODE to 1 and observed the same heading:\nhttps://logs.px4.io/plot_app?log=df2c014f-e2c2-4a61-83c3-dcd9c1add6e2\nhttps://logs.px4.io/plot_app?log=f8f03d5c-9c48-49bf-8cef-bc2ac480c478\n\n@Stifael thoughts? Changing the value seemed to work fine in #10003 not sure why it's not working on master after merge",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fly Wing can not entry into mission mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10057",
  "body": "Fly Wing can not entry into mission mode.\n\nhere is the log:  https://logs.px4.io/plot_app?log=3ede1a11-2da2-4d10-a582-3ef78658769e\n\n@priseborough could you take a look at these logs?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Yaw during takeoff during first flight after reboot",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10033",
  "body": "Every time I take off for the first time after a reboot I get some strange yaw behaviour. As soon as the vehicle takes off I get a very fast yaw (more than 90 degrees). If I land and do a second flight it doesn't happen anymore (probably some initialization issue).\n\nFrame: S500\nAutopilot: Pixhawk 4 Mini (fmu-v5)\nPX4 version: Today's Master (100f9553cef2203c818ab98e13d39406c6fc3c8c)\n\nPosition Mode:\nLog: https://review.px4.io/plot_app?log=fe704b1d-0e77-4bc4-9c9f-35aa2da2732c\nVideo: https://youtu.be/A_9ktAQalvs \n\n*Log and video are from the same flight\n*Log is 'from boot to disarm'",
  "state": "closed",
  "pull_request": null
}
{
  "title": "review tailsitter CI mission failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10032",
  "body": "https://logs.px4.io/plot_app?log=d00d50a1-f448-4c94-8966-1e6bbd136812\n\nhttp://ci.px4.io:8080/blue/organizations/jenkins/Firmware/detail/pr-update_src%2Fmodules%2Fuavcan%2Flibuavcan/29/pipeline\n\n![image](https://user-images.githubusercontent.com/84712/43202139-93899392-8fe8-11e8-9b25-84eaa8927000.png)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "pixhack v5 RC is not detected on master ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9989",
  "body": "On the pr and master, the copter does not detect the radio, only on stable works well\nfirst, send to manual mode and later to hold mode\n\n\nhttps://review.px4.io/plot_app?log=bf71d883-0596-4723-95cc-ed70f2412ce6\n\n**Drone \nf450, pixhack, 20ams hobbywing esc and iris motors \n\non the firmware master 3293fe still work good @dagar",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Intel Aero: mission upload broken on master",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9984",
  "body": "Flashed master ade70cb and the mission that was previously stored seemed to be deleted.\nAttempted to upload mission and got error: (MAV_MISSION_ERROR) & Unable to write on micro SD\n![capture](https://user-images.githubusercontent.com/13203106/42965006-946d4abe-8b4d-11e8-9509-6f8419e8183b.JPG)\n![capture1](https://user-images.githubusercontent.com/13203106/42965010-9679f442-8b4d-11e8-948b-6451b4c96fdc.JPG)\n\nLog of failed to engage Auto and failed to upload new mission:\nhttps://logs.px4.io/plot_app?log=e93d393e-eb44-48f8-a457-2be20e8b2e96",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Aerotenna OcPoc failing to engage Auto in master",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9977",
  "body": "running master 3293fe4\nsuccessful flight with auto take-off and rtl as part of mission:\nhttps://logs.px4.io/plot_app?log=593203b8-e65b-4a5a-9a9a-9cbd65ac5127\n\nafter landing, armed again but Auto would not engage\ntook off manually and still, Auto was not responsive:\nhttps://logs.px4.io/plot_app?log=9fb47e82-36d9-4600-a868-c09b1df59bb0\n\nswapped batteries and Auto still not responsing:\nhttps://logs.px4.io/plot_app?log=0b6bd97b-721f-4acf-aacd-d7147bf9c73a",
  "state": "closed",
  "pull_request": null
}
{
  "title": "NXPhlite issues.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9973",
  "body": "@davids5  Has issues maintaining altitude  in position, altitude and Auto. The accuracy of the GPS is very poor. in POS it maintain the position  but in mission it doesn't.\n\ncommit 5b0ad4e1.\nhttps://review.px4.io/plot_app?log=ff6f685c-eb1a-412a-93e3-80354cbf602c\nhttps://review.px4.io/plot_app?log=a5824a2a-e8ff-4f00-b7c4-b1018c694652\nhttps://review.px4.io/plot_app?log=1c2da437-5699-4ddc-bf01-1d5ab0814187\nhttps://review.px4.io/plot_app?log=aa719c97-71c4-4d05-aea6-ef6f8a36ce01\nhttps://review.px4.io/plot_app?log=ff6f685c-eb1a-412a-93e3-80354cbf602c\nhttps://review.px4.io/plot_app?log=b0db2ecc-a6c9-42a1-8a49-f8afea1ffa2e\n\ncommit 9e4e19d4.\nhttps://review.px4.io/plot_app?log=910de492-f7b7-4fe4-8983-837c3f130218\nhttps://review.px4.io/plot_app?log=42c37087-c863-4423-9f11-c8bb517da99f",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: ATTENTION!!! DANGER",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9965",
  "body": "PUSHER MOTOR STARTS DURING AIRSPEED CALIBRATION\non the bench.\n\nThe plane quad delta wing, the tubes from the pitot were swapped.\n\nWe recreated it two times\n\nThe second time by any chance we had logging enabled all the time so we have it on log.\n\nhttps://logs.px4.io/plot_app?log=de51dc5e-e868-426f-90c3-1fcc42855fe1\n\nIt happened after we blew in the pitot at the end of the calibration. The calibration went wrong (because of the reversed tubes). Both times the motor started.\n\nAfter we corrected the tubes never happened again.\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Intel Aero altitude drops",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9939",
  "body": "Received new Intel Aero RTF and have issues maintaining altitude in ALT, POS and Auto running current master\n\nDefault parameters:\nmanual flight:\nhttps://logs.px4.io/plot_app?log=bdb2de01-a8af-484c-9399-eb8e486e8e7d\nauto take-off and rtl:\nhttps://logs.px4.io/plot_app?log=39b0cf9c-1131-4b01-a8ea-e8faa23944b8\n\nIncreased EKF2_ACC_NOISE, EKF2_BARO_NOISE and EKF2_GYR_NOISE to double the default values respectively; minor improvement on the altitude drops but still seeing dips and corrections between most waypoints:\nhttps://logs.px4.io/plot_app?log=bbc94f3a-331d-4554-9321-569a69f8d5ee\nhttps://logs.px4.io/plot_app?log=30c1cae6-8180-4c20-b442-fe7dd305d25f",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 Replay not working from SITL logfile",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9927",
  "body": "**Describe the bug**\nWhen running replay on a logfile from sitl (```make posix_sitl_default gazebo_standard_vtol```) the generated logfile only contains the topics:\n\n```\nulog_info build/posix_sitl_default_replay/tmp/rootfs/fs/microsd/log/2018-07-16/15_19_56_replayed.ulg\nLogging start time: 0:00:00, duration: 0:03:14\nNo Dropouts\nInfo Messages:\nreplay: /home/carl/src/standard_PX4/Firmware/build/posix_sitl_default/tmp/rootfs/fs/microsd/log/2018-07-16/15_15_45.ulg\nsys_name: PX4\nsys_os_name: Linux\nsys_os_ver_release: 67371263\nsys_toolchain: GNU GCC\nsys_toolchain_ver: 6.4.0 20180424\ntime_ref_utc: 0\nver_hw: SITL\nver_sw: e2eb84042e5d15b8212b0c0ccb9045c123c39284\nver_sw_branch: master\nver_sw_release: 17301504\nInfo Multiple Messages: [perf_counter_preflight: 1]\nName (multi id, message size in bytes) number of data points, total bytes\nairspeed (0, 24) 17836 428064\nekf2_timestamps (0, 24) 43584 1046016\nsensor_combined (0, 44) 43941 1933404\nvehicle_attitude (0, 53) 43946 2329138\nvehicle_gps_position (0, 95) 696 66120\nvehicle_land_detected (0, 16) 162 2592\nvehicle_status (0, 39) 165 6435\n```\n\nI.e. the topics estimator_status and ekf2_innovations are missing etc. The log file also contains the messages:\n\n```\nulog_messages build/posix_sitl_default_replay/tmp/rootfs/fs/microsd/log/2018-07-16/15_19_56_replayed.ulg\n0:00:00 WARNING: [logger] logger: failed to add topic. Too many subscriptions\n0:00:00 WARNING: [logger] logger: failed to add topic. Too many subscriptions\n```\n\nIf a couple of topics are commented out in logger.cpp it seems to work better, i.e. all topics are there:\n\n```\nLogging start time: 0:00:00, duration: 0:01:25\nNo Dropouts\nInfo Messages:\nreplay: /home/carl/src/standard_PX4/Firmware/build/posix_sitl_default/tmp/rootfs/fs/microsd/log/2018-07-16/15_34_12.ulg\nsys_name: PX4\nsys_os_name: Linux\nsys_os_ver_release: 67371263\nsys_toolchain: GNU GCC\nsys_toolchain_ver: 6.4.0 20180424\ntime_ref_utc: 0\nver_hw: SITL\nver_sw: e2eb84042e5d15b8212b0c0ccb9045c123c39284\nver_sw_branch: master\nver_sw_release: 17301504\nInfo Multiple Messages: [perf_counter_preflight: 1]\n\nName (multi id, message size in bytes) number of data points, total bytes\nairspeed (0, 24) 7849 188376\nekf2_innovations (0, 164) 6519 1069116\nekf2_timestamps (0, 24) 10646 255504\nestimator_status (0, 272) 6518 1772896\nsensor_combined (0, 44) 19381 852764\nvehicle_air_data (0, 24) 8067 193608\nvehicle_attitude (0, 53) 19385 1027405\nvehicle_global_position (0, 64) 6265 400960\nvehicle_gps_position (0, 95) 373 35435\nvehicle_land_detected (0, 16) 60 960\nvehicle_local_position (0, 155) 6500 1007500\nvehicle_magnetometer (0, 20) 8075 161500\nvehicle_status (0, 39) 94 3666\n```\n\nHowever, the output of the estimator that is logged in the replayed file does not match the one in the original file\n\n[Original logile](https://logs.px4.io/plot_app?log=da4a2a16-ec6f-49b3-b09c-8018b791911d) | [Replayed logfile](https://logs.px4.io/plot_app?log=1344016f-79ea-421a-8cb4-cfd8194c4300)\n:-------------------------:|:-------------------------:\n![image](https://user-images.githubusercontent.com/7795133/42768355-9459dd10-891f-11e8-8884-4025661a775a.png)| ![image](https://user-images.githubusercontent.com/7795133/42768359-96a68dac-891f-11e8-9fa0-7dd3323d7ce7.png)\n\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Stale mag data not detected",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9901",
  "body": "We just had a series of flights with marginally stable position control performance (toilet bowling). Analysis of the logs showed that the mag measurements (external HMC5983, internal mags disabled) are not changing one bit. This was only fixed by power cycling the vehicle, rebooting the FC did not change anything.\n\nThere are two problems with this incident:\n1) The mag malfunctioned. Has anybody seen something like this before?\n2) More importantly: Why was this not detected by the flight controller? Should this data not be marked stale / timed out and arming in position controlled modes/switching to these modes refused?\n\nIn addition to the mag measurements being constant, EKF2's heading innovations (configured to heading only fusion) are constant, i.e. no mag measurements are fused. This makes sense considering that the mag measurements are old (`sensor_combined_0.magnetometer_timestamp_relative + sensor_combined_0.timestamp` is constant). But the heading / position estimate is not marked invalid by EKF2.\n\nOur firmware is based on 1.7.4.\n\nHere is a log file: https://logs.px4.io/plot_app?log=8f1505e6-f998-47e4-9693-58c3c0424774\n\nAny help would be appreciated!",
  "state": "closed",
  "pull_request": null
}
{
  "title": "NaN rate setpoints when switching from acro to manual",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9866",
  "body": "The log https://logs.px4.io/plot_app?log=89ab485c-7768-4fca-b7e9-5ed9d09152b3 contains NaN setpoints when switching from acro to manual. Seems to be a race condition when the position controller did not yet publish a valid attitude setpoint but the attitude controller already got the mode switch.\n\nHowever the position controller does publish an invalid setpoint with constant timestamp before that, as seen in the CSV file:\n```\ntimestamp,roll_body,pitch_body,yaw_body,yaw_sp_move_rate,q_d[0],q_d[1],q_d[2],q_d[3],thrust,landing_gear,q_d_valid,roll_reset_integral,pitch_reset_integral,yaw_reset_integral,fw_control_yaw,disable_mc_yaw_control,apply_flaps\n[...]\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n10039547,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-1.0,0,0,0,0,0,0,0\n234508568,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.118343,-1.0,1,0,0,0,0,0,0\n234529628,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.118343,-1.0,1,0,0,0,0,0,0\n234550563,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.118343,-1.0,1,0,0,0,0,0,0\n234571562,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.120316,-1.0,1,0,0,0,0,0,0\n234592561,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.123274,-1.0,1,0,0,0,0,0,0\n234613560,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.12426,-1.0,1,0,0,0,0,0,0\n234634566,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.12426,-1.0,1,0,0,0,0,0,0\n234655562,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.126233,-1.0,1,0,0,0,0,0,0\n234676562,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.12426,-1.0,1,0,0,0,0,0,0\n234697562,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.125247,-1.0,1,0,0,0,0,0,0\n234718560,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.12426,-1.0,1,0,0,0,0,0,0\n234739571,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.125247,-1.0,1,0,0,0,0,0,0\n234760563,0.0,-0.0,1.90531,0.0,0.579523,0.0,0.0,0.814956,0.126233,-1.0,1,0,0,0,0,0,0\n234781563,0.0,0.167662,1.90531,0.0,0.577487,-0.0682384,0.0485249,0.812094,0.127219,-1.0,1,0,0,0,0,0,0\n234802565,0.0,0.206141,1.90531,0.0,0.576447,-0.0838494,0.059626,0.810631,0.127219,-1.0,1,0,0,0,0,0,0\n234823563,0.0,0.241872,1.90531,0.0,0.57529,-0.0983176,0.0699145,0.809004,0.127219,-1.0,1,0,0,0,0,0,0\n```\n\n[log001_vehicle_attitude_setpoint_0.zip](https://github.com/PX4/Firmware/files/2175558/log001_vehicle_attitude_setpoint_0.zip)\n\n@MaEtUgR @Stifael can you look into this please?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Navigator: Fix fixed-wing first order altitude hold",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/9850",
  "body": "**Issue**\r\nNavigator's fixed-wing first-order altitude hold (FOH) is currently causing altitude reference oscillations when in any LOITER mode. See screenshot below. Not only altitude, but also pitch and throttle can thus oscillate significantly. We observed this during a recent test flight.\r\n\r\n![image](https://user-images.githubusercontent.com/2565608/42387985-53c6343e-8144-11e8-86d2-a42aecc4c5c0.png)\r\n\r\n\r\nLog file from SITL where this can be seen: https://review.px4.io/plot_app?log=f18c45ab-622e-4b1d-9819-03cfb06af2b5 . Here, after t=3:20 the true altitude setpoint is still the same as before t=2:20 (i.e. 630m AMSL) but the FOH logic just wrongly sets it to 660m and adds slight oscillations on top. The exact amount of oscillations depends on waypoint distance, altitude difference etc, but i have seen altitude ref oscillations of up to 30m, resulting in full pitch up/down of the aircraft.\r\n\r\n**Analysis**\r\nSee the commit for the location of the code where this is happening. Essentially, every time that the loiter radius of any loiter WP is larger than the acceptance radius calculated from the L1 turn distance, then the Navigator FOH would _not_ consider the waypoint reached and would thus not stop modifying the current altitude setpoint. This leads to the oscillations or offsets in the altitude reference. \r\n\r\n**Solution**\r\nIf in any loiter mode, consider the loiter radius times a factor of 1.2 (same as for the waypoint_reached logic [here](https://github.com/PX4/Firmware/blob/master/src/modules/navigator/mission_block.cpp#L217) as the acceptance radius. Tested in SITL, which should be sufficient for this case.\r\n\r\n@acfloria @ryanjAA @antiheavy FYI\r\n@dagar Made this PR as a quick hotfix independently of your PR at https://github.com/PX4/Firmware/pull/8883/files which supposedly also fixes this but is much larger and where it is more uncertain when this would be merged.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/9850",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/9850",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/9850.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/9850.patch",
    "merged_at": "2018-07-16T03:54:09Z"
  }
}
{
  "title": "Descending with MPC_LAND_SPEED instead of MPC_Z_VEL_MAX_DN",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9768",
  "body": "**Describe the bug**\nWhen descending during a mission in simulation the Deltaquad does the whole descend with MPC_LAND_SPEED instead of descending with MPC_Z_VEL_MAX_DN until MPC_LAND_ALT1, and than ramping down to MPC_LAND_SPEED. \n\n**To Reproduce**\nSteps to reproduce the behavior:\n1. Create \"multicopter\" mission with delta quad in gazebo (e.g. at 30m altitude)\n2. Make sure to set reasonable values for MPC_LAND_SPEED, MPC_Z_VEL_MAX_DN, MPC_LAND_ALT1, MPC_LAND_ALT2\n2. Start mission\n\n**Expected behavior**\nThe vehicle climbs with MPC_Z_VEL_MAX_UP, flies at desired altitude and than descends with MPC_LAND_SPEED all the way to the ground. \n\n**Log Files**\nhttps://logs.px4.io/plot_app?log=70e15793-db80-4ec7-91d8-d1b6af522e70\n\n**Drone (please complete the following information):**\n- Gazebo Deltaquad\n\n**Additional context**\nWe observed this also in real flights\n\n@lamping7",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 wind estimate very wrong",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9726",
  "body": "Flown on 6/18 on Master (so almost 1.8 stable)\n\nActual wind at site was between 12-15 m/s\n\nEKF2 Wind estimate shows ~2-4 m/s.\n\nhttps://review.px4.io/plot_app?log=e6d82fe3-9b3b-4f4b-b8c6-5af1e930e1a9\n\nAlso, if you take look at ground speed vs airspeed we're cruising at about 20 m/s but traveling closer to 35 m/s but wind estimates are nowhere near what we were actually in (we measure wind with an anemometer before testing) and looking at surrounding area wind readings all were consistent with ours. It was blowing your shirt against your body kind of wind, not gentle breeze which is more the 2-5 m/s reported.\n\nMaster on 6/18\nfmuv3 firmware on Original Pixhawk (2mb flash)\nQGC Daily also from 6/18\n\n@dagar",
  "state": "closed",
  "pull_request": null
}
{
  "title": "A VTOL crash after log stop in the air after 'vtol_att_control low on stack' warning (flight log linked)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9720",
  "body": "Hi~ I hope PX4 developers to help finding the reason of crash.\n\nA delta-quad type VTOL drone crashed on the water while in transition flight trials of a developing drone after logging is stopped after 'vtol_att_control low on stack' warning happened  but telemetry log sustained from the logging stop to the crash.\n\nI am not sure this is a bug or not, but upload logs for analysis.\n\n**Environment:**\nPX4 v1.7.3, Pixhawk 2.1, QGC v3.3.1, Ubuntu 14.03, DeltaQuad airframe\n\n**Changed parts of source code:**\nMixer script change for two yaw motors that separately mounted.\nMultirotor mixer mix() function change (not to include yaw control in quadrotors)\nMAVLink stream SERVO_OUTPUT_RAW_1 and ACTUATOR_CONTROL_TARGET_0 were added.\nNo change in vtol_attitude_control and other modules.\n\n**Flight procedure:**\nIn manual (stabilized) mode in multicopter phase of VTOL the drone was hovering.\nIn the state, the transition switch was turned on and it flew in manual (not stabilized) mode of forward transition phase.\nWhen it reaches to fixed-wing mode, the transition switch was tuned off because its altitude became to decline (the lift force is small because its forward thrust is small).\nIn the second trial of this transition flight the accident happened.\n\n**Peculiar things:**\nIn previous several flights, the flight mode of fixed-wing phase was stabilized mode and any accident did not happened. But in the accident the mode was manual mode for the first time though I don't know it is related or not to the cause.\n\n**Log flies:**\n- a ulog file ([flight log](https://logs.px4.io/plot_app?log=5ddb8655-0658-4c3b-9282-69bc692587f8))\nThe below files can be given to people who want more:\n- a tlog file (telemetry log) :  the file is corrupted by the abrupt disconnection of communication and cannot be loaded by QGC\n- a telemetry text log converted from the tlog file\n- a global position text log file extracted from the tlog file",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 Indoor Mag Mode not functional",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9716",
  "body": "**Describe the bug**\nThe EKF2 Indoor Mag fusion mode (EKF2_MAG_TYPE = 4) does not function on master and v1.8 release.\n\n**To Reproduce**\nSet EKF2_MAG_TYPE=4 and reboot vehicle, or restart ekf2 in SITL (`gazebo_iris_opt_flow`).\n\n**Expected behavior**\nThe EKF should initialize and produce an attitude estimate. \n\nIn this case, the EKF does not initialise or produce an attitude estimate.\n\n**Log Files and Screenshots**\nLog from SITL : https://logs.px4.io/plot_app?log=5c2e7e20-35de-4278-bee8-40ba1b92c242\n\n```\npxh> ekf2 status\nINFO  [ekf2] local position OK no\nINFO  [ekf2] global position OK no\nINFO  [ekf2] time slip: 0 us\n```",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Poor land detection",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9696",
  "body": "@MaEtUgR @bkueng Could you have a look? This is blocking v1.8\n\nA new flight report just got uploaded:\nhttps://review.px4.io/plot_app?log=22cb36a7-2ac1-4cd8-b42c-cea152c7a141\n\nDescription: beta18_mc03_pxr(05)\nFeedback: take-off in position mode; steady hold; nice tracking; good nav; poor land detection\nRating: Unsatisfactory\nWind Speed: Breeze\nUploader: santiago@3dr.com\n\nVehicle type: Quadrotor\nAirframe: DJI Flame Wheel F450, Quadrotor x\nHardware: PX4FMU_V4\nVehicle UUID: 003200333435510837363434\nSoftware git hash: aa625d9af880e3be7bd2ddd7ed49d10c74c6ada4",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW Mission Start - Wheel increases to max deflection (max pwm value)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9540",
  "body": "When starting a mission the nose wheel servo instantly increases to ~2000 pwm and there is no time to recover (turns much too much) - need to actually decrease max angles at which the servo can turn but this is a new issue. Here are three logs with this occurring several times during each log. I was able to fly the missions due to some manual offsetting of the wheel but if left centered it would not work every time.\n\nUsing an fmu_v2 during these tests. Logging is on from boot so there is a lot of nothing prior.\n\nhttps://review.px4.io/plot_app?log=02711563-1bd4-40ee-8107-16fa14017b9e\n\nhttps://review.px4.io/plot_app?log=0285460d-d71f-422b-9d55-b42bccc66cbb\n\nhttps://review.px4.io/plot_app?log=732a5f97-563d-4141-ae9b-c4c8691277af",
  "state": "closed",
  "pull_request": null
}
{
  "title": "jMAVSim SITL ekf2 starting/stopping navigation continuously",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9527",
  "body": "Recently in SITL, I've been seeing ekf2 starting and stopping navigation continuously every few seconds.\n\nThis seems like a regression somewhere. I see this on macOS with jMAVSim on Java 8.\n\nHere is log where the drone just sits there.\nhttps://logs.px4.io/plot_app?log=8a5d658f-46d1-47a6-845d-44dc40247da6\n\nEdit: this seems to happen back in April (8c9b941e604e6ed971059e5b5fce12b95e9020fb)\n\n```\nInit MAVLink\nINFO  [simulator] Got initial simulation data, running sim..\nINFO  [pwm_out_sim] MODE_16PWM\nERROR [sensors] no ADC found: /dev/adc0 (9)\nINFO  [mavlink] mode: Normal, data rate: 4000000 B/s on udp port 14556 remote port 14550\nINFO  [mavlink] mode: Onboard, data rate: 4000000 B/s on udp port 14557 remote port 14540\nINFO  [mavlink] MAVLink only on localhost (set param MAV_BROADCAST = 1 to enable network)\nINFO  [logger] logger started (mode=all)\npxh> INFO  [logger] Start file log\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-05-25/15_07_36.ulg\nINFO  [Unknown] EKF aligned, (pressure height, IMU buf: 22, OBS buf: 14)\n\npxh>\npxh>\npxh>\npxh> ekf2 status\nINFO  [ekf2] local position OK no\nINFO  [ekf2] global position OK no\nINFO  [ekf2] time slip: 2 us\npxh> ekf2 status\nINFO  [ekf2] local position OK no\nINFO  [ekf2] global position OK no\nINFO  [ekf2] time slip: 158 us\npxh> INFO  [Unknown] EKF GPS checks passed (WGS-84 origin set)\nINFO  [Unknown] EKF commencing GPS fusion\n\npxh>\npxh> WARN  [Unknown] EKF GPS data stopped\nWARN  [Unknown] EKF stopping navigation\nINFO  [Unknown] EKF commencing GPS fusion\n\npxh>\npxh>\npxh> ekf2 statusWARN  [Unknown] EKF GPS data stopped\nWARN  [Unknown] EKF stopping navigation\nINFO  [Unknown] EKF commencing GPS fusion\n\nINFO  [ekf2] local position OK yes\nINFO  [ekf2] global position OK yes\nINFO  [ekf2] time slip: 29 us\npxh>\npxh>\npxh> ekf2 status\nINFO  [ekf2] local position OK yes\nINFO  [ekf2] global position OK yes\nINFO  [ekf2] time slip: 59 us\npxh> gps status\nINFO  [gps] not running\nCommand 'gps' failed, returned -1\npxh> uorb top\n\nupdate: 1s, num topics: 79\nTOPIC NAME                        INST #SUB #MSG #LOST #QSIZE\nactuator_controls_0                  0    6  242   653 1\nbattery_status                       0    6   89   301 1\nekf2_innovations                     0    1  242   237 1\nekf2_timestamps                      0    1  242    22 1\nestimator_status                     0    4  242  1114 1\ngeofence_result                      0    1    4     0 1\nrate_ctrl_status                     0    1  242   215 1\nsensor_accel                         0    1  242     0 1\nsensor_accel                         1    1  249    55 1\nsensor_baro                          0    1  100     0 1\nsensor_bias                          0    4  242   405 1\nsensor_combined                      0    4  242   231 1\nsensor_gyro                          0    2  242     0 1\nsensor_mag                           0    1  100     0 1\nsensor_preflight                     0    1  242   235 1\nvehicle_air_data                     0    5  100    49 1\nvehicle_attitude                     0    6  242   698 1\nvehicle_attitude_groundtruth         0    1  167    73 1\nvehicle_attitude_setpoint            0    4  242   650 1\nvehicle_global_position              0    5  242   994 1\nvehicle_global_position_groundtruth  0    1  167   155 1\nvehicle_gps_position                 0    5    9     8 1\nvehicle_land_detected                0    7    1     0 1\nvehicle_local_position               0    7  242  1107 1\nvehicle_local_position_groundtruth   0    1  167   155 1\nvehicle_local_position_setpoint      0    4  242   844 1\nvehicle_magnetometer                 0    4  100    49 1\nvehicle_rates_setpoint               0    4  242   627 1\n```",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF errors with Fixed Wing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9474",
  "body": "This was tested on a slightly modified version of PX4 Master\n\nAfter letting the vehicle sit for an extended period of time we are experiencing two errors \"PREFLIGHT FAIL: EKF INTERNAL CHECKS\" and \"PREFLIGHT FAIL: HIGH IMU ACCEL BIAS\". We recalibrated the accelerometers but still experienced these issues. If the plane is armed moderately quickly after booting up and there are no errors thrown, and the aircraft flies normally.\n\nHere are some log examples of the preflight fails on ground:\n\nhttps://review.px4.io/plot_app?log=a0fb96a2-de2f-4e2d-a4f6-0f930ea53248\n\nhttps://review.px4.io/plot_app?log=42eda972-2802-4d1e-b236-bed93244427c\n\nWe also had a case where the aircraft threw a \"PREFLIGHT FAIL: HIGH IMU ACCEL BIAS\" error but then still allowed us to arm. On takeoff the aircraft flew erratically and had to be taken over with manual control. Log is posted below.\n\nhttps://review.px4.io/plot_app?log=e29821e7-9539-46ec-b563-79be1b655cf4",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 with optical flow drifts without flow data",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9414",
  "body": "So I have been bench-testing a vehicle with a PX4Flow sensor + EKF2. `EKF2_AID_MASK` is set to fuse Flow and GPS. `EKF2_OF_QMIN` is set to 50.\n\nWhen the vehicle is on the ground (PX4Flow lens blocked), the position estimate from EKF2 keeps drifting around, even the though the flow module returns 0 `quality` and 0 `integrated_x` and `integrated_y`. Here is a log from boot : https://logs.px4.io/plot_app?log=6628dc88-c567-4796-95a6-f0815ab1a535\n\nWould be great if you could have a look @priseborough @ChristophTobler!",
  "state": "closed",
  "pull_request": null
}
{
  "title": "2 hard faults (on ground + in air) with PX4FW v1.7.4",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9348",
  "body": "## Bug Report\nWe (ASL/ETHZ) have recently had two hard faults that caused Pixhawk to reboot. One of them unfortunately happened in air with a 3.2m wingspan fixed-wing, one happened during on-ground testing.\n\n## Setup\n - Hardware: mRo Pixhawk (px4fmu-v3 / 2MB flash)\n - Firmware: Basically PX4FW v1.7.4, i.e. master-branch from 5 days ago (https://github.com/PX4/Firmware/commit/71170dce0a87ce06e00d721a713dfc3dc92dfc11) but with some slight modifications mainly to adapt the mixers to our platform and one custom sensor driver. The estimator is EKF2, the flight controller is the stock controller.\n\n## Hard fault 1: In-air\nWe had done 3 short MANUAL flights before that, and in this flight first flew manual for about three minutes and then switched to stabilized. The hard fault ocured 1 minute after switching to stabilized mode. The pilot continued to fly in PX4IO's (important!) manual override mode, and, as he barely noticed the issues, actually went back into stabilized mode for some time before then landing the plane following our instructions. The ulogger-log of part 1 (see below) stops in air. We could not find any fancy stuff in the logs before the log stops. Pixhawk rebooted in-air, and continued logging as usual (part2, see below).\n\n- Log files (with attached hard fault log) from take-off to in-air hardfault and pixhawk reboot: https://review.px4.io/plot_app?log=3b702655-6052-46e6-85e2-fd012d27c25f\n- Log file after the crash (i.e. after the pixhawk reboot until landing): https://review.px4.io/plot_app?log=409fcb62-50ca-42d1-82c7-f1bcaccfe9fd\n- Telemetry logs:[2018-04-20 15-13-09.log](https://github.com/PX4/Firmware/files/1934640/2018-04-20.15-13-09.log) (rename to .tlog!). The reboot happens after ca 1/3 of the log file length, you can see that it happened because the relative altitude is suddently zero or even negative.\n\n## Hard fault 2: On-ground\nThis happened during in-lab testing. We performed extensive pre-flight checks, including rebooting FMU (by pressing the reset button) and checking that IO's manual override still works. It did, but (and i assume this is normal because there is already a mixer present) loading the mixer after that provoked reboot fails. We let the plane then just sit there for a couple of minutes, and suddenly Pixhawk rebooted. This was a hard fault, too. We unfortunately assumed this was BECAUSE we had provoked the in-air restart via pushing the FMU reset button (and after testing for another 8 hours in-lab without any hard fault assumed everything was OK). I don't have the ulog-files yet, but i have:\n\n- The hardfault log from the SD card (it looks very similar to the one we saw in flight): \n[fault_2000_01_01_18_53_35.log](https://github.com/PX4/Firmware/files/1934634/fault_2000_01_01_18_53_35.log)\n- The console output. Note again that this log starts after we provoked an FMU reset via pushing its reset button, that's why it is an in-air restart. \n[consoleLog.txt](https://github.com/PX4/Firmware/files/1934645/consoleLog.txt)\n\nI might be able to provide the firmware .elf file to allow debugging the hard fault as described in https://dev.px4.io/en/debug/gdb_debugging.html#debugging-hard-faults-in-nuttx if required.\n\nI guess it makes sense to add this to https://github.com/PX4/Firmware/issues/9271 @RomanBapst @LorenzMeier ?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 allows arming while the control is not fully initialized. (TARGET_LOCAL_NED not yet published) (workaround proposed)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9200",
  "body": "**Bug Report**\nWe were experiencing from time to time something that looked like a \"random rotation towards North\" at the takeoff of our copters. Today, we successfully reproduced it in a Gazebo simulation. It seems that we are capable of arming and taking off in offboard mode without any position (GPS or PX4Flow). Therefore, our commands (vx, vy, vz yaw_rate)  are ignored except vz.\n\nThe takeoff procedure is the following:\n- OFFBOARD\n- ARM\n- (Vx=0, Vy=0, Vz=3.0, yaw_rate=0) until a certain altitude.\n\nWhen the simulation is started from a certain time, it works perfectly (well straight takeoff) but when the simulation is just started, we can still go in offboard, arm and takeoff but additionally to the expected drift, the copter rotates to north (the gazebo simulation starts pointing east)\n\n- **Log**: https://logs.px4.io/plot_app?log=5477f120-408d-4ce5-82e1-3b3d695a3a03\n- **Expected behaviour**:\n  * The copter does not arm until GPS fix or PX4Flow fix\n  * If the copter arms, it should drift as the position is not fixed\n- **Behaviour**:\n  * The copter arms\n  * The copter drifts\n  * **The copter rotates around the yaw angle** \n\n- **Steps to reproduce the problem**:\n  * Start Mavros over UDP link\n    * roslaunch mavros px4.launch fcu_url:=\"udp://:14540@127.0.0.1:14557\"`\n  * Prepare your OFFBOARD control method\n  * Start the simulation \n    * `make -j8 posix_sitl_default gazebo`\n  * Run your OFFBOARD control method\n\n- Results:\n  * The copter arms, but rotates from East to North and drifts until we see in the console of the simulator: \"EKF GPS checks passed (WGS-84 origin set)\" and \"EKF commencing GPS fusion\". \n  * The rest of the mission works fine.\n\n- Simulation console information:\n\n```\nINFO  [mavlink] partner IP: 127.0.0.1\nWARN  [mavlink] [timesync] Hard setting offset.\nINFO  [lib__ecl] EKF aligned, (pressure height, IMU buf: 15, OBS buf: 14)\nINFO  [tone_alarm] positive\nINFO  [tone_alarm] positive\nINFO  [tone_alarm] arming\nINFO  [commander] Takeoff detected\nINFO  [tone_alarm] positive\nINFO  [lib__ecl] EKF GPS checks passed (WGS-84 origin set)\nINFO  [lib__ecl] EKF commencing GPS fusion\n```\n\n* **Hardware in simulation**: IRIS+\n* **Firmware**: \n  * PX4 1.6.5\n  * PX4 1.7.3\n\n* **CURRENT WORKAROUND:**\n  * Subscribe to `~setpoint_raw/local` topic (`handle_position_target_local_ned` Mavlink Handler) and do not approve takeoff before the topic is published. \n  * Once published, an additional (optional?) step is to verify that the position (x,y,z,yaw) in the `TARGET_LOCAL` message is **very close to** the current `LOCAL_POSITION`.\n  * Takeoff safely",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MultiRotor: Unstable manual flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9150",
  "body": "Flash current master d2712dc and took off in stabilized; very jumpy/jittery; slow oscillations in heading\nRunning Pixracer (V4)\nhttps://logs.px4.io/plot_app?log=6ca0b878-b8a4-4700-8040-e09083db4c04\n\nre-calibrated and tried again; same result:\nhttps://logs.px4.io/plot_app?log=64eac19d-2e42-4450-85e3-39dd31930393\n\ncompared to stable flight with 1.7.4 beta:\nhttps://logs.px4.io/plot_app?log=12136a55-46ff-449a-bff3-38c58b832542\n\n@dagar this might be related to recent changes to motor saturation handling?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Multi Copter land after loss of position failsafe doesn't disarm",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9137",
  "body": "SITL testing using master at commit 7830d35 and with the magnetometer data rotated 90 degrees in yaw inside the ekf2_main.cpp file has show that although the post takeoff failsafe transition into land mode occurs as expected, the vehicle does not disarm automatically after landing. If landing is commanded from the console it does disarm.\n\nDetected during testing of https://github.com/PX4/Firmware/pull/8771\n\nLog file here: https://logs.px4.io/plot_app?log=92090f9f-1e16-45ea-879e-8ef535d949ab",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 1.7.3: Total crash in loiter.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9108",
  "body": "Hello,\n\nWe've had a total crash today with 1.7.3 when we engaged loiter in FW flight. We could not find the reason behind this crash in the Log...\n\nWhile we were flying 1.7.3 for a week we've had no unexpected problems until today.\n\nVTOL deltaquad\nPX4 1.7.3\nQGC 3.3 Windows\nAUAV X2.1 HW\nWithout airspeed sensor\n\nWhen the pilot activated Hold the plane just nose dived without any control whatsoever.\nDuring the nose dive the pilot switched to MC flight but did not switch back the loiter switch, so it did not work as expected to safe the VTOL. (We did not test this but what is happening when we switch the transition switch while in loiter?)\nThere are no HW problems with the machine.\n\nLOG: https://logs.px4.io/plot_app?log=89bd8fa6-6506-4e9a-87d5-81ee2cc9243a\n\nThe log seems to be cut at the end... but the video shows it all.\n\nVideo: https://www.youtube.com/watch?v=7iCPhtmdQq8&feature=youtu.be\n\nAny ideas?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Not able to give full throttle in fw acro",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9043",
  "body": "Throttle was somehow limited in acro mode when flying with the convergence tiltrotor.\r\nIn stabilized I was able to go full throttle.\r\n\r\n\r\nhttps://logs.px4.io/plot_app?log=1bb49365-b33c-425a-b016-9ceeabc2ac7e",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL takeoff does transition into wrong direction",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9037",
  "body": "When using a VTOL takeoff mission item to combine takeoff and transition the vehicle does not consider turning to a heading which is equal to the bearing to the next waypoint. Instead it will transition into the current heading which I think is not expected by the user.\n\nThis issue does not occur when using a separate takeoff and transition command;.\n\nWe reproduced this two times using the Convergence tiltrotor (SYS_ID = 13012)\n\nHere's the log\nhttps://logs.px4.io/plot_app?log=be4b8af6-31b8-4c01-997a-d6f848ab7839",
  "state": "closed",
  "pull_request": null
}
{
  "title": "tailsitter mc mode , Uncommanded alt_ref and thrust decreased,",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9032",
  "body": "position mode , during flight, thrust decreased ,why?\nhttps://logs.px4.io/plot_app?log=c90e6575-ce6b-4610-b182-86f6fb00b2dd",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Throttle spike on arming",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9022",
  "body": "In rare cases after arming throttle level is higher for a second, then goes back to normal values.\nI noticed it first time when I used 1.7 firmware, however there is similar topic from previous year http://discuss.px4.io/t/slight-higher-idle-throttle-when-first-arm/2471 .\nIn related issue was mentioned that MPC_THR_MIN could affect but after I lowered the parameter nothing has changed.\nHere's the log https://logs.px4.io/plot_app?log=7c0b159c-bf28-48dc-8677-b3ccd1c2d25b1 .\n\nI've also noticed that it happens after first arm.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "No EKF2 init without Vision Position, arming allowing without attitude estimate",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/9020",
  "body": "I am running v1.7.3, estimator is EKF2, EK2_AID_MASK is 9 (GPS and vision position).\n\nI've attempted to fly the copter indoors in stabilized mode (there is no GPS fix) without providing VISION_POSITION_ESTIMATE messages. Flight mode changed successfully, the copter was armed and when I've applied throttle, it took off, but was completely uncontrollable with regards to roll and pitch.\n\nStrangely, if you set EKF2_AID_MASK to 1 (GPS only) and have no GPS fix, you can still take off in modes, that don't need GPS fix (altitude control, stabilized) and everything works as intended.\n\nI've expected the copter either to arm and fly normally or at least refuse to arm.\n\nHere is the flight log: https://review.px4.io/plot_app?log=0d1bf158-5559-4bb6-ab31-c23580292b4a",
  "state": "closed",
  "pull_request": null
}
{
  "title": "tailsitter  fly forward and fall suddenly",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8997",
  "body": "In position mode,tailsiter fly forward , but fall sudenly. \r\nRC alt chanel(rc_channels_0.channels[3]) no actionï¼ŒWhy vehicle_local_position_setpoint decrised.\r\n\r\nhttps://logs.px4.io/plot_app?log=e395b143-1e01-4195-b385-77ca6ab75ef7\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Landing Detector Improvement needed to avoid uncommanded Throttle Cut During Flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8984",
  "body": "**Bug Report**\n\nFiling a bug report from the original thread here: http://discuss.px4.io/t/uncommanded-throttle-cut-during-flight/5852\n\nSeveral people have experienced an unexpected / commanded throttle dip with multi rotor vehicles using PX4 1.7.3.\n\n**Here are some log files that were recoverable:**\n\nEquipment and software:\nPX4 Version: 1.7.3 Stable\nPixhawk Cube 2.1\nTransmitter: Taranis X7 with Orange RX 2.4 GhZ DSMX transmitter module \nReceiver: Spektrum Racer Receiver (SPM4648)\n\n#1. Occurs at about 04:41 (there appear to be two dips in the throttle log)\nhttps://logs.px4.io/plot_app?log=e149c039-ffee-4ca6-a479-1e77856df206\n\n![image](https://user-images.githubusercontent.com/2559382/36805299-e41fdb08-1c71-11e8-9d51-70285bc30314.png)\n\n#2. Occurs at about 10:01\nhttps://logs.px4.io/plot_app?log=30e3d454-18d3-4aac-9d21-6be86641f9b0\n\n**And here is a log file that resulted in a crash:**\n\nEquipment and software: 3DR IRIS \nIndoor: PX4Flow + Teraranger one\nPX4 Version: 1.7.3 Stable\nPixhawk 1\nTransmitter: 3DR transmitter \nReceiver: 3DR original receiver\n\nThe drop happens at 1:11; crash at 1:12. All RC commands seemed to be normal. \nhttps://logs.px4.io/plot_app?log=57df1304-7bc0-4366-8cbf-9b4233d023ba\n\n![image](https://user-images.githubusercontent.com/2559382/36807904-f63eaf92-1c78-11e8-8eab-bf9b0c14c149.png)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW unsuccessful flight 02/26/18",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8980",
  "body": "The pilot flew an FW with Pixhawk Mini and master firmware (38e5a06) and faced the next problems:\n\n1: It took a long time to connect to QGC by the telemetry radio, and when it was connected it didn't give data.\n2: When it was flying stabilized mode the plane oscillated a lot.\n3: In mission mode, the plane was only gaining altitude or advanced to the first waypoint and moved very slow.\n\nThe plane only flew well in manual mode.\n\nLogs of the flights:\nhttps://logs.px4.io/plot_app?log=316d5dcf-4773-4298-8e6e-68d85a8d2aeb\nhttps://logs.px4.io/plot_app?log=2e6acbbd-967f-44ed-9ac2-26885cc45720\nhttps://logs.px4.io/plot_app?log=73cdcdbe-128e-41cf-84df-e61ab3bde83d\nhttps://logs.px4.io/plot_app?log=bfc0ef2e-0fdf-417d-b2e3-7f65441837d8\nhttps://logs.px4.io/plot_app?log=29a06e2d-b38b-4a4a-b8f5-417b8f9c50ac\nhttps://logs.px4.io/plot_app?log=6ab92bec-5d20-45b4-a387-fd86e5117a3c\n\nPrevious successful flights:\nhttps://logs.px4.io/plot_app?log=e91adbbe-1da4-49a9-a9e3-688921b03f50\nhttps://logs.px4.io/plot_app?log=3005515b-a35e-4cae-8dd2-2fa3176e0c8d\nhttps://logs.px4.io/plot_app?log=ff408fb9-e829-4db4-ab53-c0cbfb9764c6\n\n@dagar @RomanBapst",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Unstable sensors cause Critical problem",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8927",
  "body": "Bug Report\n\nI used Pixhawk hardware's (listed below), but in Most of the time see \"PREFLIGHT FAIL\" message for MAG,GYRO,ACCEL and in one case cause crashed.\n\n[log uploaded (Pixhawk LITE 2.4.6)](https://logs.px4.io/plot_app?log=b0be3ceb-c180-40b9-9cc4-d31ef1c1920a)\n\n```\n[commander] PREFLIGHT FAIL: ACCEL #1 UNCALIBRATED\n[commander] PREFLIGHT FAIL: GYRO #1 UNCALIBRATED\n[commander] PREFLIGHT FAIL: MAG SENSORS INCONSISTENT\n[commander] PREFLIGHT FAIL: MAG #1 UNCALIBRATED\n```\n\n\n - All boards calibrated with USB cable, in some case with WiFi module\n\nThe hardware's list (all with PX4 Firmware v1.7.3 + gps module m8n):\n\n- Pixhawk 2.4.6 (maybe 3DR original version)\n- Pixhawk 2.4.6 (Copy version)\n- Pixhawk LITE 2.4.6",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL Flight Issue",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8864",
  "body": "@RomanBapst Could you please have a look at this log file?\r\nhttps://review.px4.io/plot_app?log=6fa2399a-ccb4-4a2d-8303-091dec28dda0\r\n\r\n@PX4/testflights You can tag Roman for future issues directly.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL Crash 02/01/18",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8807",
  "body": "We flew a VTOL (Delta - Quad) with Pixhawk 1 (no silicon errata), executed auto (mission) the VTOL climbed, made the transition and reached the first waypoint, then it started to fly in a straight line, tried to recovered and activated kill switch but it continued flying and eventually crashed.\n\nFirmware loaded was master (102c0ea)\n\nHere is the log:\nhttps://review.px4.io/plot_app?log=7b00d0db-adf7-4a22-a9ba-8f8d55bb0419\n\nThank you!",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 Ekf::initialiseFilter() problem (disable mag, enable HGT_MODE Vision) ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8761",
  "body": "Hello.\r\n\r\nEkf::initialiseFilter() has some limitations:\r\n\r\n// check to see if we have enough measurements and return false if not\r\nbool hgt_count_fail = _hgt_counter <= 2 * _obs_buffer_length;\r\nHere it doesn't take into account that user may choose HGT_MODE VISION but aircraft is sitting on the ground with camera giving vision only in air. So if there is no vision while we are on the ground then filter init fails.\r\n\r\nbool mag_count_fail = _mag_counter <= 2 * _obs_buffer_length;\r\nHere it doesn't take into account that mag may be disabled by user (CAL_MAG0_EN or CAL_MAG1_EN ). So if user disable mag manually then filter init fails.\r\n\r\nbool ev_count_fail = ((_params.fusion_mode & MASK_USE_EVPOS) || (_params.fusion_mode & MASK_USE_EVYAW)) && (_ev_counter <= 2 * _obs_buffer_length);\r\nHere it doesn't take into account that aircraft is sitting on the ground with camera giving vision only in air. So if there is no vision while we are on the ground then filter init fails.\r\n\r\nOverall, if user choose AID_MASK 24 (vision position and vision yaw only) and do no provide vision data from the start to correctly initialise filter then it fails. But providing vision data when aircraft is sitting on the ground may not be possible in many cases.\r\n\r\nif (hgt_count_fail || mag_count_fail || ev_count_fail) {\r\n    return false;\r\n}\r\n \r\nFlight Log: https://review.px4.io/plot_app?log=7dacafb7-cd48-4296-a4c7-03c62a174c41\r\n\r\nExpected behaviour:\r\n1. If user disables mag manually then mag_count_fail must account it correctly depending on CAL_MAG0_EN or CAL_MAG1_EN params.\r\n2. If user choose vision only mode or choose HGT_MODE vision and do not provide vision data while ekf2 is inited then filter must able to init itself without this data.\r\n\r\nFor the short-term hack it is possible just to setup all three variables to false (mag_count_fail, hgt_count_fail, ev_count_fail), but this solution is quite ugly.\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Mocap follow path unstable",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8747",
  "body": "Hi \r\n\r\nI tried us PX4 follow a certain trajectory, with Optitrack. It is configured as below,\r\n\r\nPX4 Firmware:  px4fmu-v2_default\r\nEstimator: LPE\r\nOnboard controller: Raspberry Pi\r\nSoftware: Ubuntu Mate + ROS Kinetic \r\nTele: Xbee 900MHz\r\nDrone diagonal size: 300mm\r\nSelected Airframe:DJI Flame Wheel F330 Quadrotor x (4010)\r\n\r\nI set a trajectory to let drone to follow. A example log is [here](https://logs.px4.io/plot_app?log=a26cf12c-8248-4d76-82bf-0c6938e70b63). \r\nThe drone cannot follow path stable. There is big drift in height, as well as XY direction. \r\n\r\nhow to make our drone follow more stable? \r\nShould I modify airframe torque, moments and weight in PX4 source code? if yes, how?\r\n ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[v1.7.x] Initial parameter loading via SiK radios in QGroundcontrol stuck ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8746",
  "body": "I've found a strange issue when initial parameter loading _sometimes_ stuck when using SiK radio.\nIf I use another channel (for example UART for companion computer) it loads successful. When this happens it persists until controller reboot. Qgroundcontrol reboot doesn't help. I've don't seen this on PX4 v1.6.\n\nSik radio: tried both mavlink v1 and v2 (from https://github.com/LorenzMeier/SiK).\n\n```\nnsh> mavlink status\n\ninstance #0:\nGCS heartbeat: 355442 us ago\nmavlink chan: #0\ntype: 3DR RADIO\nrssi: 208\nremote rssi: 200\ntxbuf: 99\nnoise: 64\nremote noise: 54\nrx errors: 0\nfixed: 0\nflow control: OFF\nrates:\ntx: 0.713 kB/s\ntxerr: 0.000 kB/s\nrx: 0.051 kB/s\nrate mult: 0.411\naccepting commands: YES, FTP enabled: NO\nMAVLink version: 1\ntransport protocol: serial (/dev/ttyS1 @57600)\n\ninstance #1:\nmavlink chan: #1\nno telem status.\nflow control: OFF\nrates:\ntx: 7.217 kB/s\ntxerr: 0.000 kB/s\nrx: 0.000 kB/s\nrate mult: 0.511\naccepting commands: YES, FTP enabled: YES\nMAVLink version: 1\ntransport protocol: serial (/dev/ttyS2 @1500000)\n```\n\nhttps://logs.px4.io/plot_app?log=fc30cd9d-dbd4-45bb-9b78-aed21795e62f\n\nscreencast with qgroundcontrol:\nhttps://drive.google.com/open?id=15QIV_hUYvJ9b_k1FzkWRM6zyYOaoDb4S\n\nqgroundcontrol verbose logs:\n[qgc.log.zip](https://github.com/PX4/Firmware/files/1653552/qgc.log.zip)\n\nanother screencast (with log capture process):\nhttps://drive.google.com/open?id=19XxdTa-akUOsAeQBiqocP5shjNRPeGZd",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: ATTENTION!!! DANGER",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8730",
  "body": "PUSHER MOTOR STARTS DURING AIRSPEED CALIBRATION\non the bench.\n\nThe plane quad delta wing, the tubes from the pitot were swapped.\n\nWe recreated it two times\n\nThe second time by any chance we had logging enabled all the time so we have it on log.\n\nhttps://logs.px4.io/plot_app?log=de51dc5e-e868-426f-90c3-1fcc42855fe1\n\nIt happened after we blew in the pitot at the end of the calibration. The calibration went wrong (because of the reversed tubes). Both times the motor started.\n\nAfter we corrected the tubes never happened again.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FMU restart after landing and auto re-arming",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8722",
  "body": "Bug Report\nlog1, real flight:\nhttps://logs.px4.io/plot_app?log=c365baf7-9b50-4eed-a6cc-14ad2c211db7\nlog2, auto-arming after restart:\nhttps://logs.px4.io/plot_app?log=eab3b52a-4522-4c78-8da4-5c150cb48f7a\n\nI made a flight today, at the beginning,  all seems good. After the plane is landed on the ground(already landed, touched ground!), the the FMU restarted. I try to describe the process in detail:\n1. land, plane touched ground(for sure);\n2. motor stopped;\n3. heard from QGC, connection lost\n(no more than 1 second later)\n4. heard from plane \"bi bi bi biiiiiiii~\", I suppose it's servo check passed;\n5. motor spin;\n6. heard from QGC \"mission\";\n7. KILL switch on by me.\n \nI repeat the flight for 5 times afterwards, the same situation occurs in 4 times.\n\nIn the log, I found that some topics are dead during flight, I made offsets to separate them:\n![image](https://user-images.githubusercontent.com/18409502/35088876-1f6ebdae-fc70-11e7-836b-93f71dda956b.png)\n\nif it's some hardware bug, I will replace another board.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Intel Aero: uncontrollable attitude",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8718",
  "body": "Running current master 850678b and had a flip upon take-off\nlooking at the log, pitch and roll do not look to be registering:\nhttps://logs.px4.io/plot_app?log=71f9eb76-8ccc-4444-9f6f-5d4b7ab676d1\n\nreverted to yesterday's master 0e65753 and stabilize is fully responsive:\nhttps://logs.px4.io/plot_app?log=072aada3-d5a4-4f28-bb5d-9cea084674b1\nSomething might have been damaged in the flight controller because once altitude mode was engaged, the copter shot up in altitude and hit the roof.\n\nlast successful flight was on 0e65753\nhttps://review.px4.io/plot_app?log=a3026aee-25ab-431a-b076-941084c0cc28",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MS5525 Sensor does not compensate properly.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8715",
  "body": "@dagar \n\nHi Daniel, \n\nI have some flights with MS5525 enabled and the graph does not look good at all. We are currently flying without the airspeed enabled, but the sensor is connected and the readings are there.\n\nThe sensor is calibrated once on the field and we left it like this. S don't be suprised that the sensr is not zeroed.\n\nYou can clearly see the problem arround 10 deg celsius. I remember 10 degrees and 30 degrees were limit values for the compensation mechanism. So they dont work properly.\n\nhttps://logs.px4.io/plot_app?log=09a5175f-634a-49f6-a18b-49d22bbab4ca\n\nhttps://logs.px4.io/plot_app?log=cf8767bf-3933-417a-8fca-e807db8223dd\n\nI have more logs from the past 6 days so if needed I can upload more.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: Reject position control / Hold / Mission after succeed GPS lock.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8696",
  "body": "I've found a strange issue with v1.7.3: PX4 reject to switch to POSCTL, HOLD  or Mission.\r\nGPS is running and got 3D lock. When I try to start mission from QGroundControl is shows message: \"vehicle is not ready\". I've tried to recalibrate all sensors, but it didn't help. All sensors status are good. \r\n\r\nHW is mRo pixhawk with fmuv3 (2MB) firmware.\r\nFrame is: VTOL quad delta\r\n\r\nhttps://logs.px4.io/plot_app?log=60f77638-9a48-4aac-95a8-66cf25eb19ae\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "LPE local position drifts from GPS position in position hold mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8692",
  "body": "We are trying to develop autonomous system using GPS and Vision fusion and after few weeks working only with vision we have realized that there's a problem with GPS position. Local position is not following absolute position from gps. Logs are here:\n\n[logs](https://logs.px4.io/plot_app?log=87d618e2-fc5a-4ef3-849b-8fed68e0183a)\n\nI think that all parameters are correct and it should work. `lpe_fusion` parameters is set to `173` which is `10101101_2`. According to [source code](https://github.com/PX4/Firmware/blob/master/src/modules/local_position_estimator/params.c) gps fusion is on.\n\nCould you tell me if that's a bug or something is wrong with our config?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC: Almost crash, about 1 sec strange PosCTL Setpoint behaviour",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8674",
  "body": "**Bug Report**\r\n\r\nSince changing ESC for some more aggressive Variant (BLHeli Damped Light replaced \"conventional\" ESC), I have a Problem when Braking in PosCTL Mode I get a strong Oscilation (probably by switching to Hold/Loiter when Stick is completely centered). I tried to figure MPC Settings in order to sort this out. I have still some strong Oscillation even when slowly moving the Stick back to center. \r\n\r\nTried in about 12m Alt to check some Roll Movements. Just after centering Roll Stick from a Left Bank, the Copter started to get uncontrollable and spiraled down about halfway when it started to fight the motion and managed to just stabilize about 1-2m off the Ground. \r\n\r\nI would like some Advice on this as to:\r\n- How should I tune MPC Params in order to avoid the Oscillation when braking in PosCTL?\r\n- Why were the Setpoints of Roll/Pitch kind of \"sleeping from 3:57 to 3:58.5? There it looked like the Copter got out of control and started to stabilize only after 3:58.5. Also Check Main PWM for Ch0 & 1 it looks like they almost locked on min/max just to swap at about 3:58.5\r\n\r\nAny hints are appreciated as I really start to loose trust in my Copter. \r\n\r\nLog is here: https://logs.px4.io/plot_app?log=391170a2-63e6-4f20-9e5b-14d9f33a67ae  ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: Back transition Ramp Up problem.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8672",
  "body": "Hi guys,\r\n\r\nI think we found a bug in the Position / Mission modes for vtol.\r\nTrying to fix the #8655 we made the VT_B_TRANS_DUR from 3 sec to 5 sec. And with the VT_B_TRANS_RAMP set to 3 sec. the ramp up of the quad motors to the \"commanded thrust\" happens in the middle of the transition and the throttle stays at that level up to the end of the transition, then it pasees the throttle to the MC. \r\n\r\nIn our case In Position mode the hover throttle is at 0.6 for the MC. So it is logical that the ramp up of the quad in the back transition go from 0 to hover throttle in order to hold the MC at current altitude (the idea behind Position mode) and continue like this up to the end of transition then pass the throttle to the MC to continue in Position mode until it stops.\r\n\r\nThe problem is that for the back transition ramp up commanded throttle PX4 uses VT_TRANS_THR which is the throttle for the front transition pusher motor. \r\n\r\nYou can see it clearly in:\r\n\r\nMission\r\n![mission back tr thrust comanded](https://user-images.githubusercontent.com/12617619/34905059-dbb58ea4-f859-11e7-8af5-8b617b05eb57.png)\r\n\r\nLOG: https://logs.px4.io/plot_app?log=e6381c08-4b42-41f2-a01b-bd9f7f0bbb58\r\n\r\nPosition\r\n![position back tr thrust comanded](https://user-images.githubusercontent.com/12617619/34905110-f9bab6ee-f85a-11e7-93a4-b2d198cb38dc.png)\r\n\r\nLOG: https://logs.px4.io/plot_app?log=66fa60a2-e7b4-487e-b916-3c45f024daf3\r\n\r\nWe could not see this up to now because we had a 3 sec back transition with 3 sec ramp up and with pretty low VT_TRANS_THR = 0.7 .\r\nNow because we fight the fron transition ramp up problem #8664 we made the VT_TRANS_THR = 0.9 and found out that during the back transition in Mission and Position modes the quad trhottle during the transition is so high that the VTOL just gains some 10-15 meters og height during the transition. It holds horizontal level but climbs drastically during the transition and then drops suddenly to hover throttle once in MC.\r\n\r\nIn Mission and Position modes neither the front transition ramp up neither the back transition ramp up are such to allow a smooth transition. at given altitude.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL: Back transition after the end Nasty Pitch up.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8655",
  "body": "Hi guys,\r\n\r\nWe have a strange problem with the back transition with our delta-quad.\r\n\r\nThe problem is only in Position mode. No such problem when in Altitude or Stabalized modes.\r\n\r\nAfter the back transition is finished the MC sharply makes a putch up command.\r\n\r\nWe have MPC_DEC_HOR_MAX and MPC_ACC_HOR_MAX set to 2 but still this kick back.\r\n\r\n![back transition pitch up](https://user-images.githubusercontent.com/12617619/34802898-dab458ec-f678-11e7-8a15-421c1d4597c1.png)\r\n\r\nHere is the log:\r\nhttps://logs.px4.io/plot_app?log=a11fdda4-1d23-48c2-8596-f5c5a16e23ba\r\n\r\nAny Ideas?\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Possible to Arm wo GPS Lock",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8632",
  "body": "**Bug Report**\n\nI could Arm in the Basement with an attached GPS (which did not get a valid Lock) but all Parameters set to - what I assumed - Values preventing Arming when GPS Missing or no valid Lock is available. \n\nCBRK_GPS_FAIL = 0\nCOM_ARM_WO_GPS = Disabled\nEKF2_GPS_CHECK = 21\nEKF2_REQ_EPH = 5.0m\nEKF2_REQ_EPV = 8.0m\nEKF2_REQ_NSATS = 6\nEKF2_REQ_GDOP = 2.5\n\nThere was an Error Indication though : `Preflight fail: EKF not using GPS`\n\nCheck Log: https://logs.px4.io/plot_app?log=2ad190a6-08df-40bd-96d8-a423fc393970 \n\nAddition: I armed in Stabilized (Manual?? -> See #8613) Flightmode so GPS would not really be necessary. But I usually start in Stab and switch to PositionCtl later on. So one would like to be sure that a valid Position Lock and a working GPS is there.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Eagle: Auto and RTL non responsive",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8603",
  "body": "Running master c0c0666\nAuto and RTL do not respond despite having good gps lock\nFlight in position mode without issues\nhttps://logs.px4.io/plot_app?log=474076d1-969e-41fd-bcf7-eaa0489c3038\nhttps://logs.px4.io/plot_app?log=f9593388-cbae-48b9-a55d-4884dd162644\n\nLogs not showing error messages",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF Replay generates 6 files instead of one",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8567",
  "body": "I want to try out the uLog EKF replay but when I follow the [docs](https://dev.px4.io/en/debug/system_wide_replay.html#ekf2-replay) I get for me unexpected results.\r\n\r\nThe [logfile](https://logs.px4.io/plot_app?log=2f967654-4766-4732-be75-53e8e705e732) is from a quad running v1.7.2, u3 ultra SD card and SDLOG_MODE = 2 (logging from boot until shut down)\r\n\r\nI run the replay using\r\n```\r\nmake posix none\r\n```\r\n\r\nHowever, for some reason I get 6 replay files instead of one\r\n```\r\nINFO  [uorb] Using orb rules from ./rootfs/orb_publisher.rules\r\nSleeping for 0.2 s; (0 us).\r\nINFO  [logger] logger started (mode=all)\r\nINFO  [replay] using replay log file: /home/carl/Documents/logs_quad_home/2018-01-03/11_28_36.ulg\r\nINFO  [logger] log root dir created: rootfs/fs/microsd/log\r\npxh> INFO  [replay] Ekf2 replay mode\r\nINFO  [replay] Applying params from ULog file...\r\nINFO  [logger] Start file log\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/19_26_39_replayed.ulg\r\nINFO  [replay] Replay in progress...\r\nINFO  [lib__ecl] EKF aligned, (pressure height, IMU buf: 22, OBS buf: 14)\r\nINFO  [lib__ecl] EKF GPS checks passed (WGS-84 origin set)\r\nINFO  [lib__ecl] EKF commencing GPS fusion\r\nINFO  [logger] Start file log\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/11_30_25_replayed.ulg\r\nINFO  [logger] Start file log\r\nINFO  [logger] closed logfile, bytes written: 3812493\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/11_30_44_replayed.ulg\r\nINFO  [logger] Start file log\r\nINFO  [logger] closed logfile, bytes written: 3481662\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/11_31_02_replayed.ulg\r\nINFO  [logger] Start file log\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/11_31_41_replayed.ulg\r\nINFO  [logger] Start file log\r\nINFO  [logger] closed logfile, bytes written: 2353681\r\nINFO  [logger] Opened log file: rootfs/fs/microsd/log/2018-01-03/11_31_52_replayed.ulg\r\nINFO  [replay] Replay done (published 53376 msgs, 2.832 s)\r\nINFO  [replay] \r\nINFO  [replay] Topic, Num Published, Num Error (no timestamp match found):\r\nINFO  [replay] sensor_combined: 52417, 0\r\nINFO  [replay] vehicle_gps_position: 1059, 0\r\n```\r\n\r\n```\r\nâœ” ~/src/standard_PX4/Firmware/build/posix_sitl_default_replay/tmp/rootfs/fs/microsd/log/2018-01-03 [v1.7.2|âœ”] \r\n20:27 $ ls\r\n11_30_25_replayed.ulg  11_31_02_replayed.ulg  11_31_52_replayed.ulg\r\n11_30_44_replayed.ulg  11_31_41_replayed.ulg  19_26_39_replayed.ulg\r\n```\r\n\r\nIs this intended behavior?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Offboard control CI test unstable",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8556",
  "body": "Fail example:\nhttps://logs.px4.io/plot_app?log=3a1bf335-a6d7-41c8-a2b8-0b8dd4658ee0\n\nObservations:\n\n  * System never took off\n  * Setpoints were there, but the actuators didn't respond\n  * No actuator outputs plot present at all\n\nPass example (same commit):\nhttps://logs.px4.io/plot_app?log=5331c5d9-ea98-489c-86ae-06a0344f92af\n\nScript:\nhttps://github.com/PX4/Firmware/blob/master/integrationtests/python_src/px4_it/mavros/mavros_offboard_posctl_test.py",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Convergence crashes",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8540",
  "body": "The first two flights of our Convergence after installation of Pixfalcon were failures. It flew ok in multirotor mode, but it didn't do well in airplane mode.\n\nControl surfaces deflected correctly on the ground prior to flight in stabilize mode in multirotor and both stabilize and manual modes in airplane mode.\n\nIf anyone can do an autopsy of the logs, here they are.\nLog of first flight:\nhttps://logs.px4.io/plot_app?log=4acb5cae-f192-422d-8228-75ebec5f0c7b\nFollowing transition into airplane mode, throttle cut out, then returned to full throttle, then began to roll rapidly.\n\nLog of second flight:\nhttps://logs.px4.io/plot_app?log=d772eac7-7bde-4b42-bb95-589207898224\nFollowing transition into airplane mode, it pitched down and rolled right. Unable to counter with rc inputs. Crashed hard and GPS was found 30 feet from crash site.\n\n@tumbili Do you have an idea what is going wrong here?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Go to DESCEND mode while GPS always connected",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8515",
  "body": "**Bug Report** \r\n\r\nI got a crash during a vtol flight, the flight mode changed to \"NAVIGATION_STATE_DESCEND\" at the end of front transition. Then it's goes lower and lower, when I found it is wrong, I tried to save it by turn on RTL, but it's too late.\r\n\r\nI checked source code, it seems the only way to go into that mode is GPS timeout, but I checked my GPS, at least the altitude data looks good.\r\nhere's my log link:\r\nhttps://logs.px4.io/plot_app?log=d5bbeb04-40dc-464b-bcd8-408cad3983f5\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Throttle stop after front transition",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8508",
  "body": "**Bug Report** \n\nHello,  here's the log link. \nhttps://logs.px4.io/plot_app?log=f10ed9d8-4eab-4b31-962f-bd5c69178878\n\nAfter transition to fw is done, the pusher throttle drops to 0 and goes back to normal, then altitude drops as throttle is zero. Check this:\n![image](https://user-images.githubusercontent.com/18409502/34259115-ecfc37d2-e69b-11e7-9069-bb0a4c332018.png)\n\nI reproduced this EVERYTIME I make a front transition. Tried to modify trasition parameters but seems no use.\n\nAnd I found in source code this, which might be related to the bug:\n![image](https://user-images.githubusercontent.com/18409502/34259150-15d904be-e69c-11e7-830b-13ef4642f3ba.png)\nI can't fully understand what this set_idle_fw() for, could you add a few more lines of comments here?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "It is possible to arm to mission with stale baro",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8465",
  "body": "**Bug Report**\nI flashed master cbdb08bb6109c1ea3ef4e23761233df447523a52 on to a pixracer quad, with the only difference that the baro altitude was overwritten to -15 km in the [sensor driver](https://github.com/PX4/Firmware/blob/cbdb08bb6109c1ea3ef4e23761233df447523a52/src/drivers/ms5611/ms5611.cpp#L868-L868).\n```\nreport.altitude = (((pow((p / p1), (-(a * R) / g))) * T1) - T1) / a;\nreport.altitude = -15000.0f;\n```\nWhen connecting to telemetry I get the warning that the baro data is stale\n```\n0:00:05 ERROR: [sensors] Baro #0 fail:  STALE!\n```\nThen I upload a mission in qgc and try to start it, I get as expected the messages about failing preflight checks\n```\n0:00:21 WARNING: [commander] REJECT AUTO MISSION\n0:00:45 WARNING: [commander_tests] PREFLIGHT FAIL: EKF INTERNAL CHECKS\n0:00:45 WARNING: [commander] Arming not possible in this state\n```\nHowever, after that the quad is **armed and tries to fly away**\nAt 49 s the quad is armed in mission mode and all motors start, at 52.3 s I switch to assisted so I can unplug the battery more safely.  \n![image](https://user-images.githubusercontent.com/7795133/33988228-14da4678-e0c4-11e7-82cf-c4a1604d6347.png)\n\nLog is [here](https://logs.px4.io/plot_app?log=fcdc27bc-705d-4ef6-80d0-efeadd82c219)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Not getting MAV_LANDED_STATE_ON_GROUND",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8464",
  "body": "See [flight log](https://review.px4.io/plot_app?log=4d7df5bf-d8b5-43a5-bd9a-842f8702a131).  I expect to get extended sys state showing MAV_LANDED_STATE_ON_GROUND after doing simple take off and landing.\n\n**Repro**\n1) Run [AirSim](https://github.com/Microsoft/AirSim), with PX4 connected, either SITL or HITL mode.\n2) Run this python script \n\n```python\nfrom AirSimClient import *\nimport sys\nimport time\nimport argparse\n\nclient = MultirotorClient()\nclient.confirmConnection()\nclient.enableApiControl(True)\n\nclient.armDisarm(True)\n\nlanded = client.getLandedState()\nif landed == LandedState.Landed:\n    print(\"taking off...\")\n    client.takeoff()\n        \ntime.sleep(2)\n\nprint(\"landing...\")\nclient.land()\n\nprint(\"disarming.\")\nclient.armDisarm(False)\n```\n\nNotice client.land() times out because the extended sys state is stuck in MAV_LANDED_STATE_LANDING, and never reaches MAV_LANDED_STATE_ON_GROUND.  This seems to be a regression in v1.7.0, older versions of the firmware worked fine.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Bokeh application is not working",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8458",
  "body": "Bokeh application is not working, log viewer is not working.\r\n\r\n[Log example](https://logs.px4.io/plot_app?log=1431e7f7-82a4-4a13-a0ba-162e6f492671)\r\n\r\n@LorenzMeier ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "commander: Fix pre-flight delta velocity bias check level",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8446",
  "body": "Previous check level was less than the max achievable by the estimator using current default parameters making the check ineffective. \r\n\r\nRaised in response to log https://review.px4.io/plot_app?log=f619bcb1-7427-4619-86d6-bc53e5e2024e discussed in this issue: https://github.com/PX4/Firmware/issues/7202#issuecomment-300754802\r\n\r\nCurrent ekf2 internal prediction time step is 8 msec and the default value of EKF2_ABL_LIM is 0.4 m/s/s, so the maximum delta velocity bias estimate output by the EKFis will clip at 3.2E-3 m/s using current parameter defaults. The pre flight check level has been updated to 3/4 that value (an equivalent accel bias of 0.3 m/s/s",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8446",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8446",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8446.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8446.patch",
    "merged_at": "2017-12-12T00:41:43Z"
  }
}
{
  "title": "Fix uncontrolled height gain in hold/loiter mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8418",
  "body": "This fixes the height gain bug that occurs when using hold/loiter mode after taking off without GPS and gaining it's use in-flight. Reported by https://github.com/PX4/Firmware/issues/8400\r\n\r\nIt also fixes a bug causing the  height in the mavlink global position relative_alt message to be AMSL instead of height above takeoff location if GPS checks pass after takeoff.\r\n\r\nThe practice of allowing use of hold and position change commands via GCS inputs after a non-GPS takeoff has wider implications. In such a scenario, both RTL and geofencing are disabled, the user may not be aware of this, and unlike flying using stick inputs, it would be easy for the user to inadvertently fly the vehicle to a range where comms are lost or recovery using stick demands is impossible. \r\n\r\nThis has been tested in SITL using the following procedure:\r\n\r\n1) Modify the SITL startup script to inhibit GPS lock by adding 'gpssim set -t 0' at the end\r\n2) Run 'make posix_sitl_default gazebo' and wait for the ekf to initialise\r\n3) Select 'altitud'e mode on QGC, arm and takeoff using throttle stick\r\n4) Enable GPS lock using 'gpssim set -t 3'\r\n5) Wait for EKF GPS fusion to start\r\n6) Select 'hold' mode on QGC and command a positive altitude change using the slider and confirm completion\r\n7) Command a position change on QGC using the 'fly to click' feature and confirm completion\r\n8) Command a negative altitude change using the slider and confirm completion\r\n9) Command  a landing at current location.\r\n\r\nLog file here: https://logs.px4.io/plot_app?log=afea809a-e7fe-463c-bfe7-ef6296064330",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8418",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8418",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8418.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8418.patch",
    "merged_at": "2017-12-07T08:20:17Z"
  }
}
{
  "title": "MC: LowBat RTL Performed at 5m Alt instead of 50m!",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8408",
  "body": "**Bug Report** \r\n\r\nI was doing some testing, when I ran into a LowBattery RTL. But instead of climbing to the Preset Alt of 50m in such a case, the Copter just turned face to me an returned at roughly 5m Altitude! \r\n\r\nLog here: https://logs.px4.io/plot_app?log=d55046af-324a-4e6e-91ee-205b1f34bfc3\r\n\r\nLanding was smooth an luckily the Street lantern was about 5m away. \r\n\r\nJust to note I'm still running on 1.7 RC1 (about 20 days old) - a quick search through the Commit list revealed nothing that would deal with such a problem. \r\n\r\nAddition: Just seen RTL_MIN_DIST is set to 5m but according LocalPos X/Y both have been > 10m.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MR: uncontrollable altitude gain when engaging auto or rtl",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8400",
  "body": "Sequence of events\r\n\r\narmed in position mode\r\nengaged auto, mission rejected\r\ntook off in position mode\r\nsecond attempt at engaging auto\r\ncopter took off with uncontrollable gain in altitude\r\n\r\nrtl presented the same behavior\r\nhttps://logs.px4.io/plot_app?log=01fbca4e-353b-4874-831a-03f091098584\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "F450 with Pixhawk 1 - f63c821 crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8398",
  "body": "The pilot reported it was flying in Auto and was seing the vehicle following the mission in QGC, then the RC signal was lost and the vehicle crashed on the ceiling of a building.\r\n\r\nThis a screen capture of the messages in QGC\r\n![qgc_messages](https://user-images.githubusercontent.com/5013954/33461994-da3699f2-d5e9-11e7-9eef-3e34d4edd1ce.jpg)\r\n\r\n[Log](https://review.px4.io/plot_app?log=c087212c-24ec-4076-b83c-0c690b5c26ba)\r\n\r\nPrevious successful fligths the same day\r\nhttps://review.px4.io/plot_app?log=a768ef29-6be8-4245-b191-183ffa20ddb6\r\nhttps://review.px4.io/plot_app?log=56d2c68b-cff0-4198-bb33-4197e44a4815\r\nhttps://review.px4.io/plot_app?log=95e5f4c8-b294-4182-b630-256600424117\r\nhttps://review.px4.io/plot_app?log=a75645fa-3af5-494a-b3cf-748f5d9a6d89\r\nhttps://review.px4.io/plot_app?log=c7a0d5c4-f79a-47d2-83f6-0a8d94fd216c\r\nhttps://review.px4.io/plot_app?log=83b00da7-f696-4af4-b3b7-f768fead3c7f\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "F450 with Pixhawk 3 Pro v1.7.0-rc3 crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8392",
  "body": "Flight of DJI F450 with Pixhawk 3 Pro autopilot using v1.7.0-rc3 (66d4a1b3)\r\n\r\nThe pilot reported the vehicle took off, switched to Auto, reached the first waypoint and it started to climb above 300 meters, the pilot commanded RTL through QGC, the vehicle started to move towards home position but kept gaining altitude. The pilot sent land command through QGC but the vehicle didn't respond, it only responded to RC roll so the pilot engaged the kill switch.\r\n\r\n[Log](https://review.px4.io/plot_app?log=0cdfec08-8848-4892-bcff-d4a720e99803)\r\n\r\n@dagar",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL issues with multiCopter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8389",
  "body": "If engaging RTL multiple times in the same flight, the second+ instance of RTL goes towards a previously set path by the first RTL engagement.\r\nCouple examples:\r\nhttps://review.px4.io/plot_app?log=ed176590-4352-4516-b5ed-3892436d6477\r\nhttps://review.px4.io/plot_app?log=d9c63fd1-1224-4be7-8985-932a2f670c78\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW crash v1.7.0-rc2",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8380",
  "body": "Phantom flying wing with Pixhawk mini autopilot running v1.7.0-rc2 (V3).\r\n\r\nAfter 6 successful flights, during the 7th flight, the pilot took off in manual mode, switched to Auto and the plane accelerated to maximum thrust uncontrollably; once switched back into manual the pilot reported only partial control, attempted to land manually but crashed due to the vast acceleration and only partial control over the craft.\r\n\r\n[Log](https://review.px4.io/plot_app?log=6fb19372-e027-4b23-b0e8-5425d409f5f3)\r\n\r\n[Video](https://youtu.be/3qIzzh4hfUs)\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 1.6.5 Stbl: Loiter switching BUG.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8376",
  "body": "Hi guys,\r\n\r\nWe've had a total crash with a Skywalker, Plain Airplane profile. PX4 ver 1.6.5 stable.\r\n\r\nhttps://logs.px4.io/plot_app?log=6daee88d-90d7-4cbe-abb7-440591fef87d\r\n\r\nI think I found the reason but it is very strange and I need conformation. This is due to a BUG if I'm correct so please can you take a look and confirm the reason.\r\n\r\nThe pilot is not novice, it is pretty experienced one in terms of piloting a plane, but somehow sometimes the PX4 is overwhelming for him especially in certain situation and he is doing irrational switching (as many PX4 users might do).\r\n\r\nThis is the case:\r\n\r\nHe flew in Position and went in to Loiter (Pause). Then at some point he wanted to gain altitude while in Pause mode. In the graph it is obvious he started pitching up. But nothing happened as it should be, the plain continued to control the speed and throttle in the Loiter, despite the throttle lever was at 60%.  In the latest implementation the Pause button will get the plane in Loiter from any mode. So initially he was in Position mode with activated Position switch. Absolutely normal operation as it is meant to be. Then strangely enough he switched to Manual in the attempt to gain altitude, without turning off the Pause button. The plane continued to circle, but strangely enough transferred the full control of the Throttle to the lever of the RC instead of controlling the throttle in the loiter itself automatically. At the same time the pilot continued to pitch up and gained altitude and I see it clearly in the graphics.. Because he had the lever at 60% throttle it was not enough to sustain the loiter, so the plane started stalling, but still trying to continue to sustain the loiter radius and gain altitude in the condition of under throttle. Because of the stalls the plane was rather going in spirals toward the pilot, and he explained that he thought it is drifting still not realizing what is going on. He did not realize that the Throttle is in his control. Then at the last stall the plane just plunged in nose dive. Because we have a hard limit of 45deg for the pitch, the plane did not have any altitude and time to recover. \r\n\r\nI did not see any mechanical failure, neither to the servos neither to the GPS nor the airspeed sensor nor anything else.\r\n\r\nPlease can you confirm this and if it is a BUG it should be corrected. \r\n\r\nPause should be totally Auto mode, probably allowed to have some small amount of pitch control in order to gain or loose altitude, but in no case we have to give the throttle a manual control at this moment.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Fix vulnerability in pre flight checks and failsafe",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8374",
  "body": "The preflight checking of ekf2 health status as currently implemented in the commander has a two main vulnerabilities:\r\n\r\nIf GPS arming checks had been disabled via the COM_ARM_WO_GPS parameter, then this was also bypassing the ekf2 health checks.\r\nThe ekf2Check() function in the commander is only called once per mode change or arming request which means that the status is a snapshot of the EKF output and does not handle transient errors or noise well.\r\nThis PR improves the continuous ekf2 pre-arm checks and publishes the result as a boolean on the estimator_status message, which is then checked by the ekf2Check() function in the commander.\r\nIt also removes the bypass of ekf2Check()\r\n\r\nPreflight checking changes:\r\n\r\n- Separate the vertical and horizontal checks for use by local position validity reporting\r\n- Add checking of yaw using a decaying envelope filter to the horizontal checks.\r\n- Publish the check result to estimator_status topic.\r\n\r\nLog from testing of preflight checks here: https://logs.px4.io/plot_app?log=1bc435b7-86e3-4c73-82a5-a98c77949a3d. A magnet was used to cause large changes in magnetic yaw and fail preflight checks whilst attempting to arm.\r\n\r\n![screen shot 2017-11-27 at 1 29 43 pm](https://user-images.githubusercontent.com/3596952/33248223-073adfea-d378-11e7-85c6-472212894ea8.png)\r\n\r\nIf a RW vehicle takeoff off with a large yaw error, the EKF will start to reject the GPS data due to the inconsistency with the  INS solution. This combined with the position controller can cause an uncontrolled high speed flight condition. When this occurs, the EKF reports the navigation output as invalid, however after reset back to GPS, the navigation solution will be reported as valid again for a varying interval. This causes an interaction with the commander failsafe resulting in unpredictable transitions in and out of the failsafe mode. The solution implemented by https://github.com/PX4/Firmware/commit/39134325740a193fd755763e52faffe030073e5f\r\n\r\n- Checks for loss of navigation for up to 30 seconds after takeoff or until  a horizontal speed of 5 m/s has been achieved.\r\n- If the vehicle is not landed and the check is active, then the navigation is declared as failed if the velocity innovations fail for a continuous period of 1 second.\r\n- This will cause the local and global position and velocity validity to be latched false to prevent unsafe use of position control modes.\r\n- An emergency message 'CRITICAL NAVIGATION FAILURE - CHECK SENSOR CALIBRATION' is output to console and mavlink if the failsafe is activated.\r\n\r\nTest log generated using SITL with  90 degree misaligned compass data here: https://logs.px4.io/plot_app?log=6aa3a650-a65a-499a-a4ed-9ab287e9e764",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8374",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8374",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8374.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8374.patch",
    "merged_at": "2017-12-04T09:09:56Z"
  }
}
{
  "title": "Fixed Wing reject auto mission",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8361",
  "body": "fixed wing cannot entry into auto mission\r\n\r\nhere is the flight log\r\nhttps://logs.px4.io/plot_app?log=90d6dcd2-7b87-4963-9390-987c1d062b4a\r\nhttps://logs.px4.io/plot_app?log=27b7223c-7d7b-4dba-b82a-da3229e546e0\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL fix RTL_LAND_DELAY behaviour",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8351",
  "body": "Fixed wing test flight reported RTL ignoring the RTL_LAND_DELAY setting and landing immediately.\r\nhttps://logs.px4.io/plot_app?log=c412160a-56e3-4154-b3d8-2c582aa9b9f1\r\n\r\nThis PR introduces a helper for float comparison, uses it to fix RTL_LAND_DELAY, and changes the RTL land notification to critical so that the user is alerted and the RTL state change is a little more obvious in logs.\r\n\r\nTested in SITL.\r\n\r\n@santiago3dr \r\n",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8351",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8351",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8351.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8351.patch",
    "merged_at": "2017-11-26T19:40:14Z"
  }
}
{
  "title": "F450 frame with Pixhawk mini crash - v1.7.0-rc1",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8299",
  "body": "Using F450 frame with Pixhawk mini autopilot, loaded v1.7.0-rc1\r\n\r\nThe vehicle was flying in mission mode and when going to the second waypoint it stopped to follow the mission, it didn't respond to RTL command (by RC) and it crashed.\r\n\r\nhttps://logs.px4.io/plot_app?log=57cd3193-b22d-478a-8c10-c0ff0f9a5178\r\n\r\n@dagar @LorenzMeier ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "ecl: Update ekf2 to version that addresses known vulnerabilities",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8276",
  "body": "Addresses  loss of height accuracy during sustained yaw spinning and vulnerability to transient sensor errors after in-flight yaw alignment. See:\r\n\r\nhttps://github.com/PX4/ecl/pull/350\r\nhttps://github.com/PX4/ecl/pull/354\r\n\r\nNote the amount of stack allocation has had to be increased to accomodate the potential for larger data buffers created by PR350\r\n\r\nOne hardware test using a pixracer board https://logs.px4.io/plot_app?log=f3f3826d-f8a7-4fac-91ed-f57c4a2945c1",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8276",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8276",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8276.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8276.patch",
    "merged_at": "2017-11-13T21:50:13Z"
  }
}
{
  "title": "MC: Crash due to Motor Stop (Kill Switch) but I doubt this",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8263",
  "body": "**Bug Report**\r\n\r\nI file this as a bug report since I'm concerned that my crash today may have other reasons than accidentally flipping the Kill Switch. \r\n\r\nI was performing some tests to eliminate a strong Oszillation when braking in PosCTL. This was improving, when I wanted to do another Test, shortly after Taking of the Rotors stopped in Mid-Air and the Vehicle crashed on the road where Motors where spinning again. While hitting the Ground the Battery got disconnected (as can be seen in the Telemetry log). \r\n\r\nSadly the ULG stops shortly after start so about 2meters of flight are missing from the Vehicles Log (this is kind of strange). Also the OSD did not record anything since it claimed that there was no Communication (this may also be a bug of the OSD FW but it said that there was no data for more than 400 secs, which usually does not happen). \r\n\r\nSo I'm stuck with the Telemetry Log. This is the last I got over Telemetry (from the Log):\r\n\r\n![killswitch](https://user-images.githubusercontent.com/6877067/32623752-760951f8-c587-11e7-8ec7-9ea27c5a3fcf.jpg)\r\n\r\nHere comes the 2nd strange Part. The Kill-Switch was engaged and disengaged under **0.5 sec and this twice in sequence**. I checked with my Remote and it is almost impossible to really push the switch to the position in-between where it may flip back in this quick manner. I'm not aware that I flipped the Switch and the Telemetry RC Input (Channel 6) does not reflect any change in Signal. I performed many flights, and never flipped the switch unintentionally.\r\n\r\nTelemetry Log (Check last 15 secs) : [2017-11-09 18-05-27.tlog.zip](https://github.com/PX4/Firmware/files/1458838/2017-11-09.18-05-27.tlog.zip)\r\n\r\nULog Upload : https://review.px4.io/plot_app?log=1452c840-3003-4913-b528-1fff3f17d447",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL issues with multiCopter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8257",
  "body": "Quadcopter running pixracer (v4)\r\ntwo possibly related issues\r\n- upon engaging RTL, copter does not climb to set RTL altitude\r\n- if engaging RTL twice in the same flight, the second instance of RTL veers in the wrong direction; heading is corrected half way through the return path\r\n\r\nboth issues present:\r\nhttps://logs.px4.io/plot_app?log=a229d06a-b4f6-4333-ae1c-246c3f90f8b1\r\nhttps://logs.px4.io/plot_app?log=c6d5b63b-c467-491b-83b3-cfb39064abeb\r\n\r\naltitude issue present:\r\nhttps://logs.px4.io/plot_app?log=f999958f-6a2f-419a-8a1c-e812045e8be7\r\n\r\n\r\nusing the same version of master on fixed wing, RTL looks to be working fine:\r\nRTL set to 60m:\r\nengaging rtl below set altitude:\r\nhttps://logs.px4.io/plot_app?log=ac6e62a9-6c02-4e3d-a9c3-132c2adfd0c8\r\n\r\nengaging rtl above set altitude:\r\nhttps://logs.px4.io/plot_app?log=2ead01d6-a13d-4df6-b261-54c1ec2137ab\r\n\r\n@dagar @sanderux @priseborough ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "EKF2 Altitude estimation problem on Release 1.6.5 Stable",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8256",
  "body": "Hi,\r\n\r\nI'm experiencing a strange behaviour regarding the altitude estimation. \r\n\r\nThe flight log is from a mission with 4 waypoints at 20 m height.\r\n\r\nDuring the flight, I noticed some oscillations on the drone altitude, which I was able to confirm using an RTK GPS as ground truth ([https://imgur.com/DR6G0jY](Z)) .\r\n\r\nOn the flight log it's possible to see that both the GPS and barometer notice the altitude variation, but the estimated altitude only has a small change.\r\n\r\nhttps://logs.px4.io/plot_app?log=1d070bb2-b001-48f1-b33c-73e347a17001#Nav-Altitude-Estimate\r\n\r\nDid anyone experience this problem?\r\n\r\nThank you.\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "F450 with Pixracer didn't follow the mission, started climbing.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8246",
  "body": "Took off manually, good hover in position mode launched the mission and the unit started getting altitude but did not follow the mission.\r\n\r\nhttps://logs.px4.io/plot_app?log=907d2032-92a3-43c8-9a71-1c18b0792194\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "mc_pos_control: fix position setpoint overshoot",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8240",
  "body": "This PR addresses massive position setpoint overshoot caused by `_vel_sp_prev` windup. The bug is critical for offboard mode usage.\r\n\r\nFlying in offboard mode we had constantly observed position setpoint overshoots in case of flight to distant setpoint. E.g., here we are flying back and forth in offboard mode: https://review.px4.io/plot_app?log=61a675f6-020a-462f-b1cf-b58974460d44. Overshoots really stand out:\r\n\r\n![Overshoots](https://user-images.githubusercontent.com/20798956/32437968-ff23a816-c2f9-11e7-8745-67fef6ea073d.png)\r\n\r\nHere is plot of y, vy and corresponding setpoints for 1000 m flight in offboard in SITL on current master (https://logs.px4.io/plot_app?log=92b7ba3c-e2f7-4094-98a3-05e8b5a8493f):\r\n\r\n![master](https://user-images.githubusercontent.com/20798956/32437865-b5007b24-c2f9-11e7-9580-2f456f57f81b.png)\r\n\r\nAs can be seen on the plot, copter have overshooted setpoint for over 60 m because velocity setpoint started to drop from max forward velocity when copter already was 50 m ahead of setpoint.\r\n\r\nAfter debugging of mc_pos_control_main.cpp it became clear that cause of overshoots is windup of `_vel_sp_prev(0)` and `(1)`. The reason is [this fragment](https://github.com/PX4/Firmware/blob/aa699cf4b7e63d9bf17dc2ba2b95e2e02224a6ab/src/modules/mc_pos_control/mc_pos_control_main.cpp#L2455) of `calculate_velocity_setpoint()`: \r\n\r\n```c++\r\nif (!_control_mode.flag_control_auto_enabled) {\r\n\tvel_sp_slewrate(dt);\r\n}\r\n\r\n_vel_sp_prev = _vel_sp;\r\n\r\n/* ... */\r\n\r\n/* make sure velocity setpoint is constrained in all directions (xyz) */\r\nfloat vel_norm_xy = sqrtf(_vel_sp(0) * _vel_sp(0) + _vel_sp(1) * _vel_sp(1));\r\n\r\nif (vel_norm_xy > _vel_max_xy) {\r\n\t_vel_sp(0) = _vel_sp(0) * _vel_max_xy / vel_norm_xy;\r\n\t_vel_sp(1) = _vel_sp(1) * _vel_max_xy / vel_norm_xy;\r\n}\r\n```\r\nSo `vel_sp_slewrate()` never see constrained velocity and `_vel_sp_prev` continues to rise to hunders and thousands m/s. When copter approaches the setpoint, `_vel_sp_prev` drops, but it's change rate is limited by `vel_sp_slewrate()`. Because of this windup `_vel_sp` can't begin to lower at time and vehicle overshoots. Overshoots are negligible in AUTO mode because mc_pos_control moves position setpoint so it is always close to the vehicle.\r\n\r\nIt would be more correct to address this moving `_vel_sp_prev = _vel_sp` to the end of control cycle, but this change causes incorrect behavior of smooth takeoff limiter so I had to move velocity constraining before `_vel_sp_prev` assignment, leaving smooth takeoff limit after it.\r\n\r\nThis is the same 1000 m flight in SITL after fix (https://logs.px4.io/plot_app?log=d5bd2519-432c-446a-b8c9-fd021c2fdab6):\r\n\r\n![fix](https://user-images.githubusercontent.com/20798956/32439298-21fcc03e-c2ff-11e7-963c-92051e217d9e.png)\r\n\r\n@MaEtUgR, @Stifael, please review.",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/8240",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/8240",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/8240.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/8240.patch",
    "merged_at": null
  }
}
{
  "title": "Battery remaining inversed when compensating for load",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8198",
  "body": "The battery remaining function is broken on today's master.\r\nIt increases drastically when under load (if anything it should decrease). Tested with and without setting internal resistance, both behave the same. The voltage reading does read as expected.\r\n\r\n![image](https://user-images.githubusercontent.com/14801663/32076325-dbcfdca2-ba9f-11e7-9cff-0fab8f5b43d2.png)\r\n\r\nLog from other flight same behavior:\r\nhttps://logs.px4.io/plot_app?log=7f323da0-8f75-46f1-aba9-f0a68150b691\r\n\r\nping @LorenzMeier @dagar \r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "VTOL crash on V4Pro",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8186",
  "body": "vtol crash 24/October\r\n\r\ncrash log:\r\nhttps://review.px4.io/plot_app?log=da864870-aa30-4133-be64-c766e2e0e9e7\r\n\r\nprevious successful flights on same platform:\r\nhttps://review.px4.io/plot_app?log=1fa2997a-b9d8-4039-af2e-dad379be803c\r\nhttps://review.px4.io/plot_app?log=deacbcaa-61ed-41c2-80d2-9b636b66a983\r\n\r\n\r\nFlight conditions:\r\naprox 27Â°C degrees\r\nmoderate winds, 4~5 m/s\r\n\r\nSequence of events:\r\nauto take-off in MC\r\nfailed auto-transition to FW\r\nretook manual control in stabilized and successfully engaged manual transition to FW\r\nengaged mission; vtol headed in correct direction to first waypoint\r\n\r\nafter a few waypoints, vtol started to veer off coarse and switched back to MC\r\nswitched MC to stabilized at which point it was hard to control and started to dip in pitch and roll violently while losing altitude\r\n\r\n@dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Sudden Jerk after takeoff causes crash (Kneejerk) - PX4 1.6.5px",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8105",
  "body": "I have been fighting and issue with 1.6.5 that has given me a huge headache. In a nutshell, after takeoff and before starting a mission, the autopilot performs a very intense jerk which the drone tries to catch itself but frequently does not.\r\n\r\nI can generate the bug by loading a mission on the drone and using the start button slider. It also shows up intermittently under takeoff and using the continue mission slider. I suspect the issue is either the roll axis is flipped in software and corrected mid-flight or the x/y position PID loop is running and accruing error before starting the mission. What are your thoughts?\r\n\r\nvideo:\r\nhttps://drive.google.com/open?id=0ByR2uOoTK3khMDgwckQyOE03eUU\r\n\r\nlog:\r\nhttps://logs.px4.io/plot_app?log=49f577af-c6f9-46cb-83a7-b84590ecabf8\r\n\r\nThank you for any help that you can provide\r\nMarshall",
  "state": "closed",
  "pull_request": null
}
{
  "title": "BUG on EKF2 when the PX4Flow goes invalid",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8102",
  "body": "### **Bug Report**\r\n\r\n**LOG:** https://logs.px4.io/plot_app?log=962b0f4e-3553-4ec2-b398-40258c9286e5\r\n\r\n**Explanation:**\r\nThe PX4Flow is only valid at 35cm of the floor. \r\n\r\nTo reproduce, handheld the UAV for some seconds over 50cm so we get a position then let the UAV on the ground.  After some minutes, take it over the ground again and you'll see that the position is completely off.\r\n\r\nNote: In the log, you can see the handheld parts with the accelerometer.\r\n\r\n**Anomalies in the log:**\r\n\r\n* The two first handheld parts where with some rotation yet the third one (at 10') was without clear rotation.\r\n* High yawrate while one the ground (4' - 10') \r\n* Peak in LPOS.x and LPOS.y (We don't see much because of that peak)\r\n* We don't have the same peak with the distance sensor!\r\n* Velocities are high while on the ground\r\n* At 10', while handheld (almost not moving) the velocities tend to go up.\r\n\r\n\r\n**Versions:**\r\n* PX4 Firmware: 1.6.5\r\n* Flow Firmware: QGC provided firmware (PX4/Flow/master)\r\n* EKF_AID_MASK set to PX4Flow\r\n\r\n**Workaround:** Using the PR https://github.com/PX4/Flow/issues/96 so the PX4Flow report is always marked as valid.\r\n\r\nOriginal issue: https://github.com/PX4/Flow/issues/97",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Mission randomly rejected",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8066",
  "body": "Log: https://review.px4.io/plot_app?log=6f9fa451-d3a6-42dd-b1c7-87261310b139\r\nSituation:\r\nVehicle sat outside with good gps and telemetry lock\r\nArmed via RC\r\nSwitched from Manual to Mission (jumping over ALTCTL)\r\nWarning issued: REJECT AUTO MISSION\r\n\r\nThen disarm and arm again and it works.\r\nThis happens very often but not consistently.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RC Blips when adding a 2nd mavlink stream",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/8053",
  "body": "While hovering 4 feet off the ground the drone rolled 30 degrees left and would not recover with RC controls. After analysing the logs and live mavlink data the drone was acting to what it thought was an RC command. As we debugged we observed jumps in raw rc controls. We tried a separate RC receiver as well as a separate transmitter with the same issues. Analysing the raw inputs via QGroundControl we walked through our config file and removed line by line params. We determined the that multiple mavlink streams were the cause of the issue. \r\n\r\nQGroundControl Raw RC Blips: https://i.imgur.com/BaFnAE6.png\r\n\r\nHardware:  EAGLE\r\nSoftware Version:  f160743d\r\nOS Version: Linux, v3.4.0\r\nLog from flight: https://logs.px4.io/plot_app?log=f38f504d-2888-422a-a86a-52c60f00b449\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "data link loss failsafe do not work in take off state",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7910",
  "body": "\r\nData link failsafe action is set to RTL but its not executed in takeoff state.\r\nthat might potentially cause a dangerous situation of completely uncontrolled drone when using no RC at all.\r\n\r\ncan be produce in Gazebo using master. QGC 3.2.4 ,without joystic.\r\n\r\n1. command Take Off\r\n2. Drone climb to MIS_TAKEOFF_ALT\r\n3. shut down QGC\r\n4. after COM_DL_LOSS_T  \"all data links lost\"  message  is sent\r\n5. bug here-  the drone keep loitering infinitely without any control\r\n\r\nhttps://logs.px4.io/plot_app?log=80935714-f8a4-45b9-8881-bfef1a3225f6\r\n\r\n\r\nregardless, i think drones flight mode should be changed automatically to Hold after it's reached takeoff alt, as well as when finishing mission for example",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Land detector issues",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7768",
  "body": "Log: https://logs.px4.io/plot_app?log=e31c9ecf-b862-43df-a419-23efa0aa2ed8\r\nVideo: https://drive.google.com/open?id=0B3otHVwcj_LdQ0RSbjFPOU5XaDg\r\n\r\nLand detector on VTOL in MC mode does not seem to function properly\r\nThe mag timeout and gps loss are indicative of a similar issue to https://github.com/PX4/Firmware/issues/7746\r\n\r\nThe flight was done by doing a TAKEOFF and then a LAND command. The final disarm was commanded manually. The same behavior was in mission mode.\r\n\r\nFlight was yesterdays master merged with https://github.com/PX4/Firmware/pull/7666\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Dealing with SDCARD failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7750",
  "body": "Some flights on a vehicle with a failing SDcard from a client:\r\n\r\nMission read failure (presumably) resulted in unexpected back transition: https://logs.px4.io/plot_app?log=ffa0687e-c817-4163-b52e-4f9fa1a66994 (the user then activated the takeoff waypoint to re-transition)\r\n\r\nComplete weirdness at takeoff: https://logs.px4.io/plot_app?log=bc6215da-fd24-425c-a4e8-ecfaa9b12571\r\nAlso not all params seem to have been logged\r\n\r\nTotal failure halfway: https://logs.px4.io/plot_app?log=2258f3eb-fa11-4571-a409-b1d7417f19e3\r\nAlso not all params seem to have been logged\r\n\r\nAt minimum,  when mission read fails it must RTL, not loiter around the last known WP\r\nThe other strange behavior i am pretty sure is sd card related too, maybe some io buffer issue. \r\n\r\n@LorenzMeier @dagar @bkueng thoughts?\r\n\r\nUpdate:\r\nAction: check sd-card performance at boot, warn when performance is below threshold. (see: https://github.com/PX4/Firmware/pull/4460)\r\nAction: crc checking on read missions\r\nAction: raise awareness in community\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Mission takeoff almost no thrust and does not take off",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7737",
  "body": "On today's master (a merge of https://github.com/PX4/Firmware/pull/7666 and https://github.com/PX4/Firmware/pull/7690)\r\n\r\na VTOL takeoff and a regular takeoff from mission mode was attempted. Both failed.\r\nRC control from posctl did function from a landed state.\r\nSwitching to mission while airborne did complete the takeoff and vtol takeoff command.\r\n\r\nLog: https://review.px4.io/plot_app?log=a5ab7c8f-101f-443f-a612-6e46fadc9d7f\r\n\r\nFYI @dagar @LorenzMeier ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Change Altitude causes yaw setpoint change",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7638",
  "body": "when loitering after reposition, changing the altitude will cause 180 deg change in yaw sp (facing the previous position)\n (FW v1.6.5 QG 3.2.0)\n\n1. Take-off\n2. re-position 100m north\n3. when loitering after reaching the point- change altitude to 50m\n4. bug- the drone changes the yaw setpoint (facing south)\n\nhttp://review.px4.io/plot_app?log=a6cbe484-4ef9-46b4-91f2-f98e3708d407",
  "state": "closed",
  "pull_request": null
}
{
  "title": "FW Land mode = crash",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7609",
  "body": "I recently had a flight that put up a \"[commander] failsafe: no global position warning\", then switched to Land mode and proceeded to fly straight into the earth. My main concern is why the global position was lost in the first place (did the estimated position and gps position begin to differ too much? why?), but it would be nice to know that there is a reliable FW solution for this sort of condition to return to the ground hopefully in one piece.\r\n\r\nLog here: http://logs.px4.io/plot_app?log=b7fcb8a9-a66f-4b49-94e3-f896d3a65cb7",
  "state": "closed",
  "pull_request": null
}
{
  "title": "`EKF GPS fusion timeout` errors with good GPS data available lead to big position estimate jumps",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7599",
  "body": "\r\nWhile flying an octo with ublox M8T GPS we see rapid extreme position estimate jumps, as logged here:\r\n\r\nhttp://logs.px4.io/plot_app?log=d6944989-20ef-4007-bf1e-ca0b3732347f\r\n\r\n- Multiple warnings are logged similar to: `2:24:865 | WARNING | [lib__ecl] EKF GPS fusion timeout - reset to GPS`\r\n- Have tried two different GPS units (ublox M8N, M8T) on several different airframes with the same results.\r\n- Looking at the code it appears this warning shows up when ECL decides GPS data is now valid after having been invalid for some time. From what I can tell from the logs, a good GPS position was continuously available during operation. \r\n- This problem has not yet appeared using the UAVCAN Zubax GNSS2 (which does not use the ubx gps driver.)\r\n\r\nPossibly related to:\r\n- https://github.com/PX4/Firmware/issues/6443\r\n- http://discuss.px4.io/t/position-estimate-problem-in-flight/3162/4\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 1.6.3: Strange problem with Airspeed-less transition.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7545",
  "body": "We were flying 1.6.3 for some time. But recently decided to reset all the parameters with the new defaults. For this we use change of air-frame procedure. So we carefully introduced our PIDs on top of the new defaults. We removed the circuit breaker for the airspeed and thus it did not ask us to calibrate the airspeed so the diff press cal params were empty 0.00. \r\n\r\nIn this setup we were not able to complete the transition. It never stopped the quad despite the speed got exceeding 20 m/s and the transition continued forever up to the crash.\r\n\r\nhttp://review.px4.io/plot_app?log=b6653ab1-ada7-4711-abaf-00a6a51249dc\r\n\r\nBecause we flew the 1.6.3 airspeed-less without a problem we just started thinking. We enabled the airspeed. Calibrated the airpseed. Then again we disconnected it from the breaker.\r\n\r\nOn the Bench test perfect transitions.\r\n\r\nhttp://review.px4.io/plot_app?log=619b0b6b-ae84-4220-aa52-73ddce2b7fcc\r\n\r\nhttp://review.px4.io/plot_app?log=3647be91-b6f2-4be1-a5a3-f66ca93c8b94\r\n\r\nAlso we flew without airspeed without any problem. So the only thing we had to do was to calibrate the airspeed in order to make the transition in aispeed-less config.\r\n\r\nDuring this tests we discovered another thing. In airspeed-less mode the only way we could manage the transition is timing. \r\n\r\nThere is a parameter VT_F_TR_OL_TM which is supposed to guarantee fixed transition time without airspeed. But in reality in airspeed-less mode the transition is done now by the VT_TRANS_MIN_TM which is the minimum front transition time. The VT_F_TR_OL_TM did not have any effect over the transition timing.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Unexpected back transition",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7544",
  "body": "From flight test team, FYI @dagar http://logs.px4.io/plot_app?log=78d033a5-d3e8-4e18-a73f-3602f21e78ab\r\n\r\n@bresch Can you please have a look as well?",
  "state": "closed",
  "pull_request": null
}
{
  "title": "[PixHawk3] Accel1 startup bias huge changes",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7541",
  "body": "On my Drotek PixHawk Pro v1.3 I'm facing a strange behavior.\r\nFirst I saw sometimes the warning \"Accels inconsistent, check cal\". After further investigations, I saw that usually, the Z-axis value is usually around 9.8m/s2, but sometimes, the value of the Acc1 is completely wrong (e.g.; 2 or 15). The value of the accelerometer 0 is always correct.\r\n\r\n```TOPIC: sensor_accel instance 0 #1\r\n\r\ntimestamp: 11548976\r\n\r\nintegral_dt: 4000\r\n\r\nerror_count: 0\r\n\r\nx: -0.0971\r\n\r\ny:  0.0563\r\n\r\nz:  9.8932\r\n\r\nx_integral: -0.0003\r\n\r\ny_integral:  0.0002\r\n\r\nz_integral:  0.0391\r\n\r\ntemperature: 42.7938\r\n\r\nrange_m_s2: 78.4532\r\n\r\nscaling:  0.0024\r\n\r\nx_raw: 7\r\n\r\ny_raw: 40\r\n\r\nz_raw: 4074\r\n\r\ntemperature_raw: 5815\r\n\r\ndevice_id: 3608074\r\n\r\n```\r\n\r\n```TOPIC: sensor_accel instance 1 #1\r\n\r\ntimestamp: 163650940\r\n\r\nintegral_dt: 4006\r\n\r\nerror_count: 0\r\n\r\nx:  0.0778\r\n\r\ny:  0.4095\r\n\r\nz:  2.6501\r\n\r\nx_integral:  0.0003\r\n\r\ny_integral:  0.0014\r\n\r\nz_integral:  0.0081\r\n\r\ntemperature: 59.1025\r\n\r\nrange_m_s2: 156.9064\r\n\r\nscaling:  0.0048\r\n\r\nx_raw: 53\r\n\r\ny_raw: 29\r\n\r\nz_raw: 480\r\n\r\ntemperature_raw: 8701\r\n\r\ndevice_id: 1442826\r\n\r\n```\r\nAfter a few consecutive reboots on the pixhawk, I obtained the following sequence:\r\nThe behavior was the following: `first calibration` -> `-9.8` -> `reboot` -> `-15` -> `2nd calibration` -> `-9.8` -> `reboot` -> `-3` -> `3rd calibration` -> `-9.8` -> `reboot` -> `-15` -> `reboot` -> `*-9.8*` -> `reboot` -> `-15` -> `reboot` -> `-15` - `reboot 3x` -> `-9.8` -> `reboot` -> `-15` .........\r\n\r\nI tried with two other new PixHawks Pro v3.1 and I can reproduce the error. However, strange thing, I tried on a v1.2 and I wasn't able to obtain the same result after more than 10 consecutive reboots.\r\n\r\nHere is a log where the value is correct:\r\nhttp://review.px4.io/plot_app?log=170ce58a-794e-414d-8607-168ce8c734ef\r\nAnd here, one with the incorrect bias:\r\nhttp://review.px4.io/plot_app?log=e0bba09b-1129-4438-8ded-baede72f24cc\r\n\r\nThe logs come from a device uncalibrated, but I had the same issue with an autopilot fully calibrated (thermal + scale&offset).",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Flyaway after loss of datalink (v1.6.2)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7535",
  "body": "Hello,\r\nFew days ago I flown my multicopter for about 1.5 km. and almost got flyaway, only using RC saved it for safe landing. \r\nI got 'ALL DAT LINK LOSS' and it seems that RTL has been engaged (I still had downlink). but, instead of flying toward home position for landing the multicopter started to fly very fast backward.\r\nfrom the log I see that just after losing the datalink (at 10:28) it did got new heading, X and Y setpoints of home. but just after that (when the link was regained?) the position setpoint sets back to its current position, no change of heading setpoint. and the multicopter gets higher and higher pitch, that leads it to fly very fast backward, not closing the X and Y position setpoints. I have tried to send new commands reposition, pause the multicopter seems to be affected by them but still contiues to fly at very high speed.\r\nAt this point (2km away) we toke RC control, and fly it to home for landing.\r\n\r\nlog: \r\nhttp://review.px4.io/plot_app?log=2da94d7c-a374-4bb3-b7f9-efd8fecaf445\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "navigator mission_block check range for loiter exit",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/7514",
  "body": " - fixes #7510 \r\n\r\nI haven't figured out why next isn't populated, but this prevents the flyaway.\r\n\r\nTested in SITL. http://logs.px4.io/plot_app?log=2b554775-45c8-43c0-8be4-15d2ef9ff3bf\r\n\r\nThe MC yaw after VTOL back transition is wrong, but we can look at that later. FYI @sanderux ",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/7514",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/7514",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/7514.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/7514.patch",
    "merged_at": "2017-06-29T19:28:27Z"
  }
}
{
  "title": "[Navigator] Fly away because of NaNs",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7510",
  "body": "Last day I had a fly away with my VTOL doing a mission. Fortunately, I was able to take it over the RC and came back in manual. \r\nInspection of the log revealed that the L1 controller was outputting NaNs for roll and yaw setpoints.\r\n\r\nHere is the log: http://logs.px4.io/plot_app?log=d72b30cd-d713-4c43-9f32-30510657f2e6\r\n\r\nAnd here is a dump of the setpoints getting into a NaN state:\r\n![l1_nan](https://user-images.githubusercontent.com/14822839/27689006-e4642fa6-5cdc-11e7-9d8e-48b69f02c5cf.png)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Pixhawk Pro (V4Pro) Quad near flyaway",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7495",
  "body": "Took off in position mode\r\nAlmost immediately after taking off, copter started to fly away and would not respond to user input\r\neventually regained control in altitude mode after several minutes and several hundred meters away\r\nhttp://review.px4.io/plot_app?log=2b1d4ff4-e15e-48ac-870d-2ebbe8748afc\r\n![bokeh_plot](https://user-images.githubusercontent.com/13203106/27606012-50a5876a-5b33-11e7-9c58-b839a71e1910.png)\r\n\r\nTwo succesful flights using same setup, same code, same flightplan loaded:\r\nhttp://review.px4.io/plot_app?log=776e6bbf-2971-4195-8e22-6b9d0ffe167e\r\nhttp://review.px4.io/plot_app?log=2b3f59bb-42d5-43b6-aaea-2e335318e275\r\n\r\nHad another near flyaway on this same copter a few days ago:\r\nhttp://review.px4.io/plot_app?log=00b0b048-39bd-45cd-910b-c3d54b0f39ad\r\n\r\nCopter consists of\r\nPixhawk Pro\r\n3DR ublox M8N with HMC5983 magnetometer\r\nDJI F450 quad frame\r\nDJI E300 propulsion system\r\n3S 5200mAh battery\r\nFrSky D4R-ii receiver\r\n\r\n@priseborough @bkueng @dagar ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Setting mode to PosCtl after RTL causes large velocity setpoint",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7467",
  "body": "If you command an RTL then set mode to Manual PosCtl, the vehicle will take off very fast towards the home location with no stick input while in PosCtl.\r\n\r\nSITL Log: http://logs.px4.io/plot_app?log=dd5b9854-3c7a-46ce-b97d-457dd3185a88\r\nReplication steps: \r\n- Take off in PosCtl\r\n- Command RTL\r\n- Set mode to PosCtl\r\nThe vehicle will quickly ramp up to 9 m/s with no stick input then slow down after a few seconds\r\nIt's a lot clearer to see if you set all the VEL_MAX parameters to 3 m/s\r\nSo I set \r\nMPC_VEL_MAN_MAX = 3 m/s\r\nMPC_XY_CRUISE = 3 m/s\r\nMPC_XY_VEL_MAX = 3 m/s\r\nYou'll see the vehicle go very slowly at 3 m/s then when you set mode to POSCTL, it'll quickly shoot up to 8-9 m/s ground speed with no stick input.\r\n\r\nA plot of the local_position vel_y and setpoint vel_y:\r\n![rtl_posctl](https://user-images.githubusercontent.com/1168541/27511724-b062b2ec-58e8-11e7-97f6-0df27c27b3e2.png)\r\nThe crazy velocity setpoint gets generated right after setting the vehicle to Manual PosCtl.\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "pixhawk pro quadcopter flyaway",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7463",
  "body": "http://logs.px4.io/plot_app?log=00b0b048-39bd-45cd-910b-c3d54b0f39ad\r\n\r\n![image](https://user-images.githubusercontent.com/84712/27490566-c541ba8c-580c-11e7-9737-46f6a609d4b8.png)\r\n\r\nEKF plots\r\n\r\n[00b0b048-39bd-45cd-910b-c3d54b0f39ad.ulg.pdf](https://github.com/PX4/Firmware/files/1098398/00b0b048-39bd-45cd-910b-c3d54b0f39ad.ulg.pdf)\r\n\r\n\r\n``` bash\r\n % ./process_logdata_ekf.py ~/Downloads/00b0b048-39bd-45cd-910b-c3d54b0f39ad.ulg \r\nfound estimator_status data\r\nfound ekf2_innovation data\r\nfound sensor_preflight data\r\nlog finishes while in-air at 827.3 sec\r\nUsing test criteria loaded from check_level_dict.csv\r\nTraceback (most recent call last):\r\n  File \"./process_logdata_ekf.py\", line 1407, in <module>\r\n    test_results['filter_fault_status'][0] = 'Fail'\r\nKeyError: 'filter_fault_status'\r\n```\r\n\r\n@santiago @priseborough @bkueng \r\n\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "RTL switch configuration",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7439",
  "body": "I've have a two flights (one after one)\nFirst flight was ok (mission and RTL): http://logs.px4.io/plot_app?log=f0d1fdb4-3c11-4f2a-8dc2-c0ba21947fd2\nBut in the second flight px4 ignore my RTL command: \nhttp://logs.px4.io/plot_app?log=c85d052b-70e7-4a59-98ba-6100d0934abf",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC Autoland tries to go back home while descending",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7426",
  "body": "Log: http://logs.px4.io/plot_app?log=53d0a6de-838a-4c26-b53f-87b6f19b23e5\r\nI'm on master at bc406a1\r\n\r\nSeems that autoland tries to control to an XY local position setpoint of (0,0). ",
  "state": "closed",
  "pull_request": null
}
{
  "title": "PX4 1.6.1: Land detector did not disarm after land in mission VTOL",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7402",
  "body": "Hello,\r\n\r\nWe made a mission without RC control only with the QGC. We used version 3.1.3. Everithing went ok except the land detector did not disarm after the mission was complete and the VTOL was landed. The only way we could disarm with 3.1.3 was emergency stop.\r\n\r\nVTOL left on the ground with spinning motors for some time.\r\n\r\nHere is the log:\r\nhttp://review.px4.io/plot_app?log=971f681b-2e49-4e67-816f-5b3b9c52a817\r\n\r\nAlso in Position or Altitude modes we have the same problem. The land detector probably is working, because when we touch down in one of Alt and Pos Modes the QGC says we have to be either in manual mode or landed in order to disarm.\r\n\r\nI saw it is very easy in QGC 3.2 to disarm. But it is still very nice if in the case of mission and Guided modes after touch down the land detector could at least disarm in 10-20 seconds.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Stuck during mission, if altitude higher than max height",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7309",
  "body": "For a survey I did, the default altitude was higher than the max height and the quad got stuck because it never reached the waypoint.\r\nHere's the [log](http://logs.px4.io/plot_app?log=c828d9ab-c6de-4034-a4ce-9ea5222faf74)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Yaw/thrust saturation and loss of control during flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7288",
  "body": "Hi everyone,\r\n\r\nDuring a position control flight with my VTOL (in MC mode only), I encountered a really strange behavior. After flying perfectly well, the yaw control was suddenly lost and the drone was loosing altitude.\r\n\r\n![esc_response2](https://cloud.githubusercontent.com/assets/14822839/26549616/2bc1ae62-447a-11e7-81eb-4d79c5c93205.png)\r\n\r\nAs you can see, around t=59s, the drone did not respond to the yaw command even if the ESC reported acceleration and deceleration of the motors. After that between t=63s and t=69s, the drone is spinning around it's yaw axis and since it was loosing altitude, the thrust did reach saturation, without any RPM response.\r\n\r\nI'm suspecting a mixer saturation or an ESC issue. \r\n\r\nLink to the complete [log](http://logs.px4.io/plot_app?log=55960095-7efd-4e28-8acc-1854828e75bc).\r\n\r\nFinally, my setup is a PixHawk Pro with Orel 20 ESCs and a mRo GPS.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Inspect v1.6 flight log",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7234",
  "body": "http://logs.px4.io/plot_app?log=727281fb-388a-4b9f-ae96-65bf88ddd1ce",
  "state": "closed",
  "pull_request": null
}
{
  "title": "MC 1.6RC YAW Fault when switch to Loiter during Mission",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7194",
  "body": "Today I wanted to test https://github.com/mavlink/qgroundcontrol/issues/4902 which basically works now. But when switching to Loiter during Mission the Vehicle turned around by about 160degress. Continuing the mission, the YAW Angle stayed like this. I assume this to be a bug in PX4.\r\n\r\nCheck the Log showing YAW Turnaround: http://logs.px4.io/plot_app?log=c0cf8e2d-b2c5-4594-9a09-764ee2210ded#Nav-Yaw-Angle\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "tailsitter drop down",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/7066",
  "body": "http://logs.px4.io/plot_app?log=3afcc56c-5b9d-415c-ab46-43c8fe700b6e\r\nmy tailsitter fell from the air,I adjusted this parameter FW_P_TC to 0.4 and then drop down.I have some questions.\r\n1.What is the relationship between the magnetic field and the thrust?\r\nI understand that thrust should not affect the magnetic field.is it?\r\n2.What is the reason my tailsitter is falling off?\r\n3.How should I adjust the parameters?\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "yaw estimation lost",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/6867",
  "body": "tested in sitl: \r\nrotating in yaw breaks the estimation\r\nhttp://logs.px4.io/plot_app?log=132fcf5f-ab37-4d31-bbd6-d30cd9674b2b\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "UAVCAN ESC don't seem to respond the way they should",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/6796",
  "body": "http://logs.px4.io/plot_app?log=155832f2-b37e-44ae-a81e-fb9c8dd5de02\r\n\r\n![screen shot 2017-03-12 at 21 11 54](https://cloud.githubusercontent.com/assets/5750020/23835588/55e519ec-076a-11e7-8c20-6f393051fda3.png)\r\n\r\nUsing: https://github.com/PX4/Firmware/pull/6795\r\n\r\nThis log shows a VTOL flight where the vehicle lost attitude and height control after the back transition. Observations:\r\n- power consumption of the whole system is very low after the back transition even though the thrust setpoint goes to full\r\n- the feedback from the ESCs suggest they are doing something but also that for example one motor is still turned off\r\n- attitude tracking and performance in general is fine at takeoff and before the front transition\r\n- the UAVCAN ESC status is shifted in time and logged ~2 seconds too early (or the rest too late)",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Takeoff not detected after 2nd time in altitude mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/6651",
  "body": "Hello\r\nWith release v1.6.0rc1 or the current master the takeoff seems not to be detected after the second time arming in altitude mode:\r\nhttp://review.px4.io/plot_app?log=b29f4633-e7c9-49a9-ab92-18106d9f01f9\r\n\r\n```\r\n2017_02_23_09_31_15: [logger] file: /fs/microsd/log/2017-02-23/09_31_1\r\n2017_02_23_09_34_09: ARMED by RC\r\n2017_02_23_09_34_11: Takeoff detected\r\n2017_02_23_09_34_29: Landing detected\r\n2017_02_23_09_34_31: DISARMED by auto disarm on land\r\n2017_02_23_09_34_36: ARMED by RC\r\n2017_02_23_09_34_46: DISARMED by auto disarm on land\r\n```\r\nThe first time arming in altitude, the takeoff and landing is detected fine.\r\nAfter the 2nd time arming, the motors are only spinning with idle thrust for some seconds and the attitude/position controller is not responding to any rc commands or nick/roll movement.\r\nIn case I switch to e.g. stabilized mode and then back to altitude mode again (when the motors are spinning with idle thrust) the takeoff is detected, the motors are spinning up and the attitude/position controller seems to be working again.\r\n\r\n\r\n\r\n\r\n\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "mc_pos_control: hotfix for possible thrust below minimum thrust setting",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/6392",
  "body": "Hotfix after a crash because of a heavily negative desired thrust that got clipped to 0 by the mixer.\r\n0 thrust meant no more attitude tracking.\r\n\r\nFlight log that lead to these changes:\r\nhttp://review.px4.io/plot_app?log=90a3f19b-c8c2-44db-887f-0e6f5488aa84",
  "state": "closed",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/6392",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/6392",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/6392.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/6392.patch",
    "merged_at": "2017-01-19T17:05:59Z"
  }
}
{
  "title": "EKF2 performance poor in gazebo SITL with GPS",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/6388",
  "body": "Here is a 3-way comparison on master of EKF2, IEKF, and LPE for a SITL box mission with varying altitude. EKF2 fails on the first turn even before the climb. I think we might want to add an EKF2 multirotor test mission. I know the original thinking was that it was some server cpu limitation, but I can't get it to work locally either.\r\n\r\nMaybe EKF2 could benefit from some noise tuning for SITL. For IEKF, I used [Allan variance plots](https://github.com/jgoppert/iekf_analysis/blob/master/SITL%20Noise%20Identification.ipynb)  for SITL and a [pixhawk](https://github.com/jgoppert/iekf_analysis/blob/master/Pixhawk%20Noise%20Identification.ipynb) for real life and really got great results. LPE is just using the same gains found manually from  flight testing.\r\n\r\nEKF2: http://logs.px4.io/plot_app?log=bd702929-6e9c-452f-b2b3-398e53c9cfb3\r\n\r\n![image](https://cloud.githubusercontent.com/assets/473772/22097165/a2080984-dded-11e6-9515-ff3ea03303aa.png)\r\n\r\nIEKF: http://logs.px4.io/plot_app?log=6c99fd56-0863-4e24-bf72-6b67adb27392\r\n\r\n![image](https://cloud.githubusercontent.com/assets/473772/22097178/b363f47c-dded-11e6-8531-b1775b9b9f44.png)\r\n\r\nLPE: http://logs.px4.io/plot_app?log=3fbb051c-aeb8-44af-bff3-459c4e771fb1\r\n\r\n![image](https://cloud.githubusercontent.com/assets/473772/22097187/bfcb04bc-dded-11e6-8ab6-16fbadb88216.png)\r\n",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Intel Aero CPU load & timings",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/6037",
  "body": "@lucasdemarchi @lfelipe The normal timing for PX4 is looking like this:\r\n\r\n<img width=\"844\" alt=\"screen shot 2016-12-12 at 17 49 11\" src=\"https://cloud.githubusercontent.com/assets/1208119/21107912/a0c49442-c093-11e6-8f9a-eecb1bbe3ea5.png\">\r\n\r\n\r\nFrom this log:\r\nhttp://review.px4.io/plot_app?log=1253eec0-17f1-4051-b858-dce51b268928\r\n\r\nAero looks quite different:\r\nhttp://logs.px4.io/plot_app?log=a24d89aa-d930-4894-9c6e-65ae449476ba\r\n\r\n<img width=\"844\" alt=\"screen shot 2016-12-12 at 17 54 00\" src=\"https://cloud.githubusercontent.com/assets/1208119/21108056/045efbb4-c094-11e6-8095-217c18f02cc3.png\">\r\n\r\nWe need to work out what is inducing the load and churn on Aero. Its not the logging subsystem but must be something else.",
  "state": "closed",
  "pull_request": null
}
{
  "title": "Offboard acuator setpoints interfere with lockstep in SITL",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/20052",
  "body": "## Describe the bug\r\nWhen enabling actuator setpoints for offboard mode, the simulation progresses in a much slower speed than normal simulations. This seems to be caused by actuator controls published in offboard module interfering with lockstep.\r\n\r\nThis bug was discovered by @MarvinHarms \r\n\r\n## To Reproduce\r\n- Publish `offboard_control_mode` message with actuator controls enabled (internally from PX4)\r\n- Publish `actuator_controls_o` message when in offboard mode\r\n- switch vehicle to offboard mode\r\n\r\n## Expected behavior\r\nLockstep should continue whether or not the vehicle is in offboard mode\r\n\r\n## Log Files and Screenshots\r\n![ezgif com-gif-maker (7)](https://user-images.githubusercontent.com/5248102/184627710-599d08b6-7dd7-4575-87b4-3a20d15122c4.gif)\r\n\r\n- Video: https://youtu.be/Mpve5DSk0qk\r\n- Flight log: https://review.px4.io/plot_app?log=e2dcc255-3b39-40df-ae5b-3576c6185698\r\n\r\n## Additional context\r\n- We are currently implementing an iNDI controller using the offboard interface internally\r\n- Offboard actuator setpoints were added in https://github.com/PX4/PX4-Autopilot/pull/18581 , where lockstep has been disabled for testing until now",
  "state": "open",
  "pull_request": null
}
{
  "title": "offboard land detection",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19560",
  "body": "**Describe problem solved by this pull request**\r\nWe use offboard mode to control our quadrotor.\r\nWe generate a trajectory in z position with consistent derivatives.\r\nWhen we land, our z position increase downward, z speed converge to our target (1m/s downward) and our z acceleration converges to 0 when the speed stabilizes.\r\n\r\nThe issue is that when we hit the ground, land detector detect it but the position control detect that we want to takeoff so thrust increase and it never disarm.\r\n\r\nThe takeoff detection is due to our z acceleration been about 0 but with a very small oscillation that makes point upward  by moments.\r\n\r\nHere is a log with one false detection : https://review.px4.io/plot_app?log=ced2541e-fd20-4fd3-88c6-2f284262bc95\r\n\r\n**Describe your solution**\r\nin offboard mode, if we have a valid z position setpoint superior (so more downward) than estimated, do not consider we want to take off. Same thing on z speed.\r\n\r\nThis solution will change the behavior: in offboard mode, if we have a valid z position setpoint more downward than estimated and a speed setpoint pointing upward, we will no longer consider we want to take off.",
  "state": "open",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/19560",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19560",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/19560.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/19560.patch",
    "merged_at": null
  }
}
{
  "title": "mc_pos_control: filter velocity before derivative and switch to AlphaFilter",
  "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19505",
  "body": "Investigating the root cause of small oscillations in multicopter position control modes. One possibility is the noisy velocity derivative.\r\n\r\nhttps://logs.px4.io/plot_app?log=e807f10a-f1d4-4527-b59f-9a4da6ff770e\r\n\r\n![Screenshot from 2022-04-19 12-31-30](https://user-images.githubusercontent.com/84712/164066526-c6b79e50-c60f-49aa-8564-5c310c3cc067.png)\r\n\r\n\r\nI believe this is coming from the acceleration (velocity derivative) used by the multicopter position controller when `MPC_XY_VEL_D_ACC` is non-zero.\r\n![Screenshot from 2022-04-19 14-04-14](https://user-images.githubusercontent.com/84712/164067478-5e618b57-542e-4311-88b2-a50da9474f00.png)\r\n![Screenshot from 2022-04-19 14-09-30](https://user-images.githubusercontent.com/84712/164068328-c18ccf45-3fd0-4d30-a27b-d277d64420b5.png)\r\n\r\n",
  "state": "open",
  "pull_request": {
    "url": "https://api.github.com/repos/PX4/PX4-Autopilot/pulls/19505",
    "html_url": "https://github.com/PX4/PX4-Autopilot/pull/19505",
    "diff_url": "https://github.com/PX4/PX4-Autopilot/pull/19505.diff",
    "patch_url": "https://github.com/PX4/PX4-Autopilot/pull/19505.patch",
    "merged_at": null
  }
}
{
  "title": "RC override not responding ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19292",
  "body": "Moving the RC sticks did not switch immediately from Mission mode or RTL mode to position as intended.\r\n\r\nhttps://logs.px4.io/plot_app?log=b9851ab5-ed9a-4186-8100-0d412f0fa78b\r\n\r\n![mission2position](https://user-images.githubusercontent.com/14898374/157092736-832fb5bb-9a29-49fe-8084-6242ec1226ee.png)\r\n![mission2position_2](https://user-images.githubusercontent.com/14898374/157092813-c7884dad-7c24-4c4b-83c3-125a695b58f5.png)\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Sending MAV_CMD_NAV_TAKEOFF while flying in other flight modes pushes the drone towards vec = (1, 1, 0)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/19268",
  "body": "**Describe the bug**\r\nWhen the drone is flying in MANUAL / ALTCTL / POSCTL / ACRO (and probably more?) mode and receives a MAV_CMD_NAV_TAKEOFF message (to set mode to TAKEOFF), it flies towards (x, y, z) = (1, 1, 0) direction.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n[terminal 1] make px4_sitl_rtps gazebo -j4\r\n[terminal 2] Download and run the [PoC](https://gist.github.com/squizz617/f1cb009d7e4ff730492a6b9243bedf6a)\r\n\r\n**Expected behavior**\r\nAs described in the [documentation](https://docs.px4.io/master/en/flight_modes/takeoff.html), the drone should get to the target altitude and hold. No movement in the X and Y direction is expected.\r\n\r\n**Log Files and Screenshots**\r\n- Flight review: https://logs.px4.io/plot_app?log=a0ec7e87-0bb5-44bd-8397-5af27a1d9882\r\n\r\n**Drone (please complete the following information):**\r\n- Build: `px4_sitl_rtps`\r\n- tested commit: `a2645418`\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Catapult launch: Motor delay not working ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18416",
  "body": "Hi I need to open this ticket again. Initial ticket was: 18354 (it was closed. I can^t change it back via the Web GUI)\r\n\r\nPX4 (SW 1.12.3 / HW holibro pixhawk 4)â€¨The Motor starts immedialtely after launch is detected.â€¨This causes damage to the propeller, because it hits the catapult.â€¨Actual behaviour:â€¨If Accelerometer threshold > LAUN_CAT_A then Motor starts immediatelyâ€¨Expected behaviour:â€¨If Accelerometer threshold > LAUN_CAT_A then Motorstart is delayed by value of LAUN_CATMDEL waits then motors starts.\r\nParameters: LAUN_CAT_MDEL and LAUN_CAT_T have no effect. Motor startup is not delayed as expected.\r\n\r\nThe log is made with Master\r\nhttps://review.px4.io/plot_app?log=06b779a9-95b5-4413-a82f-d4f5734ed81d\r\nâ€¨It was working in 1.9.1\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Takeoff close to Geofence causes drone to fly away uncontrollably",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18297",
  "body": "**Describe the bug**\r\nDrone flies perpendicular to geofence on takeoff close to geofence. The drone places a setpoint ~7 m away from launch point and tries to reach it aggressively.  This is very dangerous behavior which can and has caused crashes in the past.\r\n\r\nToday we went out with another drone (different flight controller and hardware) to try to trigger the same behavior and managed to do so immediately. We did two flights to ensure repeatability.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Place drone close to but not outside of geofence border.\r\n2. Enter takeoff mode. \r\n\r\n\r\n**Expected behavior**\r\nTakeoff to set altitude.\r\n\r\n**Log Files and Screenshots**\r\n[First flight](https://review.px4.io/plot_app?log=3d188929-9d67-4ff6-8a6f-eff40df8d200)\r\n[Second flight](https://review.px4.io/plot_app?log=5f430551-e48f-4486-ae38-35db4489b12d)\r\n\r\n\r\n**Drone (please complete the following information):**\r\n- FW Version 1.12.0\r\n- Holybro S500\r\n- Pixhawk 4 FC\r\n- CUAV H16 radio module\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Strange behavior of FW pitch rate PID after transition 1.11.3 -> 1.12.1",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18192",
  "body": "After upgrading from 1.11.3 to 1.12.1 our drone (VTOL, tailsitter) became unstable. As we understand now that the main problem was in gyro filters. Somehow during to transition IMU_DGYRO_CUTOFF became equal to 0. (it is perhaps some minor bug in the transition between versions). However, it seems that it is not the only problem. \r\nDuring the experiments we found that FW pitch_rate controller with PR_FW_FF = 0 and PR_FF_I = 0 is not equal to its proportional gain. See, for example, the LOG https://logs.px4.io/plot_app?log=d0fd29dc-a149-4233-90a7-5663924d443a\r\n\r\nThe difference between controller results and proportional gain is similar (but not equal) to -0.2*(pitch rate setpoint). On the plot attached red curve is the difference between actual result of controller and calculated proportional gain. Black is pitch rate setpoint (times -0.2). \r\n\r\nIs it a bug? Or if it is something intentional than what is added to FW control besides usual FF, P and I components? How can we control (and understand) this addition? It seems that even with filters corrected (and the PID parameters re-tuned due to the difference in airspeed scaler between 1.11.3 and 1.12.1) our VTOL is still less stable than it was in 1.11.3.\r\n(The situation is the same in 1.12.1 and 1.12.2)\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Airspeed spikes cause FW to lose altitude",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/18039",
  "body": "@sfuhrer @RomanBapst porting the [slack conversation](https://px4.slack.com/archives/C0W2KUFFT/p1626796170295800) here.\r\n\r\n**Describe the bug**\r\nSometimes, out of nowhere the `tecs_status.airspeed_filtered` message shows a huge spike that is enough to mess up the whole TECS algorithm. The drone loses a lot of altitude really fast. So far this has only been observed in SITL, and only rare occasions during relatively long flights.\r\n\r\n**To Reproduce**\r\nI was unable to reproduce it reliably. On the occurrences where it happened, it was with SITL gazebo_standard_vtol on long distance missions (>30km). Restarting the simulator and running the exact same mission works most of the time (until you hit the bug again). It would be a good idea to increase the logging speed of all airspeed related topics.\r\n\r\n**Expected behavior**\r\nThis should not happen.\r\n\r\n**Log Files and Screenshots**\r\nFirst occurrence: https://logs.px4.io/plot_app?log=4b21aeea-5784-46b6-8e42-964fecc7c20a\r\n![image(2)](https://user-images.githubusercontent.com/48206725/128736463-2eddc542-4eb0-4538-a7b6-83964c68ae26.png)\r\n\r\nSecond occurrence: https://logs.px4.io/plot_app?log=5acff421-3ff4-4bf2-bd5d-bb4a7222f241\r\n![image(3)](https://user-images.githubusercontent.com/48206725/128736474-71a00d4f-4cf5-4002-844e-02479e4aba58.png)\r\n\r\nOn the first occurrence, only the TECS TAS topic showed the spike, making it difficult to tell where it originated. On the second occurrence, it is also logged on the airspeed validator, but still not on the initial airspeed topic. So the source of the issue is either inside the airspeed validator module or with the (simulated) airspeed sensor.\r\n\r\n**Drone (please complete the following information):**\r\n- SITL, Gazebo Standard VTOL\r\n- v1.11 based\r\n\r\n**Potential Solutions**\r\n- find the source of the airspeed spike and eliminate it. Either in the airspeed validator (@sfuhrer) or in the simulated airspeed sensor (@Jaeyoung-Lim, maybe you would have an idea?)\r\n- As @RomanBapst proposed in the slack conversation, change the filter that is applied to the airspeed in TECS so that a single spike doesn't have that much influence. Could also help in further reducing noise coming from the airspeed sensor. Examples could be a median filter or similar types (LULU)\r\n\r\nI think changing the filter is something that would be worth doing anyway, to protect against an erroneous signal on a real airspeed sensor\r\n\r\n\r\n**Additional context**\r\nCopy of the slack thread so that it doesn't get lost in the future: Thomas Stauber  20 days ago\r\nWe've just observed a very weird behaviour in a simulation which I'm not sure if it's SITL related or if it could happen on a real flight - if it could it'd be pretty bad with a fixed-wing hitting the ground like a missile. (SITL running an v1.11-based branch)\r\nBasically the simulated VTOL was flying nicely in FW for a good amount of time when suddenly the tecs_status.airspeed_filtered message diverged to 2e8 m/s, causing the drone to cut throttle. Then tecs_status.airspeed_filtered became a constant 3 (no decimals), triggering first TECS_MODE_BAD_DESCENT  and then a few seconds later TECS_MODE_UNDERSPEED . The drone pitched down with almost full thrust and triggered an adaptive quadchute for loss of altitude.\r\nI really don't understand where the 2e8 m/s spike and the constant 3 m/s of airspeed_filtered comes from.\r\nAlso, the RTL that followed the quadchute was not working correctly for the first ca 30s where the drone kept losing altitude instead of climbing at desired RTL altitude.\r\nLog: https://logs.px4.io/plot_app?log=4b21aeea-5784-46b6-8e42-964fecc7c20a (flight review seems down, I hope I copied the correct link)\r\nThis file canâ€™t be shown because your workspace has passed the free planâ€™s 5 GB storage limit. See paid plans\r\n\r\nLorenz Meier  20 days ago\r\nSilvan Fuhrer Could you comment on that?\r\n\r\nRoman Bapst  19 days ago\r\nSilvan Fuhrer Let's check that one. Actually I'm thinking we should probably add a median filter to airspeed data somewhere. A spike with that magnitude can easily cause the complementary filter in TECS to fill up to an insane value within only one iteration.\r\n:+1:\r\n1\r\n\r\n\r\nSilvan Fuhrer  17 days ago\r\nWell the airspeed data isn't the issue here. Must be something numerical related to the accel data? local_position/az jumps at the same time as tecs_status/airspeed_filtered.\r\nI'd say we somehow limit the effect that accel data can have on airspeed_filtered, and trust more the airspeed data (whose validity we check with the airspeed validator)\r\nThis file canâ€™t be shown because your workspace has passed the free planâ€™s 5 GB storage limit. See paid plans\r\n\r\nThomas Stauber  17 days ago\r\nAre you sure the accel is at fault? I don't see anything of similar magnitude there. And I'd be surprised if such a small change in acceleration completely messed up the airspeed_filtered topic. (tbh I'm already a bit surprised it's used at all - I had always assumed it was some sort of averaging or lowpass filter. I never actually checked though) I rather think the -1.7m/sÂ² on local_position.ax are caused by cutting the throttle from 31% (cruise) to 0%.\r\n\r\nSilvan Fuhrer  17 days ago\r\nOkay well no, I can't be sure if it's not on the airspeed front.\r\nBTW, the 3m/s after the spike are due to 3 being the min airspeed defined in TECS. That means it dropped below that. https://github.com/PX4/PX4-Autopilot/blob/af50e25647aa5c2051bb09378bc9b2aaaaeb2a07/src/lib/tecs/TECS.cpp#L150\r\n\r\nThomas Stauber  17 days ago\r\nOk, already good to know where the 3 comes from. (Still not good that it's there haha). I guess it was below that because of how the filter works (https://github.com/PX4/PX4-Autopilot/blob/af50e25647aa5c2051bb09378bc9b2aaaaeb2a07/src/lib/tecs/TECS.cpp#L146). As _tas_state exploded, subsequently _tas_innov was heavily negative, and therefore also tas_state_input .\r\nApart from initialisation the only place there _tas_state gets updated is L147, so if we can track down all occurrences of the terms of that equation (respectively of the line above), we should be able to get an idea where it could have come from. I assume if the dt was the problem we'd have other problems too, so remaining are _tas_rate_state , _tas_rate_raw , _tas_innov and _tas_estimate_freq . _tas_estimate_freq  is pretty safe to exclude, leaving us with _tas_rate_state , _tas_rate_raw and _tas_innov .\r\n_tas_rate_state : can only be fucked up if _tas_innov (or _tas_estimate_freq or dt)is fucked up.\r\n_tas_rate_raw : that would indeed be the body_acceleration. Nothing logged, but maybe it was too short a spike ?\r\n_tas_innov : either _EAS or EAS2TAS is wrong. EAS2TAS is constrained between 0.9 and 2.0, so not possible. _EAS is the airspeed_validated.calibrated_airspeed_m_s  topic. Same as for _tas_rate_raw there is no logged spike.\r\nI hope I didn't miss any occurrences in my analysis. So it looks like it's either the body_acceleration or the airspeed measurement that went wild for a short spike (or something else broke completely during execution and caused some memory spill / overflow or other very unlikely erroneous behaviour, which I think we can almost certainly exclude as the rest was still working properly)\r\n\r\nThomas Stauber  17 days ago\r\nMaybe moving to another filter that wouldn't be so affected by any spike would really make sense as Roman Bapst mentioned above.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Navigation Errors during FW Flight",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17635",
  "body": "Pixhawk 4\r\n1.11.3 - Fixed Wing\r\n\r\nAfter some debate on this I decided to open an issue.\r\n\r\nNavigation between waypoints is not consistent and does not follow the expected direction (more detail below). The direction is circuitous.\r\n\r\n\r\n\r\nIn the first log, it was clear there was some mag interference (this was seen on the ground prior to takeoff - approximately 10 degrees could not be corrected even after multiple calibrations) but the issue was that the trajectory from one waypoint to the next does not make sense (in parts of the flight). Instead of going from one point to the next, there are large turns between them.\r\n\r\nI questioned if this was due to an insufficient SD card speed for reading the mission. Testing the SD card speed in QGC gave an average speed of 63kb/s (much too slow but this was only changed after these flights) and there are logging dropouts at some of the points in the log. Right around 22 min where the location looks to be sideways, it was not. In the telemetry replay it does a coordinated turn. This turn at least makes sense, that is the direction is was supposed to go. That changes though later in the same flight.\r\n\r\nAt 22:46 it looks like the aircraft starts to circle down. Maybe to hit the altitude set-point but that does not make too much sense seems it looks like it doesnt actually miss it. After it does circle down though it then just decides to go left (no errors still) and then circle around again. Mag issue? There is no reason for a turn to be in that direction though. The question becomes is if this is mag related and or SD card read access speed and mission related.\r\n\r\nLog 1 - \r\nhttps://review.px4.io/plot_app?log=72ac3453-0872-447d-8716-3fcca37c1e9e\r\n\r\n\r\n\r\n\r\n\r\n\r\nThe below log had a new mag installed and there weren't any offsets observed or mag ratios, etc but at 13:17 instead of turning left, the aircraft made a roll to the right before banking to the left to turn. Additionally, it went directly through the waypoint before turning instead of starting at the L1 distance and making the typical rounded turn. From 13:18-13:25 the log looks like the aircraft is going to the wrong direction but there is also a log dropout there, in the telemetry log the orientation and direction looks correct in terms of how the aircraft flew but not why it still turned so late and went right then left. \r\n\r\n\r\nLog 2-\r\nhttps://review.px4.io/plot_app?log=1e2b37e4-b557-45d3-9f73-6fb099bf0fa4",
  "state": "open",
  "pull_request": null
}
{
  "title": "Warnings during VTOL transitions",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17474",
  "body": "**Current behavior**\r\nIn offboard, calling a VTOL transition ends up with PX4 [[FlightModeManager]](https://github.com/PX4/PX4-Autopilot/blob/d62204856cf0711af9ca82a399aac529783c412b/src/modules/flight_mode_manager/FlightModeManager.cpp#L179) running the fligh task `[FlightTaskTransition]`. This flight task [sets the position setpoints](https://github.com/PX4/PX4-Autopilot/blob/d62204856cf0711af9ca82a399aac529783c412b/src/modules/flight_mode_manager/tasks/Transition/FlightTaskTransition.cpp#L57) to `NAN`.\r\n \r\nAs the control mode remains in offboard (`_control_mode.flag_control_offboard_enabled` is true),\r\n`[fw_pos_control_l1]` [expects a finite position setpoint](https://github.com/PX4/PX4-Autopilot/blob/d62204856cf0711af9ca82a399aac529783c412b/src/modules/fw_pos_control_l1/FixedwingPositionControl.cpp#L1704), which is not the case during transitions due to the previous flight task overwriting the setpoint.\r\n\r\nBecause the setpoint is not finite, the following warning is sent:\r\n`[fw_pos_control_l1] Invalid offboard setpoint. `\r\n\r\nHowever everything works fine as roll and pitch setpoints are override (standard vtol) during transitions.\r\n\r\n**Expected behavior**\r\nNo warning during transitions.\r\n\r\n**Possible solution?**\r\nA quick and dirty solution could be to mute the warning during a transition, either by looking at the current flight task or by checking the vehicle status. We may overlook important warnings in some corner cases though...\r\nA cleaner alternative may require an important change in the logic during transitions. \r\n\r\n**Log review**\r\n[Log review](https://logs.px4.io/plot_app?log=1f88d1db-87e1-41db-9e8b-e90b4237c385) of an offboard VTOL flight with multiple transition. ",
  "state": "open",
  "pull_request": null
}
{
  "title": "MC idle PWM automatically changes to 1000ms",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17423",
  "body": "It normally arms in MC mode properly and sets pwm to 1100 while idle as set in VT_IDLE_PWM_MC.  But sometimes arms and pwm motor signals stay at 1000ms, thus motors remain stopped. If throttle is increased It responds but ESCs turn off if the signal returns to 1000ms and you get erratic behaviour from motors.\r\n\r\nTo Reproduce, not easily reproducible...\r\n-Arm MC everithing OK\r\n-Disarm\r\n-Let the drone disarmed for a while (10min aprox)\r\n-Arm, it arms but motors do not spin at iddle.\r\n\r\nExpected behavior\r\nThis should not happen.\r\n\r\nLog Files and Screenshots\r\n[FlightLog](https://logs.px4.io/plot_app?log=eef8b1e5-baa1-4bd3-84fc-0ba256c10845)\r\n[FlightLog2](https://logs.px4.io/plot_app?log=be927c5d-c264-47b2-b3c1-094bad17fabc)\r\n\r\nDrone:\r\nFirmware: 1.11.0 Master\r\nAirframe: Tailsitter\r\nAutopilot: Cube black\r\n\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Tailsitter transitions in manual mode bug",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17422",
  "body": "\r\nThere is a problem with the FW mode after a transition from MC in manual mode.\r\nMotor outputs do not match each other (they should in FW) elevons also do not behave properly, they have an offset. If the transition to FW  is done in any other mode (stabiliize included) and then switching to manual everithing is ok.\r\n\r\n\r\n**To Reproduce**\r\n-Arm MC in manual\r\n-Switch to FW flight\r\n\r\n**Expected behavior**\r\nMotor outputs should match each other once the transition is completed.\r\n\r\n**Log Files and Screenshots**\r\n[FlightLog](https://logs.px4.io/plot_app?log=7cb28ce8-e7c6-477c-9a7b-591ba2418a25)\r\n\r\n**Drone:**\r\nFirmware: 1.11.0 Master\r\nAirframe: Tailsitter\r\nAutopilot: Cube black\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "RTL_FLT_TIME unclear and potential division by zero",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/17007",
  "body": "Log: https://logs.px4.io/plot_app?log=2c9c93ec-1b0a-49f7-beeb-ce98f10700d9\r\n\r\nBattery alert was issued at 37% capacity remaining, BAT_LOW_THR was set to 20%\r\n\r\nOther tests show that battery failsafe RTL actually kicks in around 32% while 15% was set\r\n\r\nbattery_status.warning was never above 0 indicating the battery failsafe was not issued by the battery sensor code.\r\n\r\n@dagar @julianoes @RomanBapst ",
  "state": "open",
  "pull_request": null
}
{
  "title": "SITL integration test arming failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16817",
  "body": "I've seen the case where arming is temporarily rejected and tone_alarm negative is printed but there is no information why it failed.\r\n\r\nThis happened in https://github.com/PX4/PX4-Autopilot/runs/1871257740 and the log file is https://logs.px4.io/plot_app?log=fb423508-e871-491f-a54d-9c12ca5cf55b.\r\n\r\nI have not found a path yet through the preflight checks and arming logic that would give this result but not print a reason...",
  "state": "open",
  "pull_request": null
}
{
  "title": "pitch setpoint drops just after the back-transition ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16483",
  "body": "**Describe the bug**\r\n\r\nthere's a sudden drop in the pitch setpoint just after the back transition of the standard vtol in the master. i think the initial setpoint after the back transition is set to zero  just after the back-transition, i just looked at the value of _v_att_sp.pitch_body in the vtol_att_control_main.cpp file in case mode:ROTARY_WING\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nyou can load this plan and reproduce the same with standard_vtol\r\n[plan.zip](https://github.com/PX4/PX4-Autopilot/files/5765173/plan.zip)\r\n\r\n**Expected behavior**\r\npitch setpoint should not drop immediately just after the transition, it should come down gradually.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=19538338-d46f-4c67-a3ca-11e7d1566eb9\r\n\r\nAdd screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/25317204/103545932-4734cb00-4ec8-11eb-930a-e547bc36c476.png)\r\n\r\n**Additional context**\r\nI think when changing from the flight_mode it zeros the pitch setpoint on full rotary_wing mode.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "undesirable back-transition behavior.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16474",
  "body": "when using just the vtol-transition mission item in qgc, or flipping the switch from fw to mc mode stabilized mode, the curved path gets executed with a rolling behavior in the back transition\r\n\r\nthis is solved in the pr-vtol-rtl-fixes when using vtol transition and land mode, but however it still persists on the above mentioned conditions as the l1 controller is present in those two conditions in the back-transition.\r\n\r\n**Alternate Solution**\r\nhttps://github.com/PX4/PX4-Autopilot/blob/d502292d0731a38c513dc1224c135b6f1965586e/src/modules/vtol_att_control/standard.cpp#L283\r\nin the current master, _fw_virtual_att_sp->roll_body diverges from zero after some time in the back-transition, can we make it a hard zero as we don't want the aircraft to roll in the back-transition anyway?\r\n\r\n**To Reproduce**\r\nto reproduce, in a mission set a vtol-transition mission item at the end of the mission. the behavior can be observed.\r\n\r\n\r\n**Expected behavior**\r\nThe vtol should transition to mc_mode in a straight line without going in a curved path with a roll.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=1e1bb5d2-5260-40da-bd7e-46fadf55fc6c\r\n\r\n**Additional context**\r\ni think this addresses the same issue\r\nhttps://github.com/PX4/PX4-Autopilot/issues/14933\r\n\r\nhttps://github.com/PX4/PX4-Autopilot/pull/14405/files\r\nthis introduced l1 controller to be present in the back transition which is good, but i think it needs to be further analyzed, cause this causes the aircraft roll in the back transition, which is not desirable. \r\n ",
  "state": "open",
  "pull_request": null
}
{
  "title": "VTOL standard flight to review",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16427",
  "body": "\r\n![Screenshot from 2020-12-18 13-34-46](https://user-images.githubusercontent.com/84712/102648630-d5255d80-4135-11eb-91be-57a1276bbcb2.png)\r\n\r\n\r\n\r\nhttps://review.px4.io/plot_app?log=4240e1a9-5f40-4e5b-be73-812f59a072e3\r\n\r\nhttps://px4.slack.com/archives/C39C4E709/p1608315970050900",
  "state": "open",
  "pull_request": null
}
{
  "title": "Fail to shutdown PX4 in SITL mode with Airsim",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16253",
  "body": "**Describe the bug**\r\nPX4 in SITL mode with Aisim and QGC on Windows 10 will stay running after sending command \"shutdown\" by pxh>, except the console print out \"Exiting NOW.\" and hang(never return to console prompt itself). \r\n\r\nThe px4 process will keep running until you explicitly terminate it(you can not do it with ctrl+c, had to kill it through Windows Task Manager). And I let it running at least half an hour before i kill it, and it showing no stopping sign. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Build PX4(commit: 615333badb289aa77285bcfad071cc6a70b13632)\r\n2. Build Airsim(commit: 659a7dbb93269fba8af31debf6f09f15c3fbc15c)\r\n3. Build and run QGC(commit: 13dd7a50d15808750fa35a1a52900d2c5a7f40f3)\r\n4. Run Airsim with Block environment.\r\n5. Run PX4 with command \"make px4_sitl none_iris\"\r\n6. Use QGC to takeoff the drone, and let keep orbiting a circle.\r\n7. IGNORE any warning appeared, like \"WARN  [ekf2] primary EKF changed 5 (unhealthy) -> 1\" \r\n8. IMPORTANT: Let it run for at least an hour.\r\n9. Then type \"shutdown\" command in pxh console, it will print \"Exiting NOW.\"\r\n10. And you will observing that the px4 are stilling running, and console got stuck on. \r\n\r\n**Expected behavior**\r\nAfter typing \"shutdown\" in pxh console, px4 will exit with console return to its normal prompt.\r\n\r\n**Log Files**\r\nI don't think [PX4 Flight Log File](https://logs.px4.io/plot_app?log=ba482670-d38f-4962-ab2b-5a9bf919baae)  related to this shutdown issue, but provided as well. \r\n\r\n**Screenshots**\r\nConsole hang and px4 still running:\r\n<img width=\"1149\" alt=\"Screen Shot 2020-11-22 at 10 14 27\" src=\"https://user-images.githubusercontent.com/5885946/99897641-16ad1f00-2cd6-11eb-81f6-4456716a73f7.png\">\r\n\r\nThreads:\r\n<img width=\"737\" alt=\"Screen Shot 2020-11-22 at 11 05 52\" src=\"https://user-images.githubusercontent.com/5885946/99897673-7b687980-2cd6-11eb-9700-30340b04aebf.png\">\r\n\r\nStack trace to 6480(a thread still running with 12%+ CPU)\r\n<img width=\"435\" alt=\"Screen Shot 2020-11-22 at 10 16 13\" src=\"https://user-images.githubusercontent.com/5885946/99897652-4cea9e80-2cd6-11eb-839f-6f01d36e82ea.png\">\r\n\r\nAnd i even take of dump of the PX4 process:(it take up to 2GB so not uploaded)\r\n<img width=\"1174\" alt=\"Screen Shot 2020-11-22 at 12 19 37\" src=\"https://user-images.githubusercontent.com/5885946/99897692-b1a5f900-2cd6-11eb-9e26-0b47a34a9361.png\">\r\n\r\n**Additional context**\r\n- Windows 10 x64, 1607, 14393.4046\r\n- PX4.Windows.Cygwin.Toolchain 0.9\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "PX4 v1.11.2 alt-hold flight problem with full pitch",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16246",
  "body": "**Describe the bug**\r\nFull pitch forwards on a flight in alt-hold mode creates weird flapping motion.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Connect Pixhawk 4 hardware to your PC over serial port.\r\n2. Ensure it has firmware version 1.11.2 installed.\r\n3. Run [this Windows Binary of latest AirSim](http://lovettsoftware.com/downloads/Airsim/AirsimNHTest.zip) bits (or build latest bits yourself).\r\n4. Now fly with ALT-HOLD mode turned on with full pitch forwards\r\n\r\n**Expected behavior**\r\nShould fly smoothly.\r\n\r\n**Log Files and Screenshots**\r\n*Always* provide a link to the flight log file:\r\n- https://logs.px4.io/plot_app?log=96127077-1bb0-4a6c-ae72-84d92efb1a31\r\n- See [demo video](http://lovettsoftware.com/bugs/px4_alt_hold_bug.mp4)\r\n\r\nAdd screenshots to help explain your problem.\r\n\r\n**Drone (please complete the following information):**\r\n- HITL quadrocopter X\r\n- [Pixhawk 4 from Holybro](https://shop.holybro.com/pixhawk-4beta-launch_p1089.html)\r\n\r\n**Additional context**\r\nThis did not happen with v1.9.2 of the firmware on the same hardware.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "v1.11 possible mag issues (Here2)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/16035",
  "body": "\r\n![Screenshot from 2020-10-22 11-18-04](https://user-images.githubusercontent.com/84712/96893046-4a3b2600-1458-11eb-8433-25eb73b037e9.png)\r\n\r\n\r\n\r\n - https://logs.px4.io/plot_app?log=e8f16d70-23a8-448d-8f2a-a9fa06a40892\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "[VTOL] Broken Weathervane & broken MPC_YAW_MODE",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15673",
  "body": "**Describe the bug**\r\nThe weather vane does not work anymore in Mission (MC mode). Neither does MPC_YAW_MODE have an effect on the heading. So the drone ends up flying in all directions with the same heading, which is ugly to watch and can be dangerous in high winds. \r\n\r\n**To Reproduce**\r\n\r\nTested in SITL on v1.11.0:\r\n1. Launch Gazebo with `make px4_sitl gazebo_standard_vtol__windy` (by default 4m/s wind from South to North)\r\n2. Execute some mission which contains navigation in MC mode (e.g. [Dummy_MC_loop.zip](https://github.com/PX4/Firmware/files/5162328/Dummy_MC_loop.zip))\r\n3. Observe the heading.\r\n\r\n\r\n\r\n**Expected behavior**\r\nAs stated in the docs (https://docs.px4.io/master/en/config_vtol/vtol_weathervane.html#mission-mode-behaviour). The drone should head into the wind. Also, MPC_YAW_MODE should behave as for a normal MC. I'm open to discussion whether the weather vane should have precedence over the heading calculations of MPC_YAW_MODE or not or if both should be active at the same time and you end up with a compromise. But certainly not changing the heading at all is not good.\r\n\r\n**Log Files and Screenshots**\r\n https://logs.px4.io/plot_app?log=41546a93-eaeb-45c8-af75-fcfd2af6b967 : always heading east, neither weathervaning nor heading towards waypoint.\r\n\r\nhttps://review.px4.io/plot_app?log=5cd8b35e-390b-476c-85fb-30ac2fd3ff42 : high winds on a custom branch with minor modifications from v1.11-beta. The drone gets carried away because it can't fight the wind in its bad orientation. --> dangerous situation.\r\n\r\n\r\n**Drone (please complete the following information):**\r\ngazebo_standard_vtol\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Pixhawk 4 + Drotek Sirius RTK GNSS compasses inconsistent",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15312",
  "body": "**Drone**\r\nS500 with Pixhawk 4 and Drotek Sirius RTK GNSS (with RM3100 magnetometer).\r\nPixhawk 4 with rotation_roll 180\r\nGPS no rotation\r\n\r\nInstalled master firmware to Pixhawk 4, the vehicle couldn't arm due to compasses inconsistent pre-arm check error, this error is not cleared even after compass calibration. Pixhawk 4 and GPS (with external compass) are facing forward, but the error says they are inconsistent. Installed previous commits until I found the issue was introduced by commit e819f99, before this commit I'm not getting this error.\r\n\r\nCompass calibration can be performed without issue, but this will not clear the pre-arm error.\r\n\r\nCompass calibration was performed outdoors and indoors with the same result.\r\n\r\nChecked with the GPS (with compass) included with Pixhawk 4 and is working, so this is issue is with the Drotek Sirius RTK GNSS device. \r\n\r\n**To Reproduce**\r\n1. Use Pixhawk 4 + Drotek Sirius RTK GNNS\r\n2. Install commit  e819f99 or a newer commit.\r\n3. Try to arm\r\n4. See compasses inconsistent error\r\n5. Calibrate compass\r\n6. Try to arm\r\n7. See error\r\n\r\n**Expected behavior**\r\nVehicle should be able to arm since compasses are facing same orientation.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=8e97f377-2aff-4c9a-8306-a9f13b43df1c\r\n\r\n![aec1b92_ng](https://user-images.githubusercontent.com/37613459/87255296-646b6e00-c43e-11ea-90b7-b8b367243d07.PNG)\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "V1.11.0 (Beta&Master) MC control doesnÂ´t switch off in FW (tiltrotor-vtol)",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15155",
  "body": "all mc mot control remains active (VT_FW_MOT_OFFID doesnÂ´t apply) even the nacelles are full swivelled to FW (differental thrust is only added in FW)\r\n\r\nIt can be testet on the ground with Convergence Vtol: \r\narm -> apply a bit throttle -> switch to FW -> nacelles swivel in 2 steps fully forward to FW -> Mot 3 continues running -> all 3 Mot are still under MC control if you apply roll/pitch commands\r\n\r\nfully to FW ->In this case Mot 3 should turn off and Mot 1,2 now should only be controlled by differential thrust \r\n\r\nhttps://review.px4.io/plot_app?log=dcd387e6-8402-4b7b-b53c-14096527066f\r\n\r\nConvergence with Pixracer R14 \r\nMade a real flight and thought, I could remove the problem with my external mixers ... but unfortunately this ended in a crash. \r\nhttps://review.px4.io/plot_app?log=379ea7f6-38e4-40ed-829b-6e333d91b053",
  "state": "open",
  "pull_request": null
}
{
  "title": "Altitude Losses and Gains: Possible Barometer Issues",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15096",
  "body": "**Description:**\r\nPX4 struggles to hold altitude using the barometer in both the AltHold and PosHold flight modes. Cross-breezes result in altitude gains/losses. Maneuvers result in altitude loss. Typically, the more rapid the maneuver the larger the altitude loss.\r\n\r\n**To Reproduce:**\r\n\r\n_Method 1_\r\n1. Drone switched into position hold and armed after a 3D-lock is obtained.\r\n2. Take off to an altitude far beyond the ground-effect zone.\r\n3. Pick an axis to evaluate (eg. positive x-axis)\r\n4. Perform a full-stick maneuver along that axis until max horizontal speed is achieved.\r\n5. Release the sticks\r\n6. Altitude is lost near the end of the position change and during the braking maneuver. For these maneuvers the altitude returns to the set-point after 2-5sec (far too long).\r\n[Maneuver Altitude Loss]( https://review.px4.io/plot_app?log=4972dc44-0636-4abc-a065-dbc4c23d32f5)\r\n\r\n_Method 2_\r\n1. Drone switched into position hold and armed after a 3D-lock is obtained.\r\n2. Take off to an altitude far beyond the ground-effect zone.\r\n3. Release sticks (no RC input). \r\n4. Wait for a cross-breeze\r\n5. Altitude raises or lowers (multiple meters). During these tests the drone very slowly (10-25sec), if ever, returns to the setpoint. \r\n[Wind Altitude Gain/Loss](https://review.px4.io/plot_app?log=511f8756-384c-4a3d-b214-4f9a8f401b58)\r\n\r\n**Expected Behavior:**\r\nIn AltHold and in PosHold, if the z-setpoint is not changed, the craft will not change altitude.   \r\n\r\n**Screenshots:**\r\n_Method 1_\r\n![Forward Dip](https://user-images.githubusercontent.com/66424788/84535991-eb4fee00-acba-11ea-9d09-45d2a5344f4c.png)\r\nCaption: Note the bulge in the barometer altitude coupled with the decrease in thrust both of which result in a dip during and after maneuvers.\r\n\r\n_Method 2_\r\n![Wind Altitude Gain](https://user-images.githubusercontent.com/66424788/84535994-ebe88480-acba-11ea-8888-dcaf1bbf9951.png)\r\nCaption: Note the three bulges in velocity and the area between the actual and desired curves. NO RC commands or values were given between 2:40 and the 3:25 time-stamps. After 3:25, the drone started to gain many meters of altitude at which point a downward RC command is given. Even though almost full-stick down is commanded, the copter continued to rise until the breeze (2-5mph) settled. \r\n\r\n**Craft Specifications:**\r\nThe craft itself runs 18x5.5in props on a 900mm frame and uses a Holybro Pixhawk 4 running PX4. The craft is rather heavy but well within the motors and batteries specifications for thrust and power available/required respectively.\r\nFirmware version v1.10.1 was used for all initial testing. Firmware version v1.11.0-beta2was used to connect external barometers through the I2C port (ex. for BMP388) because this is not provisioned for in v1.10.1.\r\nThese same performance issues are also present and reproducible on a much lighter craft (15x5.5 props, 750mm frame, Pixhawk 4, v1.10.1).\r\n\r\n**Attempted Solutions:**\r\n1)\tThe first tests were performed using the stock on-board MS5611 barometer with no shielding. The flight performance was fine but produced noticeable dips upon maneuvering in any direction. \r\n2)\tThe issue  https://github.com/PX4/Firmware/issues/10058 suggested shielding the barometer, and adjusting the EKF2_BARO_NSE, EKF2_PCOEF_%%%, EKF2_BCOEF_%%%, and EKF2_DRAG NOISE parameters. Shielding the barometer in an indirectly ported enclosure did not produce noticeable differences. (in either data or performance). Adding open-cell foam around the PX4 inside the enclosure also did not produce noticeable differences. Moving the barometer very far away from the propellers did not produce noticeable differences.\r\n3)\tAfter shielding and isolation were tested and had no effect on the problem, the suggested parameters began to be changed but shielding with enclosure and foam was kept for the remaining test. Setting the XN, XP, YN, and YP EKF2_PCOEFs to their minimum value of -.5 very slightly reduced the dip (10-30cm out of 1-3m). \r\n4)\tAfter PCOEFs were ineffectual, the BCOEFs were next to be altered. A theoretical ballistic coefficient was calculated for this aircraft using the drag coefficient of a flat-plate, the mass of the aircraft, and the area of the central plate. The calculated value was 23.96kg/m^2 (1kg/m^2 lower than default). The ballistic coefficient parameter was altered from minimum to maximum values. The EFK2_drag.innovations[0:1] were examined after each flight but did not change in RMS value. EKF2 Replay was attempted using JMavSim on a Windows 10 machine but errors were thrown upon completion of the documentation steps and replay never worked. Changing BCOEFs had little to no effect on the EKF2 innovations for both drag and wind estimation.\r\n5)\tThe last of the suggested parameters was EKF2_BARO_NSE. Raising EKF2_BARO_NSE to a value of 5m improved flight performance and reduced dips while maneuvering. This is NOT a solution to the problem as all it does is transition estimation authority from to the barometer to the GPS. The entire intent of this testing is to have consistent altitude performance even without GPS assistance (to fly in buildings and structures) therefore this is not the most desirable solution.\r\n6)\tAfter the above parameters failed to solve the problem, the EKF2_HGT_MODE was changed from barometer to GPS. This stopped the dip from occurring but once again is not a solution. After GPS was used, a downward-facing LIDAR was used with range-aid enabled without it being the primary height sensor and with range-aid and as the primary height sensor. Both of these removed the dip while maneuvering and followed terrain well. These too are undesired solutions due to limited LIDAR range and the possibility of ground-based objects messing up the LIDAR altitude estimation.\r\n7)\tThe next series of testing began with an external barometer/GPS from Zubax enabled via UAVCAN. This also featured the MS5611 chip and yielded the same results as the on-board MS5611 for all of the above tests. This GPS was also enclosed in the Zubax designed enclosure with open cell foam in the barometer enclosure (inside the overall enclosure). With UAVCAN enabled, both the external barometer and the external GPS were used as the primary GPS and barometer but did not produce noticeable differences in flight performance.\r\n8)\tNo other types of barometers were supported in v1.10.1 so v1.11.0-beta2 was used for the rest of the testing. The v1.11.0-beta2 code was altered to enable the driver for the BMP388 acquired from Adafruit. The MS5611 driver was also disabled to ensure that the BMP388 would be used for pressure-height data and not the on-board sensor. The PIDs for the rate, attitude, and XY- position controllers were able to be tuned to achieve the desired performance. The Z-position/velocity controller gains were left at default. Hover flight could be achieved as expected however, when a breeze blew the craft would gain altitude and not settle back to the set-point. The second log of the 3-4min flight is the best example of this. No control input would be given and the craft would gain altitude at the maximum allowed vertical speed (2m/s, default = 3m/s). The P and I values of the controller were reduced to close-to or just above the minimum allowed values (to create a sluggish and under-tuned controller) and still the craft would ascend at maximum vertical speed in a slight cross-breeze (2-5mph). For the end of the flight, the rise in altitude was partially counteracted by a downward RC command but almost full-stick down was commanded before the aircraft consistently began to descend.\r\n\r\n**Notes:**  \r\nI hypothesize that both flight abnormalities are caused by the pressure changes across the barometer. That being said, all tested barometers were a fully enclosed as they could have been without rendering them inoperable. My second hypothesis is that the altitude fusion in the EKF2 does not handle these barometer fluctuations well. The same craft flown with a DJI A3 controller does not have these problems when flown under the same conditions (wind, maneuvers, poor GPS environment, etc.). These logs and descriptions hopefully show problems with dynamic pressure handling (either craft moving in static air or air moving over static craft) that Pixhawk 4 has. This problem effects AltHold, PosHold, and Loiter flight modes and mission performance in many different scenarios and its significant diminishment or removal would make PX4 based systems more useful and versatile. \r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "SITL standard_vtol without airspeed flies too slow",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15067",
  "body": "**Describe the bug**\r\nWhen airspeed is blocked (not published) for standard_vtol in SITL, it starts to fly slower and slower (below stall speed and starts oscillating in speed and height. I assume this is just because the cruise throttle is not set up correctly but I'm not sure.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use: https://github.com/PX4/Firmware/pull/15063\r\n2. `make px4_sitl gazebo_standard_vtol`\r\n3. Plan VTOL mission in QGC and start it.\r\n4. Enable failure injection: `param set SYS_FAILURE_EN 1`\r\n5. Trigger GPS lost: `failure airspeed off`\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=687fe868-4005-4494-a5a3-dc63aefaa127\r\n\r\nFYI @sfuhrer @RomanBapst ",
  "state": "open",
  "pull_request": null
}
{
  "title": "GPS lost during VTOL fixedwing mission immediately triggers loiter descent",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/15066",
  "body": "**Describe the bug**\r\nWhen GPS is lost during the fixedwing part of a VTOL mission, the plane says it is going to `fixed bank loiter`. It does so without thrust, so starts diving to keep above stall speed. This results in a \"hard landing\" at 13 m/s horizontal and 3 m/s vertical speed.\r\n\r\nI would assume that by default a VTOL would either actually loiter for a while to try to regain GPS or otherwise transition back to multicopter mode and slowly descend.\r\n\r\nIt certainly should not dive like that, especially when datalink and manual control is still available.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use: https://github.com/PX4/Firmware/pull/15063\r\n2. `make px4_sitl gazebo_standard_vtol`\r\n3. Plan VTOL mission in QGC and start it.\r\n4. Enable failure injection: `param set SYS_FAILURE_EN 1`\r\n5. Trigger GPS lost: `failure gps off`\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=d4571b45-9472-4265-bc6c-87555e95c784\r\n\r\n```\r\nINFO  [simulator] Waiting for simulator to accept connection on TCP port 4560\r\nINFO  [simulator] Simulator connected on TCP port 4560.\r\nINFO  [commander] LED: open /dev/led0 failed (22)\r\n  MAV_TYPE: curr: 2 -> new: 22\r\nINFO  [init] Mixer: etc/mixers-sitl/standard_vtol_sitl.main.mix on /dev/pwm_output0\r\nINFO  [mavlink] mode: Normal, data rate: 4000000 B/s on udp port 18570 remote port 14550\r\nINFO  [mavlink] mode: Onboard, data rate: 4000000 B/s on udp port 14580 remote port 14540\r\nINFO  [mavlink] mode: Onboard, data rate: 4000 B/s on udp port 14280 remote port 14030\r\nINFO  [logger] logger started (mode=all)\r\nINFO  [logger] Start file log (type: full)\r\nINFO  [logger] [logger] ./log/2020-06-09/15_20_07.ulg\r\nINFO  [logger] Opened full log file: ./log/2020-06-09/15_20_07.ulg\r\nINFO  [mavlink] MAVLink only on localhost (set param MAV_BROADCAST = 1 to enable network)\r\nINFO  [px4] Startup script returned successfully\r\npxh> INFO  [mavlink] partner IP: 127.0.0.1\r\n[Wrn] [Event.cc:61] Warning: Deleting a connection right after creation. Make sure to save the ConnectionPtr from a Connect call\r\nINFO  [ecl/EKF] 568000: GPS checks passed\r\nINFO  [ekf2] Mag sensor ID changed to 197388\r\nINFO  [ecl/EKF] 1792000: EKF aligned, (baro hgt, IMU buf: 18, OBS buf: 14)\r\nINFO  [ecl/EKF] 1792000: reset position to last known position\r\nINFO  [ecl/EKF] 1792000: reset velocity to zero\r\nINFO  [ecl/EKF] 5151999: reset position to GPS\r\nINFO  [ecl/EKF] 5151999: reset velocity to GPS\r\nINFO  [ecl/EKF] 5151999: starting GPS fusion\r\nINFO  [commander] ARMED by Arm/Disarm component command\r\nINFO  [navigator] Takeoff to 50.0 meters above home.\r\nINFO  [commander] Takeoff detected\r\n\r\npxh> \r\npxh> \r\npxh> \r\npxh> failure gps off\r\nERROR [failure] Failure injection disabled by SYS_FAILURE_EN param.\r\nCommand 'failure' failed, returned 1.\r\npxh> param set SYS_FAILURE_EN 1\r\n  SYS_FAILURE_EN: curr: 0 -> new: 1\r\npxh> failure gps off\r\npxh> \r\npxh> \r\npxh> WARN  [commander] Failsafe enabled: no global position\r\nINFO  [commander] Failsafe mode activated\r\nWARN  [navigator] Global position failure: fixed bank loiter\r\nWARN  [ecl/EKF] 156320000: GPS data stopped\r\nINFO  [ecl/EKF] 156320000: reset position to last known position\r\nINFO  [ecl/EKF] 156320000: reset velocity to zero\r\nWARN  [ecl/EKF] 156320000: stopping navigation\r\n\r\npxh> commander disarm\r\npxh> WARN  [commander] Disarming denied! Not landed\r\n\r\npxh> \r\npxh> commander disarm -f\r\npxh> WARN  [commander] Disarming denied! Not landed\r\n```\r\n\r\nFYI @sfuhrer @RomanBapst ",
  "state": "open",
  "pull_request": null
}
{
  "title": "Flips/crashes in SITL",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14997",
  "body": "I stumbled upon weird failures in SITL with lockstep at 20x where the vehicle flips during RTL.\r\n\r\nI've seen this at least twice now, and it's potentially related to #14835.\r\n\r\n1: https://logs.px4.io/plot_app?log=4d4c672d-2330-4ab6-9c1d-215c09f4bbd7\r\n\r\n2: https://logs.px4.io/plot_app?log=09114cbf-10fb-4fc9-8e2a-6f07cfa8297a\r\n\r\n3: https://logs.px4.io/plot_app?log=f838236c-e6d6-41d6-ab82-a218ef39e900\r\n\r\n4: https://logs.px4.io/3d?log=6b8d6b58-808a-43ed-b1a8-a07b38acca1b\r\n\r\n5: https://logs.px4.io/plot_app?log=a6130dd5-6178-4578-ad54-45225f9b4ed7\r\n\r\n6: https://logs.px4.io/plot_app?log=1bff7bd0-7b1a-4e17-8073-ee30625cc36f\r\n\r\n**To reproduce:**\r\n\r\nI get these by running the MAVSDK SITL tests at 20x in Ubuntu 18.04 in VirtualBox (on a Linux host):\r\n\r\n```\r\nDONT_RUN=1 make px4_sitl gazebo mavsdk_tests && test/mavsdk_tests/mavsdk_test_runner.py test/mavsdk_tests/configs/sitl.json --abort-early --model iris --speed-factor 20 --iterations 20 --verbose\r\n```",
  "state": "open",
  "pull_request": null
}
{
  "title": "Drone flies towards old mission waypoint on arm, when no current=1 is set on new mission",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14981",
  "body": "**Describe the bug**\r\nWhen a mission is stopped midway, and the drone then lands, receives a new mission with all items having ``current=0`` parameters and is armed again, the drone immediately flies towards the waypoint from the old mission, instead of executing the first item on the new mission. This crashed our drone as it tilts and tries to fly forward before properly \"takeoff\" to a safe altitude, thus catching the ground with the landing struts.  \r\n\r\nThe resetting of ``mission_current`` seems to happen upon arming, but there seems to be some sort of race-condition, as the drone reports ``mission_current`` to reset to 0 upon arming, but the log shows the drone still gets a setpoint for the old waypoint and tries to fly that, before the ``mission_current`` index reset is realised.\r\n\r\nThomas Stauber spotted that our velocity controller asked for a 3m/s horizontal velocity immediately upon arming, which indicated that the drone was flying towards an old mission item.\r\n![image](https://user-images.githubusercontent.com/7889925/82942796-d4aa5700-9f98-11ea-85f8-13f5744f75a6.png) \r\n\r\n**To Reproduce**\r\nSteps we did to reproduce the behaviour:\r\n1. Fly normal mission\r\n2. Before normal mission finishes, switch mode to \"land now\" or \"RTL\" and land the drone\r\n3. Start new flight with identical mission. (It uploads the same mission again, but doesn't clear the old one first)\r\n4. Arm and send \"start_mission\" command\r\n5. Drone attempts to fly to the waypoint it was at in the last mission and thus flip in the direction of that waypoint.\r\n\r\n**Expected behavior**\r\nUpon uploading a new mission with no ``current=1`` parameters set, we would expect the drone to reset the current-index of mission items to 0. Intuitively I would expect the index to get reset when the PX4 accepts the new mission and sends ``MAV_MISSION_ACCEPTED`` and not first on arming the drone. \r\n\r\n**Log Files and Screenshots**\r\nflight log: https://review.px4.io/plot_app?log=116b78e1-7732-4e6e-acf8-88e640d8cdfc \r\nvideo of the takeoff and flip: https://nextcloud.sdu.dk/index.php/s/46H7m9TXgXkQqQF\r\n\r\nlog from our GCS rosbag, showing the ``mission_current`` is not reset until arming, but keeps the old missions current index. The new mission had been uploaded and accepted by the PX4 before this snippet from the log:\r\n```\r\n---\r\ndata: 0\r\n---\r\ndata: 0\r\n---            <----------- a second before it changes to 15, the flightmode of the FC is set to \"Auto - Mission\". It appears the current_waypoint change is due to the flightmode being changed\r\ndata: 15\r\n---\r\ndata: 15\r\n---\r\ndata: 15\r\n---\r\ndata: 15\r\n---\r\ndata: 15\r\n---            <----------- Right at the same time it goes from 15 to 0, is when the drone report it is \"armed\". So it seems like the index isn't reset until the drone is armed\r\ndata: 0\r\n---\r\ndata: 0\r\n---\r\ndata: 0\r\n---\r\n```\r\n\r\n\r\n**Drone (please complete the following information):**\r\n- Hexacopter using Pixhawk 2.1 Cube\r\n- (The long legs shown on the video are due to testing, we know they are long, ugly and doesn't help make it stable)\r\n- SD-card for PX4: Scandisk Edge 16GB - Class 4\r\n\r\n**Additional context**\r\n\r\nAs soon as we added ``current=1`` on the first item of the new mission we can no longer reproduce this error and we are using that fix for the time being. ",
  "state": "open",
  "pull_request": null
}
{
  "title": "Mixer corner case with too low collective thrust and no airmode?",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14945",
  "body": "I had airmode disabled (`MC_AIRMODE` set to 0) and minimum thrust in stabilized on zero (`MPC_MANTHR_MIN` set to 0).\r\n\r\n**Expected behavior**\r\nThe vehicle should fly normally as long as the collective thrust is high enough and have loose rate and attitude tracking temporarily when the thrust is too low to have full torque authority because two motors cannot ramp any lower.\r\n\r\n**Describe the bug**\r\nInstead it lost attitude tracking completely not even compensating with the two motors that were still in actuation range and never regained any authority even though I increased throttle to more than hover thrust. It even commanded the motors to stop completely.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Flash master\r\n2. Set `MC_AIRMODE` to 0 (default)\r\n3. Set `MPC_MANTHR_MIN` to 0\r\n4. Hover in stabilized mode\r\n5. Start pushing roll back and forth\r\n6. Lower thrust all the way to zero just very quickly and pull it up immediately again\r\n7. See drone flipping multiple times and crashing\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=60177bc8-95ce-481f-9454-79ef03267a7c\r\n\r\n![image](https://user-images.githubusercontent.com/4668506/82447708-f1322500-9aa8-11ea-8f82-e967faa229c7.png)\r\n\r\n**Drone (please complete the following information):**\r\n- Holybro QAV250\r\n- I was testing https://github.com/PX4/Firmware/pull/14896, https://github.com/PX4/Firmware/pull/14823, https://github.com/PX4/Firmware/pull/14738, https://github.com/PX4/Firmware/pull/14551 based on 793eb821531191409aba3034606d6fad12d3be3a and am very convinced the problem is unrelated to the tested prs.\r\n\r\n**Initial investigation**\r\nMy initial investigation brought me to the mixer since the rate and attitude setpoints and reactions looked very plausible but the `actuator_control` goes to -3.75 which I'm not completely sure if it's in the expected range and the actuator outputs first all go to idle and then completely to zero commanding the motors to stop without disarm, kill, land detection or ~failure detection~.\r\n\r\nJFYI @bresch @bkueng ",
  "state": "open",
  "pull_request": null
}
{
  "title": "[VTOL] Dangerous Back Transition ",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14933",
  "body": "@RomanBapst \r\n\r\n**Describe the bug**\r\nIf the drone overshoots on a back transition, it initiates a FW style U turn, which already scares me in SITL. \r\n![image](https://user-images.githubusercontent.com/48206725/82304684-ebf7ac00-99bc-11ea-87fd-41e822a4196f.png)\r\nDuring this manoeuver the drone isn't capable of keeping the desired pitch, leading to a large drop in altitude, which makes the drone gain speed, which makes that the back transition doesn't finish.\r\n\r\nAdditionally, there is no support of the MC motors during the back transition. I would have expected them to [ramp up](https://docs.px4.io/master/en/advanced_config/parameter_reference.html#VT_B_TRANS_RAMP).\r\n\r\n**To Reproduce**\r\nIt's not completely trivial to reproduce and it's not always entirely equal. Here is my setup with which I found the problem:\r\n[bad_BT.zip](https://github.com/PX4/Firmware/files/4649422/bad_BT.zip)\r\n\r\nFirmware  v1.11.0-beta2\r\n-Gazebo: standard_vtol (modified sdf file to have stronger motors)\r\n-Mission: simple mission using normal Takeoff waypoint to take off in FW mode (which is why I needed a stronger motor). Interestingly enough the back transition isn't the same when replacing the Takeoff waypoint with a VTOL takeoff waypoint.\r\n-Parameters: mostly default, need to set CBRK_VTOLARMING = 159753 to allow arming in FW mode.\r\n\r\n**Expected behavior**\r\n1. The MC motors should ramp up during the back transition, independent of the take off method used.\r\n2. (Even though it's a logical consequence of using FW L1 position control) IMO the drone shouldn't do this crazy U turn during transition. I'd be in favour of force-ending the transition when you are at the desired position even if the speed is too high.\r\n\r\n**Log Files and Screenshots**\r\nThe first two logs are both with a FW takeoff, identical setup but the direction of the U turn is different. The third log shows the mission where FW takeoff has been replaced with VTOL Takeoff. It's interesting to see that the MC motors ramp up in this case.\r\n\r\nhttps://logs.px4.io/plot_app?log=241b24bb-248a-4451-a7e0-4638565f9d34\r\nhttps://logs.px4.io/plot_app?log=abe58451-984d-43e9-a8ac-31308bf0d66e\r\n\r\nhttps://logs.px4.io/plot_app?log=99aa4c67-3e82-47d8-95a3-105c49280e6f\r\n\r\n**Drone (please complete the following information):**\r\nSITL Gazebo Standard VTOL with stronger motors\r\n\r\n**Additional context**\r\nPosition controlled transitions have been introduced here: https://github.com/PX4/Firmware/pull/14405\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "CI SITL MC_offboard_rpyrt test intermittant failure",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14847",
  "body": "\r\n![Screenshot from 2020-05-06 10-11-55](https://user-images.githubusercontent.com/84712/81187436-0b84e280-8f82-11ea-8f03-3bf941297a56.png)\r\n\r\n\r\nhttp://ci.px4.io:8080/blue/organizations/jenkins/PX4_misc%2FFirmware-SITL_tests_ASan/detail/master/1747/pipeline/57\r\nhttps://logs.px4.io/plot_app?log=423ec840-cc41-45de-8efb-71053cb26936\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "EKF2 yaw estimate diverges on VIO stop/restart - v1.11-beta",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14840",
  "body": "**Describe the bug**\r\nThe EKF yaw estimate diverges if external vision data is stopped and restarted. This is easily reproducible in hand/bench tests.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start sending EV yaw data.\r\n2. Check QGC, EKF yaw estimate looks fine and matches EV.\r\n3. Stop sending EV data.\r\n4. Check QGC, EKF yaw estimate is spinning out of control.\r\n5. Start sending EV data again\r\n6. Check QGC, EKF yaw resets to correct EV value, but then continues spinning out of control.\r\n\r\n**Expected behavior**\r\n1. The yaw estimate falls back to compass after EV stop (?)\r\n2. The yaw estimate follows the external vision data after EV restart. \r\n\r\n**Log Files and Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/5557676/81130915-60d7da00-8f17-11ea-80ba-511c14d4fa75.png)\r\n\r\nLog from boot: https://logs.px4.io/plot_app?log=c0a43438-fb28-45fd-9a5b-92329748fb93",
  "state": "open",
  "pull_request": null
}
{
  "title": "Takeoff denied in HITL Simulation with Gazebo",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14721",
  "body": "**Describe the bug**\r\nWhen running a HITL setup with Gazebo, I can arm (the rotors in Gazebo start spinning) but I cannot takeoff. QGC's error message is only \"Takeoff command temporarily rejected\". In the log it says \"Critical: Takeoff denied! Please disarm and retry\". Doing so leads to the same result.\r\nA SITL setup with Gazebo works fine. Using JMavSim in a HITL setup works perfectly, too.\r\nOne difference I have noticed when comparing my error scenario to the two that work: QGC says the value of Alt (Rel) is NaN (or --.-- on the HUD).\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Install the development toolchain according to the [Toolchain Installation](https://dev.px4.io/v1.9.0/en/setup/dev_env.html).\r\n2. Follow the [instructions for setting up a HITL simulation](https://dev.px4.io/v1.9.0/en/simulation/hitl.html) with Gazebo.\r\n    a) In step 4 of the Simulation Setup for Gazebo I use `/dev/tty.usbmodem01` on my MacBook Pro. On an iMac I've had to use `/dev/tty.usbmodem1`.\r\n    b) In a recent commit the iris world was removed, so instead of running Gazebo as in step 5 of the Gazebo Setup section, I've had to run `make px4_sitl gazebo` again to achieve the same result. I have already had the described problem before this change was made.\r\n3. After starting QGC in step 6 of the instructions for the Gazebo Setup, arm the drone and select Takeoff in QGC.\r\n\r\n**Expected behavior**\r\nThe drone should takeoff without errors and I should be able to see that it does so in the Gazebo client.\r\n\r\n**Log Files and Screenshots**\r\nFlight log file: [Log file link](https://review.px4.io/plot_app?log=629eabe0-cfbb-4cd8-ad61-29d150175b0f)\r\n\r\n**Drone:**\r\nI am using an FMUK66 board by NXP.\r\n\r\n**Additional context**\r\nI am running macOS 10.15.4.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Some AUX pwm outputs go lower on arm",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14675",
  "body": "**Describe the bug**\r\nWhen the UAV is armed (via RC), some AUX pwm outputs (actuator_outputs_1) shortly go to a lower value, although this is not commanded via an actuator_control message. It seems that this only happens with AUX outputs who's PWM_AUX_DIS is set.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. change PWM_AUX_DIS2 (or another) from -1 to 100\r\n2. (set SDLOG_MODE 0 -> 1)\r\n3. pre-arm UAV via onboard arm-switch\r\n4. arm via RC\r\n5. see in log: during 2nd arming the actuator_outputs_1[1] goes down for a short while\r\n\r\n**Expected behavior**\r\nThe output should be following the commanded value via the mixer file, thus stay constant.\r\n\r\n**Log Files and Screenshots**\r\n*Always* provide a link to the flight log file:\r\n- 1st log: modified firmware [PX4 Flight Review](https://logs.px4.io/plot_app?log=45d2537b-d485-4103-9a95-22cfb1819fef), [AUX output chart](https://logs.px4.io/plot_app?log=45d2537b-d485-4103-9a95-22cfb1819fef#Nav-Actuator-Outputs-AUX).\r\nPWM_AUX_DIS2 and PWM_AUX_DIS3 set to 100 (AUX output 1 & 2).\r\nNote that the lower value is 1050 and ramps up to commanded value.\r\nUsed mixer: \r\nactuator_outputs_1[0] = actuator_control_0[7] (landing gear)\r\nactuator_outputs_1[1] = actuator_control_2[1] (mount pitch)\r\nactuator_outputs_1[2] = actuator_control_2[4] (mount custom)\r\n\r\n- 2nd log: PX4 v1.10.0, vmount enabled [PX4 Flight Review](https://logs.px4.io/plot_app?log=d626193a-b86e-4510-a230-463f0c6caed6), [AUX output chart](https://logs.px4.io/plot_app?log=d626193a-b86e-4510-a230-463f0c6caed6#Nav-Actuator-Outputs-AUX).\r\nPWM_AUX_DIS2 set to 100 (AUX output 1).\r\nNote that the lower value goes to 100, then 1050 and ramps up to commanded value.\r\nUsed mixer: mount activated\r\n\r\n- 3rd log: PX4 v1.10.0, default mixer [PX4 Flight Review](https://logs.px4.io/plot_app?log=20112ab9-12fe-4f15-96a0-fb3691030048), [AUX output chart](https://logs.px4.io/plot_app?log=20112ab9-12fe-4f15-96a0-fb3691030048#Nav-Actuator-Outputs-AUX).\r\nPWM_AUX_DIS2 set to 100 (AUX output 1).\r\nNote that the lower value goes to 100, then 1050 and ramps up to commanded value.\r\nUsed mixer: default (pass trough?)\r\n\r\nAdd screenshots to help explain your problem.\r\n1st log:\r\n![Screenshot from 2020-04-15 14-58-24](https://user-images.githubusercontent.com/6920950/79339729-92b5dc00-7f29-11ea-8c76-4ff6cbde7cbb.png)\r\n*Note that the arming_state is scaled\r\n2nd and 3rd log:\r\n![Screenshot from 2020-04-15 14-49-29](https://user-images.githubusercontent.com/6920950/79339402-1f13cf00-7f29-11ea-940e-988a3dafd4d9.png)\r\n*Note that the arming_state is scaled\r\n\r\n\r\n**Drone (please complete the following information):**\r\n- octo/quadcopter\r\n- PX4 1.10.0\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "[fixed wing]nose down after mission mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14313",
  "body": "**Describe the bug**\r\nWhen I switch the flight mode from stablize to mission, the plane have a strange nose down and power max immidately, I haven't see that before, and the speed is enough to level flight, but I think maybe some problem about airspeed because I haven't airspeed sensor, the speed is depend on the groundspeed from GPS.\r\nthe flight log is below:\r\nhttps://logs.px4.io/plot_app?log=1a3116dd-d687-470f-8cb3-31740f9e0ac6\r\nspeed:\r\n![image](https://user-images.githubusercontent.com/5361334/76086296-c9293e80-5fee-11ea-8d6c-6f25fe57bebd.png)\r\n\r\nnose down immidately\r\n![image](https://user-images.githubusercontent.com/5361334/76086550-3f2da580-5fef-11ea-9f3b-dc2734474338.png)\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Altitude hold not working with GPS as primary height source and GPS blending enabled",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14267",
  "body": "Autopilot= Pixhawk 4\r\nFirmware= Branch based on v1.10\r\n\r\n**Describe the bug**\r\nAltitude hold not working when GPS is the primary height source and we are blending two different GPS modules (one is ublox and one ashtech).\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1) Set the primary height mode to GPS (EKF2_HGT_MODE=1)\r\n2) Enabled GPS blending (EKF2_GPS_MASK=3)\r\n3) Takeoff to about 1 meter. --> the drone started going down. I started counteracting with the sticks but it was still going down. \r\n\r\n\r\n**Log Files and Screenshots**\r\nBlending enabled but baro as primary height source (this works fine): https://review.px4.io/plot_app?log=1da0b48b-deed-4963-8efa-e3a646b20018\r\n\r\nBlending enabled and gps as primary height source (issue) - log1: https://review.px4.io/plot_app?log=2c5ab2b2-38a4-4d37-ad4c-e2bb3e564966\r\n\r\nBlending enabled and gps as primary height source (issue) -log2: https://review.px4.io/plot_app?log=c65eae25-6f75-4583-849f-11567e01d231\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Runway takeoff not tracking",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14262",
  "body": "Runway takeoff (on fixed wing with the nose gear on its own channel) is not tracking. It immediately veers off to the right substantially taking it off the runway. \r\n\r\n3 logs of this with one log having large gains and unlimited travel for good measure on the wheel controller.\r\n\r\nTo further test this we took another aircraft in a different location and recreated. That log is not attached but it obeyed in the identical way.\r\n\r\nThere is more than enough wheel authority, no errors, mag issues, etc so understanding the lack of tracking and any mission start yields to veering off to the right would be important to understand.\r\n\r\nhttps://review.px4.io/plot_app?log=d7858c28-bb1f-49df-9df5-c8fd04755a80\r\n(vibration only because it was taken at high speed off the runway)\r\n\r\nhttps://review.px4.io/plot_app?log=0d6e9b1f-1d37-43fb-a673-c19de0298fac\r\n(Immediate right upon initiating the mission - only look at the mission portion of the log)\r\n\r\nhttps://review.px4.io/plot_app?log=65c49e9f-61a4-4a75-8813-4ce66160a4c4\r\n(Immediate right upon initiating the mission - only look at the mission portion of the log but with larger wheel rate gains for good measure.)\r\n\r\n\r\nIt would seem like something is wrong for it to always want to go hard right first. Is this a bug or something that simply now needs to be re-tuned so there is a much more subdued effect on the WR controller's abilities? I just find it strange since this did occur occasionally over the years but not every time which is happening now. \r\n\r\n\r\nFirmware: 1.9.2\r\nPixhawk with 2mb of flash",
  "state": "open",
  "pull_request": null
}
{
  "title": "Failsafe for position loss in Offboard mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/14076",
  "body": "**Describe the bug**\r\nWhen a position loss event occurs while in Offboard mode (which requires a valid position estimate), the vehicle performs a blind land failsafe, despite the fact that COM_POSCTL_NAVL is configured to \"Assume R/C, switch to altitude mode...\" and there is a remote control.\r\n\r\n**To Reproduce**\r\nStream VISION_POSITION_ESTIMATE mavlink messages to simulated Iris copter (in Gazebo), switch to offboard and fly to a waypoint (via SET_POSITION_TARGET_LOCAL_NED message). While the drone is flying to the waypoint, stop sending VISION_POSITION_ESTIMATE messages.\r\n\r\n**Expected behavior**\r\nI would have expected that the failsafe obeys the COM_POSCTL_NAVL parameter and switches to Altitude mode (hight estimation was valid due to barometer). I also tried the same thing in Position mode and there it actually does switch to Altitude mode as expected.\r\n\r\n**Log Files and Screenshots**\r\nhttps://review.px4.io/plot_app?log=62c8308a-bd4d-4185-8db9-1e45d6e9efa0\r\nINFO  [ecl/EKF] 36996000: EKF commencing external vision position fusion\r\nINFO  [ecl/EKF] 36996000: EKF commencing external vision yaw fusion\r\nWARN  [ecl/EKF] 75820000: EKF ev hgt timeout - reset to baro\r\nWARN  [mc_pos_control] Position-Control Setpoint-Update failed\r\nWARN  [mc_pos_control] Failsafe: blind land\r\nINFO  [ecl/EKF] 77532000: EKF External Vision Data Stopped\r\nWARN  [ecl/EKF] 77540000: EKF stopping navigation\r\n\r\nFor comparison, this is the output when flying in Position-mode:\r\nINFO  [ecl/EKF] 533328000: EKF commencing external vision position fusion\r\nINFO  [ecl/EKF] 533328000: EKF commencing external vision yaw fusion\r\nWARN  [commander] Failsafe enabled: no local position\r\nWARN  [ecl/EKF] 560472000: EKF ev hgt timeout - reset to baro\r\nINFO  [ecl/EKF] 562184000: EKF External Vision Data Stopped\r\nWARN  [ecl/EKF] 562192000: EKF stopping navigation\r\n\r\n**Drone (please complete the following information):**\r\nIris in Sitl Gazebo, with PX4 1.10.0\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "SITL takeoff intermittent failures",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13684",
  "body": "**Describe the bug**\r\nSometimes, when starting a mission using QGC, I get the warning \"manual control lost\" right on arming/takeoff. Sometimes afterwards the vehicle won't takeoff.\r\nSometimes, I don't see the \"manual control lost\" warning but it does not take off anyway.\r\nThis happened with `standard_vtol`.\r\n\r\n**To Reproduce**\r\n1. Start SITL\r\n2. Upload mission from QGC\r\n3. Wait for GPS lock and press \"Start Mission\" \r\n\r\n**Expected behavior**\r\nIt should not lose RC if RC is sent from QGC. And it should takeoff when QGC tells it to do so.\r\n\r\n```\r\npxh> INFO  [ecl/EKF] 5900000: EKF commencing GPS fusion\r\npxh> WARN  [commander] Manual control lost\r\nERROR [navigator] mission update failed\r\nERROR [navigator] mission check failed\r\nWARN  [mc_pos_control] Failsafe: stop and wait\r\nINFO  [logger] closed logfile, bytes written: 3506011\r\n```\r\n\r\n**Logs**\r\n\r\nManual control lost, and not taking off:\r\nhttps://logs.px4.io/plot_app?log=cc4c6fd3-38d6-430d-9f11-047c2ea7251a\r\n\r\nNot taking off:\r\nhttps://logs.px4.io/plot_app?log=5adecad5-c0af-4166-8e69-5eaa1a48e98c\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Flight Speed control doesn't always work",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13671",
  "body": "**Describe the bug**\r\nWhen a \"Flight Speed\" is attached to a waypoint in QGC, the speed is not always used. This behavior is intermittent but happens more often than not.\r\n\r\n![image](https://user-images.githubusercontent.com/4399188/70094566-9fb7db80-15d7-11ea-97dc-10a36c110c6e.png)\r\n\r\n**To Reproduce**\r\nThis behavior is intermittent.\r\n\r\nSteps to reproduce the behavior:\r\n- Create mission with a \"Flight speed\" attached to a waypoint\r\n- Upload to flight controller\r\n- Take off and fly in mission mode.\r\n\r\n**Expected behavior**\r\nNew speed is used.\r\n\r\n**Log Files and Screenshots**\r\n- Log: https://logs.px4.io/plot_app?log=36040896-dbc3-48d4-baab-ec18c0ed29bd\r\n- Plan: [no-speed-control.plan.txt](https://github.com/PX4/Firmware/files/3918981/no-speed-control.plan.txt)\r\n\r\n**Drone (please complete the following information):**\r\n- Tarot X6 (with Tarot retracts)\r\n- Pixhawk Cube 2.1\r\n- Here2 GNSS\r\n- PX4 1.10.0 rc2\r\n- QGC daily 12/2/2019 Win10\r\n- Gremsy S1 Gimbal connected to Telem2 (Mavlink)\r\n\r\n**Additional context**\r\nThis feels **very** similar to this bug https://github.com/PX4/Firmware/issues/13474 In fact, I had an ROI waypoint in the plan and speed control and both were sometimes ignored. If one worked, the other seemed to usually work. If the ROI failed, the speed control would typically fail also. It seems like the messages from the piece of the firmware that processes the mission items are often ignored.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Navigator running erratic or very slow",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13536",
  "body": "**Describe the bug**\r\nWe had a flight where the `vehicle_status.nav_state` was set to `NAVIGATION_STATE_AUTO_RTL` for about 0.6 seconds and no message or triplet from navigator was published, as if it was not running.\r\n\r\nIn the logfile below there are times where RTL should have been engaged by navigator because the nav state was set:\r\n- 279 s / 7.02 --> **No reaction from navigator**\r\n- 280.5 s --> RTL actions were taken again\r\n- 284.5 s --> RTL actions were taken again\r\n\r\n**To Reproduce**\r\nNot sure.\r\n\r\n**Expected behavior**\r\nRTL should have been initiated.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=7c4e2956-6ab5-409f-a2ac-0b908652a1de\r\n\r\n![rtl times](https://user-images.githubusercontent.com/1419688/69232983-58b7f800-0b8c-11ea-8354-fec0e9814cfb.png)\r\n\r\n**Additional context**\r\nNavigator is polling on local_position and there are regular updates of this topic.\r\n\r\nWe need to investigate the effects of accessing the SD card in some of the navigator modes when not inactive. E.g. Mission and Rtl modes check mission items respective rally points even if not active! Also, we check for geofences set in every iteration.\r\n\r\nFYI @MaEtUgR ",
  "state": "open",
  "pull_request": null
}
{
  "title": "Drone rotates towards setpoints in Precision Land flight mode in 1.9.x and 1.10.0",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13498",
  "body": "Drone rotates towards setpoints and subsequently fails to land on the target if precision landing starts outside of the mission (by command `commander mode auto:precland`) . The drone yaw was always **0** in **1.8.x**. The worst part is that I can't reproduce this behavior in **SITL** or **HITL**.\r\n\r\n**Steps to reproduce the behavior:**\r\n\r\n1. Takeoff above **IR-Lock** beacon.\r\n2. Call `commander mode auto:precland`.\r\n3. Watch the precision landing process.\r\n\r\n**Expected behavior**\r\nThe drone yaw must always be constant to perform a successful precise landing.\r\n\r\n**Log Files and Screenshots**\r\n[Log](https://logs.px4.io/plot_app?log=85b20945-deca-4b19-b7d5-7cc8e6bdc2c7)\r\n\r\n![Yaw Angle](https://user-images.githubusercontent.com/36663802/69052720-c80cdb00-0a18-11ea-930b-90ee223e75bb.png)\r\n\r\n**Drone:**\r\nF450-based Quadrotor x\r\n\r\n<img src=\"https://user-images.githubusercontent.com/36663802/69053177-e1625700-0a19-11ea-87fc-fe5b8a49d399.jpg\" alt=\"photo_2019-11-18_15-39-53\" height=800px />\r\n\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "ROI waypoints don't always work",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13474",
  "body": "**Describe the bug**\r\nOccasionally (maybe 50% of the time) an ROI waypoint will not be processed. This bug has been present since at least 1.8.2 (when I started using PX4). When I was using 1.8.2, I was using a PWM driven gimbal hooked to the AUX port. Now, I am using 1.10.0-rc1 and experiencing the same bug with a Mavlink connected gimbal. Completely different hardware,\r\n\r\n**To Reproduce**\r\nThis behavior is intermittent and hard to regularly reproduce.\r\n\r\nSteps to reproduce the behavior:\r\n1) Create mission with a \"ROI\" waypoint and possibly a \"Cancel ROI\"\r\n2) Upload to flight controller\r\n3) Take off and fly in mission mode.\r\n\r\n**Expected behavior**\r\nThe gimbal will point at the ROI waypoint. If a \"Cancel ROI\" waypoint is issued, the gimbal will return to a neutral position.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=566767d5-5d67-4d58-add6-fad66e1579d9\r\n\r\nFlight plan:\r\n[ROI.txt](https://github.com/PX4/Firmware/files/3848510/ROI.txt)\r\n\r\nIn the flight above an ROI waypoint is added. Sometimes the gimbal will point at the ROI waypoint as it should. On some flights it wont. Attached to the last waypoint is a \"Cancel ROI\" waypoint which doesn't always cancel the ROI. Several flights were performed as well as several reboots of the AP. The results were an inconsistent mix of everything working to nothing.\r\n\r\n**Drone (please complete the following information):**\r\n- Tarot X6 (with Tarot retracts)\r\n- Pixhawk Cube 2.1\r\n- Here2 GNSS\r\n- PX4 1.10.1rc1\r\n- QGC 3.5.5\r\n- Gremsy S1 Gimbal connected to Telem2 (Mavlink)\r\n\r\n**Additional context**\r\nI have verified the gimbal is working correctly. My MNT_MODE_IN is set to \"AUTO\" and I can always control the gimbal pointing angle via RC. The problem only occurs when a ROI waypoint is used to control the gimbal. I have verified that this behavior also exists when the MNT_MODE_IN is set to \"MAVLINK_ROI\".\r\n\r\nI am eager to do as many test flights as necessary to get this resolved. If additional logging is required, please provide instructions to enable logs. I am also willing and able to build new firmware.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Rover: GPS loss leads to \"fixed bank loiter\" instead of just stopping",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13467",
  "body": "When the GPS position is lost during a mission, the rover switches to a \"fixed bank loiter\", which is nice for a fixed wing aircraft, but not necessary for a ground vehicle.\r\n(I just tested in SITL and not with a real rover.)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start rover and QCG\r\n2. create and upload a mission and start the mission\r\n3. turn off GPS in nxh with `gpssim stop` at any point in the mission\r\n4. obverse two warning messages in QGC\r\n```\r\nWARN  [commander] Failsafe enabled: no global position\r\nWARN  [navigator] Global position failure: fixed bank loiter\r\n```\r\n\r\n**Current behavior**\r\nThe vehicle outputs cruising? throttle (PWM 1665) and a zero degree steering angle (PWM 1492). The roll set point is set to 15 degrees, which has no effect on a rover.\r\n\r\n**Expected behavior**\r\nJust stop driving\r\n\r\n**Log Files and Screenshots**\r\n- Flight log: https://logs.px4.io/plot_app?log=b8a6959a-7e85-4ebb-8473-d9d930775e3e\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Aircraft not automatically disarming while in Land flight mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13408",
  "body": "**Describe the bug**\r\nI'm having an issue where my hexacopter will not disarm once the aircraft has landed. The aircraft was flown in Position flight mode (or Stabilize flight mode) and then changed to Land flight mode. The aircraft is able to successfully descend and touch the ground successfully. However, instead of disarming, the motors speed up, which results in the aircraft wanting to tip over and crash.\r\n\r\nI have looked on the internet and I have found that it is important to get the hover throttle percentage correct as well as  the manual minimum throttle percentage. I have adjusted these values but still no success. I also changed the parameter (COM_DISARM_LAND) to 0.1 seconds, but still no success.\r\n\r\nI know that there isnâ€™t an issue with the actual aircraft as I have managed to successfully perform a mission using APM firmware, where it was able to land and disarm safely.\r\n\r\nIs this possibly an issue with the firmware or does someone perhaps know a solution to this problem?\r\n\r\nP.S. I have disabled the arming switch (changed parameter CBRK_IO_SAFETY from 0 to 22027)\r\n \r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Disable arming switch\r\n2. Change flight mode to Position or Stabilize\r\n3. Arm & takeoff to an altitude between (5 - 10 metres)\r\n4. Switch flight mode to Land\r\n\r\n**Expected behavior**\r\nThe aircraft should land and disarm successfully and not want to tip over and crash.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=bc0410c1-4285-4781-bf1b-b6ddee3b120d\r\n\r\n**Drone**\r\nDJI F550 Flame Wheel (hexacopter)\r\n\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "[HIL VTOL Offboard] set_attitude() not working",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/13209",
  "body": "**Describe the bug**\nSetting offboard attitude setpoints doesn't work for VTOLs in HIL simulation. The last attitude setpoint from before sending atttitude setpoints is kept instead.\n\nThis problem persists even with @irsdkv's fix #13141, even though now a few of the setpoints are registered : \n![bokeh!UNITO-UNDERSCORE!plot(7)](https://user-images.githubusercontent.com/48206725/66927391-0422d980-f030-11e9-8f88-6df6be4b9e81.png)\n\n**To Reproduce**\nSteps to reproduce the behavior:\n\n1. Switch to branch of PR #13141 (optional, but recommended)\n1. Start HIL simulation with the standard VTOL model (Gazebo)\n1. Launch MAVSDK offboard example.\n1. Observe the problem\n\n**Expected behavior**\nThe vehicle should follow the offboard setpoints, like in this log where the MAVSDK offboard example works with Iris quadcopter in HIL: \nhttps://logs.px4.io/plot_app?log=f032c92d-ffa3-4831-a730-977bbb8e229e\n\n**Log Files and Screenshots**\nStandard VTOL, HIL:\nhttps://logs.px4.io/plot_app?log=1fae08b3-82f3-4a45-b5d9-ff997bb9e7a3\n\n**Drone (please complete the following information):**\n\n* HIL Standard VTOL QuadPlane, sys_autostart = 1002\n* Pixhawk 4 is the used hardware\n\n**Additional context**\n#13141 fixes the problem for SITL, but interestingly enough not for HIL. Without #13141, it makes sense that it's not working, whereas with it I really don't know why the old setpoint persists.\n\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "[MC / VTOL] Take off ramp overshoots MPC_TKO_SPEED constraint",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12689",
  "body": "**Describe the bug**\nDuring the take off ramp, the vehicle doesn't respect the MPC_TKO_SPEED constraint. Instead, the vehicle accelerates to MPC_Z_VEL_MAX_UP even when below MPC_LAND_ALT1 (and after finishing the ramp it slows down again if still below MPC_LAND_ALT1).\n\n**To Reproduce**\nSteps to reproduce the behavior:\n\n1. Start SITL (tested with Gazebo's standard VTOL plane, but I imagine it's the same for any MC)\n1. Set up parameters (tested with MPC_TKO_SPEED =1m/s, MPC_Z_VEL_MAX_UP = 2.5m/s, MPC_TKO_RAMP_T = 5s, MPC_LAND_ALT1 = 10m in SITL, and with MPC_TKO_SPEED =1.5m/s, MPC_Z_VEL_MAX_UP = 2.5m/s, MPC_TKO_RAMP_T = 5s, MPC_LAND_ALT1 = 12m in the real world)\n1. Take off\n\nI experienced this behaviour with the take off command in QGC as well as launching missions. It's reproducible in SITL and on our real VTOL drone.\n\n**Expected behavior**\nHave the vehicle respect the MPC_TKO_SPEED during the take off ramp\n\n**Log Files and Screenshots**\n_Always_ provide a link to the flight log file:\nhttps://logs.px4.io/plot_app?log=a9e878be-395a-45ee-8f72-40db4b265931\n\nAdd screenshots to help explain your problem.\n![Screenshot from 2019-08-13 10-45-52](https://user-images.githubusercontent.com/48206725/62927814-9a7c1a00-bdb7-11e9-9d7d-ab972713cbd2.png)\n\n**Drone (please complete the following information):**\n\n* Tested on standard VTOL in Gazebo and a v-tail quadplane in the real world\n* SITL was tested on both on v1.9.0 and current (13.08.19) master, real drone runs v1.9.0 on a Cube\n\nOn a side note: why does QGC complain about MPC_TKO_RAMP_T having to be between 0 and 1 and in the parameter reference it says between 0 and 5?\n\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Incorrect log publisher topic by commander modules",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12670",
  "body": "**Describe the bug**\r\nI have a problem where my global position is invalid and failsafe is triggered. I checked the source code and the failsafe should be triggered by `commander` module.\r\nHowever, logged message indicated that it was published by `commander_tests`. Which wasn't running at that time.\r\n\r\nI've check other people log and it seems that they all have the same problem in both SITL and actual hardware such as\r\nIn SITL: https://github.com/PX4/Firmware/issues/9178\r\nIn hardware: https://logs.px4.io/plot_app?log=e226431c-9515-456c-8d45-d2fd22d0d68b\r\nIn my case, hardware (See **Logged Messages** at the time of 00:11:04\r\n`[commander_tests] Failsafe enabled: no global position`): https://logs.px4.io/plot_app?log=1e614d6c-d948-43c2-ba40-b0312aceaa83\r\n\r\nAll log indicated `[commander_tests] Failsafe enabled: no global position` (or local) which should be `[commander]` instead.\r\n\r\nAfter some digging and searching through the code. I found that `state_machine_helper.cpp` and `PreflightCheck.cpp` is being included in SRCS of `CMakeLists.txt` of both `commander_test` and `commander`. Moreover, `commander_test` is being compiled and linked before `commander`. Which might be the possible cause of this bug.\r\n\r\nI am using a derived v1.8.2, but this part is untouched. Also, v1.9.2 still exhibit the same code.\r\n\r\ncommander_test cmake: https://github.com/PX4/Firmware/blob/v1.9.2/src/modules/commander/commander_tests/CMakeLists.txt\r\ncommander cmake: https://github.com/PX4/Firmware/blob/v1.9.2/src/modules/commander/CMakeLists.txt\r\n\r\nI think mavlink log pub handler might incorrectly assume the source of the message based on the first module name that it is being compiled.\r\n\r\n**To Reproduce**\r\nMake anything that triggers a logged message that output from `state_machine_helper.cpp` or `PreflightCheck.cpp` inside src/modules/commander. It will be logged as `[commander_tests]`\r\n\r\n**Expected behavior**\r\nLog should indicate that publisher is `[commander]`\r\n\r\n**Additional context**\r\nI know that my vibration is severe, but that's not the case for this bug.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Fixedwing throttle 0 in mission mode",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12530",
  "body": "hello \r\nI use pixhawk 2.1 as the hardware and px4 version is 1.9.2.\r\nMy fixed-wing plane took off in manual mode. But when I change flight mode into mission, autopilot will shut down throttle. \r\nWhat should I do to slove this problem?\r\nThis is flight review: https://logs.px4.io/plot_app?log=f6fe68da-652e-46c7-8d1c-758b804a8939\r\nThanks.",
  "state": "open",
  "pull_request": null
}
{
  "title": "Low takeoff is not getting executed",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12471",
  "body": "**Describe the bug**\r\nWhen the takeoff altitude is set too low (< than around 0.7 meters) using the param `MIS_TAKEOFF_ALT` a quadcopter won't takeoff but just auto-disarm again.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start SITL jMAVSim or Gazebo\r\n2. `param set MIS_TAKEOFF_ALT 0.5`\r\n3. `commander takeoff`\r\n\r\n**Expected behavior**\r\nIt should still take off even if the altitude is quite low.\r\n\r\n**Log Files and Screenshots**\r\nhttps://logs.px4.io/plot_app?log=b5802f74-4a52-42f2-8f31-0bbf01fa84e9\r\n\r\n**Additional context**\r\nThis currently makes the MAVSDK integration test `ActionTakeoffAndKill` fail.\r\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Takeoff vs init race in SITL",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12264",
  "body": "Sometimes when I'm to eager to do `commander takeoff` and not everything is initialized as it should I can get into the state where the takeoff is not executed properly.\r\n\r\n```\r\nINFO  [ecl/EKF] EKF aligned, (pressure height, IMU buf: 22, OBS buf: 14)\r\n\r\npxh> \r\npxh> commander takeoff\r\nERROR [commander] rejecting takeoff, no position lock yet. Please retry..\r\nCommand 'commander' failed, returned 1.\r\npxh> INFO  [ecl/EKF] EKF GPS checks passed (WGS-84 origin set)\r\npxh> commander takeoff\r\nERROR [commander] rejecting takeoff, no position lock yet. Please retry..\r\nCommand 'commander' failed, returned 1.\r\npxh> INFO  [ecl/EKF] EKF commencing GPS fusion\r\npxh> commander takeoff\r\nERROR [commander] rejecting takeoff, no position lock yet. Please retry..\r\nCommand 'commander' failed, returned 1.\r\npxh> commander takeoff\r\npxh> WARN  [navigator] Already higher than takeoff altitude\r\nINFO  [logger] closed logfile, bytes written: 1644561\r\n```\r\n\r\nhttps://logs.px4.io/plot_app?log=86eed90e-0e5c-41a7-bd3a-47daf256458c",
  "state": "open",
  "pull_request": null
}
{
  "title": "altitude mode not failing, when all height sources are missing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12074",
  "body": "When flying in Altitude mode and all height sources failed (GPS and Baro), PX4 does not switch to stabilized mode but stays in altitude mode, which is obviously not possible to achieve any more. (Only tested in jmavsim STIL)\n\n**To Reproduce**\nSteps to reproduce the behavior:\n\n1. Start jmavsim SITL simulation with QGroundControl (with on screen RC inputs enabled or using a RC via USB/ Serial)\n1. type `commander takeoff` in the PX4 shell\n1. the vehicle takes off and holds position\n1. change to position mode in QGC\n1. type `gpssim stop` in the PX4 shell\n1. PX4 switches from position mode to altitude\n1. stop/ disable the barometer (`barosim stop` in the PX4 shell)\n1. PX4 stays in altitude mode\n1. (I switched to manual to be able to land the vehicle and then disarmed/ emergency stopped in QGC)\n\nThe issue is the same, if the barometer fails first (then PX4 will do a failover to GPS height) and GPS is turned off second.\n\n**Expected behavior**\nPX4 should switch from altitude to stabilized or at least print a warning in QGC.\n\n**Log Files and Screenshots**\nhttps://logs.px4.io/plot_app?log=0d53ff6b-2cb8-4955-8940-05f1bb611fff\n(I still had a patch running, that disables the magnetometer, so there is no mag data. But this does not affect the issue.)\n\n**Additional context**\nHere is my patch which adds a `stop` command to the `barosim`:\n\n```patch\ndiff --git a/src/modules/simulator/barosim/baro.cpp b/src/modules/simulator/barosim/baro.cpp\nindex 86a370fbac..6d263a39b9 100644\n--- a/src/modules/simulator/barosim/baro.cpp\n+++ b/src/modules/simulator/barosim/baro.cpp\n@@ -308,7 +308,7 @@ info()\nstatic void\nusage()\n{\n- PX4_WARN(\"missing command: try 'start', 'info'\");\n+ PX4_WARN(\"missing command: try 'start', 'stop', 'info'\");\n}\n\n}; // namespace barosim\n@@ -332,6 +332,16 @@ barosim_main(int argc, char *argv[])\nret = barosim::start();\n}\n\n+ else if (!strcmp(verb, \"stop\")) {\n+ if (g_barosim != nullptr) {\n+ delete g_barosim;\n+ g_barosim = nullptr;\n+ } else {\n+ PX4_WARN(\"already stopped.\");\n+ }\n+ ret = 0;\n+ }\n+\n/*\n* Print driver information.\n*/\n```\n\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "FW review RTL loiter behaviour",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/12035",
  "body": "From https://discuss.px4.io/t/plane-flyaway-recovery-rtl-loiter-then-flew-away/10991.\n\nhttps://logs.px4.io/plot_app?log=a204d10b-a40d-4c05-9bb6-6f2c23bf574c\n\n> I found that putting a FIXED WING LANDING PATTERN in the mission FROM the preset â€œpatternâ€ icon/button, then setting the RTL mode to head for the landing 1st (NOT head directly to home), causes the plane to go to that loiter-to-land pattern and subsequently line up to the runway and land correctly. That preset FW landing pattern is very nice - much nicer than basic waypoint and land. thx to the coder!\n> .\n> However, even with this fw landing pattern in place and working as such, if i tried to use the RTL mode that just flies directly to home, with the RTL conditions set to loiter for (time) 45sec then land, the plane would loiter for 45secs, then proceed to fly away in the direction of its choice. BUG!\n> .\n\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Problem with MAVLINK_MSG_ID_HIL_ACTUATOR_CONTROLS",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11697",
  "body": "**Repro**: run [AirSim](https://github.com/Microsoft/AirSim) with latest v1.8.2 firmware on Pixhawk v2 in HIL_QUADROCOPTER_X mode.  Try and take off, nothing happens, rotors do not spin.\n\nThe PX4 status shows MAV_MODE_FLAG_HIL_ENABLED and AirSim is getting MAVLINK_MSG_ID_HIL_ACTUATOR_CONTROLS , but the actuator control values in the message are all zeros all the time even when my RC radio throttle is set to full.\n\nSee my [px4 log file](https://logs.px4.io/plot_app?log=b69e4688-8dd7-43d9-b965-6c2d1bea2aab).  You can see my manual Throttle input in \"Manual Control Inputs\" graph - but these throttle values are not making it out to the HIL_ACTUATOR_CONTROLS message.\n\nIf I move my Pixhawk back to version 1.7.0 of the PX4 Firmware then everything works fine.  Has something changed recently in the mavlink protocol with PX4 in this area?  \n\nNote that if I also connect to nuttx shell the commander seems happy enough, but still sending no actuator controls to AirSim:\n```\nnsh> commander status\ncommander status\nWARN  [commander] type: symmetric motion\nWARN  [commander] safety: USB enabled: [OK], power state valid:  [OK]\nWARN  [commander] home: lat = 47.6728307, lon = -122.1229818, alt = NaN, yaw: 0.08\nWARN  [commander] home: x = 0.0055329, y = 0.0004450, z = NaN\nWARN  [commander] datalink: OK\nWARN  [commander] main state: 11\nWARN  [commander] nav state: 18\nWARN  [commander] arming: STANDBY\nnsh> commander arm\ncommander arm\nnsh> STATUS: sev=6, 'ARMED by command line'\nSTATUS: sev=6, '[logger] file: /fs/microsd/log/2019-03-21/21_00_2'\ncommander takeoff\ncommander takeoff\nnsh> STATUS: sev=6, 'Using minimum takeoff altitude: 2.50 m'\n    PX4_CUSTOM_MAIN_MODE_AUTO\n    PX4_CUSTOM_SUB_MODE_AUTO_TAKEOFF\ncommander land\ncommander land\nnsh> STATUS: sev=6, 'Landing at current position'\ncom    PX4_CUSTOM_MAIN_MODE_AUTO\n    PX4_CUSTOM_SUB_MODE_AUTO_LAND\ncommander disarm\nnsh> STATUS: sev=6, 'DISARMED by command line'\n```\n\npx4 parameters: [params.zip](https://github.com/PX4/Firmware/files/2993971/params.zip)\n\nNote: the same scenario works fine with v1.8.2 SITL build of PX4.  So something different with HITL...",
  "state": "open",
  "pull_request": null
}
{
  "title": "vtol front transition height drop",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11467",
  "body": "I use 1.8.1 code. When the VTOL conversion is completed, the throttle drops and the plane drops. The given pitch is positive, but the actual pitch is negative. It takes a while for the pitch to rise again. Does anyone know how to debug it?The log is on\n[https://logs.px4.io/plot_app?log=d1482f4d-880f-48fa-aca3-023fddb0eed5](http://url)\nThanks!\n\n",
  "state": "open",
  "pull_request": null
}
{
  "title": "Tailsitter throttle drops to 0 after forward transition.",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/11220",
  "body": "**Describe the bug**\nThrottle output thrust drop to 0 (zero) after forward FW transition is completed in any mode that has auto throttle control. This happens randomly, some flight does, some flight don't. Same configuration, same aircraft, same location.\n\nRight after forward transition, the aircraft dropped throttle output from forward transition throttle value to zero as shown on the log below. \nhttps://logs.px4.io/plot_app?log=5f2f02c7-d2bd-4ff3-9d10-c48c87272d2f\n\n![throttle drop1](https://user-images.githubusercontent.com/2929677/51170909-268d9800-18e2-11e9-84b2-8bf6c784387e.png)\n\nThis behavior also occurred in any other mode that has auto throttle control (Altitude, Position) but does not always occur on every flight. The log below is the flight without this behavior.\nhttps://logs.px4.io/plot_app?log=4eed6594-9aaf-4026-a571-202857b4c387\n\n![throttle not drop](https://user-images.githubusercontent.com/2929677/51170920-30170000-18e2-11e9-8a4d-04d18d5eb008.png)\n\nBesides the above log which is from an actual flight test, we also conducted bench test in position mode to reproduce this behavior. The throttle drop also occurred in the same way as the actual flight test. The logs from bench test are presented below.\n\n**To Reproduce**\nSteps to reproduce the behavior (on bench-test):\n1. Put the aircraft in position mode (multi-rotor).\n2. Arm the aircraft.\n3. Raise throttle input to be above 50%.\n4. Raise the aircraft itself by hand.\n5. Flip the transition switch from MC to FW.\n6. Flip the aircraft from vertical to horizontal orientation (this is a tailsitter) \n7. Accelerate the airflow in the front of the aircraft from 0 m/s to transition airspeed gradually.\n8. Aircraft should switch from MC to FW and throttle should drops to zero.\n\n**Expected behavior**\nThrottle should not drop to zero and causing it to be uncontrollable.\n\n**Log Files and Screenshots**\nFirst figure (throttle drop): https://logs.px4.io/plot_app?log=5f2f02c7-d2bd-4ff3-9d10-c48c87272d2f\n2nd figure (throttle not drop): https://logs.px4.io/plot_app?log=4eed6594-9aaf-4026-a571-202857b4c387\nBench-test attempt\nAttempt1: https://logs.px4.io/plot_app?log=cade9885-e8c0-48e0-a730-1658fb1c69c4\nAttempt2: https://logs.px4.io/plot_app?log=e38fdf1f-58cd-4fd9-8ce1-a964cee2b72e\nAttempt3: https://logs.px4.io/plot_app?log=2ac76818-9c41-4b5e-b865-1a74b5623578\nAttempt4: https://logs.px4.io/plot_app?log=fe89ef0b-9b6d-4473-8810-911d028d638d\nAttempt5 (w/o drop) : https://logs.px4.io/plot_app?log=ebd3c67a-2ebf-4028-ac8d-216dc5e25822\n\n**Drone:**\nAirframe config: Duo Tailsitter\n\n![bat-electronicsdiagram](https://user-images.githubusercontent.com/2929677/51171068-78362280-18e2-11e9-9a99-d8721863ed69.png)\n\n![img_6755 resized](https://user-images.githubusercontent.com/2929677/51171775-550c7280-18e4-11e9-8ae3-417ab1ce65e6.JPG)",
  "state": "open",
  "pull_request": null
}
{
  "title": "Magnetometer Calibration seems not possible for external MAG on CAN Bus",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10621",
  "body": "**Describe the bug**\nI always have inconsistent magnetometers, despite many calibration dances\n\nLooking at the parameter settings there are no calibration settings for the external mag\n![image](https://user-images.githubusercontent.com/30323691/46333687-902eb280-c621-11e8-8883-1d0eba29b60e.png)\n\n\n**To Reproduce**\nSteps to reproduce the behavior:\n1. Drone switched on '...'\n2. Uploaded mission '....' (attach QGC mission file)\n3. Took off '....'\n4. See error\n\n**Expected behavior**\nA clear and concise description of what you expected to happen.\n\n**Log Files and Screenshots**\n*Always* provide a link to the flight log file:\n- Download the flight log file from the vehicle ([tutorial](https://docs.px4.io/en/getting_started/flight_reporting.html)).\n- Share the link to a log showing the problem on [PX4 Flight Review](http://logs.px4.io/).\n\nAdd screenshots to help explain your problem.\n\n**Drone (please complete the following information):**\n- Describe the type of drone.\n- Photo of the IMU / autopilot setup if possible.\n\n**Additional context**\nAdd any other context about the problem here.",
  "state": "open",
  "pull_request": null
}
{
  "title": "Large negative Pitch Setpoint at takeoff, hand launched Fixed Wing",
  "html_url": "https://github.com/PX4/PX4-Autopilot/issues/10076",
  "body": "Most of our fixed wing flight logs show a large negative step input to the pitch command right at Takeoff.  I think the \"minimum pitch\" param in the Takeoff Waypoint overrides this, but behind the scenes something is wrong.\n\nI've seen users attempt to auto-takeoff to a non-Takeoff Waypoint and the vehicle immediately noses into the ground.\n\nI suspect some bad interactions between LandDetector and typical ground handling of hand launched fixed wings, but I'm not sure what exactly...  (fyi @dagar we discussed previously).\n\n![image](https://user-images.githubusercontent.com/12117027/43370412-3c14b920-9344-11e8-8599-5b2aa06673f4.png)\n\nHere are a number of logs that show this issue right at Takeoff:\nhttps://review.px4.io/plot_app?log=80301c1d-fac9-4a8a-a5e1-870927233e64\nhttps://review.px4.io/plot_app?log=6f7119a2-c6c3-4d0c-88e5-8debcf59e88f\nhttps://review.px4.io/plot_app?log=a8b193bc-f3d7-4cab-ae3e-ba0302c1834b\nhttps://review.px4.io/plot_app?log=13dcbb27-7d97-49d4-94d3-0f092d283c7c\n\nRelated PR that attempts to improve Fixed Wing takeoff, might need to look into the root cause of this issue here:\nhttps://github.com/PX4/Firmware/pull/9243",
  "state": "open",
  "pull_request": null
}
